const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-CoBdcKs7.js","./index-ByHJ9eWM.js","./index-DgbYwIvn.js","./index-DnVQsUKD.css","./SelectTrigger.vue_vue_type_script_setup_true_lang-Cma0zh5R.js","./Input.vue_vue_type_script_setup_true_lang-9lKhZL8M.js","./AlertDialogTitle.vue_vue_type_script_setup_true_lang-D9beM2gr.js","./Label.vue_vue_type_script_setup_true_lang-DiM_UGrc.js","./refresh-ccw-Dhr5OiqT.js","./_plugin-vue_export-helper-DlAUqK2U.js","./index-B71Wb_qo.js","./index-3pL4yDd7.js","./index-Bj0L4Za6.js","./index-UQjh9F23.js","./index-2aCpt5ux.js","./index-ehJIvk1g.js","./index-DT8Hmtjo.js","./index-DZhRMKXa.js","./index-CWQp13jX.js","./index-DFX7lOOU.js","./index-E9SIhi8b.js","./index-DwbOYRBb.js","./index-CcuegdXj.js","./index-Bh6poQ78.js","./index-CPX9qP5g.js","./index-CYLSigZA.js","./index-CfaQeutw.js","./dockerfile-BuNIbK2j.js","./simple-mode-C4Nsj8zu.js","./factor-D8pE9siL.js","./nsis-CEAdamBV.js","./pug-BmUsPMDj.js","./javascript-iSgyE4tI.js","./index-CRcCKETb.js","./index-CiQB8x9P.js"])))=>i.map(i=>d[i]);
var Pe=Object.defineProperty;var Oe=(pe,r,e)=>r in pe?Pe(pe,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):pe[r]=e;var ge=(pe,r,e)=>Oe(pe,typeof r!="symbol"?r+"":r,e);import{d as defineComponent,B as xe,o as openBlock,f as createBlock,w as withCtx,x as renderSlot,C as normalizeProps,D as guardReactiveProps,g as unref,T as zg,q as computed,a as createVNode,G as mergeProps,A as cn,U as Hg,V as jg,W as Kg,Y as Tg,b as createLucideIcon,Z as Gy,_ as Qy,$ as Mv,a0 as _mitt,z,a1 as BLOCK_CONTENT_TYPES,Q as watch,a2 as useEventBus,a3 as shallowRef,a4 as shallowReactive,a5 as createContext,a6 as useLocalStorage,e as ref,a7 as BLOCK_INFO_DOC_NAME,a8 as BLOCK_DATA_DOC_NAME_PREFIX,a9 as toRaw,aa as useRouterParams,S as ServerInfoContext,ab as nextTick,ac as readonly,ad as useTaskQueue,m as useDebounceFn,ae as useRoute,v as usePostApi,R as RESP_CODES,af as RespSchema,ag as reactive,ah as mergeModels,ai as useModel,aj as onMounted,ak as onUnmounted,c as createElementBlock,al as ys,am as ws,an as bs,ao as gs,u as useToast,p as useI18n,ap as h,i as createBaseVNode,j as isRef,l as renderList,F as Fragment$1,t as toDisplayString,k as createCommentVNode,y as normalizeClass,aq as onBeforeUnmount,ar as onBeforeMount,as as __vitePreload,at as ThemeContext,au as sh,av as uh,aw as ih,ax as fh,J as At,ay as ch$1,az as bh,aA as Ch,aB as wh,aC as rh,h as createTextVNode,aD as normalizeStyle,aE as Vy,aF as My,aG as ky,aH as Fy,aI as Oy,aJ as O,aK as useThrottleFn,s as timeout,X,aL as withModifiers,aM as hg,aN as mg,aO as provide,aP as Ss,aQ as inject,aR as useVModel,aS as Kv,aT as zv,aU as BLOCK_TYPE_ZH_NAMES,aV as Wu,aW as Zu,aX as Hu,aY as Yu,aZ as qu,a_ as Xu,a$ as ju,b0 as zu,b1 as Ku,b2 as Uu,b3 as Gu,b4 as Lu,b5 as resolveDynamicComponent,b6 as om,b7 as rm$2,b8 as sm,b9 as lm,ba as _sfc_main$1$,bb as Teleport,bc as Transition,bd as ji,be as qi,bf as Ui,r as resolveComponent,bg as syncRef,__tla as __tla_0}from"./index-DgbYwIvn.js";import{f as fetchWebpageTitle,_ as _sfc_main$1N,a as _sfc_main$1O,b as _sfc_main$1P,c as _sfc_main$1Q,C as ChevronDown}from"./SelectTrigger.vue_vue_type_script_setup_true_lang-Cma0zh5R.js";import{b as buttonVariants,_ as _sfc_main$1H,L as LoaderCircle,a as _sfc_main$1I,C as Check}from"./Input.vue_vue_type_script_setup_true_lang-9lKhZL8M.js";import{T as Trash2,_ as _sfc_main$1J,a as _sfc_main$1K,b as _sfc_main$1L,c as _sfc_main$1R,d as _sfc_main$1S,e as _sfc_main$1T,g as _sfc_main$1U,h as _sfc_main$1V,i as _sfc_main$1W,j as _sfc_main$1X,k as _sfc_main$1Y,f as _sfc_main$1Z,l as _sfc_main$1_,P as Plus,L as LogOut}from"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-D9beM2gr.js";import{_ as _sfc_main$1M}from"./Label.vue_vue_type_script_setup_true_lang-DiM_UGrc.js";import{R as RefreshCcw}from"./refresh-ccw-Dhr5OiqT.js";import{_ as _export_sfc}from"./_plugin-vue_export-helper-DlAUqK2U.js";let languageDataProp,foldService,CompletionContext,LanguageDescription,EditorView,ParseContext,bracketMatchingHandle,DefaultBufferLength,IterMode,sublanguageProp,KbView,LRLanguage,NodeWeakMap,Parser$1,Tag,LanguageSupport,ifNotIn,continuedIndent,completeFromList,syntaxTree,foldNodeProp,flatIndent,delimitedIndent,indentNodeProp,foldInside,snippetCompletion,EditorSelection,NodeType,NodeProp,NodeSet,parseMixed,Tree,countColumn,styleTags,tags,Prec,keymap,EditorState,Language,indentUnit,defineLanguageFacet,__tla=Promise.all([(()=>{try{return __tla_0}catch{}})()]).then(async()=>{const _sfc_main$1G=defineComponent({__name:"Tooltip",props:{defaultOpen:{type:Boolean},open:{type:Boolean},delayDuration:{},disableHoverableContent:{type:Boolean},disableClosingTrigger:{type:Boolean},disabled:{type:Boolean},ignoreNonKeyboardFocus:{type:Boolean}},emits:["update:open"],setup(r,{emit:e}){const n=xe(r,e);return(o,s)=>(openBlock(),createBlock(unref(zg),normalizeProps(guardReactiveProps(unref(n))),{default:withCtx(()=>[renderSlot(o.$slots,"default")]),_:3},16))}}),_sfc_main$1F=defineComponent({inheritAttrs:!1,__name:"TooltipContent",props:{forceMount:{type:Boolean},ariaLabel:{},asChild:{type:Boolean},as:{},side:{},sideOffset:{default:4},align:{},alignOffset:{},avoidCollisions:{type:Boolean},collisionBoundary:{},collisionPadding:{},arrowPadding:{},sticky:{},hideWhenDetached:{type:Boolean},class:{}},emits:["escapeKeyDown","pointerDownOutside"],setup(r,{emit:e}){const n=r,o=e,s=computed(()=>{const{class:l,...c}=n;return c}),a=xe(s,o);return(l,c)=>(openBlock(),createBlock(unref(jg),null,{default:withCtx(()=>[createVNode(unref(Hg),mergeProps({...unref(a),...l.$attrs},{class:unref(cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n.class)}),{default:withCtx(()=>[renderSlot(l.$slots,"default")]),_:3},16,["class"])]),_:3}))}}),_sfc_main$1E=defineComponent({__name:"TooltipTrigger",props:{asChild:{type:Boolean},as:{}},setup(r){const e=r;return(n,o)=>(openBlock(),createBlock(unref(Kg),normalizeProps(guardReactiveProps(e)),{default:withCtx(()=>[renderSlot(n.$slots,"default")]),_:3},16))}}),_sfc_main$1D=defineComponent({__name:"ToastAction",props:{altText:{},asChild:{type:Boolean},as:{},class:{}},setup(r){const e=r,n=computed(()=>{const{class:o,...s}=e;return s});return(o,s)=>(openBlock(),createBlock(unref(Tg),mergeProps(n.value,{class:unref(cn)("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",e.class)}),{default:withCtx(()=>[renderSlot(o.$slots,"default")]),_:3},16,["class"]))}}),ArrowDownAZ=createLucideIcon("ArrowDownAZIcon",[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"M20 8h-5",key:"1vsyxs"}],["path",{d:"M15 10V6.5a2.5 2.5 0 0 1 5 0V10",key:"ag13bf"}],["path",{d:"M15 14h5l-5 6h5",key:"ur5jdg"}]]),ArrowDownFromLine=createLucideIcon("ArrowDownFromLineIcon",[["path",{d:"M19 3H5",key:"1236rx"}],["path",{d:"M12 21V7",key:"gj6g52"}],["path",{d:"m6 15 6 6 6-6",key:"h15q88"}]]),ArrowLeft=createLucideIcon("ArrowLeftIcon",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),ArrowRightFromLine=createLucideIcon("ArrowRightFromLineIcon",[["path",{d:"M3 5v14",key:"1nt18q"}],["path",{d:"M21 12H7",key:"13ipq5"}],["path",{d:"m15 18 6-6-6-6",key:"6tx3qv"}]]),ArrowRight=createLucideIcon("ArrowRightIcon",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),ArrowUpAZ=createLucideIcon("ArrowUpAZIcon",[["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}],["path",{d:"M20 8h-5",key:"1vsyxs"}],["path",{d:"M15 10V6.5a2.5 2.5 0 0 1 5 0V10",key:"ag13bf"}],["path",{d:"M15 14h5l-5 6h5",key:"ur5jdg"}]]),ArrowUpNarrowWide=createLucideIcon("ArrowUpNarrowWideIcon",[["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}],["path",{d:"M11 12h4",key:"q8tih4"}],["path",{d:"M11 16h7",key:"uosisv"}],["path",{d:"M11 20h10",key:"jvxblo"}]]),Bell=createLucideIcon("BellIcon",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),Blend=createLucideIcon("BlendIcon",[["circle",{cx:"9",cy:"9",r:"7",key:"p2h5vp"}],["circle",{cx:"15",cy:"15",r:"7",key:"19ennj"}]]),Bookmark=createLucideIcon("BookmarkIcon",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]),CalendarArrowDown=createLucideIcon("CalendarArrowDownIcon",[["path",{d:"m14 18 4 4 4-4",key:"1waygx"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M18 14v8",key:"irew45"}],["path",{d:"M21 11.354V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h7.343",key:"bse4f3"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 2v4",key:"1cmpym"}]]),CalendarArrowUp=createLucideIcon("CalendarArrowUpIcon",[["path",{d:"m14 18 4-4 4 4",key:"ftkppy"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M18 22v-8",key:"su0gjh"}],["path",{d:"M21 11.343V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h9",key:"1exg90"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 2v4",key:"1cmpym"}]]),CalendarDays=createLucideIcon("CalendarDaysIcon",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]),ChevronLeft=createLucideIcon("ChevronLeftIcon",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),ChevronRight=createLucideIcon("ChevronRightIcon",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),CircleHelp=createLucideIcon("CircleHelpIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Circle=createLucideIcon("CircleIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),Clipboard=createLucideIcon("ClipboardIcon",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}]]),Command=createLucideIcon("CommandIcon",[["path",{d:"M15 6v12a3 3 0 1 0 3-3H6a3 3 0 1 0 3 3V6a3 3 0 1 0-3 3h12a3 3 0 1 0-3-3",key:"11bfej"}]]),Copy=createLucideIcon("CopyIcon",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),Database=createLucideIcon("DatabaseIcon",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),Delete=createLucideIcon("DeleteIcon",[["path",{d:"M10 5a2 2 0 0 0-1.344.519l-6.328 5.74a1 1 0 0 0 0 1.481l6.328 5.741A2 2 0 0 0 10 19h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2z",key:"1yo7s0"}],["path",{d:"m12 9 6 6",key:"anjzzh"}],["path",{d:"m18 9-6 6",key:"1fp51s"}]]),Diamond=createLucideIcon("DiamondIcon",[["path",{d:"M2.7 10.3a2.41 2.41 0 0 0 0 3.41l7.59 7.59a2.41 2.41 0 0 0 3.41 0l7.59-7.59a2.41 2.41 0 0 0 0-3.41l-7.59-7.59a2.41 2.41 0 0 0-3.41 0Z",key:"1f1r0c"}]]),Dot=createLucideIcon("DotIcon",[["circle",{cx:"12.1",cy:"12.1",r:"1",key:"18d7e5"}]]),Download=createLucideIcon("DownloadIcon",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),EllipsisVertical=createLucideIcon("EllipsisVerticalIcon",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),Ellipsis=createLucideIcon("EllipsisIcon",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]),Eye=createLucideIcon("EyeIcon",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),FileScan=createLucideIcon("FileScanIcon",[["path",{d:"M20 10V7l-5-5H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4",key:"1rdf37"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M16 14a2 2 0 0 0-2 2",key:"ceaadl"}],["path",{d:"M20 14a2 2 0 0 1 2 2",key:"1ny6zw"}],["path",{d:"M20 22a2 2 0 0 0 2-2",key:"1l9q4k"}],["path",{d:"M16 22a2 2 0 0 1-2-2",key:"1wqh5n"}]]),File=createLucideIcon("FileIcon",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]),FlipHorizontal=createLucideIcon("FlipHorizontalIcon",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h3",key:"1i73f7"}],["path",{d:"M16 3h3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-3",key:"saxlbk"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 14v2",key:"8jcxud"}],["path",{d:"M12 8v2",key:"1woqiv"}],["path",{d:"M12 2v2",key:"tus03m"}]]),Focus=createLucideIcon("FocusIcon",[["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]]),FolderClosed=createLucideIcon("FolderClosedIcon",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}],["path",{d:"M2 10h20",key:"1ir3d8"}]]),FolderInput=createLucideIcon("FolderInputIcon",[["path",{d:"M2 9V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H20a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-1",key:"fm4g5t"}],["path",{d:"M2 13h10",key:"pgb2dq"}],["path",{d:"m9 16 3-3-3-3",key:"6m91ic"}]]),Folder=createLucideIcon("FolderIcon",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]),History=createLucideIcon("HistoryIcon",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),Image$1=createLucideIcon("ImageIcon",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),Info=createLucideIcon("InfoIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),Kanban=createLucideIcon("KanbanIcon",[["path",{d:"M6 5v11",key:"mdvv1e"}],["path",{d:"M12 5v6",key:"14ar3b"}],["path",{d:"M18 5v14",key:"7ji314"}]]),Link2=createLucideIcon("Link2Icon",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]),Link=createLucideIcon("LinkIcon",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),ListTree=createLucideIcon("ListTreeIcon",[["path",{d:"M21 12h-8",key:"1bmf0i"}],["path",{d:"M21 6H8",key:"1pqkrb"}],["path",{d:"M21 18h-8",key:"1tm79t"}],["path",{d:"M3 6v4c0 1.1.9 2 2 2h3",key:"1ywdgy"}],["path",{d:"M3 10v6c0 1.1.9 2 2 2h3",key:"2wc746"}]]),List=createLucideIcon("ListIcon",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]),MessageSquareMore=createLucideIcon("MessageSquareMoreIcon",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M16 10h.01",key:"1m94wz"}]]),Moon=createLucideIcon("MoonIcon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]),Paintbrush=createLucideIcon("PaintbrushIcon",[["path",{d:"m14.622 17.897-10.68-2.913",key:"vj2p1u"}],["path",{d:"M18.376 2.622a1 1 0 1 1 3.002 3.002L17.36 9.643a.5.5 0 0 0 0 .707l.944.944a2.41 2.41 0 0 1 0 3.408l-.944.944a.5.5 0 0 1-.707 0L8.354 7.348a.5.5 0 0 1 0-.707l.944-.944a2.41 2.41 0 0 1 3.408 0l.944.944a.5.5 0 0 0 .707 0z",key:"18tc5c"}],["path",{d:"M9 8c-1.804 2.71-3.97 3.46-6.583 3.948a.507.507 0 0 0-.302.819l7.32 8.883a1 1 0 0 0 1.185.204C12.735 20.405 16 16.792 16 15",key:"ytzfxy"}]]),PanelLeft=createLucideIcon("PanelLeftIcon",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}]]),PanelRight=createLucideIcon("PanelRightIcon",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M15 3v18",key:"14nvp0"}]]),PanelsTopLeft=createLucideIcon("PanelsTopLeftIcon",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M9 21V9",key:"1oto5p"}]]),RefreshCw=createLucideIcon("RefreshCwIcon",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),Search=createLucideIcon("SearchIcon",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),Settings$1=createLucideIcon("SettingsIcon",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),SlidersHorizontal=createLucideIcon("SlidersHorizontalIcon",[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]]),Sun=createLucideIcon("SunIcon",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]),Table=createLucideIcon("TableIcon",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]),Triangle=createLucideIcon("TriangleIcon",[["path",{d:"M13.73 4a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"14u9p9"}]]),Upload=createLucideIcon("UploadIcon",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),_sfc_main$1C=defineComponent({__name:"SelectGroup",props:{asChild:{type:Boolean},as:{},class:{}},setup(r){const e=r,n=computed(()=>{const{class:o,...s}=e;return s});return(o,s)=>(openBlock(),createBlock(unref(Gy),mergeProps({class:unref(cn)("p-1 w-full",e.class)},n.value),{default:withCtx(()=>[renderSlot(o.$slots,"default")]),_:3},16,["class"]))}}),_sfc_main$1B=defineComponent({__name:"SelectValue",props:{placeholder:{},asChild:{type:Boolean},as:{}},setup(r){const e=r;return(n,o)=>(openBlock(),createBlock(unref(Qy),normalizeProps(guardReactiveProps(e)),{default:withCtx(()=>[renderSlot(n.$slots,"default")]),_:3},16))}}),_sfc_main$1A=defineComponent({__name:"AlertDialogAction",props:{asChild:{type:Boolean},as:{},class:{}},setup(r){const e=r,n=computed(()=>{const{class:o,...s}=e;return s});return(o,s)=>(openBlock(),createBlock(unref(Mv),mergeProps(n.value,{class:unref(cn)(unref(buttonVariants)(),e.class)}),{default:withCtx(()=>[renderSlot(o.$slots,"default")]),_:3},16,["class"]))}}),createPromise=()=>{let r;return{promise:new Promise(e=>{r=e}),resolve:r}},createSyncLayer=()=>{const r=_mitt(),{promise:e,resolve:n}=createPromise(),o=new Worker(new URL(""+new URL("syncWorker-Bv7l7MDY.js",import.meta.url).href,import.meta.url),{type:"module"});o.addEventListener("message",p=>{const g=p.data;if(g.type==="init"){n(void 0);return}console.debug("[syncLayer] Received message from syncWorker:",g),r.emit(g.type,g)});const s=p=>{(async()=>(await e,o.postMessage(p)))()},a=(p,g,y)=>{s({type:"connect",serverUrl:p,location:g,token:y})},l=()=>{s({type:"disconnect"})},c=p=>{s({type:"loadDataDoc",docId:p})},d=p=>{s({type:"unloadDataDoc",docId:p})},u=p=>{s({type:"_printBlockInfo",blockId:p})},m=(p,g)=>{s({type:"_printBlockData",docId:p,blockId:g})},f=p=>{const g={_tr:{patches:[],origin:p},upsertBlockInfo:(y,b)=>{g._tr.patches.push({op:"upsertBlockInfo",blockId:y,blockInfo:b})},deleteBlockInfo:y=>{g._tr.patches.push({op:"deleteBlockInfo",blockId:y})},upsertBlockData:(y,b,k)=>{g._tr.patches.push({op:"upsertBlockData",docId:y,blockId:b,blockData:k})},deleteBlockData:(y,b)=>{g._tr.patches.push({op:"deleteBlockData",docId:y,blockId:b})},commit:()=>{g._tr.patches.length!==0&&s({type:"postYjsLayerTransaction",transaction:g._tr})}};return g};return{connect:a,disconnect:l,on:r.on,off:r.off,createSyncLayerTransaction:f,loadDataDoc:c,unloadDataDoc:d,_printBlockInfo:u,_printBlockData:m}},extractBlockStatus=r=>{const e=r&3,n=r&4;return{type:e==0?"normalBlock":e==1?"mirrorBlock":"virtualBlock",fold:n!=0}},calcBlockStatus=(r,e)=>(r=="normalBlock"?0:r=="mirrorBlock"?1:2)|(e?4:0),TextContentSchema=z.tuple([z.literal(BLOCK_CONTENT_TYPES.TEXT),z.any()]),ImageFilterSchema=z.enum(["blend","circle","invert","invertW","outline","blendLuminosity"]),ImageContentSchema=z.tuple([z.literal(BLOCK_CONTENT_TYPES.IMAGE),z.string(),z.enum(["left","center"]),z.string().nullable(),z.number().nullable(),z.array(ImageFilterSchema).nullable()]);z.tuple([z.literal(BLOCK_CONTENT_TYPES.CAROUSEL),z.array(z.string()),z.string().nullable(),z.number().nullable(),z.array(ImageFilterSchema).nullable()]);const CodeContentSchema=z.tuple([z.literal(BLOCK_CONTENT_TYPES.CODE),z.string(),z.string()]),MathDisplayContentSchema=z.tuple([z.literal(BLOCK_CONTENT_TYPES.MATH),z.string()]),QueryContentSchema=z.tuple([z.literal(BLOCK_CONTENT_TYPES.QUERY),z.any(),z.string(),z.boolean(),z.boolean()]),BlockContentSchema=z.union([TextContentSchema,ImageContentSchema,CodeContentSchema,MathDisplayContentSchema,QueryContentSchema]);z.tuple([BlockContentSchema.nullable(),z.record(z.any())]);const BlockIdSchema=z.string(),BlockStatusSchema=z.number().min(0).max(5);z.tuple([BlockStatusSchema,BlockIdSchema,z.array(BlockIdSchema),z.number().nullable(),BlockIdSchema.nullable()]);const getPlatform=()=>{const r=globalThis.process;if(typeof r<"u"&&r.platform)switch(r.platform){case"win32":return"win32";case"darwin":return"macos";case"linux":return"linux";default:throw new Error("Unsupported platform")}if(typeof navigator<"u"){const e=navigator.platform.toLowerCase();if(e.includes("win"))return"win32";if(e.includes("mac"))return"macos";if(e.includes("linux"))return"linux";throw new Error("Unsupported platform")}throw new Error("Platform detection failed")},getSeperator=()=>getPlatform()==="win32"?"\\":"/",getPathSegments=r=>r.split(getSeperator()),joinPathSegments=r=>{const e=getSeperator(),n=[];for(const o of r){let s=o;s.startsWith(e)&&(s=s.slice(1)),s.endsWith(e)&&(s=s.slice(0,-1)),s.length!==0&&n.push(s)}return n.join(e)},getBasename=r=>{const e=getPathSegments(r);return e[e.length-1]};function OrderedMap(r){this.content=r}OrderedMap.prototype={constructor:OrderedMap,find:function(r){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===r)return e;return-1},get:function(r){var e=this.find(r);return e==-1?void 0:this.content[e+1]},update:function(r,e,n){var o=n&&n!=r?this.remove(n):this,s=o.find(r),a=o.content.slice();return s==-1?a.push(n||r,e):(a[s+1]=e,n&&(a[s]=n)),new OrderedMap(a)},remove:function(r){var e=this.find(r);if(e==-1)return this;var n=this.content.slice();return n.splice(e,2),new OrderedMap(n)},addToStart:function(r,e){return new OrderedMap([r,e].concat(this.remove(r).content))},addToEnd:function(r,e){var n=this.remove(r).content.slice();return n.push(r,e),new OrderedMap(n)},addBefore:function(r,e,n){var o=this.remove(e),s=o.content.slice(),a=o.find(r);return s.splice(a==-1?s.length:a,0,e,n),new OrderedMap(s)},forEach:function(r){for(var e=0;e<this.content.length;e+=2)r(this.content[e],this.content[e+1])},prepend:function(r){return r=OrderedMap.from(r),r.size?new OrderedMap(r.content.concat(this.subtract(r).content)):this},append:function(r){return r=OrderedMap.from(r),r.size?new OrderedMap(this.subtract(r).content.concat(r.content)):this},subtract:function(r){var e=this;r=OrderedMap.from(r);for(var n=0;n<r.content.length;n+=2)e=e.remove(r.content[n]);return e},toObject:function(){var r={};return this.forEach(function(e,n){r[e]=n}),r},get size(){return this.content.length>>1}},OrderedMap.from=function(r){if(r instanceof OrderedMap)return r;var e=[];if(r)for(var n in r)e.push(n,r[n]);return new OrderedMap(e)};function findDiffStart(r,e,n){for(let o=0;;o++){if(o==r.childCount||o==e.childCount)return r.childCount==e.childCount?null:n;let s=r.child(o),a=e.child(o);if(s==a){n+=s.nodeSize;continue}if(!s.sameMarkup(a))return n;if(s.isText&&s.text!=a.text){for(let l=0;s.text[l]==a.text[l];l++)n++;return n}if(s.content.size||a.content.size){let l=findDiffStart(s.content,a.content,n+1);if(l!=null)return l}n+=s.nodeSize}}function findDiffEnd(r,e,n,o){for(let s=r.childCount,a=e.childCount;;){if(s==0||a==0)return s==a?null:{a:n,b:o};let l=r.child(--s),c=e.child(--a),d=l.nodeSize;if(l==c){n-=d,o-=d;continue}if(!l.sameMarkup(c))return{a:n,b:o};if(l.isText&&l.text!=c.text){let u=0,m=Math.min(l.text.length,c.text.length);for(;u<m&&l.text[l.text.length-u-1]==c.text[c.text.length-u-1];)u++,n--,o--;return{a:n,b:o}}if(l.content.size||c.content.size){let u=findDiffEnd(l.content,c.content,n-1,o-1);if(u)return u}n-=d,o-=d}}class Fragment{constructor(e,n){if(this.content=e,this.size=n||0,n==null)for(let o=0;o<e.length;o++)this.size+=e[o].nodeSize}nodesBetween(e,n,o,s=0,a){for(let l=0,c=0;c<n;l++){let d=this.content[l],u=c+d.nodeSize;if(u>e&&o(d,s+c,a||null,l)!==!1&&d.content.size){let m=c+1;d.nodesBetween(Math.max(0,e-m),Math.min(d.content.size,n-m),o,s+m)}c=u}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,n,o,s){let a="",l=!0;return this.nodesBetween(e,n,(c,d)=>{let u=c.isText?c.text.slice(Math.max(e,d)-d,n-d):c.isLeaf?s?typeof s=="function"?s(c):s:c.type.spec.leafText?c.type.spec.leafText(c):"":"";c.isBlock&&(c.isLeaf&&u||c.isTextblock)&&o&&(l?l=!1:a+=o),a+=u},0),a}append(e){if(!e.size)return this;if(!this.size)return e;let n=this.lastChild,o=e.firstChild,s=this.content.slice(),a=0;for(n.isText&&n.sameMarkup(o)&&(s[s.length-1]=n.withText(n.text+o.text),a=1);a<e.content.length;a++)s.push(e.content[a]);return new Fragment(s,this.size+e.size)}cut(e,n=this.size){if(e==0&&n==this.size)return this;let o=[],s=0;if(n>e)for(let a=0,l=0;l<n;a++){let c=this.content[a],d=l+c.nodeSize;d>e&&((l<e||d>n)&&(c.isText?c=c.cut(Math.max(0,e-l),Math.min(c.text.length,n-l)):c=c.cut(Math.max(0,e-l-1),Math.min(c.content.size,n-l-1))),o.push(c),s+=c.nodeSize),l=d}return new Fragment(o,s)}cutByIndex(e,n){return e==n?Fragment.empty:e==0&&n==this.content.length?this:new Fragment(this.content.slice(e,n))}replaceChild(e,n){let o=this.content[e];if(o==n)return this;let s=this.content.slice(),a=this.size+n.nodeSize-o.nodeSize;return s[e]=n,new Fragment(s,a)}addToStart(e){return new Fragment([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new Fragment(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let n=0;n<this.content.length;n++)if(!this.content[n].eq(e.content[n]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let n=this.content[e];if(!n)throw new RangeError("Index "+e+" out of range for "+this);return n}maybeChild(e){return this.content[e]||null}forEach(e){for(let n=0,o=0;n<this.content.length;n++){let s=this.content[n];e(s,o,n),o+=s.nodeSize}}findDiffStart(e,n=0){return findDiffStart(this,e,n)}findDiffEnd(e,n=this.size,o=e.size){return findDiffEnd(this,e,n,o)}findIndex(e,n=-1){if(e==0)return retIndex(0,e);if(e==this.size)return retIndex(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let o=0,s=0;;o++){let a=this.child(o),l=s+a.nodeSize;if(l>=e)return l==e||n>0?retIndex(o+1,l):retIndex(o,s);s=l}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,n){if(!n)return Fragment.empty;if(!Array.isArray(n))throw new RangeError("Invalid input for Fragment.fromJSON");return new Fragment(n.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return Fragment.empty;let n,o=0;for(let s=0;s<e.length;s++){let a=e[s];o+=a.nodeSize,s&&a.isText&&e[s-1].sameMarkup(a)?(n||(n=e.slice(0,s)),n[n.length-1]=a.withText(n[n.length-1].text+a.text)):n&&n.push(a)}return new Fragment(n||e,o)}static from(e){if(!e)return Fragment.empty;if(e instanceof Fragment)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new Fragment([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}Fragment.empty=new Fragment([],0);const found={index:0,offset:0};function retIndex(r,e){return found.index=r,found.offset=e,found}function compareDeep(r,e){if(r===e)return!0;if(!(r&&typeof r=="object")||!(e&&typeof e=="object"))return!1;let n=Array.isArray(r);if(Array.isArray(e)!=n)return!1;if(n){if(r.length!=e.length)return!1;for(let o=0;o<r.length;o++)if(!compareDeep(r[o],e[o]))return!1}else{for(let o in r)if(!(o in e)||!compareDeep(r[o],e[o]))return!1;for(let o in e)if(!(o in r))return!1}return!0}class Mark{constructor(e,n){this.type=e,this.attrs=n}addToSet(e){let n,o=!1;for(let s=0;s<e.length;s++){let a=e[s];if(this.eq(a))return e;if(this.type.excludes(a.type))n||(n=e.slice(0,s));else{if(a.type.excludes(this.type))return e;!o&&a.type.rank>this.type.rank&&(n||(n=e.slice(0,s)),n.push(this),o=!0),n&&n.push(a)}}return n||(n=e.slice()),o||n.push(this),n}removeFromSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return e.slice(0,n).concat(e.slice(n+1));return e}isInSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return!0;return!1}eq(e){return this==e||this.type==e.type&&compareDeep(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Mark.fromJSON");let o=e.marks[n.type];if(!o)throw new RangeError(`There is no mark type ${n.type} in this schema`);let s=o.create(n.attrs);return o.checkAttrs(s.attrs),s}static sameSet(e,n){if(e==n)return!0;if(e.length!=n.length)return!1;for(let o=0;o<e.length;o++)if(!e[o].eq(n[o]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return Mark.none;if(e instanceof Mark)return[e];let n=e.slice();return n.sort((o,s)=>o.type.rank-s.type.rank),n}}Mark.none=[];class ReplaceError extends Error{}class Slice{constructor(e,n,o){this.content=e,this.openStart=n,this.openEnd=o}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,n){let o=insertInto(this.content,e+this.openStart,n);return o&&new Slice(o,this.openStart,this.openEnd)}removeBetween(e,n){return new Slice(removeRange(this.content,e+this.openStart,n+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,n){if(!n)return Slice.empty;let o=n.openStart||0,s=n.openEnd||0;if(typeof o!="number"||typeof s!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new Slice(Fragment.fromJSON(e,n.content),o,s)}static maxOpen(e,n=!0){let o=0,s=0;for(let a=e.firstChild;a&&!a.isLeaf&&(n||!a.type.spec.isolating);a=a.firstChild)o++;for(let a=e.lastChild;a&&!a.isLeaf&&(n||!a.type.spec.isolating);a=a.lastChild)s++;return new Slice(e,o,s)}}Slice.empty=new Slice(Fragment.empty,0,0);function removeRange(r,e,n){let{index:o,offset:s}=r.findIndex(e),a=r.maybeChild(o),{index:l,offset:c}=r.findIndex(n);if(s==e||a.isText){if(c!=n&&!r.child(l).isText)throw new RangeError("Removing non-flat range");return r.cut(0,e).append(r.cut(n))}if(o!=l)throw new RangeError("Removing non-flat range");return r.replaceChild(o,a.copy(removeRange(a.content,e-s-1,n-s-1)))}function insertInto(r,e,n,o){let{index:s,offset:a}=r.findIndex(e),l=r.maybeChild(s);if(a==e||l.isText)return r.cut(0,e).append(n).append(r.cut(e));let c=insertInto(l.content,e-a-1,n);return c&&r.replaceChild(s,l.copy(c))}function replace$2(r,e,n){if(n.openStart>r.depth)throw new ReplaceError("Inserted content deeper than insertion position");if(r.depth-n.openStart!=e.depth-n.openEnd)throw new ReplaceError("Inconsistent open depths");return replaceOuter(r,e,n,0)}function replaceOuter(r,e,n,o){let s=r.index(o),a=r.node(o);if(s==e.index(o)&&o<r.depth-n.openStart){let l=replaceOuter(r,e,n,o+1);return a.copy(a.content.replaceChild(s,l))}else if(n.content.size)if(!n.openStart&&!n.openEnd&&r.depth==o&&e.depth==o){let l=r.parent,c=l.content;return close$1(l,c.cut(0,r.parentOffset).append(n.content).append(c.cut(e.parentOffset)))}else{let{start:l,end:c}=prepareSliceForReplace(n,r);return close$1(a,replaceThreeWay(r,l,c,e,o))}else return close$1(a,replaceTwoWay(r,e,o))}function checkJoin(r,e){if(!e.type.compatibleContent(r.type))throw new ReplaceError("Cannot join "+e.type.name+" onto "+r.type.name)}function joinable(r,e,n){let o=r.node(n);return checkJoin(o,e.node(n)),o}function addNode(r,e){let n=e.length-1;n>=0&&r.isText&&r.sameMarkup(e[n])?e[n]=r.withText(e[n].text+r.text):e.push(r)}function addRange$1(r,e,n,o){let s=(e||r).node(n),a=0,l=e?e.index(n):s.childCount;r&&(a=r.index(n),r.depth>n?a++:r.textOffset&&(addNode(r.nodeAfter,o),a++));for(let c=a;c<l;c++)addNode(s.child(c),o);e&&e.depth==n&&e.textOffset&&addNode(e.nodeBefore,o)}function close$1(r,e){return r.type.checkContent(e),r.copy(e)}function replaceThreeWay(r,e,n,o,s){let a=r.depth>s&&joinable(r,e,s+1),l=o.depth>s&&joinable(n,o,s+1),c=[];return addRange$1(null,r,s,c),a&&l&&e.index(s)==n.index(s)?(checkJoin(a,l),addNode(close$1(a,replaceThreeWay(r,e,n,o,s+1)),c)):(a&&addNode(close$1(a,replaceTwoWay(r,e,s+1)),c),addRange$1(e,n,s,c),l&&addNode(close$1(l,replaceTwoWay(n,o,s+1)),c)),addRange$1(o,null,s,c),new Fragment(c)}function replaceTwoWay(r,e,n){let o=[];if(addRange$1(null,r,n,o),r.depth>n){let s=joinable(r,e,n+1);addNode(close$1(s,replaceTwoWay(r,e,n+1)),o)}return addRange$1(e,null,n,o),new Fragment(o)}function prepareSliceForReplace(r,e){let n=e.depth-r.openStart,o=e.node(n).copy(r.content);for(let s=n-1;s>=0;s--)o=e.node(s).copy(Fragment.from(o));return{start:o.resolveNoCache(r.openStart+n),end:o.resolveNoCache(o.content.size-r.openEnd-n)}}class ResolvedPos{constructor(e,n,o){this.pos=e,this.path=n,this.parentOffset=o,this.depth=n.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,n=this.index(this.depth);if(n==e.childCount)return null;let o=this.pos-this.path[this.path.length-1],s=e.child(n);return o?e.child(n).cut(o):s}get nodeBefore(){let e=this.index(this.depth),n=this.pos-this.path[this.path.length-1];return n?this.parent.child(e).cut(0,n):e==0?null:this.parent.child(e-1)}posAtIndex(e,n){n=this.resolveDepth(n);let o=this.path[n*3],s=n==0?0:this.path[n*3-1]+1;for(let a=0;a<e;a++)s+=o.child(a).nodeSize;return s}marks(){let e=this.parent,n=this.index();if(e.content.size==0)return Mark.none;if(this.textOffset)return e.child(n).marks;let o=e.maybeChild(n-1),s=e.maybeChild(n);if(!o){let c=o;o=s,s=c}let a=o.marks;for(var l=0;l<a.length;l++)a[l].type.spec.inclusive===!1&&(!s||!a[l].isInSet(s.marks))&&(a=a[l--].removeFromSet(a));return a}marksAcross(e){let n=this.parent.maybeChild(this.index());if(!n||!n.isInline)return null;let o=n.marks,s=e.parent.maybeChild(e.index());for(var a=0;a<o.length;a++)o[a].type.spec.inclusive===!1&&(!s||!o[a].isInSet(s.marks))&&(o=o[a--].removeFromSet(o));return o}sharedDepth(e){for(let n=this.depth;n>0;n--)if(this.start(n)<=e&&this.end(n)>=e)return n;return 0}blockRange(e=this,n){if(e.pos<this.pos)return e.blockRange(this);for(let o=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);o>=0;o--)if(e.pos<=this.end(o)&&(!n||n(this.node(o))))return new NodeRange(this,e,o);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let n=1;n<=this.depth;n++)e+=(e?"/":"")+this.node(n).type.name+"_"+this.index(n-1);return e+":"+this.parentOffset}static resolve(e,n){if(!(n>=0&&n<=e.content.size))throw new RangeError("Position "+n+" out of range");let o=[],s=0,a=n;for(let l=e;;){let{index:c,offset:d}=l.content.findIndex(a),u=a-d;if(o.push(l,c,s+d),!u||(l=l.child(c),l.isText))break;a=u-1,s+=d+1}return new ResolvedPos(n,o,a)}static resolveCached(e,n){let o=resolveCache.get(e);if(o)for(let a=0;a<o.elts.length;a++){let l=o.elts[a];if(l.pos==n)return l}else resolveCache.set(e,o=new ResolveCache);let s=o.elts[o.i]=ResolvedPos.resolve(e,n);return o.i=(o.i+1)%resolveCacheSize,s}}class ResolveCache{constructor(){this.elts=[],this.i=0}}const resolveCacheSize=12,resolveCache=new WeakMap;class NodeRange{constructor(e,n,o){this.$from=e,this.$to=n,this.depth=o}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const emptyAttrs=Object.create(null);let Node$1=class _e{constructor(e,n,o,s=Mark.none){this.type=e,this.attrs=n,this.marks=s,this.content=o||Fragment.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,n,o,s=0){this.content.nodesBetween(e,n,o,s,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,n,o,s){return this.content.textBetween(e,n,o,s)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,n,o){return this.type==e&&compareDeep(this.attrs,n||e.defaultAttrs||emptyAttrs)&&Mark.sameSet(this.marks,o||Mark.none)}copy(e=null){return e==this.content?this:new _e(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new _e(this.type,this.attrs,this.content,e)}cut(e,n=this.content.size){return e==0&&n==this.content.size?this:this.copy(this.content.cut(e,n))}slice(e,n=this.content.size,o=!1){if(e==n)return Slice.empty;let s=this.resolve(e),a=this.resolve(n),l=o?0:s.sharedDepth(n),c=s.start(l),d=s.node(l).content.cut(s.pos-c,a.pos-c);return new Slice(d,s.depth-l,a.depth-l)}replace(e,n,o){return replace$2(this.resolve(e),this.resolve(n),o)}nodeAt(e){for(let n=this;;){let{index:o,offset:s}=n.content.findIndex(e);if(n=n.maybeChild(o),!n)return null;if(s==e||n.isText)return n;e-=s+1}}childAfter(e){let{index:n,offset:o}=this.content.findIndex(e);return{node:this.content.maybeChild(n),index:n,offset:o}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:n,offset:o}=this.content.findIndex(e);if(o<e)return{node:this.content.child(n),index:n,offset:o};let s=this.content.child(n-1);return{node:s,index:n-1,offset:o-s.nodeSize}}resolve(e){return ResolvedPos.resolveCached(this,e)}resolveNoCache(e){return ResolvedPos.resolve(this,e)}rangeHasMark(e,n,o){let s=!1;return n>e&&this.nodesBetween(e,n,a=>(o.isInSet(a.marks)&&(s=!0),!s)),s}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),wrapMarks$1(this.marks,e)}contentMatchAt(e){let n=this.type.contentMatch.matchFragment(this.content,0,e);if(!n)throw new Error("Called contentMatchAt on a node with invalid content");return n}canReplace(e,n,o=Fragment.empty,s=0,a=o.childCount){let l=this.contentMatchAt(e).matchFragment(o,s,a),c=l&&l.matchFragment(this.content,n);if(!c||!c.validEnd)return!1;for(let d=s;d<a;d++)if(!this.type.allowsMarks(o.child(d).marks))return!1;return!0}canReplaceWith(e,n,o,s){if(s&&!this.type.allowsMarks(s))return!1;let a=this.contentMatchAt(e).matchType(o),l=a&&a.matchFragment(this.content,n);return l?l.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=Mark.none;for(let n=0;n<this.marks.length;n++){let o=this.marks[n];o.type.checkAttrs(o.attrs),e=o.addToSet(e)}if(!Mark.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(n=>n.type.name)}`);this.content.forEach(n=>n.check())}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(n=>n.toJSON())),e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Node.fromJSON");let o;if(n.marks){if(!Array.isArray(n.marks))throw new RangeError("Invalid mark data for Node.fromJSON");o=n.marks.map(e.markFromJSON)}if(n.type=="text"){if(typeof n.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(n.text,o)}let s=Fragment.fromJSON(e,n.content),a=e.nodeType(n.type).create(n.attrs,s,o);return a.type.checkAttrs(a.attrs),a}};Node$1.prototype.text=void 0;let TextNode$2=class Te extends Node$1{constructor(e,n,o,s){if(super(e,n,null,s),!o)throw new RangeError("Empty text nodes are not allowed");this.text=o}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):wrapMarks$1(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,n){return this.text.slice(e,n)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new Te(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new Te(this.type,this.attrs,e,this.marks)}cut(e=0,n=this.text.length){return e==0&&n==this.text.length?this:this.withText(this.text.slice(e,n))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}};function wrapMarks$1(r,e){for(let n=r.length-1;n>=0;n--)e=r[n].type.name+"("+e+")";return e}class ContentMatch{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,n){let o=new TokenStream(e,n);if(o.next==null)return ContentMatch.empty;let s=parseExpr(o);o.next&&o.err("Unexpected trailing text");let a=dfa(nfa(s));return checkForDeadEnds(a,o),a}matchType(e){for(let n=0;n<this.next.length;n++)if(this.next[n].type==e)return this.next[n].next;return null}matchFragment(e,n=0,o=e.childCount){let s=this;for(let a=n;s&&a<o;a++)s=s.matchType(e.child(a).type);return s}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:n}=this.next[e];if(!(n.isText||n.hasRequiredAttrs()))return n}return null}compatible(e){for(let n=0;n<this.next.length;n++)for(let o=0;o<e.next.length;o++)if(this.next[n].type==e.next[o].type)return!0;return!1}fillBefore(e,n=!1,o=0){let s=[this];function a(l,c){let d=l.matchFragment(e,o);if(d&&(!n||d.validEnd))return Fragment.from(c.map(u=>u.createAndFill()));for(let u=0;u<l.next.length;u++){let{type:m,next:f}=l.next[u];if(!(m.isText||m.hasRequiredAttrs())&&s.indexOf(f)==-1){s.push(f);let p=a(f,c.concat(m));if(p)return p}}return null}return a(this,[])}findWrapping(e){for(let o=0;o<this.wrapCache.length;o+=2)if(this.wrapCache[o]==e)return this.wrapCache[o+1];let n=this.computeWrapping(e);return this.wrapCache.push(e,n),n}computeWrapping(e){let n=Object.create(null),o=[{match:this,type:null,via:null}];for(;o.length;){let s=o.shift(),a=s.match;if(a.matchType(e)){let l=[];for(let c=s;c.type;c=c.via)l.push(c.type);return l.reverse()}for(let l=0;l<a.next.length;l++){let{type:c,next:d}=a.next[l];!c.isLeaf&&!c.hasRequiredAttrs()&&!(c.name in n)&&(!s.type||d.validEnd)&&(o.push({match:c.contentMatch,type:c,via:s}),n[c.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function n(o){e.push(o);for(let s=0;s<o.next.length;s++)e.indexOf(o.next[s].next)==-1&&n(o.next[s].next)}return n(this),e.map((o,s)=>{let a=s+(o.validEnd?"*":" ")+" ";for(let l=0;l<o.next.length;l++)a+=(l?", ":"")+o.next[l].type.name+"->"+e.indexOf(o.next[l].next);return a}).join(`
`)}}ContentMatch.empty=new ContentMatch(!0);class TokenStream{constructor(e,n){this.string=e,this.nodeTypes=n,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function parseExpr(r){let e=[];do e.push(parseExprSeq(r));while(r.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function parseExprSeq(r){let e=[];do e.push(parseExprSubscript(r));while(r.next&&r.next!=")"&&r.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function parseExprSubscript(r){let e=parseExprAtom(r);for(;;)if(r.eat("+"))e={type:"plus",expr:e};else if(r.eat("*"))e={type:"star",expr:e};else if(r.eat("?"))e={type:"opt",expr:e};else if(r.eat("{"))e=parseExprRange(r,e);else break;return e}function parseNum(r){/\D/.test(r.next)&&r.err("Expected number, got '"+r.next+"'");let e=Number(r.next);return r.pos++,e}function parseExprRange(r,e){let n=parseNum(r),o=n;return r.eat(",")&&(r.next!="}"?o=parseNum(r):o=-1),r.eat("}")||r.err("Unclosed braced range"),{type:"range",min:n,max:o,expr:e}}function resolveName(r,e){let n=r.nodeTypes,o=n[e];if(o)return[o];let s=[];for(let a in n){let l=n[a];l.isInGroup(e)&&s.push(l)}return s.length==0&&r.err("No node type or group '"+e+"' found"),s}function parseExprAtom(r){if(r.eat("(")){let e=parseExpr(r);return r.eat(")")||r.err("Missing closing paren"),e}else if(/\W/.test(r.next))r.err("Unexpected token '"+r.next+"'");else{let e=resolveName(r,r.next).map(n=>(r.inline==null?r.inline=n.isInline:r.inline!=n.isInline&&r.err("Mixing inline and block content"),{type:"name",value:n}));return r.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function nfa(r){let e=[[]];return s(a(r,0),n()),e;function n(){return e.push([])-1}function o(l,c,d){let u={term:d,to:c};return e[l].push(u),u}function s(l,c){l.forEach(d=>d.to=c)}function a(l,c){if(l.type=="choice")return l.exprs.reduce((d,u)=>d.concat(a(u,c)),[]);if(l.type=="seq")for(let d=0;;d++){let u=a(l.exprs[d],c);if(d==l.exprs.length-1)return u;s(u,c=n())}else if(l.type=="star"){let d=n();return o(c,d),s(a(l.expr,d),d),[o(d)]}else if(l.type=="plus"){let d=n();return s(a(l.expr,c),d),s(a(l.expr,d),d),[o(d)]}else{if(l.type=="opt")return[o(c)].concat(a(l.expr,c));if(l.type=="range"){let d=c;for(let u=0;u<l.min;u++){let m=n();s(a(l.expr,d),m),d=m}if(l.max==-1)s(a(l.expr,d),d);else for(let u=l.min;u<l.max;u++){let m=n();o(d,m),s(a(l.expr,d),m),d=m}return[o(d)]}else{if(l.type=="name")return[o(c,void 0,l.value)];throw new Error("Unknown expr type")}}}}function cmp(r,e){return e-r}function nullFrom(r,e){let n=[];return o(e),n.sort(cmp);function o(s){let a=r[s];if(a.length==1&&!a[0].term)return o(a[0].to);n.push(s);for(let l=0;l<a.length;l++){let{term:c,to:d}=a[l];!c&&n.indexOf(d)==-1&&o(d)}}}function dfa(r){let e=Object.create(null);return n(nullFrom(r,0));function n(o){let s=[];o.forEach(l=>{r[l].forEach(({term:c,to:d})=>{if(!c)return;let u;for(let m=0;m<s.length;m++)s[m][0]==c&&(u=s[m][1]);nullFrom(r,d).forEach(m=>{u||s.push([c,u=[]]),u.indexOf(m)==-1&&u.push(m)})})});let a=e[o.join(",")]=new ContentMatch(o.indexOf(r.length-1)>-1);for(let l=0;l<s.length;l++){let c=s[l][1].sort(cmp);a.next.push({type:s[l][0],next:e[c.join(",")]||n(c)})}return a}}function checkForDeadEnds(r,e){for(let n=0,o=[r];n<o.length;n++){let s=o[n],a=!s.validEnd,l=[];for(let c=0;c<s.next.length;c++){let{type:d,next:u}=s.next[c];l.push(d.name),a&&!(d.isText||d.hasRequiredAttrs())&&(a=!1),o.indexOf(u)==-1&&o.push(u)}a&&e.err("Only non-generatable nodes ("+l.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function defaultAttrs(r){let e=Object.create(null);for(let n in r){let o=r[n];if(!o.hasDefault)return null;e[n]=o.default}return e}function computeAttrs(r,e){let n=Object.create(null);for(let o in r){let s=e&&e[o];if(s===void 0){let a=r[o];if(a.hasDefault)s=a.default;else throw new RangeError("No value supplied for attribute "+o)}n[o]=s}return n}function checkAttrs(r,e,n,o){for(let s in e)if(!(s in r))throw new RangeError(`Unsupported attribute ${s} for ${n} of type ${s}`);for(let s in r){let a=r[s];a.validate&&a.validate(e[s])}}function initAttrs(r,e){let n=Object.create(null);if(e)for(let o in e)n[o]=new Attribute(r,o,e[o]);return n}let NodeType$2=class Be{constructor(e,n,o){this.name=e,this.schema=n,this.spec=o,this.markSet=null,this.groups=o.group?o.group.split(" "):[],this.attrs=initAttrs(e,o.attrs),this.defaultAttrs=defaultAttrs(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(o.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==ContentMatch.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:computeAttrs(this.attrs,e)}create(e=null,n,o){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Node$1(this,this.computeAttrs(e),Fragment.from(n),Mark.setFrom(o))}createChecked(e=null,n,o){return n=Fragment.from(n),this.checkContent(n),new Node$1(this,this.computeAttrs(e),n,Mark.setFrom(o))}createAndFill(e=null,n,o){if(e=this.computeAttrs(e),n=Fragment.from(n),n.size){let l=this.contentMatch.fillBefore(n);if(!l)return null;n=l.append(n)}let s=this.contentMatch.matchFragment(n),a=s&&s.fillBefore(Fragment.empty,!0);return a?new Node$1(this,e,n.append(a),Mark.setFrom(o)):null}validContent(e){let n=this.contentMatch.matchFragment(e);if(!n||!n.validEnd)return!1;for(let o=0;o<e.childCount;o++)if(!this.allowsMarks(e.child(o).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){checkAttrs(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let n=0;n<e.length;n++)if(!this.allowsMarkType(e[n].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let n;for(let o=0;o<e.length;o++)this.allowsMarkType(e[o].type)?n&&n.push(e[o]):n||(n=e.slice(0,o));return n?n.length?n:Mark.none:e}static compile(e,n){let o=Object.create(null);e.forEach((a,l)=>o[a]=new Be(a,n,l));let s=n.spec.topNode||"doc";if(!o[s])throw new RangeError("Schema is missing its top node type ('"+s+"')");if(!o.text)throw new RangeError("Every schema needs a 'text' type");for(let a in o.text.attrs)throw new RangeError("The text node type should not have attributes");return o}};function validateType(r,e,n){let o=n.split("|");return s=>{let a=s===null?"null":typeof s;if(o.indexOf(a)<0)throw new RangeError(`Expected value of type ${o} for attribute ${e} on type ${r}, got ${a}`)}}class Attribute{constructor(e,n,o){this.hasDefault=Object.prototype.hasOwnProperty.call(o,"default"),this.default=o.default,this.validate=typeof o.validate=="string"?validateType(e,n,o.validate):o.validate}get isRequired(){return!this.hasDefault}}class MarkType{constructor(e,n,o,s){this.name=e,this.rank=n,this.schema=o,this.spec=s,this.attrs=initAttrs(e,s.attrs),this.excluded=null;let a=defaultAttrs(this.attrs);this.instance=a?new Mark(this,a):null}create(e=null){return!e&&this.instance?this.instance:new Mark(this,computeAttrs(this.attrs,e))}static compile(e,n){let o=Object.create(null),s=0;return e.forEach((a,l)=>o[a]=new MarkType(a,s++,n,l)),o}removeFromSet(e){for(var n=0;n<e.length;n++)e[n].type==this&&(e=e.slice(0,n).concat(e.slice(n+1)),n--);return e}isInSet(e){for(let n=0;n<e.length;n++)if(e[n].type==this)return e[n]}checkAttrs(e){checkAttrs(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class Schema{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let n=this.spec={};for(let s in e)n[s]=e[s];n.nodes=OrderedMap.from(e.nodes),n.marks=OrderedMap.from(e.marks||{}),this.nodes=NodeType$2.compile(this.spec.nodes,this),this.marks=MarkType.compile(this.spec.marks,this);let o=Object.create(null);for(let s in this.nodes){if(s in this.marks)throw new RangeError(s+" can not be both a node and a mark");let a=this.nodes[s],l=a.spec.content||"",c=a.spec.marks;if(a.contentMatch=o[l]||(o[l]=ContentMatch.parse(l,this.nodes)),a.inlineContent=a.contentMatch.inlineContent,a.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!a.isInline||!a.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=a}a.markSet=c=="_"?null:c?gatherMarks(this,c.split(" ")):c==""||!a.inlineContent?[]:null}for(let s in this.marks){let a=this.marks[s],l=a.spec.excludes;a.excluded=l==null?[a]:l==""?[]:gatherMarks(this,l.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,n=null,o,s){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof NodeType$2){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(n,o,s)}text(e,n){let o=this.nodes.text;return new TextNode$2(o,o.defaultAttrs,e,Mark.setFrom(n))}mark(e,n){return typeof e=="string"&&(e=this.marks[e]),e.create(n)}nodeFromJSON(e){return Node$1.fromJSON(this,e)}markFromJSON(e){return Mark.fromJSON(this,e)}nodeType(e){let n=this.nodes[e];if(!n)throw new RangeError("Unknown node type: "+e);return n}}function gatherMarks(r,e){let n=[];for(let o=0;o<e.length;o++){let s=e[o],a=r.marks[s],l=a;if(a)n.push(a);else for(let c in r.marks){let d=r.marks[c];(s=="_"||d.spec.group&&d.spec.group.split(" ").indexOf(s)>-1)&&n.push(l=d)}if(!l)throw new SyntaxError("Unknown mark type: '"+e[o]+"'")}return n}function isTagRule(r){return r.tag!=null}function isStyleRule(r){return r.style!=null}let DOMParser$1=class Me{constructor(e,n){this.schema=e,this.rules=n,this.tags=[],this.styles=[];let o=this.matchedStyles=[];n.forEach(s=>{if(isTagRule(s))this.tags.push(s);else if(isStyleRule(s)){let a=/[^=]*/.exec(s.style)[0];o.indexOf(a)<0&&o.push(a),this.styles.push(s)}}),this.normalizeLists=!this.tags.some(s=>{if(!/^(ul|ol)\b/.test(s.tag)||!s.node)return!1;let a=e.nodes[s.node];return a.contentMatch.matchType(a)})}parse(e,n={}){let o=new ParseContext$1(this,n,!1);return o.addAll(e,Mark.none,n.from,n.to),o.finish()}parseSlice(e,n={}){let o=new ParseContext$1(this,n,!0);return o.addAll(e,Mark.none,n.from,n.to),Slice.maxOpen(o.finish())}matchTag(e,n,o){for(let s=o?this.tags.indexOf(o)+1:0;s<this.tags.length;s++){let a=this.tags[s];if(matches(e,a.tag)&&(a.namespace===void 0||e.namespaceURI==a.namespace)&&(!a.context||n.matchesContext(a.context))){if(a.getAttrs){let l=a.getAttrs(e);if(l===!1)continue;a.attrs=l||void 0}return a}}}matchStyle(e,n,o,s){for(let a=s?this.styles.indexOf(s)+1:0;a<this.styles.length;a++){let l=this.styles[a],c=l.style;if(!(c.indexOf(e)!=0||l.context&&!o.matchesContext(l.context)||c.length>e.length&&(c.charCodeAt(e.length)!=61||c.slice(e.length+1)!=n))){if(l.getAttrs){let d=l.getAttrs(n);if(d===!1)continue;l.attrs=d||void 0}return l}}}static schemaRules(e){let n=[];function o(s){let a=s.priority==null?50:s.priority,l=0;for(;l<n.length;l++){let c=n[l];if((c.priority==null?50:c.priority)<a)break}n.splice(l,0,s)}for(let s in e.marks){let a=e.marks[s].spec.parseDOM;a&&a.forEach(l=>{o(l=copy(l)),l.mark||l.ignore||l.clearMark||(l.mark=s)})}for(let s in e.nodes){let a=e.nodes[s].spec.parseDOM;a&&a.forEach(l=>{o(l=copy(l)),l.node||l.ignore||l.mark||(l.node=s)})}return n}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new Me(e,Me.schemaRules(e)))}};const blockTags$1={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},ignoreTags$1={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},listTags={ol:!0,ul:!0},OPT_PRESERVE_WS=1,OPT_PRESERVE_WS_FULL=2,OPT_OPEN_LEFT=4;function wsOptionsFor(r,e,n){return e!=null?(e?OPT_PRESERVE_WS:0)|(e==="full"?OPT_PRESERVE_WS_FULL:0):r&&r.whitespace=="pre"?OPT_PRESERVE_WS|OPT_PRESERVE_WS_FULL:n&-5}class NodeContext{constructor(e,n,o,s,a,l){this.type=e,this.attrs=n,this.marks=o,this.solid=s,this.options=l,this.content=[],this.activeMarks=Mark.none,this.match=a||(l&OPT_OPEN_LEFT?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let n=this.type.contentMatch.fillBefore(Fragment.from(e));if(n)this.match=this.type.contentMatch.matchFragment(n);else{let o=this.type.contentMatch,s;return(s=o.findWrapping(e.type))?(this.match=o,s):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&OPT_PRESERVE_WS)){let o=this.content[this.content.length-1],s;if(o&&o.isText&&(s=/[ \t\r\n\u000c]+$/.exec(o.text))){let a=o;o.text.length==s[0].length?this.content.pop():this.content[this.content.length-1]=a.withText(a.text.slice(0,a.text.length-s[0].length))}}let n=Fragment.from(this.content);return!e&&this.match&&(n=n.append(this.match.fillBefore(Fragment.empty,!0))),this.type?this.type.create(this.attrs,n,this.marks):n}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!blockTags$1.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}let ParseContext$1=class{constructor(r,e,n){this.parser=r,this.options=e,this.isOpen=n,this.open=0,this.localPreserveWS=!1;let o=e.topNode,s,a=wsOptionsFor(null,e.preserveWhitespace,0)|(n?OPT_OPEN_LEFT:0);o?s=new NodeContext(o.type,o.attrs,Mark.none,!0,e.topMatch||o.type.contentMatch,a):n?s=new NodeContext(null,null,Mark.none,!0,null,a):s=new NodeContext(r.schema.topNodeType,null,Mark.none,!0,null,a),this.nodes=[s],this.find=e.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(r,e){r.nodeType==3?this.addTextNode(r,e):r.nodeType==1&&this.addElement(r,e)}addTextNode(r,e){let n=r.nodeValue,o=this.top,s=o.options&OPT_PRESERVE_WS_FULL?"full":this.localPreserveWS||(o.options&OPT_PRESERVE_WS)>0;if(s==="full"||o.inlineContext(r)||/[^ \t\r\n\u000c]/.test(n)){if(s)s!=="full"?n=n.replace(/\r?\n|\r/g," "):n=n.replace(/\r\n?/g,`
`);else if(n=n.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(n)&&this.open==this.nodes.length-1){let a=o.content[o.content.length-1],l=r.previousSibling;(!a||l&&l.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(n=n.slice(1))}n&&this.insertNode(this.parser.schema.text(n),e),this.findInText(r)}else this.findInside(r)}addElement(r,e,n){let o=this.localPreserveWS,s=this.top;(r.tagName=="PRE"||/pre/.test(r.style&&r.style.whiteSpace))&&(this.localPreserveWS=!0);let a=r.nodeName.toLowerCase(),l;listTags.hasOwnProperty(a)&&this.parser.normalizeLists&&normalizeList(r);let c=this.options.ruleFromNode&&this.options.ruleFromNode(r)||(l=this.parser.matchTag(r,this,n));e:if(c?c.ignore:ignoreTags$1.hasOwnProperty(a))this.findInside(r),this.ignoreFallback(r,e);else if(!c||c.skip||c.closeParent){c&&c.closeParent?this.open=Math.max(0,this.open-1):c&&c.skip.nodeType&&(r=c.skip);let d,u=this.needsBlock;if(blockTags$1.hasOwnProperty(a))s.content.length&&s.content[0].isInline&&this.open&&(this.open--,s=this.top),d=!0,s.type||(this.needsBlock=!0);else if(!r.firstChild){this.leafFallback(r,e);break e}let m=c&&c.skip?e:this.readStyles(r,e);m&&this.addAll(r,m),d&&this.sync(s),this.needsBlock=u}else{let d=this.readStyles(r,e);d&&this.addElementByRule(r,c,d,c.consuming===!1?l:void 0)}this.localPreserveWS=o}leafFallback(r,e){r.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(r.ownerDocument.createTextNode(`
`),e)}ignoreFallback(r,e){r.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),e)}readStyles(r,e){let n=r.style;if(n&&n.length)for(let o=0;o<this.parser.matchedStyles.length;o++){let s=this.parser.matchedStyles[o],a=n.getPropertyValue(s);if(a)for(let l=void 0;;){let c=this.parser.matchStyle(s,a,this,l);if(!c)break;if(c.ignore)return null;if(c.clearMark?e=e.filter(d=>!c.clearMark(d)):e=e.concat(this.parser.schema.marks[c.mark].create(c.attrs)),c.consuming===!1)l=c;else break}}return e}addElementByRule(r,e,n,o){let s,a;if(e.node)if(a=this.parser.schema.nodes[e.node],a.isLeaf)this.insertNode(a.create(e.attrs),n)||this.leafFallback(r,n);else{let c=this.enter(a,e.attrs||null,n,e.preserveWhitespace);c&&(s=!0,n=c)}else{let c=this.parser.schema.marks[e.mark];n=n.concat(c.create(e.attrs))}let l=this.top;if(a&&a.isLeaf)this.findInside(r);else if(o)this.addElement(r,n,o);else if(e.getContent)this.findInside(r),e.getContent(r,this.parser.schema).forEach(c=>this.insertNode(c,n));else{let c=r;typeof e.contentElement=="string"?c=r.querySelector(e.contentElement):typeof e.contentElement=="function"?c=e.contentElement(r):e.contentElement&&(c=e.contentElement),this.findAround(r,c,!0),this.addAll(c,n),this.findAround(r,c,!1)}s&&this.sync(l)&&this.open--}addAll(r,e,n,o){let s=n||0;for(let a=n?r.childNodes[n]:r.firstChild,l=o==null?null:r.childNodes[o];a!=l;a=a.nextSibling,++s)this.findAtPoint(r,s),this.addDOM(a,e);this.findAtPoint(r,s)}findPlace(r,e){let n,o;for(let s=this.open;s>=0;s--){let a=this.nodes[s],l=a.findWrapping(r);if(l&&(!n||n.length>l.length)&&(n=l,o=a,!l.length)||a.solid)break}if(!n)return null;this.sync(o);for(let s=0;s<n.length;s++)e=this.enterInner(n[s],null,e,!1);return e}insertNode(r,e){if(r.isInline&&this.needsBlock&&!this.top.type){let o=this.textblockFromContext();o&&(e=this.enterInner(o,null,e))}let n=this.findPlace(r,e);if(n){this.closeExtra();let o=this.top;o.match&&(o.match=o.match.matchType(r.type));let s=Mark.none;for(let a of n.concat(r.marks))(o.type?o.type.allowsMarkType(a.type):markMayApply(a.type,r.type))&&(s=a.addToSet(s));return o.content.push(r.mark(s)),!0}return!1}enter(r,e,n,o){let s=this.findPlace(r.create(e),n);return s&&(s=this.enterInner(r,e,n,!0,o)),s}enterInner(r,e,n,o=!1,s){this.closeExtra();let a=this.top;a.match=a.match&&a.match.matchType(r);let l=wsOptionsFor(r,s,a.options);a.options&OPT_OPEN_LEFT&&a.content.length==0&&(l|=OPT_OPEN_LEFT);let c=Mark.none;return n=n.filter(d=>(a.type?a.type.allowsMarkType(d.type):markMayApply(d.type,r))?(c=d.addToSet(c),!1):!0),this.nodes.push(new NodeContext(r,e,c,o,null,l)),this.open++,n}closeExtra(r=!1){let e=this.nodes.length-1;if(e>this.open){for(;e>this.open;e--)this.nodes[e-1].content.push(this.nodes[e].finish(r));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(r){for(let e=this.open;e>=0;e--){if(this.nodes[e]==r)return this.open=e,!0;this.localPreserveWS&&(this.nodes[e].options|=OPT_PRESERVE_WS)}return!1}get currentPos(){this.closeExtra();let r=0;for(let e=this.open;e>=0;e--){let n=this.nodes[e].content;for(let o=n.length-1;o>=0;o--)r+=n[o].nodeSize;e&&r++}return r}findAtPoint(r,e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==r&&this.find[n].offset==e&&(this.find[n].pos=this.currentPos)}findInside(r){if(this.find)for(let e=0;e<this.find.length;e++)this.find[e].pos==null&&r.nodeType==1&&r.contains(this.find[e].node)&&(this.find[e].pos=this.currentPos)}findAround(r,e,n){if(r!=e&&this.find)for(let o=0;o<this.find.length;o++)this.find[o].pos==null&&r.nodeType==1&&r.contains(this.find[o].node)&&e.compareDocumentPosition(this.find[o].node)&(n?2:4)&&(this.find[o].pos=this.currentPos)}findInText(r){if(this.find)for(let e=0;e<this.find.length;e++)this.find[e].node==r&&(this.find[e].pos=this.currentPos-(r.nodeValue.length-this.find[e].offset))}matchesContext(r){if(r.indexOf("|")>-1)return r.split(/\s*\|\s*/).some(this.matchesContext,this);let e=r.split("/"),n=this.options.context,o=!this.isOpen&&(!n||n.parent.type==this.nodes[0].type),s=-(n?n.depth+1:0)+(o?0:1),a=(l,c)=>{for(;l>=0;l--){let d=e[l];if(d==""){if(l==e.length-1||l==0)continue;for(;c>=s;c--)if(a(l-1,c))return!0;return!1}else{let u=c>0||c==0&&o?this.nodes[c].type:n&&c>=s?n.node(c-s).type:null;if(!u||u.name!=d&&!u.isInGroup(d))return!1;c--}}return!0};return a(e.length-1,this.open)}textblockFromContext(){let r=this.options.context;if(r)for(let e=r.depth;e>=0;e--){let n=r.node(e).contentMatchAt(r.indexAfter(e)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let e in this.parser.schema.nodes){let n=this.parser.schema.nodes[e];if(n.isTextblock&&n.defaultAttrs)return n}}};function normalizeList(r){for(let e=r.firstChild,n=null;e;e=e.nextSibling){let o=e.nodeType==1?e.nodeName.toLowerCase():null;o&&listTags.hasOwnProperty(o)&&n?(n.appendChild(e),e=n):o=="li"?n=e:o&&(n=null)}}function matches(r,e){return(r.matches||r.msMatchesSelector||r.webkitMatchesSelector||r.mozMatchesSelector).call(r,e)}function copy(r){let e={};for(let n in r)e[n]=r[n];return e}function markMayApply(r,e){let n=e.schema.nodes;for(let o in n){let s=n[o];if(!s.allowsMarkType(r))continue;let a=[],l=c=>{a.push(c);for(let d=0;d<c.edgeCount;d++){let{type:u,next:m}=c.edge(d);if(u==e||a.indexOf(m)<0&&l(m))return!0}};if(l(s.contentMatch))return!0}}class DOMSerializer{constructor(e,n){this.nodes=e,this.marks=n}serializeFragment(e,n={},o){o||(o=doc$2(n).createDocumentFragment());let s=o,a=[];return e.forEach(l=>{if(a.length||l.marks.length){let c=0,d=0;for(;c<a.length&&d<l.marks.length;){let u=l.marks[d];if(!this.marks[u.type.name]){d++;continue}if(!u.eq(a[c][0])||u.type.spec.spanning===!1)break;c++,d++}for(;c<a.length;)s=a.pop()[1];for(;d<l.marks.length;){let u=l.marks[d++],m=this.serializeMark(u,l.isInline,n);m&&(a.push([u,s]),s.appendChild(m.dom),s=m.contentDOM||m.dom)}}s.appendChild(this.serializeNodeInner(l,n))}),o}serializeNodeInner(e,n){let{dom:o,contentDOM:s}=renderSpec(doc$2(n),this.nodes[e.type.name](e),null,e.attrs);if(s){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,n,s)}return o}serializeNode(e,n={}){let o=this.serializeNodeInner(e,n);for(let s=e.marks.length-1;s>=0;s--){let a=this.serializeMark(e.marks[s],e.isInline,n);a&&((a.contentDOM||a.dom).appendChild(o),o=a.dom)}return o}serializeMark(e,n,o={}){let s=this.marks[e.type.name];return s&&renderSpec(doc$2(o),s(e,n),null,e.attrs)}static renderSpec(e,n,o=null,s){return renderSpec(e,n,o,s)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new DOMSerializer(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let n=gatherToDOM(e.nodes);return n.text||(n.text=o=>o.text),n}static marksFromSchema(e){return gatherToDOM(e.marks)}}function gatherToDOM(r){let e={};for(let n in r){let o=r[n].spec.toDOM;o&&(e[n]=o)}return e}function doc$2(r){return r.document||window.document}const suspiciousAttributeCache=new WeakMap;function suspiciousAttributes(r){let e=suspiciousAttributeCache.get(r);return e===void 0&&suspiciousAttributeCache.set(r,e=suspiciousAttributesInner(r)),e}function suspiciousAttributesInner(r){let e=null;function n(o){if(o&&typeof o=="object")if(Array.isArray(o))if(typeof o[0]=="string")e||(e=[]),e.push(o);else for(let s=0;s<o.length;s++)n(o[s]);else for(let s in o)n(o[s])}return n(r),e}function renderSpec(r,e,n,o){if(typeof e=="string")return{dom:r.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let s=e[0],a;if(typeof s!="string")throw new RangeError("Invalid array passed to renderSpec");if(o&&(a=suspiciousAttributes(o))&&a.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let l=s.indexOf(" ");l>0&&(n=s.slice(0,l),s=s.slice(l+1));let c,d=n?r.createElementNS(n,s):r.createElement(s),u=e[1],m=1;if(u&&typeof u=="object"&&u.nodeType==null&&!Array.isArray(u)){m=2;for(let f in u)if(u[f]!=null){let p=f.indexOf(" ");p>0?d.setAttributeNS(f.slice(0,p),f.slice(p+1),u[f]):d.setAttribute(f,u[f])}}for(let f=m;f<e.length;f++){let p=e[f];if(p===0){if(f<e.length-1||f>m)throw new RangeError("Content hole must be the only child of its parent node");return{dom:d,contentDOM:d}}else{let{dom:g,contentDOM:y}=renderSpec(r,p,n,o);if(d.appendChild(g),y){if(c)throw new RangeError("Multiple content holes");c=y}}}return{dom:d,contentDOM:c}}const getPmSchema=r=>new Schema({nodes:{doc:{content:"inline*"},text:{group:"inline"},pathRef:{inline:!0,atom:!0,attrs:{path:{}},group:"inline",selectable:!0,toDOM:e=>{const n=document.createElement("span");n.classList.add("path-ref"),n.dataset.path=e.attrs.path;const o=getBasename(e.attrs.path);return n.innerHTML=o,n},parseDOM:[{tag:"span.path-ref",getAttrs:e=>({path:e.getAttribute("path")})}],leafText:e=>e.attrs.path},blockRef_v2:{inline:!0,atom:!0,attrs:{toBlockId:{},tag:{default:!1}},group:"inline",selectable:!0,toDOM:e=>{const{toBlockId:n}=e.attrs,o=document.createElement("span");o.classList.add("block-ref-v2"),e.attrs.tag&&o.classList.add("tag"),o.addEventListener("click",a=>{var d,u;a.preventDefault(),a.stopPropagation(),(d=r.pushHistoryItem)==null||d.call(r);const l=(u=r.getMainTree)==null?void 0:u.call(r);if(!l)return;const c=l.findDi(m=>m.type==="basic-block"&&m.block.id===n);c&&l.focusDi(c.itemId,{highlight:!0,expandIfFold:!0})});const s=r.getBlockRef(n);return watch(s,a=>{var l,c;if(a){const d=a.ctext??"";o.innerHTML=d.trim(),o.dataset.blockId=a.id,o.dataset.ctext=d,(l=a.metadata)!=null&&l.blockRefColor?o.dataset.blockRefColor=(c=a.metadata)==null?void 0:c.blockRefColor:delete o.dataset.blockRefColor,o.classList.remove("invalid")}else o.innerHTML="Invalid Ref",o.classList.add("invalid")},{immediate:!0}),o},parseDOM:[{tag:"span.block-ref-v2",getAttrs(e){return e instanceof HTMLElement?{toBlockId:e.dataset.blockId,tag:e.classList.contains("tag")}:{}}}],leafText:e=>{var o;const{toBlockId:n}=e.attrs;return n?((o=r.getBlockRef(n).value)==null?void 0:o.ctext)??"":""}},mathInline:{inline:!0,atom:!0,attrs:{src:{}},leafText:e=>e.attrs.src,group:"inline",selectable:!0,toDOM:e=>["span",{class:"math-inline",src:e.attrs.src,contenteditable:!0}],parseDOM:[{tag:"span.math-inline",getAttrs:e=>({src:e.getAttribute("src")})}]},hardBreak:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM(){return["br"]}}},marks:{link:{attrs:{href:{}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs:e=>({href:e.getAttribute("href")})}],toDOM(e){const{href:n}=e.attrs,o=document.createElement("a");return o.href=n,o.spellcheck=!1,o.addEventListener("click",s=>{s.preventDefault(),s.stopPropagation(),window.open(n,"_blank")}),o}},code:{parseDOM:[{tag:"code"}],toDOM(){return["code",{spellcheck:!1},0]}},italic:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"},{style:"font-style=normal",clearMark:e=>e.type.name=="em"}],toDOM(){return["em",0]}},bold:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:e=>e.style.fontWeight!="normal"&&null},{style:"font-weight=400",clearMark:e=>e.type.name=="strong"},{style:"font-weight",getAttrs:e=>/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}],toDOM:()=>["strong",0]},strikethrough:{parseDOM:[{tag:"s"},{tag:"del"},{style:"text-decoration: line-through"}],toDOM:()=>["s",0]},underline:{parseDOM:[{tag:"u"},{style:"text-decoration: underline"}],toDOM:()=>["u",0]},cloze:{attrs:{clozeId:{}},inclusive:!1,toDOM(e){const n=document.createElement("span");return n.classList.add("cloze"),n.setAttribute("clozeid",e.attrs.clozeId),{dom:n,contentDom:n}},parseDOM:[{tag:"span.cloze",getAttrs:e=>({clozeId:e.getAttribute("clozeId")})}]},highlight:{attrs:{bg:{default:"bg4"},fg:{default:null}},inclusive:!1,toDOM(e){const{bg:n,fg:o}=e.attrs;return["span",{class:"highlight",bg:n,fg:o},0]},parseDOM:[{tag:"span.highlight",getAttrs:e=>({bg:e.getAttribute("bg"),fg:e.getAttribute("fg")})}]}}}),HTTP_LINK_REGEX=/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_+.~#?&//=]*)/g,linkify=function(r,e){const n=[];return r.forEach(o=>{if(o.isText){const s=o.text;let a=0,l;for(;l=HTTP_LINK_REGEX.exec(s);){const c=l.index,d=c+l[0].length,u=o.type.schema.marks.link;c>0&&n.push(o.cut(a,c));const m=s.slice(c,d),f=u.create({href:m});n.push(o.cut(c,d).mark(f.addToSet(o.marks))),e.push(m),a=d}a<s.length&&n.push(o.cut(a))}else n.push(o.copy(linkify(o.content,e)))}),Fragment.fromArray(n)},contentNodesToPmNode=r=>[BLOCK_CONTENT_TYPES.TEXT,{type:"doc",content:r.map(e=>e.toJSON())}],plainTextToPmNode=(r,e)=>{let n;if(r.length===0)n=Fragment.empty;else{const o=e.text(r);n=linkify(Fragment.from(o),[])}return e.nodes.doc.create({},n)},plainTextToTextContent=(r,e)=>{let n;if(r.length===0)n=Fragment.empty;else{const s=e.text(r);n=linkify(Fragment.from(s),[])}const o=e.nodes.doc.create({},n);return[BLOCK_CONTENT_TYPES.TEXT,o.toJSON()]},blockRefToTextContent=r=>[BLOCK_CONTENT_TYPES.TEXT,{type:"doc",content:[{type:"blockRef_v2",attrs:{toBlockId:r,tag:!1}}]}];var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var dayjs_min={exports:{}};(function(r,e){(function(n,o){r.exports=o()})(commonjsGlobal,function(){var n=1e3,o=6e4,s=36e5,a="millisecond",l="second",c="minute",d="hour",u="day",m="week",f="month",p="quarter",g="year",y="date",b="Invalid Date",k=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,w=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,B={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(H){var V=["th","st","nd","rd"],R=H%100;return"["+H+(V[(R-20)%10]||V[R]||V[0])+"]"}},M=function(H,V,R){var J=String(H);return!J||J.length>=V?H:""+Array(V+1-J.length).join(R)+H},x={s:M,z:function(H){var V=-H.utcOffset(),R=Math.abs(V),J=Math.floor(R/60),Y=R%60;return(V<=0?"+":"-")+M(J,2,"0")+":"+M(Y,2,"0")},m:function H(V,R){if(V.date()<R.date())return-H(R,V);var J=12*(R.year()-V.year())+(R.month()-V.month()),Y=V.clone().add(J,f),re=R-Y<0,Q=V.clone().add(J+(re?-1:1),f);return+(-(J+(R-Y)/(re?Y-Q:Q-Y))||0)},a:function(H){return H<0?Math.ceil(H)||0:Math.floor(H)},p:function(H){return{M:f,y:g,w:m,d:u,D:y,h:d,m:c,s:l,ms:a,Q:p}[H]||String(H||"").toLowerCase().replace(/s$/,"")},u:function(H){return H===void 0}},v="en",_={};_[v]=B;var E="$isDayjsObject",N=function(H){return H instanceof F||!(!H||!H[E])},I=function H(V,R,J){var Y;if(!V)return v;if(typeof V=="string"){var re=V.toLowerCase();_[re]&&(Y=re),R&&(_[re]=R,Y=re);var Q=V.split("-");if(!Y&&Q.length>1)return H(Q[0])}else{var j=V.name;_[j]=V,Y=j}return!J&&Y&&(v=Y),Y||!J&&v},L=function(H,V){if(N(H))return H.clone();var R=typeof V=="object"?V:{};return R.date=H,R.args=arguments,new F(R)},A=x;A.l=I,A.i=N,A.w=function(H,V){return L(H,{locale:V.$L,utc:V.$u,x:V.$x,$offset:V.$offset})};var F=function(){function H(R){this.$L=I(R.locale,null,!0),this.parse(R),this.$x=this.$x||R.x||{},this[E]=!0}var V=H.prototype;return V.parse=function(R){this.$d=function(J){var Y=J.date,re=J.utc;if(Y===null)return new Date(NaN);if(A.u(Y))return new Date;if(Y instanceof Date)return new Date(Y);if(typeof Y=="string"&&!/Z$/i.test(Y)){var Q=Y.match(k);if(Q){var j=Q[2]-1||0,q=(Q[7]||"0").substring(0,3);return re?new Date(Date.UTC(Q[1],j,Q[3]||1,Q[4]||0,Q[5]||0,Q[6]||0,q)):new Date(Q[1],j,Q[3]||1,Q[4]||0,Q[5]||0,Q[6]||0,q)}}return new Date(Y)}(R),this.init()},V.init=function(){var R=this.$d;this.$y=R.getFullYear(),this.$M=R.getMonth(),this.$D=R.getDate(),this.$W=R.getDay(),this.$H=R.getHours(),this.$m=R.getMinutes(),this.$s=R.getSeconds(),this.$ms=R.getMilliseconds()},V.$utils=function(){return A},V.isValid=function(){return this.$d.toString()!==b},V.isSame=function(R,J){var Y=L(R);return this.startOf(J)<=Y&&Y<=this.endOf(J)},V.isAfter=function(R,J){return L(R)<this.startOf(J)},V.isBefore=function(R,J){return this.endOf(J)<L(R)},V.$g=function(R,J,Y){return A.u(R)?this[J]:this.set(Y,R)},V.unix=function(){return Math.floor(this.valueOf()/1e3)},V.valueOf=function(){return this.$d.getTime()},V.startOf=function(R,J){var Y=this,re=!!A.u(J)||J,Q=A.p(R),j=function(P,Z){var $=A.w(Y.$u?Date.UTC(Y.$y,Z,P):new Date(Y.$y,Z,P),Y);return re?$:$.endOf(u)},q=function(P,Z){return A.w(Y.toDate()[P].apply(Y.toDate("s"),(re?[0,0,0,0]:[23,59,59,999]).slice(Z)),Y)},ee=this.$W,G=this.$M,te=this.$D,ce="set"+(this.$u?"UTC":"");switch(Q){case g:return re?j(1,0):j(31,11);case f:return re?j(1,G):j(0,G+1);case m:var W=this.$locale().weekStart||0,U=(ee<W?ee+7:ee)-W;return j(re?te-U:te+(6-U),G);case u:case y:return q(ce+"Hours",0);case d:return q(ce+"Minutes",1);case c:return q(ce+"Seconds",2);case l:return q(ce+"Milliseconds",3);default:return this.clone()}},V.endOf=function(R){return this.startOf(R,!1)},V.$set=function(R,J){var Y,re=A.p(R),Q="set"+(this.$u?"UTC":""),j=(Y={},Y[u]=Q+"Date",Y[y]=Q+"Date",Y[f]=Q+"Month",Y[g]=Q+"FullYear",Y[d]=Q+"Hours",Y[c]=Q+"Minutes",Y[l]=Q+"Seconds",Y[a]=Q+"Milliseconds",Y)[re],q=re===u?this.$D+(J-this.$W):J;if(re===f||re===g){var ee=this.clone().set(y,1);ee.$d[j](q),ee.init(),this.$d=ee.set(y,Math.min(this.$D,ee.daysInMonth())).$d}else j&&this.$d[j](q);return this.init(),this},V.set=function(R,J){return this.clone().$set(R,J)},V.get=function(R){return this[A.p(R)]()},V.add=function(R,J){var Y,re=this;R=Number(R);var Q=A.p(J),j=function(G){var te=L(re);return A.w(te.date(te.date()+Math.round(G*R)),re)};if(Q===f)return this.set(f,this.$M+R);if(Q===g)return this.set(g,this.$y+R);if(Q===u)return j(1);if(Q===m)return j(7);var q=(Y={},Y[c]=o,Y[d]=s,Y[l]=n,Y)[Q]||1,ee=this.$d.getTime()+R*q;return A.w(ee,this)},V.subtract=function(R,J){return this.add(-1*R,J)},V.format=function(R){var J=this,Y=this.$locale();if(!this.isValid())return Y.invalidDate||b;var re=R||"YYYY-MM-DDTHH:mm:ssZ",Q=A.z(this),j=this.$H,q=this.$m,ee=this.$M,G=Y.weekdays,te=Y.months,ce=Y.meridiem,W=function(Z,$,K,ne){return Z&&(Z[$]||Z(J,re))||K[$].slice(0,ne)},U=function(Z){return A.s(j%12||12,Z,"0")},P=ce||function(Z,$,K){var ne=Z<12?"AM":"PM";return K?ne.toLowerCase():ne};return re.replace(w,function(Z,$){return $||function(K){switch(K){case"YY":return String(J.$y).slice(-2);case"YYYY":return A.s(J.$y,4,"0");case"M":return ee+1;case"MM":return A.s(ee+1,2,"0");case"MMM":return W(Y.monthsShort,ee,te,3);case"MMMM":return W(te,ee);case"D":return J.$D;case"DD":return A.s(J.$D,2,"0");case"d":return String(J.$W);case"dd":return W(Y.weekdaysMin,J.$W,G,2);case"ddd":return W(Y.weekdaysShort,J.$W,G,3);case"dddd":return G[J.$W];case"H":return String(j);case"HH":return A.s(j,2,"0");case"h":return U(1);case"hh":return U(2);case"a":return P(j,q,!0);case"A":return P(j,q,!1);case"m":return String(q);case"mm":return A.s(q,2,"0");case"s":return String(J.$s);case"ss":return A.s(J.$s,2,"0");case"SSS":return A.s(J.$ms,3,"0");case"Z":return Q}return null}(Z)||Q.replace(":","")})},V.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},V.diff=function(R,J,Y){var re,Q=this,j=A.p(J),q=L(R),ee=(q.utcOffset()-this.utcOffset())*o,G=this-q,te=function(){return A.m(Q,q)};switch(j){case g:re=te()/12;break;case f:re=te();break;case p:re=te()/3;break;case m:re=(G-ee)/6048e5;break;case u:re=(G-ee)/864e5;break;case d:re=G/s;break;case c:re=G/o;break;case l:re=G/n;break;default:re=G}return Y?re:A.a(re)},V.daysInMonth=function(){return this.endOf(f).$D},V.$locale=function(){return _[this.$L]},V.locale=function(R,J){if(!R)return this.$L;var Y=this.clone(),re=I(R,J,!0);return re&&(Y.$L=re),Y},V.clone=function(){return A.w(this.$d,this)},V.toDate=function(){return new Date(this.valueOf())},V.toJSON=function(){return this.isValid()?this.toISOString():null},V.toISOString=function(){return this.$d.toISOString()},V.toString=function(){return this.$d.toUTCString()},H}(),se=F.prototype;return L.prototype=se,[["$ms",a],["$s",l],["$m",c],["$H",d],["$W",u],["$M",f],["$y",g],["$D",y]].forEach(function(H){se[H[1]]=function(V){return this.$g(V,H[0],H[1])}}),L.extend=function(H,V){return H.$i||(H(V,F,L),H.$i=!0),L},L.locale=I,L.isDayjs=N,L.unix=function(H){return L(1e3*H)},L.en=_[v],L.Ls=_,L.p={},L})})(dayjs_min);var dayjs_minExports=dayjs_min.exports;const dayjs=getDefaultExportFromCjs(dayjs_minExports),urlAlphabet="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let nanoid=(r=21)=>{let e="",n=crypto.getRandomValues(new Uint8Array(r|=0));for(;r--;)e+=urlAlphabet[n[r]&63];return e};function useBlockTransaction(r){const{mainRootBlockId:e,lastFocusedBlockTree:n,lastFocusedDiId:o,blocks:s,latestBlockInfos:a,latestBlockDatas:l,yjsLayer:c,getBlockRef:d,getCtext:u,getMtext:m,getOlinks:f}=r,p=useEventBus(),g=x=>{const v={origin:x,patches:[],reversePatches:[],meta:{isUndoRedo:!1,autoAddUndoPoint:!0,canUndo:!0,envUndoStrategy:"beforeCommit"},envInfo:{onCreate:y(),beforeCommit:null,afterCommit:null},addBlock:_=>(v.patches.push({op:"add",block:_}),v.reversePatches.push({op:"delete",blockId:_.id}),v),updateBlock:_=>{var N;const E=(N=s.get(_.id))==null?void 0:N.value;if(!E)throw new Error(`Cannot find old block ${_.id}, maybe you should add it first?`);return v.patches.push({op:"update",block:_}),v.reversePatches.push({op:"update",block:k(E)}),v},deleteBlock:_=>{var N;const E=(N=s.get(_))==null?void 0:N.value;if(!E)throw new Error(`Cannot find old block ${_}, maybe you should add it first?`);return v.patches.push({op:"delete",blockId:_}),v.reversePatches.push({op:"add",block:k(E)}),v},commit:()=>{v.envInfo.beforeCommit=y(),b(v),v.envInfo.afterCommit=y()},setMeta:(_,E)=>(v.meta[_]=E,v),addTransaction:_=>(v.patches.push(..._.patches),v.reversePatches.push(..._.reversePatches),v),addReverseTransaction:_=>(v.patches.push(..._.reversePatches),v.reversePatches.push(..._.patches),v)};return v},y=()=>{var E,N,I;const x=((E=n.value)==null?void 0:E.getId())??null,v=o.value??null,_=((I=v?(N=n.value)==null?void 0:N.getEditorView(v):null)==null?void 0:I.state.selection.toJSON())??null;return{rootBlockId:e.value,focusedTreeId:x,focusedItemId:v,selection:_}},b=x=>{const{origin:v,patches:_}=x;console.debug("Committing transaction with origin:",v,"and patches:",_);const E=v.type==="ui"?c.createSyncLayerTransaction(v):void 0;for(const N of _){const{op:I}=N;if(I=="add"||I=="update"){const L=N.block,A=Object.assign({origin:v},w(L));A&&B(A.id,A,E)}else if(I=="delete"){const{blockId:L}=N;M(L,E)}}E==null||E.commit(),p.emit("afterBlocksTrCommit",[x])},k=x=>{if(x.type=="normalBlock")return{type:"normalBlock",id:x.id,fold:x.fold,parentId:x.parentId,childrenIds:x.childrenIds,content:x.content,metadata:x.metadata};if(x.type=="mirrorBlock")return{type:x.type,id:x.id,fold:x.fold,parentId:x.parentId,childrenIds:x.childrenIds,src:x.src};if(x.type=="virtualBlock")return{type:x.type,id:x.id,fold:x.fold,parentId:x.parentId,childrenIds:x.childrenIds,src:x.src,childrenCreated:x.childrenCreated};throw new Error("Invalid block type")},w=x=>{if(x.type=="normalBlock")return{type:"normalBlock",id:x.id,parentId:x.parentId,parentRef:d(x.parentId),childrenIds:x.childrenIds,childrenRefs:x.childrenIds.map(v=>d(v)),fold:x.fold,deleted:!1,content:x.content,ctext:u(x.content),metadata:x.metadata,mtext:m(x.metadata),olinks:x.content[0]===BLOCK_CONTENT_TYPES.TEXT?f(x.content[1]):[],boosting:0,acturalSrc:x.id,docId:0};if(x.type=="mirrorBlock"){const v=d(x.src).value;return v?{type:"mirrorBlock",id:x.id,parentId:x.parentId,parentRef:d(x.parentId),childrenIds:x.childrenIds,childrenRefs:x.childrenIds.map(_=>d(_)),fold:x.fold,deleted:!1,content:x.content??v.content,ctext:u(x.content),metadata:x.metadata??v.metadata,mtext:m(x.metadata),olinks:x.content[0]===BLOCK_CONTENT_TYPES.TEXT?f(x.content[1]):[],boosting:x.boosting??v.boosting,acturalSrc:x.acturalSrc??v.acturalSrc,src:x.src}:(console.error(`mirror block ${x.id} \u7684\u6E90\u5757 ${x.src} \u4E0D\u5B58\u5728`),null)}else if(x.type=="virtualBlock"){const v=d(x.src).value;return v?{type:"virtualBlock",id:x.id,parentId:x.parentId,parentRef:d(x.parentId),childrenIds:x.childrenIds,childrenRefs:x.childrenIds.map(_=>d(_)),fold:x.fold,deleted:!1,content:x.content??v.content,ctext:u(x.content),metadata:x.metadata??v.metadata,mtext:m(x.metadata),olinks:x.content[0]===BLOCK_CONTENT_TYPES.TEXT?f(x.content[1]):[],boosting:x.boosting??v.boosting,acturalSrc:x.acturalSrc??v.acturalSrc,src:x.src,childrenCreated:x.childrenCreated}:(console.error(`virtual block ${x.id} \u7684\u6E90\u5757 ${x.src} \u4E0D\u5B58\u5728`),null)}throw new Error("Invalid block type")},B=(x,v,_)=>{var N;const E=(N=s.get(x))==null?void 0:N.value;if(s.has(x))s.get(x).value=v;else{const I=shallowRef(v);s.set(x,I)}if(v&&_){a.get(x);const I=[calcBlockStatus(v.type,v.fold),v.parentId,v.childrenIds,"docId"in v?v.docId:null,"src"in v?v.src:null];if(_.upsertBlockInfo(x,I),v.type=="normalBlock"){l.get(x);const L=[v.content,v.metadata];_.upsertBlockData(v.docId,x,L)}(E==null?void 0:E.type)=="normalBlock"&&v.type!="normalBlock"&&_.deleteBlockData(E.docId,x)}},M=(x,v)=>{var E;const _=(E=s.get(x))==null?void 0:E.value;_&&v&&(_.deleted=!0,s.delete(x),v.deleteBlockInfo(x),_.type=="normalBlock"&&v.deleteBlockData(_.docId,x))};return{createBlockTransaction:g,addBlock:(x,v)=>g(v).addBlock(x).commit(),updateBlock:(x,v)=>g(v).updateBlock(x).commit(),deleteBlock:(x,v)=>g(v).deleteBlock(x).commit()}}const lower16=65535,factor16=Math.pow(2,16);function makeRecover(r,e){return r+e*factor16}function recoverIndex(r){return r&lower16}function recoverOffset(r){return(r-(r&lower16))/factor16}const DEL_BEFORE=1,DEL_AFTER=2,DEL_ACROSS=4,DEL_SIDE=8;class MapResult{constructor(e,n,o){this.pos=e,this.delInfo=n,this.recover=o}get deleted(){return(this.delInfo&DEL_SIDE)>0}get deletedBefore(){return(this.delInfo&(DEL_BEFORE|DEL_ACROSS))>0}get deletedAfter(){return(this.delInfo&(DEL_AFTER|DEL_ACROSS))>0}get deletedAcross(){return(this.delInfo&DEL_ACROSS)>0}}class StepMap{constructor(e,n=!1){if(this.ranges=e,this.inverted=n,!e.length&&StepMap.empty)return StepMap.empty}recover(e){let n=0,o=recoverIndex(e);if(!this.inverted)for(let s=0;s<o;s++)n+=this.ranges[s*3+2]-this.ranges[s*3+1];return this.ranges[o*3]+n+recoverOffset(e)}mapResult(e,n=1){return this._map(e,n,!1)}map(e,n=1){return this._map(e,n,!0)}_map(e,n,o){let s=0,a=this.inverted?2:1,l=this.inverted?1:2;for(let c=0;c<this.ranges.length;c+=3){let d=this.ranges[c]-(this.inverted?s:0);if(d>e)break;let u=this.ranges[c+a],m=this.ranges[c+l],f=d+u;if(e<=f){let p=u?e==d?-1:e==f?1:n:n,g=d+s+(p<0?0:m);if(o)return g;let y=e==(n<0?d:f)?null:makeRecover(c/3,e-d),b=e==d?DEL_AFTER:e==f?DEL_BEFORE:DEL_ACROSS;return(n<0?e!=d:e!=f)&&(b|=DEL_SIDE),new MapResult(g,b,y)}s+=m-u}return o?e+s:new MapResult(e+s,0,null)}touches(e,n){let o=0,s=recoverIndex(n),a=this.inverted?2:1,l=this.inverted?1:2;for(let c=0;c<this.ranges.length;c+=3){let d=this.ranges[c]-(this.inverted?o:0);if(d>e)break;let u=this.ranges[c+a],m=d+u;if(e<=m&&c==s*3)return!0;o+=this.ranges[c+l]-u}return!1}forEach(e){let n=this.inverted?2:1,o=this.inverted?1:2;for(let s=0,a=0;s<this.ranges.length;s+=3){let l=this.ranges[s],c=l-(this.inverted?a:0),d=l+(this.inverted?0:a),u=this.ranges[s+n],m=this.ranges[s+o];e(c,c+u,d,d+m),a+=m-u}}invert(){return new StepMap(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?StepMap.empty:new StepMap(e<0?[0,-e,0]:[0,0,e])}}StepMap.empty=new StepMap([]);class Mapping{constructor(e=[],n,o=0,s=e.length){this.maps=e,this.mirror=n,this.from=o,this.to=s}slice(e=0,n=this.maps.length){return new Mapping(this.maps,this.mirror,e,n)}copy(){return new Mapping(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)}appendMap(e,n){this.to=this.maps.push(e),n!=null&&this.setMirror(this.maps.length-1,n)}appendMapping(e){for(let n=0,o=this.maps.length;n<e.maps.length;n++){let s=e.getMirror(n);this.appendMap(e.maps[n],s!=null&&s<n?o+s:void 0)}}getMirror(e){if(this.mirror){for(let n=0;n<this.mirror.length;n++)if(this.mirror[n]==e)return this.mirror[n+(n%2?-1:1)]}}setMirror(e,n){this.mirror||(this.mirror=[]),this.mirror.push(e,n)}appendMappingInverted(e){for(let n=e.maps.length-1,o=this.maps.length+e.maps.length;n>=0;n--){let s=e.getMirror(n);this.appendMap(e.maps[n].invert(),s!=null&&s>n?o-s-1:void 0)}}invert(){let e=new Mapping;return e.appendMappingInverted(this),e}map(e,n=1){if(this.mirror)return this._map(e,n,!0);for(let o=this.from;o<this.to;o++)e=this.maps[o].map(e,n);return e}mapResult(e,n=1){return this._map(e,n,!1)}_map(e,n,o){let s=0;for(let a=this.from;a<this.to;a++){let l=this.maps[a],c=l.mapResult(e,n);if(c.recover!=null){let d=this.getMirror(a);if(d!=null&&d>a&&d<this.to){a=d,e=this.maps[d].recover(c.recover);continue}}s|=c.delInfo,e=c.pos}return o?e:new MapResult(e,s,null)}}const stepsByID=Object.create(null);class Step{getMap(){return StepMap.empty}merge(e){return null}static fromJSON(e,n){if(!n||!n.stepType)throw new RangeError("Invalid input for Step.fromJSON");let o=stepsByID[n.stepType];if(!o)throw new RangeError(`No step type ${n.stepType} defined`);return o.fromJSON(e,n)}static jsonID(e,n){if(e in stepsByID)throw new RangeError("Duplicate use of step JSON ID "+e);return stepsByID[e]=n,n.prototype.jsonID=e,n}}class StepResult{constructor(e,n){this.doc=e,this.failed=n}static ok(e){return new StepResult(e,null)}static fail(e){return new StepResult(null,e)}static fromReplace(e,n,o,s){try{return StepResult.ok(e.replace(n,o,s))}catch(a){if(a instanceof ReplaceError)return StepResult.fail(a.message);throw a}}}function mapFragment(r,e,n){let o=[];for(let s=0;s<r.childCount;s++){let a=r.child(s);a.content.size&&(a=a.copy(mapFragment(a.content,e,a))),a.isInline&&(a=e(a,n,s)),o.push(a)}return Fragment.fromArray(o)}class AddMarkStep extends Step{constructor(e,n,o){super(),this.from=e,this.to=n,this.mark=o}apply(e){let n=e.slice(this.from,this.to),o=e.resolve(this.from),s=o.node(o.sharedDepth(this.to)),a=new Slice(mapFragment(n.content,(l,c)=>!l.isAtom||!c.type.allowsMarkType(this.mark.type)?l:l.mark(this.mark.addToSet(l.marks)),s),n.openStart,n.openEnd);return StepResult.fromReplace(e,this.from,this.to,a)}invert(){return new RemoveMarkStep(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),o=e.mapResult(this.to,-1);return n.deleted&&o.deleted||n.pos>=o.pos?null:new AddMarkStep(n.pos,o.pos,this.mark)}merge(e){return e instanceof AddMarkStep&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new AddMarkStep(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new AddMarkStep(n.from,n.to,e.markFromJSON(n.mark))}}Step.jsonID("addMark",AddMarkStep);class RemoveMarkStep extends Step{constructor(e,n,o){super(),this.from=e,this.to=n,this.mark=o}apply(e){let n=e.slice(this.from,this.to),o=new Slice(mapFragment(n.content,s=>s.mark(this.mark.removeFromSet(s.marks)),e),n.openStart,n.openEnd);return StepResult.fromReplace(e,this.from,this.to,o)}invert(){return new AddMarkStep(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),o=e.mapResult(this.to,-1);return n.deleted&&o.deleted||n.pos>=o.pos?null:new RemoveMarkStep(n.pos,o.pos,this.mark)}merge(e){return e instanceof RemoveMarkStep&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new RemoveMarkStep(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new RemoveMarkStep(n.from,n.to,e.markFromJSON(n.mark))}}Step.jsonID("removeMark",RemoveMarkStep);class AddNodeMarkStep extends Step{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return StepResult.fail("No node at mark step's position");let o=n.type.create(n.attrs,null,this.mark.addToSet(n.marks));return StepResult.fromReplace(e,this.pos,this.pos+1,new Slice(Fragment.from(o),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);if(n){let o=this.mark.addToSet(n.marks);if(o.length==n.marks.length){for(let s=0;s<n.marks.length;s++)if(!n.marks[s].isInSet(o))return new AddNodeMarkStep(this.pos,n.marks[s]);return new AddNodeMarkStep(this.pos,this.mark)}}return new RemoveNodeMarkStep(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new AddNodeMarkStep(n.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new AddNodeMarkStep(n.pos,e.markFromJSON(n.mark))}}Step.jsonID("addNodeMark",AddNodeMarkStep);class RemoveNodeMarkStep extends Step{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return StepResult.fail("No node at mark step's position");let o=n.type.create(n.attrs,null,this.mark.removeFromSet(n.marks));return StepResult.fromReplace(e,this.pos,this.pos+1,new Slice(Fragment.from(o),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);return!n||!this.mark.isInSet(n.marks)?this:new AddNodeMarkStep(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new RemoveNodeMarkStep(n.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new RemoveNodeMarkStep(n.pos,e.markFromJSON(n.mark))}}Step.jsonID("removeNodeMark",RemoveNodeMarkStep);class ReplaceStep extends Step{constructor(e,n,o,s=!1){super(),this.from=e,this.to=n,this.slice=o,this.structure=s}apply(e){return this.structure&&contentBetween(e,this.from,this.to)?StepResult.fail("Structure replace would overwrite content"):StepResult.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new StepMap([this.from,this.to-this.from,this.slice.size])}invert(e){return new ReplaceStep(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let n=e.mapResult(this.from,1),o=e.mapResult(this.to,-1);return n.deletedAcross&&o.deletedAcross?null:new ReplaceStep(n.pos,Math.max(n.pos,o.pos),this.slice)}merge(e){if(!(e instanceof ReplaceStep)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let n=this.slice.size+e.slice.size==0?Slice.empty:new Slice(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new ReplaceStep(this.from,this.to+(e.to-e.from),n,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let n=this.slice.size+e.slice.size==0?Slice.empty:new Slice(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new ReplaceStep(e.from,this.to,n,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new ReplaceStep(n.from,n.to,Slice.fromJSON(e,n.slice),!!n.structure)}}Step.jsonID("replace",ReplaceStep);class ReplaceAroundStep extends Step{constructor(e,n,o,s,a,l,c=!1){super(),this.from=e,this.to=n,this.gapFrom=o,this.gapTo=s,this.slice=a,this.insert=l,this.structure=c}apply(e){if(this.structure&&(contentBetween(e,this.from,this.gapFrom)||contentBetween(e,this.gapTo,this.to)))return StepResult.fail("Structure gap-replace would overwrite content");let n=e.slice(this.gapFrom,this.gapTo);if(n.openStart||n.openEnd)return StepResult.fail("Gap is not a flat range");let o=this.slice.insertAt(this.insert,n.content);return o?StepResult.fromReplace(e,this.from,this.to,o):StepResult.fail("Content does not fit in gap")}getMap(){return new StepMap([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let n=this.gapTo-this.gapFrom;return new ReplaceAroundStep(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let n=e.mapResult(this.from,1),o=e.mapResult(this.to,-1),s=this.from==this.gapFrom?n.pos:e.map(this.gapFrom,-1),a=this.to==this.gapTo?o.pos:e.map(this.gapTo,1);return n.deletedAcross&&o.deletedAcross||s<n.pos||a>o.pos?null:new ReplaceAroundStep(n.pos,o.pos,s,a,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number"||typeof n.gapFrom!="number"||typeof n.gapTo!="number"||typeof n.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new ReplaceAroundStep(n.from,n.to,n.gapFrom,n.gapTo,Slice.fromJSON(e,n.slice),n.insert,!!n.structure)}}Step.jsonID("replaceAround",ReplaceAroundStep);function contentBetween(r,e,n){let o=r.resolve(e),s=n-e,a=o.depth;for(;s>0&&a>0&&o.indexAfter(a)==o.node(a).childCount;)a--,s--;if(s>0){let l=o.node(a).maybeChild(o.indexAfter(a));for(;s>0;){if(!l||l.isLeaf)return!0;l=l.firstChild,s--}}return!1}function addMark(r,e,n,o){let s=[],a=[],l,c;r.doc.nodesBetween(e,n,(d,u,m)=>{if(!d.isInline)return;let f=d.marks;if(!o.isInSet(f)&&m.type.allowsMarkType(o.type)){let p=Math.max(u,e),g=Math.min(u+d.nodeSize,n),y=o.addToSet(f);for(let b=0;b<f.length;b++)f[b].isInSet(y)||(l&&l.to==p&&l.mark.eq(f[b])?l.to=g:s.push(l=new RemoveMarkStep(p,g,f[b])));c&&c.to==p?c.to=g:a.push(c=new AddMarkStep(p,g,o))}}),s.forEach(d=>r.step(d)),a.forEach(d=>r.step(d))}function removeMark(r,e,n,o){let s=[],a=0;r.doc.nodesBetween(e,n,(l,c)=>{if(!l.isInline)return;a++;let d=null;if(o instanceof MarkType){let u=l.marks,m;for(;m=o.isInSet(u);)(d||(d=[])).push(m),u=m.removeFromSet(u)}else o?o.isInSet(l.marks)&&(d=[o]):d=l.marks;if(d&&d.length){let u=Math.min(c+l.nodeSize,n);for(let m=0;m<d.length;m++){let f=d[m],p;for(let g=0;g<s.length;g++){let y=s[g];y.step==a-1&&f.eq(s[g].style)&&(p=y)}p?(p.to=u,p.step=a):s.push({style:f,from:Math.max(c,e),to:u,step:a})}}}),s.forEach(l=>r.step(new RemoveMarkStep(l.from,l.to,l.style)))}function clearIncompatible(r,e,n,o=n.contentMatch,s=!0){let a=r.doc.nodeAt(e),l=[],c=e+1;for(let d=0;d<a.childCount;d++){let u=a.child(d),m=c+u.nodeSize,f=o.matchType(u.type);if(!f)l.push(new ReplaceStep(c,m,Slice.empty));else{o=f;for(let p=0;p<u.marks.length;p++)n.allowsMarkType(u.marks[p].type)||r.step(new RemoveMarkStep(c,m,u.marks[p]));if(s&&u.isText&&n.whitespace!="pre"){let p,g=/\r?\n|\r/g,y;for(;p=g.exec(u.text);)y||(y=new Slice(Fragment.from(n.schema.text(" ",n.allowedMarks(u.marks))),0,0)),l.push(new ReplaceStep(c+p.index,c+p.index+p[0].length,y))}}c=m}if(!o.validEnd){let d=o.fillBefore(Fragment.empty,!0);r.replace(c,c,new Slice(d,0,0))}for(let d=l.length-1;d>=0;d--)r.step(l[d])}function lift(r,e,n){let{$from:o,$to:s,depth:a}=e,l=o.before(a+1),c=s.after(a+1),d=l,u=c,m=Fragment.empty,f=0;for(let y=a,b=!1;y>n;y--)b||o.index(y)>0?(b=!0,m=Fragment.from(o.node(y).copy(m)),f++):d--;let p=Fragment.empty,g=0;for(let y=a,b=!1;y>n;y--)b||s.after(y+1)<s.end(y)?(b=!0,p=Fragment.from(s.node(y).copy(p)),g++):u++;r.step(new ReplaceAroundStep(d,u,l,c,new Slice(m.append(p),f,g),m.size-f,!0))}function wrap(r,e,n){let o=Fragment.empty;for(let l=n.length-1;l>=0;l--){if(o.size){let c=n[l].type.contentMatch.matchFragment(o);if(!c||!c.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}o=Fragment.from(n[l].type.create(n[l].attrs,o))}let s=e.start,a=e.end;r.step(new ReplaceAroundStep(s,a,s,a,new Slice(o,0,0),n.length,!0))}function setBlockType(r,e,n,o,s){if(!o.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let a=r.steps.length;r.doc.nodesBetween(e,n,(l,c)=>{let d=typeof s=="function"?s(l):s;if(l.isTextblock&&!l.hasMarkup(o,d)&&canChangeType(r.doc,r.mapping.slice(a).map(c),o)){let u=null;if(o.schema.linebreakReplacement){let g=o.whitespace=="pre",y=!!o.contentMatch.matchType(o.schema.linebreakReplacement);g&&!y?u=!1:!g&&y&&(u=!0)}u===!1&&replaceLinebreaks(r,l,c,a),clearIncompatible(r,r.mapping.slice(a).map(c,1),o,void 0,u===null);let m=r.mapping.slice(a),f=m.map(c,1),p=m.map(c+l.nodeSize,1);return r.step(new ReplaceAroundStep(f,p,f+1,p-1,new Slice(Fragment.from(o.create(d,null,l.marks)),0,0),1,!0)),u===!0&&replaceNewlines(r,l,c,a),!1}})}function replaceNewlines(r,e,n,o){e.forEach((s,a)=>{if(s.isText){let l,c=/\r?\n|\r/g;for(;l=c.exec(s.text);){let d=r.mapping.slice(o).map(n+1+a+l.index);r.replaceWith(d,d+1,e.type.schema.linebreakReplacement.create())}}})}function replaceLinebreaks(r,e,n,o){e.forEach((s,a)=>{if(s.type==s.type.schema.linebreakReplacement){let l=r.mapping.slice(o).map(n+1+a);r.replaceWith(l,l+1,e.type.schema.text(`
`))}})}function canChangeType(r,e,n){let o=r.resolve(e),s=o.index();return o.parent.canReplaceWith(s,s+1,n)}function setNodeMarkup(r,e,n,o,s){let a=r.doc.nodeAt(e);if(!a)throw new RangeError("No node at given position");n||(n=a.type);let l=n.create(o,null,s||a.marks);if(a.isLeaf)return r.replaceWith(e,e+a.nodeSize,l);if(!n.validContent(a.content))throw new RangeError("Invalid content for node type "+n.name);r.step(new ReplaceAroundStep(e,e+a.nodeSize,e+1,e+a.nodeSize-1,new Slice(Fragment.from(l),0,0),1,!0))}function split(r,e,n=1,o){let s=r.doc.resolve(e),a=Fragment.empty,l=Fragment.empty;for(let c=s.depth,d=s.depth-n,u=n-1;c>d;c--,u--){a=Fragment.from(s.node(c).copy(a));let m=o&&o[u];l=Fragment.from(m?m.type.create(m.attrs,l):s.node(c).copy(l))}r.step(new ReplaceStep(e,e,new Slice(a.append(l),n,n),!0))}function join(r,e,n){let o=null,{linebreakReplacement:s}=r.doc.type.schema,a=r.doc.resolve(e-n),l=a.node().type;if(s&&l.inlineContent){let m=l.whitespace=="pre",f=!!l.contentMatch.matchType(s);m&&!f?o=!1:!m&&f&&(o=!0)}let c=r.steps.length;if(o===!1){let m=r.doc.resolve(e+n);replaceLinebreaks(r,m.node(),m.before(),c)}l.inlineContent&&clearIncompatible(r,e+n-1,l,a.node().contentMatchAt(a.index()),o==null);let d=r.mapping.slice(c),u=d.map(e-n);if(r.step(new ReplaceStep(u,d.map(e+n,-1),Slice.empty,!0)),o===!0){let m=r.doc.resolve(u);replaceNewlines(r,m.node(),m.before(),r.steps.length)}return r}function insertPoint(r,e,n){let o=r.resolve(e);if(o.parent.canReplaceWith(o.index(),o.index(),n))return e;if(o.parentOffset==0)for(let s=o.depth-1;s>=0;s--){let a=o.index(s);if(o.node(s).canReplaceWith(a,a,n))return o.before(s+1);if(a>0)return null}if(o.parentOffset==o.parent.content.size)for(let s=o.depth-1;s>=0;s--){let a=o.indexAfter(s);if(o.node(s).canReplaceWith(a,a,n))return o.after(s+1);if(a<o.node(s).childCount)return null}return null}function dropPoint(r,e,n){let o=r.resolve(e);if(!n.content.size)return e;let s=n.content;for(let a=0;a<n.openStart;a++)s=s.firstChild.content;for(let a=1;a<=(n.openStart==0&&n.size?2:1);a++)for(let l=o.depth;l>=0;l--){let c=l==o.depth?0:o.pos<=(o.start(l+1)+o.end(l+1))/2?-1:1,d=o.index(l)+(c>0?1:0),u=o.node(l),m=!1;if(a==1)m=u.canReplace(d,d,s);else{let f=u.contentMatchAt(d).findWrapping(s.firstChild.type);m=f&&u.canReplaceWith(d,d,f[0])}if(m)return c==0?o.pos:c<0?o.before(l+1):o.after(l+1)}return null}function replaceStep(r,e,n=e,o=Slice.empty){if(e==n&&!o.size)return null;let s=r.resolve(e),a=r.resolve(n);return fitsTrivially(s,a,o)?new ReplaceStep(e,n,o):new Fitter(s,a,o).fit()}function fitsTrivially(r,e,n){return!n.openStart&&!n.openEnd&&r.start()==e.start()&&r.parent.canReplace(r.index(),e.index(),n.content)}class Fitter{constructor(e,n,o){this.$from=e,this.$to=n,this.unplaced=o,this.frontier=[],this.placed=Fragment.empty;for(let s=0;s<=e.depth;s++){let a=e.node(s);this.frontier.push({type:a.type,match:a.contentMatchAt(e.indexAfter(s))})}for(let s=e.depth;s>0;s--)this.placed=Fragment.from(e.node(s).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let u=this.findFittable();u?this.placeNodes(u):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,o=this.$from,s=this.close(e<0?this.$to:o.doc.resolve(e));if(!s)return null;let a=this.placed,l=o.depth,c=s.depth;for(;l&&c&&a.childCount==1;)a=a.firstChild.content,l--,c--;let d=new Slice(a,l,c);return e>-1?new ReplaceAroundStep(o.pos,e,this.$to.pos,this.$to.end(),d,n):d.size||o.pos!=this.$to.pos?new ReplaceStep(o.pos,s.pos,d):null}findFittable(){let e=this.unplaced.openStart;for(let n=this.unplaced.content,o=0,s=this.unplaced.openEnd;o<e;o++){let a=n.firstChild;if(n.childCount>1&&(s=0),a.type.spec.isolating&&s<=o){e=o;break}n=a.content}for(let n=1;n<=2;n++)for(let o=n==1?e:this.unplaced.openStart;o>=0;o--){let s,a=null;o?(a=contentAt(this.unplaced.content,o-1).firstChild,s=a.content):s=this.unplaced.content;let l=s.firstChild;for(let c=this.depth;c>=0;c--){let{type:d,match:u}=this.frontier[c],m,f=null;if(n==1&&(l?u.matchType(l.type)||(f=u.fillBefore(Fragment.from(l),!1)):a&&d.compatibleContent(a.type)))return{sliceDepth:o,frontierDepth:c,parent:a,inject:f};if(n==2&&l&&(m=u.findWrapping(l.type)))return{sliceDepth:o,frontierDepth:c,parent:a,wrap:m};if(a&&u.matchType(a.type))break}}}openMore(){let{content:e,openStart:n,openEnd:o}=this.unplaced,s=contentAt(e,n);return!s.childCount||s.firstChild.isLeaf?!1:(this.unplaced=new Slice(e,n+1,Math.max(o,s.size+n>=e.size-o?n+1:0)),!0)}dropNode(){let{content:e,openStart:n,openEnd:o}=this.unplaced,s=contentAt(e,n);if(s.childCount<=1&&n>0){let a=e.size-n<=n+s.size;this.unplaced=new Slice(dropFromFragment(e,n-1,1),n-1,a?n-1:o)}else this.unplaced=new Slice(dropFromFragment(e,n,1),n,o)}placeNodes({sliceDepth:e,frontierDepth:n,parent:o,inject:s,wrap:a}){for(;this.depth>n;)this.closeFrontierNode();if(a)for(let b=0;b<a.length;b++)this.openFrontierNode(a[b]);let l=this.unplaced,c=o?o.content:l.content,d=l.openStart-e,u=0,m=[],{match:f,type:p}=this.frontier[n];if(s){for(let b=0;b<s.childCount;b++)m.push(s.child(b));f=f.matchFragment(s)}let g=c.size+e-(l.content.size-l.openEnd);for(;u<c.childCount;){let b=c.child(u),k=f.matchType(b.type);if(!k)break;u++,(u>1||d==0||b.content.size)&&(f=k,m.push(closeNodeStart(b.mark(p.allowedMarks(b.marks)),u==1?d:0,u==c.childCount?g:-1)))}let y=u==c.childCount;y||(g=-1),this.placed=addToFragment(this.placed,n,Fragment.from(m)),this.frontier[n].match=f,y&&g<0&&o&&o.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let b=0,k=c;b<g;b++){let w=k.lastChild;this.frontier.push({type:w.type,match:w.contentMatchAt(w.childCount)}),k=w.content}this.unplaced=y?e==0?Slice.empty:new Slice(dropFromFragment(l.content,e-1,1),e-1,g<0?l.openEnd:e-1):new Slice(dropFromFragment(l.content,e,u),l.openStart,l.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],n;if(!e.type.isTextblock||!contentAfterFits(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(n=this.findCloseLevel(this.$to))&&n.depth==this.depth)return-1;let{depth:o}=this.$to,s=this.$to.after(o);for(;o>1&&s==this.$to.end(--o);)++s;return s}findCloseLevel(e){e:for(let n=Math.min(this.depth,e.depth);n>=0;n--){let{match:o,type:s}=this.frontier[n],a=n<e.depth&&e.end(n+1)==e.pos+(e.depth-(n+1)),l=contentAfterFits(e,n,s,o,a);if(l){for(let c=n-1;c>=0;c--){let{match:d,type:u}=this.frontier[c],m=contentAfterFits(e,c,u,d,!0);if(!m||m.childCount)continue e}return{depth:n,fit:l,move:a?e.doc.resolve(e.after(n+1)):e}}}}close(e){let n=this.findCloseLevel(e);if(!n)return null;for(;this.depth>n.depth;)this.closeFrontierNode();n.fit.childCount&&(this.placed=addToFragment(this.placed,n.depth,n.fit)),e=n.move;for(let o=n.depth+1;o<=e.depth;o++){let s=e.node(o),a=s.type.contentMatch.fillBefore(s.content,!0,e.index(o));this.openFrontierNode(s.type,s.attrs,a)}return e}openFrontierNode(e,n=null,o){let s=this.frontier[this.depth];s.match=s.match.matchType(e),this.placed=addToFragment(this.placed,this.depth,Fragment.from(e.create(n,o))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let e=this.frontier.pop().match.fillBefore(Fragment.empty,!0);e.childCount&&(this.placed=addToFragment(this.placed,this.frontier.length,e))}}function dropFromFragment(r,e,n){return e==0?r.cutByIndex(n,r.childCount):r.replaceChild(0,r.firstChild.copy(dropFromFragment(r.firstChild.content,e-1,n)))}function addToFragment(r,e,n){return e==0?r.append(n):r.replaceChild(r.childCount-1,r.lastChild.copy(addToFragment(r.lastChild.content,e-1,n)))}function contentAt(r,e){for(let n=0;n<e;n++)r=r.firstChild.content;return r}function closeNodeStart(r,e,n){if(e<=0)return r;let o=r.content;return e>1&&(o=o.replaceChild(0,closeNodeStart(o.firstChild,e-1,o.childCount==1?n-1:0))),e>0&&(o=r.type.contentMatch.fillBefore(o).append(o),n<=0&&(o=o.append(r.type.contentMatch.matchFragment(o).fillBefore(Fragment.empty,!0)))),r.copy(o)}function contentAfterFits(r,e,n,o,s){let a=r.node(e),l=s?r.indexAfter(e):r.index(e);if(l==a.childCount&&!n.compatibleContent(a.type))return null;let c=o.fillBefore(a.content,!0,l);return c&&!invalidMarks(n,a.content,l)?c:null}function invalidMarks(r,e,n){for(let o=n;o<e.childCount;o++)if(!r.allowsMarks(e.child(o).marks))return!0;return!1}function definesContent(r){return r.spec.defining||r.spec.definingForContent}function replaceRange$1(r,e,n,o){if(!o.size)return r.deleteRange(e,n);let s=r.doc.resolve(e),a=r.doc.resolve(n);if(fitsTrivially(s,a,o))return r.step(new ReplaceStep(e,n,o));let l=coveredDepths(s,r.doc.resolve(n));l[l.length-1]==0&&l.pop();let c=-(s.depth+1);l.unshift(c);for(let p=s.depth,g=s.pos-1;p>0;p--,g--){let y=s.node(p).type.spec;if(y.defining||y.definingAsContext||y.isolating)break;l.indexOf(p)>-1?c=p:s.before(p)==g&&l.splice(1,0,-p)}let d=l.indexOf(c),u=[],m=o.openStart;for(let p=o.content,g=0;;g++){let y=p.firstChild;if(u.push(y),g==o.openStart)break;p=y.content}for(let p=m-1;p>=0;p--){let g=u[p],y=definesContent(g.type);if(y&&!g.sameMarkup(s.node(Math.abs(c)-1)))m=p;else if(y||!g.type.isTextblock)break}for(let p=o.openStart;p>=0;p--){let g=(p+m+1)%(o.openStart+1),y=u[g];if(y)for(let b=0;b<l.length;b++){let k=l[(b+d)%l.length],w=!0;k<0&&(w=!1,k=-k);let B=s.node(k-1),M=s.index(k-1);if(B.canReplaceWith(M,M,y.type,y.marks))return r.replace(s.before(k),w?a.after(k):n,new Slice(closeFragment(o.content,0,o.openStart,g),g,o.openEnd))}}let f=r.steps.length;for(let p=l.length-1;p>=0&&(r.replace(e,n,o),!(r.steps.length>f));p--){let g=l[p];g<0||(e=s.before(g),n=a.after(g))}}function closeFragment(r,e,n,o,s){if(e<n){let a=r.firstChild;r=r.replaceChild(0,a.copy(closeFragment(a.content,e+1,n,o,a)))}if(e>o){let a=s.contentMatchAt(0),l=a.fillBefore(r).append(r);r=l.append(a.matchFragment(l).fillBefore(Fragment.empty,!0))}return r}function replaceRangeWith(r,e,n,o){if(!o.isInline&&e==n&&r.doc.resolve(e).parent.content.size){let s=insertPoint(r.doc,e,o.type);s!=null&&(e=n=s)}r.replaceRange(e,n,new Slice(Fragment.from(o),0,0))}function deleteRange(r,e,n){let o=r.doc.resolve(e),s=r.doc.resolve(n),a=coveredDepths(o,s);for(let l=0;l<a.length;l++){let c=a[l],d=l==a.length-1;if(d&&c==0||o.node(c).type.contentMatch.validEnd)return r.delete(o.start(c),s.end(c));if(c>0&&(d||o.node(c-1).canReplace(o.index(c-1),s.indexAfter(c-1))))return r.delete(o.before(c),s.after(c))}for(let l=1;l<=o.depth&&l<=s.depth;l++)if(e-o.start(l)==o.depth-l&&n>o.end(l)&&s.end(l)-n!=s.depth-l&&o.start(l-1)==s.start(l-1)&&o.node(l-1).canReplace(o.index(l-1),s.index(l-1)))return r.delete(o.before(l),n);r.delete(e,n)}function coveredDepths(r,e){let n=[],o=Math.min(r.depth,e.depth);for(let s=o;s>=0;s--){let a=r.start(s);if(a<r.pos-(r.depth-s)||e.end(s)>e.pos+(e.depth-s)||r.node(s).type.spec.isolating||e.node(s).type.spec.isolating)break;(a==e.start(s)||s==r.depth&&s==e.depth&&r.parent.inlineContent&&e.parent.inlineContent&&s&&e.start(s-1)==a-1)&&n.push(s)}return n}class AttrStep extends Step{constructor(e,n,o){super(),this.pos=e,this.attr=n,this.value=o}apply(e){let n=e.nodeAt(this.pos);if(!n)return StepResult.fail("No node at attribute step's position");let o=Object.create(null);for(let a in n.attrs)o[a]=n.attrs[a];o[this.attr]=this.value;let s=n.type.create(o,null,n.marks);return StepResult.fromReplace(e,this.pos,this.pos+1,new Slice(Fragment.from(s),0,n.isLeaf?0:1))}getMap(){return StepMap.empty}invert(e){return new AttrStep(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new AttrStep(n.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.pos!="number"||typeof n.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new AttrStep(n.pos,n.attr,n.value)}}Step.jsonID("attr",AttrStep);class DocAttrStep extends Step{constructor(e,n){super(),this.attr=e,this.value=n}apply(e){let n=Object.create(null);for(let s in e.attrs)n[s]=e.attrs[s];n[this.attr]=this.value;let o=e.type.create(n,e.content,e.marks);return StepResult.ok(o)}getMap(){return StepMap.empty}invert(e){return new DocAttrStep(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new DocAttrStep(n.attr,n.value)}}Step.jsonID("docAttr",DocAttrStep);let TransformError=class extends Error{};TransformError=function r(e){let n=Error.call(this,e);return n.__proto__=r.prototype,n},TransformError.prototype=Object.create(Error.prototype),TransformError.prototype.constructor=TransformError,TransformError.prototype.name="TransformError";class Transform{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Mapping}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let n=this.maybeStep(e);if(n.failed)throw new TransformError(n.failed);return this}maybeStep(e){let n=e.apply(this.doc);return n.failed||this.addStep(e,n.doc),n}get docChanged(){return this.steps.length>0}addStep(e,n){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=n}replace(e,n=e,o=Slice.empty){let s=replaceStep(this.doc,e,n,o);return s&&this.step(s),this}replaceWith(e,n,o){return this.replace(e,n,new Slice(Fragment.from(o),0,0))}delete(e,n){return this.replace(e,n,Slice.empty)}insert(e,n){return this.replaceWith(e,e,n)}replaceRange(e,n,o){return replaceRange$1(this,e,n,o),this}replaceRangeWith(e,n,o){return replaceRangeWith(this,e,n,o),this}deleteRange(e,n){return deleteRange(this,e,n),this}lift(e,n){return lift(this,e,n),this}join(e,n=1){return join(this,e,n),this}wrap(e,n){return wrap(this,e,n),this}setBlockType(e,n=e,o,s=null){return setBlockType(this,e,n,o,s),this}setNodeMarkup(e,n,o=null,s){return setNodeMarkup(this,e,n,o,s),this}setNodeAttribute(e,n,o){return this.step(new AttrStep(e,n,o)),this}setDocAttribute(e,n){return this.step(new DocAttrStep(e,n)),this}addNodeMark(e,n){return this.step(new AddNodeMarkStep(e,n)),this}removeNodeMark(e,n){if(!(n instanceof Mark)){let o=this.doc.nodeAt(e);if(!o)throw new RangeError("No node at position "+e);if(n=n.isInSet(o.marks),!n)return this}return this.step(new RemoveNodeMarkStep(e,n)),this}split(e,n=1,o){return split(this,e,n,o),this}addMark(e,n,o){return addMark(this,e,n,o),this}removeMark(e,n,o){return removeMark(this,e,n,o),this}clearIncompatible(e,n,o){return clearIncompatible(this,e,n,o),this}}const classesById=Object.create(null);class Selection{constructor(e,n,o){this.$anchor=e,this.$head=n,this.ranges=o||[new SelectionRange$1(e.min(n),e.max(n))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let n=0;n<e.length;n++)if(e[n].$from.pos!=e[n].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,n=Slice.empty){let o=n.content.lastChild,s=null;for(let c=0;c<n.openEnd;c++)s=o,o=o.lastChild;let a=e.steps.length,l=this.ranges;for(let c=0;c<l.length;c++){let{$from:d,$to:u}=l[c],m=e.mapping.slice(a);e.replaceRange(m.map(d.pos),m.map(u.pos),c?Slice.empty:n),c==0&&selectionToInsertionEnd(e,a,(o?o.isInline:s&&s.isTextblock)?-1:1)}}replaceWith(e,n){let o=e.steps.length,s=this.ranges;for(let a=0;a<s.length;a++){let{$from:l,$to:c}=s[a],d=e.mapping.slice(o),u=d.map(l.pos),m=d.map(c.pos);a?e.deleteRange(u,m):(e.replaceRangeWith(u,m,n),selectionToInsertionEnd(e,o,n.isInline?-1:1))}}static findFrom(e,n,o=!1){let s=e.parent.inlineContent?new TextSelection(e):findSelectionIn(e.node(0),e.parent,e.pos,e.index(),n,o);if(s)return s;for(let a=e.depth-1;a>=0;a--){let l=n<0?findSelectionIn(e.node(0),e.node(a),e.before(a+1),e.index(a),n,o):findSelectionIn(e.node(0),e.node(a),e.after(a+1),e.index(a)+1,n,o);if(l)return l}return null}static near(e,n=1){return this.findFrom(e,n)||this.findFrom(e,-n)||new AllSelection(e.node(0))}static atStart(e){return findSelectionIn(e,e,0,0,1)||new AllSelection(e)}static atEnd(e){return findSelectionIn(e,e,e.content.size,e.childCount,-1)||new AllSelection(e)}static fromJSON(e,n){if(!n||!n.type)throw new RangeError("Invalid input for Selection.fromJSON");let o=classesById[n.type];if(!o)throw new RangeError(`No selection type ${n.type} defined`);return o.fromJSON(e,n)}static jsonID(e,n){if(e in classesById)throw new RangeError("Duplicate use of selection JSON ID "+e);return classesById[e]=n,n.prototype.jsonID=e,n}getBookmark(){return TextSelection.between(this.$anchor,this.$head).getBookmark()}}Selection.prototype.visible=!0;let SelectionRange$1=class{constructor(r,e){this.$from=r,this.$to=e}},warnedAboutTextSelection=!1;function checkTextSelection(r){!warnedAboutTextSelection&&!r.parent.inlineContent&&(warnedAboutTextSelection=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+r.parent.type.name+")"))}class TextSelection extends Selection{constructor(e,n=e){checkTextSelection(e),checkTextSelection(n),super(e,n)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,n){let o=e.resolve(n.map(this.head));if(!o.parent.inlineContent)return Selection.near(o);let s=e.resolve(n.map(this.anchor));return new TextSelection(s.parent.inlineContent?s:o,o)}replace(e,n=Slice.empty){if(super.replace(e,n),n==Slice.empty){let o=this.$from.marksAcross(this.$to);o&&e.ensureMarks(o)}}eq(e){return e instanceof TextSelection&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new TextBookmark(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,n){if(typeof n.anchor!="number"||typeof n.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new TextSelection(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,o=n){let s=e.resolve(n);return new this(s,o==n?s:e.resolve(o))}static between(e,n,o){let s=e.pos-n.pos;if((!o||s)&&(o=s>=0?1:-1),!n.parent.inlineContent){let a=Selection.findFrom(n,o,!0)||Selection.findFrom(n,-o,!0);if(a)n=a.$head;else return Selection.near(n,o)}return e.parent.inlineContent||(s==0?e=n:(e=(Selection.findFrom(e,-o,!0)||Selection.findFrom(e,o,!0)).$anchor,e.pos<n.pos!=s<0&&(e=n))),new TextSelection(e,n)}}Selection.jsonID("text",TextSelection);class TextBookmark{constructor(e,n){this.anchor=e,this.head=n}map(e){return new TextBookmark(e.map(this.anchor),e.map(this.head))}resolve(e){return TextSelection.between(e.resolve(this.anchor),e.resolve(this.head))}}class NodeSelection extends Selection{constructor(e){let n=e.nodeAfter,o=e.node(0).resolve(e.pos+n.nodeSize);super(e,o),this.node=n}map(e,n){let{deleted:o,pos:s}=n.mapResult(this.anchor),a=e.resolve(s);return o?Selection.near(a):new NodeSelection(a)}content(){return new Slice(Fragment.from(this.node),0,0)}eq(e){return e instanceof NodeSelection&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new NodeBookmark(this.anchor)}static fromJSON(e,n){if(typeof n.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new NodeSelection(e.resolve(n.anchor))}static create(e,n){return new NodeSelection(e.resolve(n))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}NodeSelection.prototype.visible=!1,Selection.jsonID("node",NodeSelection);class NodeBookmark{constructor(e){this.anchor=e}map(e){let{deleted:n,pos:o}=e.mapResult(this.anchor);return n?new TextBookmark(o,o):new NodeBookmark(o)}resolve(e){let n=e.resolve(this.anchor),o=n.nodeAfter;return o&&NodeSelection.isSelectable(o)?new NodeSelection(n):Selection.near(n)}}class AllSelection extends Selection{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,n=Slice.empty){if(n==Slice.empty){e.delete(0,e.doc.content.size);let o=Selection.atStart(e.doc);o.eq(e.selection)||e.setSelection(o)}else super.replace(e,n)}toJSON(){return{type:"all"}}static fromJSON(e){return new AllSelection(e)}map(e){return new AllSelection(e)}eq(e){return e instanceof AllSelection}getBookmark(){return AllBookmark}}Selection.jsonID("all",AllSelection);const AllBookmark={map(){return this},resolve(r){return new AllSelection(r)}};function findSelectionIn(r,e,n,o,s,a=!1){if(e.inlineContent)return TextSelection.create(r,n);for(let l=o-(s>0?0:1);s>0?l<e.childCount:l>=0;l+=s){let c=e.child(l);if(c.isAtom){if(!a&&NodeSelection.isSelectable(c))return NodeSelection.create(r,n-(s<0?c.nodeSize:0))}else{let d=findSelectionIn(r,c,n+s,s<0?c.childCount:0,s,a);if(d)return d}n+=c.nodeSize*s}return null}function selectionToInsertionEnd(r,e,n){let o=r.steps.length-1;if(o<e)return;let s=r.steps[o];if(!(s instanceof ReplaceStep||s instanceof ReplaceAroundStep))return;let a=r.mapping.maps[o],l;a.forEach((c,d,u,m)=>{l==null&&(l=m)}),r.setSelection(Selection.near(r.doc.resolve(l),n))}const UPDATED_SEL=1,UPDATED_MARKS=2,UPDATED_SCROLL=4;let Transaction$1=class extends Transform{constructor(r){super(r.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=r.selection,this.storedMarks=r.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(r){if(r.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=r,this.curSelectionFor=this.steps.length,this.updated=(this.updated|UPDATED_SEL)&-3,this.storedMarks=null,this}get selectionSet(){return(this.updated&UPDATED_SEL)>0}setStoredMarks(r){return this.storedMarks=r,this.updated|=UPDATED_MARKS,this}ensureMarks(r){return Mark.sameSet(this.storedMarks||this.selection.$from.marks(),r)||this.setStoredMarks(r),this}addStoredMark(r){return this.ensureMarks(r.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(r){return this.ensureMarks(r.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&UPDATED_MARKS)>0}addStep(r,e){super.addStep(r,e),this.updated=this.updated&-3,this.storedMarks=null}setTime(r){return this.time=r,this}replaceSelection(r){return this.selection.replace(this,r),this}replaceSelectionWith(r,e=!0){let n=this.selection;return e&&(r=r.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||Mark.none))),n.replaceWith(this,r),this}deleteSelection(){return this.selection.replace(this),this}insertText(r,e,n){let o=this.doc.type.schema;if(e==null)return r?this.replaceSelectionWith(o.text(r),!0):this.deleteSelection();{if(n==null&&(n=e),n=n??e,!r)return this.deleteRange(e,n);let s=this.storedMarks;if(!s){let a=this.doc.resolve(e);s=n==e?a.marks():a.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(e,n,o.text(r,s)),this.selection.empty||this.setSelection(Selection.near(this.selection.$to)),this}}setMeta(r,e){return this.meta[typeof r=="string"?r:r.key]=e,this}getMeta(r){return this.meta[typeof r=="string"?r:r.key]}get isGeneric(){for(let r in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=UPDATED_SCROLL,this}get scrolledIntoView(){return(this.updated&UPDATED_SCROLL)>0}};function bind(r,e){return!e||!r?r:r.bind(e)}class FieldDesc{constructor(e,n,o){this.name=e,this.init=bind(n.init,o),this.apply=bind(n.apply,o)}}const baseFields=[new FieldDesc("doc",{init(r){return r.doc||r.schema.topNodeType.createAndFill()},apply(r){return r.doc}}),new FieldDesc("selection",{init(r,e){return r.selection||Selection.atStart(e.doc)},apply(r){return r.selection}}),new FieldDesc("storedMarks",{init(r){return r.storedMarks||null},apply(r,e,n,o){return o.selection.$cursor?r.storedMarks:null}}),new FieldDesc("scrollToSelection",{init(){return 0},apply(r,e){return r.scrolledIntoView?e+1:e}})];let Configuration$1=class{constructor(r,e){this.schema=r,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=baseFields.slice(),e&&e.forEach(n=>{if(this.pluginsByKey[n.key])throw new RangeError("Adding different instances of a keyed plugin ("+n.key+")");this.plugins.push(n),this.pluginsByKey[n.key]=n,n.spec.state&&this.fields.push(new FieldDesc(n.key,n.spec.state,n))})}},EditorState$1=class Se{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,n=-1){for(let o=0;o<this.config.plugins.length;o++)if(o!=n){let s=this.config.plugins[o];if(s.spec.filterTransaction&&!s.spec.filterTransaction.call(s,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let n=[e],o=this.applyInner(e),s=null;for(;;){let a=!1;for(let l=0;l<this.config.plugins.length;l++){let c=this.config.plugins[l];if(c.spec.appendTransaction){let d=s?s[l].n:0,u=s?s[l].state:this,m=d<n.length&&c.spec.appendTransaction.call(c,d?n.slice(d):n,u,o);if(m&&o.filterTransaction(m,l)){if(m.setMeta("appendedTransaction",e),!s){s=[];for(let f=0;f<this.config.plugins.length;f++)s.push(f<l?{state:o,n:n.length}:{state:this,n:0})}n.push(m),o=o.applyInner(m),a=!0}s&&(s[l]={state:o,n:n.length})}}if(!a)return{state:o,transactions:n}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let n=new Se(this.config),o=this.config.fields;for(let s=0;s<o.length;s++){let a=o[s];n[a.name]=a.apply(e,this[a.name],this,n)}return n}get tr(){return new Transaction$1(this)}static create(e){let n=new Configuration$1(e.doc?e.doc.type.schema:e.schema,e.plugins),o=new Se(n);for(let s=0;s<n.fields.length;s++)o[n.fields[s].name]=n.fields[s].init(e,o);return o}reconfigure(e){let n=new Configuration$1(this.schema,e.plugins),o=n.fields,s=new Se(n);for(let a=0;a<o.length;a++){let l=o[a].name;s[l]=this.hasOwnProperty(l)?this[l]:o[a].init(e,s)}return s}toJSON(e){let n={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(n.storedMarks=this.storedMarks.map(o=>o.toJSON())),e&&typeof e=="object")for(let o in e){if(o=="doc"||o=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let s=e[o],a=s.spec.state;a&&a.toJSON&&(n[o]=a.toJSON.call(s,this[s.key]))}return n}static fromJSON(e,n,o){if(!n)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let s=new Configuration$1(e.schema,e.plugins),a=new Se(s);return s.fields.forEach(l=>{if(l.name=="doc")a.doc=Node$1.fromJSON(e.schema,n.doc);else if(l.name=="selection")a.selection=Selection.fromJSON(a.doc,n.selection);else if(l.name=="storedMarks")n.storedMarks&&(a.storedMarks=n.storedMarks.map(e.schema.markFromJSON));else{if(o)for(let c in o){let d=o[c],u=d.spec.state;if(d.key==l.name&&u&&u.fromJSON&&Object.prototype.hasOwnProperty.call(n,c)){a[l.name]=u.fromJSON.call(d,e,n[c],a);return}}a[l.name]=l.init(e,a)}}),a}};function bindProps(r,e,n){for(let o in r){let s=r[o];s instanceof Function?s=s.bind(e):o=="handleDOMEvents"&&(s=bindProps(s,e,{})),n[o]=s}return n}class Plugin{constructor(e){this.spec=e,this.props={},e.props&&bindProps(e.props,this,this.props),this.key=e.key?e.key.key:createKey("plugin")}getState(e){return e[this.key]}}const keys=Object.create(null);function createKey(r){return r in keys?r+"$"+ ++keys[r]:(keys[r]=0,r+"$")}const domIndex$1=function(r){for(var e=0;;e++)if(r=r.previousSibling,!r)return e},parentNode=function(r){let e=r.assignedSlot||r.parentNode;return e&&e.nodeType==11?e.host:e};let reusedRange=null;const textRange$1=function(r,e,n){let o=reusedRange||(reusedRange=document.createRange());return o.setEnd(r,n??r.nodeValue.length),o.setStart(r,e||0),o},clearReusedRange=function(){reusedRange=null},isEquivalentPosition$1=function(r,e,n,o){return n&&(scanFor$1(r,e,n,o,-1)||scanFor$1(r,e,n,o,1))},atomElements=/^(img|br|input|textarea|hr)$/i;function scanFor$1(r,e,n,o,s){for(;;){if(r==n&&e==o)return!0;if(e==(s<0?0:nodeSize$1(r))){let a=r.parentNode;if(!a||a.nodeType!=1||hasBlockDesc(r)||atomElements.test(r.nodeName)||r.contentEditable=="false")return!1;e=domIndex$1(r)+(s<0?0:1),r=a}else if(r.nodeType==1){if(r=r.childNodes[e+(s<0?-1:0)],r.contentEditable=="false")return!1;e=s<0?nodeSize$1(r):0}else return!1}}function nodeSize$1(r){return r.nodeType==3?r.nodeValue.length:r.childNodes.length}function textNodeBefore$1(r,e){for(;;){if(r.nodeType==3&&e)return r;if(r.nodeType==1&&e>0){if(r.contentEditable=="false")return null;r=r.childNodes[e-1],e=nodeSize$1(r)}else if(r.parentNode&&!hasBlockDesc(r))e=domIndex$1(r),r=r.parentNode;else return null}}function textNodeAfter$1(r,e){for(;;){if(r.nodeType==3&&e<r.nodeValue.length)return r;if(r.nodeType==1&&e<r.childNodes.length){if(r.contentEditable=="false")return null;r=r.childNodes[e],e=0}else if(r.parentNode&&!hasBlockDesc(r))e=domIndex$1(r)+1,r=r.parentNode;else return null}}function isOnEdge(r,e,n){for(let o=e==0,s=e==nodeSize$1(r);o||s;){if(r==n)return!0;let a=domIndex$1(r);if(r=r.parentNode,!r)return!1;o=o&&a==0,s=s&&a==nodeSize$1(r)}}function hasBlockDesc(r){let e;for(let n=r;n&&!(e=n.pmViewDesc);n=n.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==r||e.contentDOM==r)}const selectionCollapsed=function(r){return r.focusNode&&isEquivalentPosition$1(r.focusNode,r.focusOffset,r.anchorNode,r.anchorOffset)};function keyEvent(r,e){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=r,n.key=n.code=e,n}function deepActiveElement(r){let e=r.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function caretFromPoint(r,e,n){if(r.caretPositionFromPoint)try{let o=r.caretPositionFromPoint(e,n);if(o)return{node:o.offsetNode,offset:Math.min(nodeSize$1(o.offsetNode),o.offset)}}catch{}if(r.caretRangeFromPoint){let o=r.caretRangeFromPoint(e,n);if(o)return{node:o.startContainer,offset:Math.min(nodeSize$1(o.startContainer),o.startOffset)}}}const nav$1=typeof navigator<"u"?navigator:null,doc$1=typeof document<"u"?document:null,agent=nav$1&&nav$1.userAgent||"",ie_edge$1=/Edge\/(\d+)/.exec(agent),ie_upto10$1=/MSIE \d/.exec(agent),ie_11up$1=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(agent),ie$2=!!(ie_upto10$1||ie_11up$1||ie_edge$1),ie_version=ie_upto10$1?document.documentMode:ie_11up$1?+ie_11up$1[1]:ie_edge$1?+ie_edge$1[1]:0,gecko$1=!ie$2&&/gecko\/(\d+)/i.test(agent);gecko$1&&+(/Firefox\/(\d+)/.exec(agent)||[0,0])[1];const _chrome=!ie$2&&/Chrome\/(\d+)/.exec(agent),chrome$1=!!_chrome,chrome_version=_chrome?+_chrome[1]:0,safari$1=!ie$2&&!!nav$1&&/Apple Computer/.test(nav$1.vendor),ios$1=safari$1&&(/Mobile\/\w+/.test(agent)||!!nav$1&&nav$1.maxTouchPoints>2),mac$2=ios$1||(nav$1?/Mac/.test(nav$1.platform):!1),windows=nav$1?/Win/.test(nav$1.platform):!1,android$1=/Android \d/.test(agent),webkit$1=!!doc$1&&"webkitFontSmoothing"in doc$1.documentElement.style,webkit_version=webkit$1?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function windowRect$1(r){let e=r.defaultView&&r.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:r.documentElement.clientWidth,top:0,bottom:r.documentElement.clientHeight}}function getSide(r,e){return typeof r=="number"?r:r[e]}function clientRect(r){let e=r.getBoundingClientRect(),n=e.width/r.offsetWidth||1,o=e.height/r.offsetHeight||1;return{left:e.left,right:e.left+r.clientWidth*n,top:e.top,bottom:e.top+r.clientHeight*o}}function scrollRectIntoView$1(r,e,n){let o=r.someProp("scrollThreshold")||0,s=r.someProp("scrollMargin")||5,a=r.dom.ownerDocument;for(let l=n||r.dom;l;l=parentNode(l)){if(l.nodeType!=1)continue;let c=l,d=c==a.body,u=d?windowRect$1(a):clientRect(c),m=0,f=0;if(e.top<u.top+getSide(o,"top")?f=-(u.top-e.top+getSide(s,"top")):e.bottom>u.bottom-getSide(o,"bottom")&&(f=e.bottom-e.top>u.bottom-u.top?e.top+getSide(s,"top")-u.top:e.bottom-u.bottom+getSide(s,"bottom")),e.left<u.left+getSide(o,"left")?m=-(u.left-e.left+getSide(s,"left")):e.right>u.right-getSide(o,"right")&&(m=e.right-u.right+getSide(s,"right")),m||f)if(d)a.defaultView.scrollBy(m,f);else{let p=c.scrollLeft,g=c.scrollTop;f&&(c.scrollTop+=f),m&&(c.scrollLeft+=m);let y=c.scrollLeft-p,b=c.scrollTop-g;e={left:e.left-y,top:e.top-b,right:e.right-y,bottom:e.bottom-b}}if(d||/^(fixed|sticky)$/.test(getComputedStyle(l).position))break}}function storeScrollPos(r){let e=r.dom.getBoundingClientRect(),n=Math.max(0,e.top),o,s;for(let a=(e.left+e.right)/2,l=n+1;l<Math.min(innerHeight,e.bottom);l+=5){let c=r.root.elementFromPoint(a,l);if(!c||c==r.dom||!r.dom.contains(c))continue;let d=c.getBoundingClientRect();if(d.top>=n-20){o=c,s=d.top;break}}return{refDOM:o,refTop:s,stack:scrollStack(r.dom)}}function scrollStack(r){let e=[],n=r.ownerDocument;for(let o=r;o&&(e.push({dom:o,top:o.scrollTop,left:o.scrollLeft}),r!=n);o=parentNode(o));return e}function resetScrollPos({refDOM:r,refTop:e,stack:n}){let o=r?r.getBoundingClientRect().top:0;restoreScrollStack(n,o==0?0:o-e)}function restoreScrollStack(r,e){for(let n=0;n<r.length;n++){let{dom:o,top:s,left:a}=r[n];o.scrollTop!=s+e&&(o.scrollTop=s+e),o.scrollLeft!=a&&(o.scrollLeft=a)}}let preventScrollSupported$1=null;function focusPreventScroll$1(r){if(r.setActive)return r.setActive();if(preventScrollSupported$1)return r.focus(preventScrollSupported$1);let e=scrollStack(r);r.focus(preventScrollSupported$1==null?{get preventScroll(){return preventScrollSupported$1={preventScroll:!0},!0}}:void 0),preventScrollSupported$1||(preventScrollSupported$1=!1,restoreScrollStack(e,0))}function findOffsetInNode(r,e){let n,o=2e8,s,a=0,l=e.top,c=e.top,d,u;for(let m=r.firstChild,f=0;m;m=m.nextSibling,f++){let p;if(m.nodeType==1)p=m.getClientRects();else if(m.nodeType==3)p=textRange$1(m).getClientRects();else continue;for(let g=0;g<p.length;g++){let y=p[g];if(y.top<=l&&y.bottom>=c){l=Math.max(y.bottom,l),c=Math.min(y.top,c);let b=y.left>e.left?y.left-e.left:y.right<e.left?e.left-y.right:0;if(b<o){n=m,o=b,s=b&&n.nodeType==3?{left:y.right<e.left?y.right:y.left,top:e.top}:e,m.nodeType==1&&b&&(a=f+(e.left>=(y.left+y.right)/2?1:0));continue}}else y.top>e.top&&!d&&y.left<=e.left&&y.right>=e.left&&(d=m,u={left:Math.max(y.left,Math.min(y.right,e.left)),top:y.top});!n&&(e.left>=y.right&&e.top>=y.top||e.left>=y.left&&e.top>=y.bottom)&&(a=f+1)}}return!n&&d&&(n=d,s=u,o=0),n&&n.nodeType==3?findOffsetInText(n,s):!n||o&&n.nodeType==1?{node:r,offset:a}:findOffsetInNode(n,s)}function findOffsetInText(r,e){let n=r.nodeValue.length,o=document.createRange();for(let s=0;s<n;s++){o.setEnd(r,s+1),o.setStart(r,s);let a=singleRect(o,1);if(a.top!=a.bottom&&inRect(e,a))return{node:r,offset:s+(e.left>=(a.left+a.right)/2?1:0)}}return{node:r,offset:0}}function inRect(r,e){return r.left>=e.left-1&&r.left<=e.right+1&&r.top>=e.top-1&&r.top<=e.bottom+1}function targetKludge(r,e){let n=r.parentNode;return n&&/^li$/i.test(n.nodeName)&&e.left<r.getBoundingClientRect().left?n:r}function posFromElement(r,e,n){let{node:o,offset:s}=findOffsetInNode(e,n),a=-1;if(o.nodeType==1&&!o.firstChild){let l=o.getBoundingClientRect();a=l.left!=l.right&&n.left>(l.left+l.right)/2?1:-1}return r.docView.posFromDOM(o,s,a)}function posFromCaret(r,e,n,o){let s=-1;for(let a=e,l=!1;a!=r.dom;){let c=r.docView.nearestDesc(a,!0),d;if(!c)return null;if(c.dom.nodeType==1&&(c.node.isBlock&&c.parent||!c.contentDOM)&&((d=c.dom.getBoundingClientRect()).width||d.height)&&(c.node.isBlock&&c.parent&&(!l&&d.left>o.left||d.top>o.top?s=c.posBefore:(!l&&d.right<o.left||d.bottom<o.top)&&(s=c.posAfter),l=!0),!c.contentDOM&&s<0&&!c.node.isText))return(c.node.isBlock?o.top<(d.top+d.bottom)/2:o.left<(d.left+d.right)/2)?c.posBefore:c.posAfter;a=c.dom.parentNode}return s>-1?s:r.docView.posFromDOM(e,n,-1)}function elementFromPoint(r,e,n){let o=r.childNodes.length;if(o&&n.top<n.bottom)for(let s=Math.max(0,Math.min(o-1,Math.floor(o*(e.top-n.top)/(n.bottom-n.top))-2)),a=s;;){let l=r.childNodes[a];if(l.nodeType==1){let c=l.getClientRects();for(let d=0;d<c.length;d++){let u=c[d];if(inRect(e,u))return elementFromPoint(l,e,u)}}if((a=(a+1)%o)==s)break}return r}function posAtCoords$1(r,e){let n=r.dom.ownerDocument,o,s=0,a=caretFromPoint(n,e.left,e.top);a&&({node:o,offset:s}=a);let l=(r.root.elementFromPoint?r.root:n).elementFromPoint(e.left,e.top),c;if(!l||!r.dom.contains(l.nodeType!=1?l.parentNode:l)){let u=r.dom.getBoundingClientRect();if(!inRect(e,u)||(l=elementFromPoint(r.dom,e,u),!l))return null}if(safari$1)for(let u=l;o&&u;u=parentNode(u))u.draggable&&(o=void 0);if(l=targetKludge(l,e),o){if(gecko$1&&o.nodeType==1&&(s=Math.min(s,o.childNodes.length),s<o.childNodes.length)){let m=o.childNodes[s],f;m.nodeName=="IMG"&&(f=m.getBoundingClientRect()).right<=e.left&&f.bottom>e.top&&s++}let u;webkit$1&&s&&o.nodeType==1&&(u=o.childNodes[s-1]).nodeType==1&&u.contentEditable=="false"&&u.getBoundingClientRect().top>=e.top&&s--,o==r.dom&&s==o.childNodes.length-1&&o.lastChild.nodeType==1&&e.top>o.lastChild.getBoundingClientRect().bottom?c=r.state.doc.content.size:(s==0||o.nodeType!=1||o.childNodes[s-1].nodeName!="BR")&&(c=posFromCaret(r,o,s,e))}c==null&&(c=posFromElement(r,l,e));let d=r.docView.nearestDesc(l,!0);return{pos:c,inside:d?d.posAtStart-d.border:-1}}function nonZero(r){return r.top<r.bottom||r.left<r.right}function singleRect(r,e){let n=r.getClientRects();if(n.length){let o=n[e<0?0:n.length-1];if(nonZero(o))return o}return Array.prototype.find.call(n,nonZero)||r.getBoundingClientRect()}const BIDI=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function coordsAtPos(r,e,n){let{node:o,offset:s,atom:a}=r.docView.domFromPos(e,n<0?-1:1),l=webkit$1||gecko$1;if(o.nodeType==3)if(l&&(BIDI.test(o.nodeValue)||(n<0?!s:s==o.nodeValue.length))){let c=singleRect(textRange$1(o,s,s),n);if(gecko$1&&s&&/\s/.test(o.nodeValue[s-1])&&s<o.nodeValue.length){let d=singleRect(textRange$1(o,s-1,s-1),-1);if(d.top==c.top){let u=singleRect(textRange$1(o,s,s+1),-1);if(u.top!=c.top)return flattenV(u,u.left<d.left)}}return c}else{let c=s,d=s,u=n<0?1:-1;return n<0&&!s?(d++,u=-1):n>=0&&s==o.nodeValue.length?(c--,u=1):n<0?c--:d++,flattenV(singleRect(textRange$1(o,c,d),u),u<0)}if(!r.state.doc.resolve(e-(a||0)).parent.inlineContent){if(a==null&&s&&(n<0||s==nodeSize$1(o))){let c=o.childNodes[s-1];if(c.nodeType==1)return flattenH(c.getBoundingClientRect(),!1)}if(a==null&&s<nodeSize$1(o)){let c=o.childNodes[s];if(c.nodeType==1)return flattenH(c.getBoundingClientRect(),!0)}return flattenH(o.getBoundingClientRect(),n>=0)}if(a==null&&s&&(n<0||s==nodeSize$1(o))){let c=o.childNodes[s-1],d=c.nodeType==3?textRange$1(c,nodeSize$1(c)-(l?0:1)):c.nodeType==1&&(c.nodeName!="BR"||!c.nextSibling)?c:null;if(d)return flattenV(singleRect(d,1),!1)}if(a==null&&s<nodeSize$1(o)){let c=o.childNodes[s];for(;c.pmViewDesc&&c.pmViewDesc.ignoreForCoords;)c=c.nextSibling;let d=c?c.nodeType==3?textRange$1(c,0,l?0:1):c.nodeType==1?c:null:null;if(d)return flattenV(singleRect(d,-1),!0)}return flattenV(singleRect(o.nodeType==3?textRange$1(o):o,-n),n>=0)}function flattenV(r,e){if(r.width==0)return r;let n=e?r.left:r.right;return{top:r.top,bottom:r.bottom,left:n,right:n}}function flattenH(r,e){if(r.height==0)return r;let n=e?r.top:r.bottom;return{top:n,bottom:n,left:r.left,right:r.right}}function withFlushedState(r,e,n){let o=r.state,s=r.root.activeElement;o!=e&&r.updateState(e),s!=r.dom&&r.focus();try{return n()}finally{o!=e&&r.updateState(o),s!=r.dom&&s&&s.focus()}}function endOfTextblockVertical(r,e,n){let o=e.selection,s=n=="up"?o.$from:o.$to;return withFlushedState(r,e,()=>{let{node:a}=r.docView.domFromPos(s.pos,n=="up"?-1:1);for(;;){let c=r.docView.nearestDesc(a,!0);if(!c)break;if(c.node.isBlock){a=c.contentDOM||c.dom;break}a=c.dom.parentNode}let l=coordsAtPos(r,s.pos,1);for(let c=a.firstChild;c;c=c.nextSibling){let d;if(c.nodeType==1)d=c.getClientRects();else if(c.nodeType==3)d=textRange$1(c,0,c.nodeValue.length).getClientRects();else continue;for(let u=0;u<d.length;u++){let m=d[u];if(m.bottom>m.top+1&&(n=="up"?l.top-m.top>(m.bottom-l.top)*2:m.bottom-l.bottom>(l.bottom-m.top)*2))return!1}}return!0})}const maybeRTL=/[\u0590-\u08ac]/;function endOfTextblockHorizontal(r,e,n){let{$head:o}=e.selection;if(!o.parent.isTextblock)return!1;let s=o.parentOffset,a=!s,l=s==o.parent.content.size,c=r.domSelection();return c?!maybeRTL.test(o.parent.textContent)||!c.modify?n=="left"||n=="backward"?a:l:withFlushedState(r,e,()=>{let{focusNode:d,focusOffset:u,anchorNode:m,anchorOffset:f}=r.domSelectionRange(),p=c.caretBidiLevel;c.modify("move",n,"character");let g=o.depth?r.docView.domAfterPos(o.before()):r.dom,{focusNode:y,focusOffset:b}=r.domSelectionRange(),k=y&&!g.contains(y.nodeType==1?y:y.parentNode)||d==y&&u==b;try{c.collapse(m,f),d&&(d!=m||u!=f)&&c.extend&&c.extend(d,u)}catch{}return p!=null&&(c.caretBidiLevel=p),k}):o.pos==o.start()||o.pos==o.end()}let cachedState=null,cachedDir=null,cachedResult=!1;function endOfTextblock(r,e,n){return cachedState==e&&cachedDir==n?cachedResult:(cachedState=e,cachedDir=n,cachedResult=n=="up"||n=="down"?endOfTextblockVertical(r,e,n):endOfTextblockHorizontal(r,e,n))}const NOT_DIRTY=0,CHILD_DIRTY=1,CONTENT_DIRTY=2,NODE_DIRTY=3;class ViewDesc{constructor(e,n,o,s){this.parent=e,this.children=n,this.dom=o,this.contentDOM=s,this.dirty=NOT_DIRTY,o.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,n,o){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let n=0;n<this.children.length;n++)e+=this.children[n].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let n=0,o=this.posAtStart;;n++){let s=this.children[n];if(s==e)return o;o+=s.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,n,o){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(o<0){let a,l;if(e==this.contentDOM)a=e.childNodes[n-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;a=e.previousSibling}for(;a&&!((l=a.pmViewDesc)&&l.parent==this);)a=a.previousSibling;return a?this.posBeforeChild(l)+l.size:this.posAtStart}else{let a,l;if(e==this.contentDOM)a=e.childNodes[n];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;a=e.nextSibling}for(;a&&!((l=a.pmViewDesc)&&l.parent==this);)a=a.nextSibling;return a?this.posBeforeChild(l):this.posAtEnd}let s;if(e==this.dom&&this.contentDOM)s=n>domIndex$1(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))s=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(n==0)for(let a=e;;a=a.parentNode){if(a==this.dom){s=!1;break}if(a.previousSibling)break}if(s==null&&n==e.childNodes.length)for(let a=e;;a=a.parentNode){if(a==this.dom){s=!0;break}if(a.nextSibling)break}}return s??o>0?this.posAtEnd:this.posAtStart}nearestDesc(e,n=!1){for(let o=!0,s=e;s;s=s.parentNode){let a=this.getDesc(s),l;if(a&&(!n||a.node))if(o&&(l=a.nodeDOM)&&!(l.nodeType==1?l.contains(e.nodeType==1?e:e.parentNode):l==e))o=!1;else return a}}getDesc(e){let n=e.pmViewDesc;for(let o=n;o;o=o.parent)if(o==this)return n}posFromDOM(e,n,o){for(let s=e;s;s=s.parentNode){let a=this.getDesc(s);if(a)return a.localPosFromDOM(e,n,o)}return-1}descAt(e){for(let n=0,o=0;n<this.children.length;n++){let s=this.children[n],a=o+s.size;if(o==e&&a!=o){for(;!s.border&&s.children.length;)s=s.children[0];return s}if(e<a)return s.descAt(e-o-s.border);o=a}}domFromPos(e,n){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let o=0,s=0;for(let a=0;o<this.children.length;o++){let l=this.children[o],c=a+l.size;if(c>e||l instanceof TrailingHackViewDesc){s=e-a;break}a=c}if(s)return this.children[o].domFromPos(s-this.children[o].border,n);for(let a;o&&!(a=this.children[o-1]).size&&a instanceof WidgetViewDesc&&a.side>=0;o--);if(n<=0){let a,l=!0;for(;a=o?this.children[o-1]:null,!(!a||a.dom.parentNode==this.contentDOM);o--,l=!1);return a&&n&&l&&!a.border&&!a.domAtom?a.domFromPos(a.size,n):{node:this.contentDOM,offset:a?domIndex$1(a.dom)+1:0}}else{let a,l=!0;for(;a=o<this.children.length?this.children[o]:null,!(!a||a.dom.parentNode==this.contentDOM);o++,l=!1);return a&&l&&!a.border&&!a.domAtom?a.domFromPos(0,n):{node:this.contentDOM,offset:a?domIndex$1(a.dom):this.contentDOM.childNodes.length}}}parseRange(e,n,o=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:n,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let s=-1,a=-1;for(let l=o,c=0;;c++){let d=this.children[c],u=l+d.size;if(s==-1&&e<=u){let m=l+d.border;if(e>=m&&n<=u-d.border&&d.node&&d.contentDOM&&this.contentDOM.contains(d.contentDOM))return d.parseRange(e,n,m);e=l;for(let f=c;f>0;f--){let p=this.children[f-1];if(p.size&&p.dom.parentNode==this.contentDOM&&!p.emptyChildAt(1)){s=domIndex$1(p.dom)+1;break}e-=p.size}s==-1&&(s=0)}if(s>-1&&(u>n||c==this.children.length-1)){n=u;for(let m=c+1;m<this.children.length;m++){let f=this.children[m];if(f.size&&f.dom.parentNode==this.contentDOM&&!f.emptyChildAt(-1)){a=domIndex$1(f.dom);break}n+=f.size}a==-1&&(a=this.contentDOM.childNodes.length);break}l=u}return{node:this.contentDOM,from:e,to:n,fromOffset:s,toOffset:a}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let n=this.children[e<0?0:this.children.length-1];return n.size==0||n.emptyChildAt(e)}domAfterPos(e){let{node:n,offset:o}=this.domFromPos(e,0);if(n.nodeType!=1||o==n.childNodes.length)throw new RangeError("No node after pos "+e);return n.childNodes[o]}setSelection(e,n,o,s=!1){let a=Math.min(e,n),l=Math.max(e,n);for(let g=0,y=0;g<this.children.length;g++){let b=this.children[g],k=y+b.size;if(a>y&&l<k)return b.setSelection(e-y-b.border,n-y-b.border,o,s);y=k}let c=this.domFromPos(e,e?-1:1),d=n==e?c:this.domFromPos(n,n?-1:1),u=o.root.getSelection(),m=o.domSelectionRange(),f=!1;if((gecko$1||safari$1)&&e==n){let{node:g,offset:y}=c;if(g.nodeType==3){if(f=!!(y&&g.nodeValue[y-1]==`
`),f&&y==g.nodeValue.length)for(let b=g,k;b;b=b.parentNode){if(k=b.nextSibling){k.nodeName=="BR"&&(c=d={node:k.parentNode,offset:domIndex$1(k)+1});break}let w=b.pmViewDesc;if(w&&w.node&&w.node.isBlock)break}}else{let b=g.childNodes[y-1];f=b&&(b.nodeName=="BR"||b.contentEditable=="false")}}if(gecko$1&&m.focusNode&&m.focusNode!=d.node&&m.focusNode.nodeType==1){let g=m.focusNode.childNodes[m.focusOffset];g&&g.contentEditable=="false"&&(s=!0)}if(!(s||f&&safari$1)&&isEquivalentPosition$1(c.node,c.offset,m.anchorNode,m.anchorOffset)&&isEquivalentPosition$1(d.node,d.offset,m.focusNode,m.focusOffset))return;let p=!1;if((u.extend||e==n)&&!f){u.collapse(c.node,c.offset);try{e!=n&&u.extend(d.node,d.offset),p=!0}catch{}}if(!p){if(e>n){let y=c;c=d,d=y}let g=document.createRange();g.setEnd(d.node,d.offset),g.setStart(c.node,c.offset),u.removeAllRanges(),u.addRange(g)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,n){for(let o=0,s=0;s<this.children.length;s++){let a=this.children[s],l=o+a.size;if(o==l?e<=l&&n>=o:e<l&&n>o){let c=o+a.border,d=l-a.border;if(e>=c&&n<=d){this.dirty=e==o||n==l?CONTENT_DIRTY:CHILD_DIRTY,e==c&&n==d&&(a.contentLost||a.dom.parentNode!=this.contentDOM)?a.dirty=NODE_DIRTY:a.markDirty(e-c,n-c);return}else a.dirty=a.dom==a.contentDOM&&a.dom.parentNode==this.contentDOM&&!a.children.length?CONTENT_DIRTY:NODE_DIRTY}o=l}this.dirty=CONTENT_DIRTY}markParentsDirty(){let e=1;for(let n=this.parent;n;n=n.parent,e++){let o=e==1?CONTENT_DIRTY:CHILD_DIRTY;n.dirty<o&&(n.dirty=o)}}get domAtom(){return!1}get ignoreForCoords(){return!1}isText(e){return!1}}class WidgetViewDesc extends ViewDesc{constructor(e,n,o,s){let a,l=n.type.toDOM;if(typeof l=="function"&&(l=l(o,()=>{if(!a)return s;if(a.parent)return a.parent.posBeforeChild(a)})),!n.type.spec.raw){if(l.nodeType!=1){let c=document.createElement("span");c.appendChild(l),l=c}l.contentEditable="false",l.classList.add("ProseMirror-widget")}super(e,[],l,null),this.widget=n,this.widget=n,a=this}matchesWidget(e){return this.dirty==NOT_DIRTY&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let n=this.widget.spec.stopEvent;return n?n(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get side(){return this.widget.type.side}}class CompositionViewDesc extends ViewDesc{constructor(e,n,o,s){super(e,[],n,null),this.textDOM=o,this.text=s}get size(){return this.text.length}localPosFromDOM(e,n){return e!=this.textDOM?this.posAtStart+(n?this.size:0):this.posAtStart+n}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class MarkViewDesc extends ViewDesc{constructor(e,n,o,s,a){super(e,[],o,s),this.mark=n,this.spec=a}static create(e,n,o,s){let a=s.nodeViews[n.type.name],l=a&&a(n,s,o);return(!l||!l.dom)&&(l=DOMSerializer.renderSpec(document,n.type.spec.toDOM(n,o),null,n.attrs)),new MarkViewDesc(e,n,l.dom,l.contentDOM||l.dom,l)}parseRule(){return this.dirty&NODE_DIRTY||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=NODE_DIRTY&&this.mark.eq(e)}markDirty(e,n){if(super.markDirty(e,n),this.dirty!=NOT_DIRTY){let o=this.parent;for(;!o.node;)o=o.parent;o.dirty<this.dirty&&(o.dirty=this.dirty),this.dirty=NOT_DIRTY}}slice(e,n,o){let s=MarkViewDesc.create(this.parent,this.mark,!0,o),a=this.children,l=this.size;n<l&&(a=replaceNodes(a,n,l,o)),e>0&&(a=replaceNodes(a,0,e,o));for(let c=0;c<a.length;c++)a[c].parent=s;return s.children=a,s}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class NodeViewDesc extends ViewDesc{constructor(e,n,o,s,a,l,c,d,u){super(e,[],a,l),this.node=n,this.outerDeco=o,this.innerDeco=s,this.nodeDOM=c}static create(e,n,o,s,a,l){let c=a.nodeViews[n.type.name],d,u=c&&c(n,a,()=>{if(!d)return l;if(d.parent)return d.parent.posBeforeChild(d)},o,s),m=u&&u.dom,f=u&&u.contentDOM;if(n.isText){if(!m)m=document.createTextNode(n.text);else if(m.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else m||({dom:m,contentDOM:f}=DOMSerializer.renderSpec(document,n.type.spec.toDOM(n),null,n.attrs));!f&&!n.isText&&m.nodeName!="BR"&&(m.hasAttribute("contenteditable")||(m.contentEditable="false"),n.type.spec.draggable&&(m.draggable=!0));let p=m;return m=applyOuterDeco(m,o,n),u?d=new CustomNodeViewDesc(e,n,o,s,m,f||null,p,u,a,l+1):n.isText?new TextViewDesc(e,n,o,s,m,p,a):new NodeViewDesc(e,n,o,s,m,f||null,p,a,l+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let n=this.children.length-1;n>=0;n--){let o=this.children[n];if(this.dom.contains(o.dom.parentNode)){e.contentElement=o.dom.parentNode;break}}e.contentElement||(e.getContent=()=>Fragment.empty)}return e}matchesNode(e,n,o){return this.dirty==NOT_DIRTY&&e.eq(this.node)&&sameOuterDeco(n,this.outerDeco)&&o.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,n){let o=this.node.inlineContent,s=n,a=e.composing?this.localCompositionInfo(e,n):null,l=a&&a.pos>-1?a:null,c=a&&a.pos<0,d=new ViewTreeUpdater(this,l&&l.node,e);iterDeco(this.node,this.innerDeco,(u,m,f)=>{u.spec.marks?d.syncToMarks(u.spec.marks,o,e):u.type.side>=0&&!f&&d.syncToMarks(m==this.node.childCount?Mark.none:this.node.child(m).marks,o,e),d.placeWidget(u,e,s)},(u,m,f,p)=>{d.syncToMarks(u.marks,o,e);let g;d.findNodeMatch(u,m,f,p)||c&&e.state.selection.from>s&&e.state.selection.to<s+u.nodeSize&&(g=d.findIndexWithChild(a.node))>-1&&d.updateNodeAt(u,m,f,g,e)||d.updateNextNode(u,m,f,e,p,s)||d.addNode(u,m,f,e,s),s+=u.nodeSize}),d.syncToMarks([],o,e),this.node.isTextblock&&d.addTextblockHacks(),d.destroyRest(),(d.changed||this.dirty==CONTENT_DIRTY)&&(l&&this.protectLocalComposition(e,l),renderDescs(this.contentDOM,this.children,e),ios$1&&iosHacks(this.dom))}localCompositionInfo(e,n){let{from:o,to:s}=e.state.selection;if(!(e.state.selection instanceof TextSelection)||o<n||s>n+this.node.content.size)return null;let a=e.input.compositionNode;if(!a||!this.dom.contains(a.parentNode))return null;if(this.node.inlineContent){let l=a.nodeValue,c=findTextInFragment(this.node.content,l,o-n,s-n);return c<0?null:{node:a,pos:c,text:l}}else return{node:a,pos:-1,text:""}}protectLocalComposition(e,{node:n,pos:o,text:s}){if(this.getDesc(n))return;let a=n;for(;a.parentNode!=this.contentDOM;a=a.parentNode){for(;a.previousSibling;)a.parentNode.removeChild(a.previousSibling);for(;a.nextSibling;)a.parentNode.removeChild(a.nextSibling);a.pmViewDesc&&(a.pmViewDesc=void 0)}let l=new CompositionViewDesc(this,a,n,s);e.input.compositionNodes.push(l),this.children=replaceNodes(this.children,o,o+s.length,e,l)}update(e,n,o,s){return this.dirty==NODE_DIRTY||!e.sameMarkup(this.node)?!1:(this.updateInner(e,n,o,s),!0)}updateInner(e,n,o,s){this.updateOuterDeco(n),this.node=e,this.innerDeco=o,this.contentDOM&&this.updateChildren(s,this.posAtStart),this.dirty=NOT_DIRTY}updateOuterDeco(e){if(sameOuterDeco(e,this.outerDeco))return;let n=this.nodeDOM.nodeType!=1,o=this.dom;this.dom=patchOuterDeco(this.dom,this.nodeDOM,computeOuterDeco(this.outerDeco,this.node,n),computeOuterDeco(e,this.node,n)),this.dom!=o&&(o.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function docViewDesc(r,e,n,o,s){applyOuterDeco(o,e,r);let a=new NodeViewDesc(void 0,r,e,n,o,o,o,s,0);return a.contentDOM&&a.updateChildren(s,0),a}class TextViewDesc extends NodeViewDesc{constructor(e,n,o,s,a,l,c){super(e,n,o,s,a,null,l,c,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,n,o,s){return this.dirty==NODE_DIRTY||this.dirty!=NOT_DIRTY&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(n),(this.dirty!=NOT_DIRTY||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,s.trackWrites==this.nodeDOM&&(s.trackWrites=null)),this.node=e,this.dirty=NOT_DIRTY,!0)}inParent(){let e=this.parent.contentDOM;for(let n=this.nodeDOM;n;n=n.parentNode)if(n==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,n,o){return e==this.nodeDOM?this.posAtStart+Math.min(n,this.node.text.length):super.localPosFromDOM(e,n,o)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,n,o){let s=this.node.cut(e,n),a=document.createTextNode(s.text);return new TextViewDesc(this.parent,s,this.outerDeco,this.innerDeco,a,a,o)}markDirty(e,n){super.markDirty(e,n),this.dom!=this.nodeDOM&&(e==0||n==this.nodeDOM.nodeValue.length)&&(this.dirty=NODE_DIRTY)}get domAtom(){return!1}isText(e){return this.node.text==e}}class TrailingHackViewDesc extends ViewDesc{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==NOT_DIRTY&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class CustomNodeViewDesc extends NodeViewDesc{constructor(e,n,o,s,a,l,c,d,u,m){super(e,n,o,s,a,l,c,u,m),this.spec=d}update(e,n,o,s){if(this.dirty==NODE_DIRTY)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let a=this.spec.update(e,n,o);return a&&this.updateInner(e,n,o,s),a}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,n,o,s)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,n,o,s){this.spec.setSelection?this.spec.setSelection(e,n,o.root):super.setSelection(e,n,o,s)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function renderDescs(r,e,n){let o=r.firstChild,s=!1;for(let a=0;a<e.length;a++){let l=e[a],c=l.dom;if(c.parentNode==r){for(;c!=o;)o=rm(o),s=!0;o=o.nextSibling}else s=!0,r.insertBefore(c,o);if(l instanceof MarkViewDesc){let d=o?o.previousSibling:r.lastChild;renderDescs(l.contentDOM,l.children,n),o=d?d.nextSibling:r.firstChild}}for(;o;)o=rm(o),s=!0;s&&n.trackWrites==r&&(n.trackWrites=null)}const OuterDecoLevel=function(r){r&&(this.nodeName=r)};OuterDecoLevel.prototype=Object.create(null);const noDeco=[new OuterDecoLevel];function computeOuterDeco(r,e,n){if(r.length==0)return noDeco;let o=n?noDeco[0]:new OuterDecoLevel,s=[o];for(let a=0;a<r.length;a++){let l=r[a].type.attrs;if(l){l.nodeName&&s.push(o=new OuterDecoLevel(l.nodeName));for(let c in l){let d=l[c];d!=null&&(n&&s.length==1&&s.push(o=new OuterDecoLevel(e.isInline?"span":"div")),c=="class"?o.class=(o.class?o.class+" ":"")+d:c=="style"?o.style=(o.style?o.style+";":"")+d:c!="nodeName"&&(o[c]=d))}}}return s}function patchOuterDeco(r,e,n,o){if(n==noDeco&&o==noDeco)return e;let s=e;for(let a=0;a<o.length;a++){let l=o[a],c=n[a];if(a){let d;c&&c.nodeName==l.nodeName&&s!=r&&(d=s.parentNode)&&d.nodeName.toLowerCase()==l.nodeName||(d=document.createElement(l.nodeName),d.pmIsDeco=!0,d.appendChild(s),c=noDeco[0]),s=d}patchAttributes(s,c||noDeco[0],l)}return s}function patchAttributes(r,e,n){for(let o in e)o!="class"&&o!="style"&&o!="nodeName"&&!(o in n)&&r.removeAttribute(o);for(let o in n)o!="class"&&o!="style"&&o!="nodeName"&&n[o]!=e[o]&&r.setAttribute(o,n[o]);if(e.class!=n.class){let o=e.class?e.class.split(" ").filter(Boolean):[],s=n.class?n.class.split(" ").filter(Boolean):[];for(let a=0;a<o.length;a++)s.indexOf(o[a])==-1&&r.classList.remove(o[a]);for(let a=0;a<s.length;a++)o.indexOf(s[a])==-1&&r.classList.add(s[a]);r.classList.length==0&&r.removeAttribute("class")}if(e.style!=n.style){if(e.style){let o=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,s;for(;s=o.exec(e.style);)r.style.removeProperty(s[1])}n.style&&(r.style.cssText+=n.style)}}function applyOuterDeco(r,e,n){return patchOuterDeco(r,r,noDeco,computeOuterDeco(e,n,r.nodeType!=1))}function sameOuterDeco(r,e){if(r.length!=e.length)return!1;for(let n=0;n<r.length;n++)if(!r[n].type.eq(e[n].type))return!1;return!0}function rm(r){let e=r.nextSibling;return r.parentNode.removeChild(r),e}class ViewTreeUpdater{constructor(e,n,o){this.lock=n,this.view=o,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=preMatch(e.node.content,e)}destroyBetween(e,n){if(e!=n){for(let o=e;o<n;o++)this.top.children[o].destroy();this.top.children.splice(e,n-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,n,o){let s=0,a=this.stack.length>>1,l=Math.min(a,e.length);for(;s<l&&(s==a-1?this.top:this.stack[s+1<<1]).matchesMark(e[s])&&e[s].type.spec.spanning!==!1;)s++;for(;s<a;)this.destroyRest(),this.top.dirty=NOT_DIRTY,this.index=this.stack.pop(),this.top=this.stack.pop(),a--;for(;a<e.length;){this.stack.push(this.top,this.index+1);let c=-1;for(let d=this.index;d<Math.min(this.index+3,this.top.children.length);d++){let u=this.top.children[d];if(u.matchesMark(e[a])&&!this.isLocked(u.dom)){c=d;break}}if(c>-1)c>this.index&&(this.changed=!0,this.destroyBetween(this.index,c)),this.top=this.top.children[this.index];else{let d=MarkViewDesc.create(this.top,e[a],n,o);this.top.children.splice(this.index,0,d),this.top=d,this.changed=!0}this.index=0,a++}}findNodeMatch(e,n,o,s){let a=-1,l;if(s>=this.preMatch.index&&(l=this.preMatch.matches[s-this.preMatch.index]).parent==this.top&&l.matchesNode(e,n,o))a=this.top.children.indexOf(l,this.index);else for(let c=this.index,d=Math.min(this.top.children.length,c+5);c<d;c++){let u=this.top.children[c];if(u.matchesNode(e,n,o)&&!this.preMatch.matched.has(u)){a=c;break}}return a<0?!1:(this.destroyBetween(this.index,a),this.index++,!0)}updateNodeAt(e,n,o,s,a){let l=this.top.children[s];return l.dirty==NODE_DIRTY&&l.dom==l.contentDOM&&(l.dirty=CONTENT_DIRTY),l.update(e,n,o,a)?(this.destroyBetween(this.index,s),this.index++,!0):!1}findIndexWithChild(e){for(;;){let n=e.parentNode;if(!n)return-1;if(n==this.top.contentDOM){let o=e.pmViewDesc;if(o){for(let s=this.index;s<this.top.children.length;s++)if(this.top.children[s]==o)return s}return-1}e=n}}updateNextNode(e,n,o,s,a,l){for(let c=this.index;c<this.top.children.length;c++){let d=this.top.children[c];if(d instanceof NodeViewDesc){let u=this.preMatch.matched.get(d);if(u!=null&&u!=a)return!1;let m=d.dom,f,p=this.isLocked(m)&&!(e.isText&&d.node&&d.node.isText&&d.nodeDOM.nodeValue==e.text&&d.dirty!=NODE_DIRTY&&sameOuterDeco(n,d.outerDeco));if(!p&&d.update(e,n,o,s))return this.destroyBetween(this.index,c),d.dom!=m&&(this.changed=!0),this.index++,!0;if(!p&&(f=this.recreateWrapper(d,e,n,o,s,l)))return this.destroyBetween(this.index,c),this.top.children[this.index]=f,f.contentDOM&&(f.dirty=CONTENT_DIRTY,f.updateChildren(s,l+1),f.dirty=NOT_DIRTY),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,n,o,s,a,l){if(e.dirty||n.isAtom||!e.children.length||!e.node.content.eq(n.content)||!sameOuterDeco(o,e.outerDeco)||!s.eq(e.innerDeco))return null;let c=NodeViewDesc.create(this.top,n,o,s,a,l);if(c.contentDOM){c.children=e.children,e.children=[];for(let d of c.children)d.parent=c}return e.destroy(),c}addNode(e,n,o,s,a){let l=NodeViewDesc.create(this.top,e,n,o,s,a);l.contentDOM&&l.updateChildren(s,a+1),this.top.children.splice(this.index++,0,l),this.changed=!0}placeWidget(e,n,o){let s=this.index<this.top.children.length?this.top.children[this.index]:null;if(s&&s.matchesWidget(e)&&(e==s.widget||!s.widget.type.toDOM.parentNode))this.index++;else{let a=new WidgetViewDesc(this.top,e,n,o);this.top.children.splice(this.index++,0,a),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],n=this.top;for(;e instanceof MarkViewDesc;)n=e,e=n.children[n.children.length-1];(!e||!(e instanceof TextViewDesc)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((safari$1||chrome$1)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",n),this.addHackNode("BR",this.top))}addHackNode(e,n){if(n==this.top&&this.index<n.children.length&&n.children[this.index].matchesHack(e))this.index++;else{let o=document.createElement(e);e=="IMG"&&(o.className="ProseMirror-separator",o.alt=""),e=="BR"&&(o.className="ProseMirror-trailingBreak");let s=new TrailingHackViewDesc(this.top,[],o,null);n!=this.top?n.children.push(s):n.children.splice(this.index++,0,s),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function preMatch(r,e){let n=e,o=n.children.length,s=r.childCount,a=new Map,l=[];e:for(;s>0;){let c;for(;;)if(o){let u=n.children[o-1];if(u instanceof MarkViewDesc)n=u,o=u.children.length;else{c=u,o--;break}}else{if(n==e)break e;o=n.parent.children.indexOf(n),n=n.parent}let d=c.node;if(d){if(d!=r.child(s-1))break;--s,a.set(c,s),l.push(c)}}return{index:s,matched:a,matches:l.reverse()}}function compareSide(r,e){return r.type.side-e.type.side}function iterDeco(r,e,n,o){let s=e.locals(r),a=0;if(s.length==0){for(let u=0;u<r.childCount;u++){let m=r.child(u);o(m,s,e.forChild(a,m),u),a+=m.nodeSize}return}let l=0,c=[],d=null;for(let u=0;;){let m,f;for(;l<s.length&&s[l].to==a;){let k=s[l++];k.widget&&(m?(f||(f=[m])).push(k):m=k)}if(m)if(f){f.sort(compareSide);for(let k=0;k<f.length;k++)n(f[k],u,!!d)}else n(m,u,!!d);let p,g;if(d)g=-1,p=d,d=null;else if(u<r.childCount)g=u,p=r.child(u++);else break;for(let k=0;k<c.length;k++)c[k].to<=a&&c.splice(k--,1);for(;l<s.length&&s[l].from<=a&&s[l].to>a;)c.push(s[l++]);let y=a+p.nodeSize;if(p.isText){let k=y;l<s.length&&s[l].from<k&&(k=s[l].from);for(let w=0;w<c.length;w++)c[w].to<k&&(k=c[w].to);k<y&&(d=p.cut(k-a),p=p.cut(0,k-a),y=k,g=-1)}else for(;l<s.length&&s[l].to<y;)l++;let b=p.isInline&&!p.isLeaf?c.filter(k=>!k.inline):c.slice();o(p,b,e.forChild(a,p),g),a=y}}function iosHacks(r){if(r.nodeName=="UL"||r.nodeName=="OL"){let e=r.style.cssText;r.style.cssText=e+"; list-style: square !important",window.getComputedStyle(r).listStyle,r.style.cssText=e}}function findTextInFragment(r,e,n,o){for(let s=0,a=0;s<r.childCount&&a<=o;){let l=r.child(s++),c=a;if(a+=l.nodeSize,!l.isText)continue;let d=l.text;for(;s<r.childCount;){let u=r.child(s++);if(a+=u.nodeSize,!u.isText)break;d+=u.text}if(a>=n){if(a>=o&&d.slice(o-e.length-c,o-c)==e)return o-e.length;let u=c<o?d.lastIndexOf(e,o-c-1):-1;if(u>=0&&u+e.length+c>=n)return c+u;if(n==o&&d.length>=o+e.length-c&&d.slice(o-c,o-c+e.length)==e)return o}}return-1}function replaceNodes(r,e,n,o,s){let a=[];for(let l=0,c=0;l<r.length;l++){let d=r[l],u=c,m=c+=d.size;u>=n||m<=e?a.push(d):(u<e&&a.push(d.slice(0,e-u,o)),s&&(a.push(s),s=void 0),m>n&&a.push(d.slice(n-u,d.size,o)))}return a}function selectionFromDOM(r,e=null){let n=r.domSelectionRange(),o=r.state.doc;if(!n.focusNode)return null;let s=r.docView.nearestDesc(n.focusNode),a=s&&s.size==0,l=r.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(l<0)return null;let c=o.resolve(l),d,u;if(selectionCollapsed(n)){for(d=l;s&&!s.node;)s=s.parent;let f=s.node;if(s&&f.isAtom&&NodeSelection.isSelectable(f)&&s.parent&&!(f.isInline&&isOnEdge(n.focusNode,n.focusOffset,s.dom))){let p=s.posBefore;u=new NodeSelection(l==p?c:o.resolve(p))}}else{if(n instanceof r.dom.ownerDocument.defaultView.Selection&&n.rangeCount>1){let f=l,p=l;for(let g=0;g<n.rangeCount;g++){let y=n.getRangeAt(g);f=Math.min(f,r.docView.posFromDOM(y.startContainer,y.startOffset,1)),p=Math.max(p,r.docView.posFromDOM(y.endContainer,y.endOffset,-1))}if(f<0)return null;[d,l]=p==r.state.selection.anchor?[p,f]:[f,p],c=o.resolve(l)}else d=r.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(d<0)return null}let m=o.resolve(d);if(!u){let f=e=="pointer"||r.state.selection.head<c.pos&&!a?1:-1;u=selectionBetween(r,m,c,f)}return u}function editorOwnsSelection(r){return r.editable?r.hasFocus():hasSelection$1(r)&&document.activeElement&&document.activeElement.contains(r.dom)}function selectionToDOM(r,e=!1){let n=r.state.selection;if(syncNodeSelection(r,n),!!editorOwnsSelection(r)){if(!e&&r.input.mouseDown&&r.input.mouseDown.allowDefault&&chrome$1){let o=r.domSelectionRange(),s=r.domObserver.currentSelection;if(o.anchorNode&&s.anchorNode&&isEquivalentPosition$1(o.anchorNode,o.anchorOffset,s.anchorNode,s.anchorOffset)){r.input.mouseDown.delayedSelectionSync=!0,r.domObserver.setCurSelection();return}}if(r.domObserver.disconnectSelection(),r.cursorWrapper)selectCursorWrapper(r);else{let{anchor:o,head:s}=n,a,l;brokenSelectBetweenUneditable&&!(n instanceof TextSelection)&&(n.$from.parent.inlineContent||(a=temporarilyEditableNear(r,n.from)),!n.empty&&!n.$from.parent.inlineContent&&(l=temporarilyEditableNear(r,n.to))),r.docView.setSelection(o,s,r,e),brokenSelectBetweenUneditable&&(a&&resetEditable(a),l&&resetEditable(l)),n.visible?r.dom.classList.remove("ProseMirror-hideselection"):(r.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&removeClassOnSelectionChange(r))}r.domObserver.setCurSelection(),r.domObserver.connectSelection()}}const brokenSelectBetweenUneditable=safari$1||chrome$1&&chrome_version<63;function temporarilyEditableNear(r,e){let{node:n,offset:o}=r.docView.domFromPos(e,0),s=o<n.childNodes.length?n.childNodes[o]:null,a=o?n.childNodes[o-1]:null;if(safari$1&&s&&s.contentEditable=="false")return setEditable(s);if((!s||s.contentEditable=="false")&&(!a||a.contentEditable=="false")){if(s)return setEditable(s);if(a)return setEditable(a)}}function setEditable(r){return r.contentEditable="true",safari$1&&r.draggable&&(r.draggable=!1,r.wasDraggable=!0),r}function resetEditable(r){r.contentEditable="false",r.wasDraggable&&(r.draggable=!0,r.wasDraggable=null)}function removeClassOnSelectionChange(r){let e=r.dom.ownerDocument;e.removeEventListener("selectionchange",r.input.hideSelectionGuard);let n=r.domSelectionRange(),o=n.anchorNode,s=n.anchorOffset;e.addEventListener("selectionchange",r.input.hideSelectionGuard=()=>{(n.anchorNode!=o||n.anchorOffset!=s)&&(e.removeEventListener("selectionchange",r.input.hideSelectionGuard),setTimeout(()=>{(!editorOwnsSelection(r)||r.state.selection.visible)&&r.dom.classList.remove("ProseMirror-hideselection")},20))})}function selectCursorWrapper(r){let e=r.domSelection(),n=document.createRange();if(!e)return;let o=r.cursorWrapper.dom,s=o.nodeName=="IMG";s?n.setStart(o.parentNode,domIndex$1(o)+1):n.setStart(o,0),n.collapse(!0),e.removeAllRanges(),e.addRange(n),!s&&!r.state.selection.visible&&ie$2&&ie_version<=11&&(o.disabled=!0,o.disabled=!1)}function syncNodeSelection(r,e){if(e instanceof NodeSelection){let n=r.docView.descAt(e.from);n!=r.lastSelectedViewDesc&&(clearNodeSelection(r),n&&n.selectNode(),r.lastSelectedViewDesc=n)}else clearNodeSelection(r)}function clearNodeSelection(r){r.lastSelectedViewDesc&&(r.lastSelectedViewDesc.parent&&r.lastSelectedViewDesc.deselectNode(),r.lastSelectedViewDesc=void 0)}function selectionBetween(r,e,n,o){return r.someProp("createSelectionBetween",s=>s(r,e,n))||TextSelection.between(e,n,o)}function hasFocusAndSelection(r){return r.editable&&!r.hasFocus()?!1:hasSelection$1(r)}function hasSelection$1(r){let e=r.domSelectionRange();if(!e.anchorNode)return!1;try{return r.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(r.editable||r.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function anchorInRightPlace(r){let e=r.docView.domFromPos(r.state.selection.anchor,0),n=r.domSelectionRange();return isEquivalentPosition$1(e.node,e.offset,n.anchorNode,n.anchorOffset)}function moveSelectionBlock(r,e){let{$anchor:n,$head:o}=r.selection,s=e>0?n.max(o):n.min(o),a=s.parent.inlineContent?s.depth?r.doc.resolve(e>0?s.after():s.before()):null:s;return a&&Selection.findFrom(a,e)}function apply(r,e){return r.dispatch(r.state.tr.setSelection(e).scrollIntoView()),!0}function selectHorizontally(r,e,n){let o=r.state.selection;if(o instanceof TextSelection)if(n.indexOf("s")>-1){let{$head:s}=o,a=s.textOffset?null:e<0?s.nodeBefore:s.nodeAfter;if(!a||a.isText||!a.isLeaf)return!1;let l=r.state.doc.resolve(s.pos+a.nodeSize*(e<0?-1:1));return apply(r,new TextSelection(o.$anchor,l))}else if(o.empty){if(r.endOfTextblock(e>0?"forward":"backward")){let s=moveSelectionBlock(r.state,e);return s&&s instanceof NodeSelection?apply(r,s):!1}else if(!(mac$2&&n.indexOf("m")>-1)){let s=o.$head,a=s.textOffset?null:e<0?s.nodeBefore:s.nodeAfter,l;if(!a||a.isText)return!1;let c=e<0?s.pos-a.nodeSize:s.pos;return a.isAtom||(l=r.docView.descAt(c))&&!l.contentDOM?NodeSelection.isSelectable(a)?apply(r,new NodeSelection(e<0?r.state.doc.resolve(s.pos-a.nodeSize):s)):webkit$1?apply(r,new TextSelection(r.state.doc.resolve(e<0?c:c+a.nodeSize))):!1:!1}}else return!1;else{if(o instanceof NodeSelection&&o.node.isInline)return apply(r,new TextSelection(e>0?o.$to:o.$from));{let s=moveSelectionBlock(r.state,e);return s?apply(r,s):!1}}}function nodeLen(r){return r.nodeType==3?r.nodeValue.length:r.childNodes.length}function isIgnorable(r,e){let n=r.pmViewDesc;return n&&n.size==0&&(e<0||r.nextSibling||r.nodeName!="BR")}function skipIgnoredNodes(r,e){return e<0?skipIgnoredNodesBefore(r):skipIgnoredNodesAfter(r)}function skipIgnoredNodesBefore(r){let e=r.domSelectionRange(),n=e.focusNode,o=e.focusOffset;if(!n)return;let s,a,l=!1;for(gecko$1&&n.nodeType==1&&o<nodeLen(n)&&isIgnorable(n.childNodes[o],-1)&&(l=!0);;)if(o>0){if(n.nodeType!=1)break;{let c=n.childNodes[o-1];if(isIgnorable(c,-1))s=n,a=--o;else if(c.nodeType==3)n=c,o=n.nodeValue.length;else break}}else{if(isBlockNode(n))break;{let c=n.previousSibling;for(;c&&isIgnorable(c,-1);)s=n.parentNode,a=domIndex$1(c),c=c.previousSibling;if(c)n=c,o=nodeLen(n);else{if(n=n.parentNode,n==r.dom)break;o=0}}}l?setSelFocus(r,n,o):s&&setSelFocus(r,s,a)}function skipIgnoredNodesAfter(r){let e=r.domSelectionRange(),n=e.focusNode,o=e.focusOffset;if(!n)return;let s=nodeLen(n),a,l;for(;;)if(o<s){if(n.nodeType!=1)break;let c=n.childNodes[o];if(isIgnorable(c,1))a=n,l=++o;else break}else{if(isBlockNode(n))break;{let c=n.nextSibling;for(;c&&isIgnorable(c,1);)a=c.parentNode,l=domIndex$1(c)+1,c=c.nextSibling;if(c)n=c,o=0,s=nodeLen(n);else{if(n=n.parentNode,n==r.dom)break;o=s=0}}}a&&setSelFocus(r,a,l)}function isBlockNode(r){let e=r.pmViewDesc;return e&&e.node&&e.node.isBlock}function textNodeAfter$2(r,e){for(;r&&e==r.childNodes.length&&!hasBlockDesc(r);)e=domIndex$1(r)+1,r=r.parentNode;for(;r&&e<r.childNodes.length;){let n=r.childNodes[e];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;r=n,e=0}}function textNodeBefore$2(r,e){for(;r&&!e&&!hasBlockDesc(r);)e=domIndex$1(r),r=r.parentNode;for(;r&&e;){let n=r.childNodes[e-1];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;r=n,e=r.childNodes.length}}function setSelFocus(r,e,n){if(e.nodeType!=3){let a,l;(l=textNodeAfter$2(e,n))?(e=l,n=0):(a=textNodeBefore$2(e,n))&&(e=a,n=a.nodeValue.length)}let o=r.domSelection();if(!o)return;if(selectionCollapsed(o)){let a=document.createRange();a.setEnd(e,n),a.setStart(e,n),o.removeAllRanges(),o.addRange(a)}else o.extend&&o.extend(e,n);r.domObserver.setCurSelection();let{state:s}=r;setTimeout(()=>{r.state==s&&selectionToDOM(r)},50)}function findDirection(r,e){let n=r.state.doc.resolve(e);if(!(chrome$1||windows)&&n.parent.inlineContent){let o=r.coordsAtPos(e);if(e>n.start()){let s=r.coordsAtPos(e-1),a=(s.top+s.bottom)/2;if(a>o.top&&a<o.bottom&&Math.abs(s.left-o.left)>1)return s.left<o.left?"ltr":"rtl"}if(e<n.end()){let s=r.coordsAtPos(e+1),a=(s.top+s.bottom)/2;if(a>o.top&&a<o.bottom&&Math.abs(s.left-o.left)>1)return s.left>o.left?"ltr":"rtl"}}return getComputedStyle(r.dom).direction=="rtl"?"rtl":"ltr"}function selectVertically(r,e,n){let o=r.state.selection;if(o instanceof TextSelection&&!o.empty||n.indexOf("s")>-1||mac$2&&n.indexOf("m")>-1)return!1;let{$from:s,$to:a}=o;if(!s.parent.inlineContent||r.endOfTextblock(e<0?"up":"down")){let l=moveSelectionBlock(r.state,e);if(l&&l instanceof NodeSelection)return apply(r,l)}if(!s.parent.inlineContent){let l=e<0?s:a,c=o instanceof AllSelection?Selection.near(l,e):Selection.findFrom(l,e);return c?apply(r,c):!1}return!1}function stopNativeHorizontalDelete(r,e){if(!(r.state.selection instanceof TextSelection))return!0;let{$head:n,$anchor:o,empty:s}=r.state.selection;if(!n.sameParent(o))return!0;if(!s)return!1;if(r.endOfTextblock(e>0?"forward":"backward"))return!0;let a=!n.textOffset&&(e<0?n.nodeBefore:n.nodeAfter);if(a&&!a.isText){let l=r.state.tr;return e<0?l.delete(n.pos-a.nodeSize,n.pos):l.delete(n.pos,n.pos+a.nodeSize),r.dispatch(l),!0}return!1}function switchEditable(r,e,n){r.domObserver.stop(),e.contentEditable=n,r.domObserver.start()}function safariDownArrowBug(r){if(!safari$1||r.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:n}=r.domSelectionRange();if(e&&e.nodeType==1&&n==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let o=e.firstChild;switchEditable(r,o,"true"),setTimeout(()=>switchEditable(r,o,"false"),20)}return!1}function getMods(r){let e="";return r.ctrlKey&&(e+="c"),r.metaKey&&(e+="m"),r.altKey&&(e+="a"),r.shiftKey&&(e+="s"),e}function captureKeyDown(r,e){let n=e.keyCode,o=getMods(e);if(n==8||mac$2&&n==72&&o=="c")return stopNativeHorizontalDelete(r,-1)||skipIgnoredNodes(r,-1);if(n==46&&!e.shiftKey||mac$2&&n==68&&o=="c")return stopNativeHorizontalDelete(r,1)||skipIgnoredNodes(r,1);if(n==13||n==27)return!0;if(n==37||mac$2&&n==66&&o=="c"){let s=n==37?findDirection(r,r.state.selection.from)=="ltr"?-1:1:-1;return selectHorizontally(r,s,o)||skipIgnoredNodes(r,s)}else if(n==39||mac$2&&n==70&&o=="c"){let s=n==39?findDirection(r,r.state.selection.from)=="ltr"?1:-1:1;return selectHorizontally(r,s,o)||skipIgnoredNodes(r,s)}else{if(n==38||mac$2&&n==80&&o=="c")return selectVertically(r,-1,o)||skipIgnoredNodes(r,-1);if(n==40||mac$2&&n==78&&o=="c")return safariDownArrowBug(r)||selectVertically(r,1,o)||skipIgnoredNodes(r,1);if(o==(mac$2?"m":"c")&&(n==66||n==73||n==89||n==90))return!0}return!1}function serializeForClipboard(r,e){r.someProp("transformCopied",g=>{e=g(e,r)});let n=[],{content:o,openStart:s,openEnd:a}=e;for(;s>1&&a>1&&o.childCount==1&&o.firstChild.childCount==1;){s--,a--;let g=o.firstChild;n.push(g.type.name,g.attrs!=g.type.defaultAttrs?g.attrs:null),o=g.content}let l=r.someProp("clipboardSerializer")||DOMSerializer.fromSchema(r.state.schema),c=detachedDoc(),d=c.createElement("div");d.appendChild(l.serializeFragment(o,{document:c}));let u=d.firstChild,m,f=0;for(;u&&u.nodeType==1&&(m=wrapMap[u.nodeName.toLowerCase()]);){for(let g=m.length-1;g>=0;g--){let y=c.createElement(m[g]);for(;d.firstChild;)y.appendChild(d.firstChild);d.appendChild(y),f++}u=d.firstChild}u&&u.nodeType==1&&u.setAttribute("data-pm-slice",`${s} ${a}${f?` -${f}`:""} ${JSON.stringify(n)}`);let p=r.someProp("clipboardTextSerializer",g=>g(e,r))||e.content.textBetween(0,e.content.size,`

`);return{dom:d,text:p,slice:e}}function parseFromClipboard(r,e,n,o,s){let a=s.parent.type.spec.code,l,c;if(!n&&!e)return null;let d=e&&(o||a||!n);if(d){if(r.someProp("transformPastedText",p=>{e=p(e,a||o,r)}),a)return e?new Slice(Fragment.from(r.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0):Slice.empty;let f=r.someProp("clipboardTextParser",p=>p(e,s,o,r));if(f)c=f;else{let p=s.marks(),{schema:g}=r.state,y=DOMSerializer.fromSchema(g);l=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(b=>{let k=l.appendChild(document.createElement("p"));b&&k.appendChild(y.serializeNode(g.text(b,p)))})}}else r.someProp("transformPastedHTML",f=>{n=f(n,r)}),l=readHTML(n),webkit$1&&restoreReplacedSpaces(l);let u=l&&l.querySelector("[data-pm-slice]"),m=u&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(u.getAttribute("data-pm-slice")||"");if(m&&m[3])for(let f=+m[3];f>0;f--){let p=l.firstChild;for(;p&&p.nodeType!=1;)p=p.nextSibling;if(!p)break;l=p}if(c||(c=(r.someProp("clipboardParser")||r.someProp("domParser")||DOMParser$1.fromSchema(r.state.schema)).parseSlice(l,{preserveWhitespace:!!(d||m),context:s,ruleFromNode(f){return f.nodeName=="BR"&&!f.nextSibling&&f.parentNode&&!inlineParents.test(f.parentNode.nodeName)?{ignore:!0}:null}})),m)c=addContext(closeSlice(c,+m[1],+m[2]),m[4]);else if(c=Slice.maxOpen(normalizeSiblings(c.content,s),!0),c.openStart||c.openEnd){let f=0,p=0;for(let g=c.content.firstChild;f<c.openStart&&!g.type.spec.isolating;f++,g=g.firstChild);for(let g=c.content.lastChild;p<c.openEnd&&!g.type.spec.isolating;p++,g=g.lastChild);c=closeSlice(c,f,p)}return r.someProp("transformPasted",f=>{c=f(c,r)}),c}const inlineParents=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function normalizeSiblings(r,e){if(r.childCount<2)return r;for(let n=e.depth;n>=0;n--){let o=e.node(n).contentMatchAt(e.index(n)),s,a=[];if(r.forEach(l=>{if(!a)return;let c=o.findWrapping(l.type),d;if(!c)return a=null;if(d=a.length&&s.length&&addToSibling(c,s,l,a[a.length-1],0))a[a.length-1]=d;else{a.length&&(a[a.length-1]=closeRight(a[a.length-1],s.length));let u=withWrappers(l,c);a.push(u),o=o.matchType(u.type),s=c}}),a)return Fragment.from(a)}return r}function withWrappers(r,e,n=0){for(let o=e.length-1;o>=n;o--)r=e[o].create(null,Fragment.from(r));return r}function addToSibling(r,e,n,o,s){if(s<r.length&&s<e.length&&r[s]==e[s]){let a=addToSibling(r,e,n,o.lastChild,s+1);if(a)return o.copy(o.content.replaceChild(o.childCount-1,a));if(o.contentMatchAt(o.childCount).matchType(s==r.length-1?n.type:r[s+1]))return o.copy(o.content.append(Fragment.from(withWrappers(n,r,s+1))))}}function closeRight(r,e){if(e==0)return r;let n=r.content.replaceChild(r.childCount-1,closeRight(r.lastChild,e-1)),o=r.contentMatchAt(r.childCount).fillBefore(Fragment.empty,!0);return r.copy(n.append(o))}function closeRange(r,e,n,o,s,a){let l=e<0?r.firstChild:r.lastChild,c=l.content;return r.childCount>1&&(a=0),s<o-1&&(c=closeRange(c,e,n,o,s+1,a)),s>=n&&(c=e<0?l.contentMatchAt(0).fillBefore(c,a<=s).append(c):c.append(l.contentMatchAt(l.childCount).fillBefore(Fragment.empty,!0))),r.replaceChild(e<0?0:r.childCount-1,l.copy(c))}function closeSlice(r,e,n){return e<r.openStart&&(r=new Slice(closeRange(r.content,-1,e,r.openStart,0,r.openEnd),e,r.openEnd)),n<r.openEnd&&(r=new Slice(closeRange(r.content,1,n,r.openEnd,0,0),r.openStart,n)),r}const wrapMap={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let _detachedDoc=null;function detachedDoc(){return _detachedDoc||(_detachedDoc=document.implementation.createHTMLDocument("title"))}let _policy=null;function maybeWrapTrusted(r){let e=window.trustedTypes;return e?(_policy||(_policy=e.createPolicy("ProseMirrorClipboard",{createHTML:n=>n})),_policy.createHTML(r)):r}function readHTML(r){let e=/^(\s*<meta [^>]*>)*/.exec(r);e&&(r=r.slice(e[0].length));let n=detachedDoc().createElement("div"),o=/<([a-z][^>\s]+)/i.exec(r),s;if((s=o&&wrapMap[o[1].toLowerCase()])&&(r=s.map(a=>"<"+a+">").join("")+r+s.map(a=>"</"+a+">").reverse().join("")),n.innerHTML=maybeWrapTrusted(r),s)for(let a=0;a<s.length;a++)n=n.querySelector(s[a])||n;return n}function restoreReplacedSpaces(r){let e=r.querySelectorAll(chrome$1?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<e.length;n++){let o=e[n];o.childNodes.length==1&&o.textContent=="\xA0"&&o.parentNode&&o.parentNode.replaceChild(r.ownerDocument.createTextNode(" "),o)}}function addContext(r,e){if(!r.size)return r;let n=r.content.firstChild.type.schema,o;try{o=JSON.parse(e)}catch{return r}let{content:s,openStart:a,openEnd:l}=r;for(let c=o.length-2;c>=0;c-=2){let d=n.nodes[o[c]];if(!d||d.hasRequiredAttrs())break;s=Fragment.from(d.create(o[c+1],s)),a++,l++}return new Slice(s,a,l)}const handlers$1={},editHandlers={},passiveHandlers={touchstart:!0,touchmove:!0};let InputState$1=class{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:""},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}};function initInput(r){for(let e in handlers$1){let n=handlers$1[e];r.dom.addEventListener(e,r.input.eventHandlers[e]=o=>{eventBelongsToView(r,o)&&!runCustomHandler(r,o)&&(r.editable||!(o.type in editHandlers))&&n(r,o)},passiveHandlers[e]?{passive:!0}:void 0)}safari$1&&r.dom.addEventListener("input",()=>null),ensureListeners(r)}function setSelectionOrigin(r,e){r.input.lastSelectionOrigin=e,r.input.lastSelectionTime=Date.now()}function destroyInput(r){r.domObserver.stop();for(let e in r.input.eventHandlers)r.dom.removeEventListener(e,r.input.eventHandlers[e]);clearTimeout(r.input.composingTimeout),clearTimeout(r.input.lastIOSEnterFallbackTimeout)}function ensureListeners(r){r.someProp("handleDOMEvents",e=>{for(let n in e)r.input.eventHandlers[n]||r.dom.addEventListener(n,r.input.eventHandlers[n]=o=>runCustomHandler(r,o))})}function runCustomHandler(r,e){return r.someProp("handleDOMEvents",n=>{let o=n[e.type];return o?o(r,e)||e.defaultPrevented:!1})}function eventBelongsToView(r,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let n=e.target;n!=r.dom;n=n.parentNode)if(!n||n.nodeType==11||n.pmViewDesc&&n.pmViewDesc.stopEvent(e))return!1;return!0}function dispatchEvent(r,e){!runCustomHandler(r,e)&&handlers$1[e.type]&&(r.editable||!(e.type in editHandlers))&&handlers$1[e.type](r,e)}editHandlers.keydown=(r,e)=>{let n=e;if(r.input.shiftKey=n.keyCode==16||n.shiftKey,!inOrNearComposition(r,n)&&(r.input.lastKeyCode=n.keyCode,r.input.lastKeyCodeTime=Date.now(),!(android$1&&chrome$1&&n.keyCode==13)))if(n.keyCode!=229&&r.domObserver.forceFlush(),ios$1&&n.keyCode==13&&!n.ctrlKey&&!n.altKey&&!n.metaKey){let o=Date.now();r.input.lastIOSEnter=o,r.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{r.input.lastIOSEnter==o&&(r.someProp("handleKeyDown",s=>s(r,keyEvent(13,"Enter"))),r.input.lastIOSEnter=0)},200)}else r.someProp("handleKeyDown",o=>o(r,n))||captureKeyDown(r,n)?n.preventDefault():setSelectionOrigin(r,"key")},editHandlers.keyup=(r,e)=>{e.keyCode==16&&(r.input.shiftKey=!1)},editHandlers.keypress=(r,e)=>{let n=e;if(inOrNearComposition(r,n)||!n.charCode||n.ctrlKey&&!n.altKey||mac$2&&n.metaKey)return;if(r.someProp("handleKeyPress",s=>s(r,n))){n.preventDefault();return}let o=r.state.selection;if(!(o instanceof TextSelection)||!o.$from.sameParent(o.$to)){let s=String.fromCharCode(n.charCode);!/[\r\n]/.test(s)&&!r.someProp("handleTextInput",a=>a(r,o.$from.pos,o.$to.pos,s))&&r.dispatch(r.state.tr.insertText(s).scrollIntoView()),n.preventDefault()}};function eventCoords(r){return{left:r.clientX,top:r.clientY}}function isNear(r,e){let n=e.x-r.clientX,o=e.y-r.clientY;return n*n+o*o<100}function runHandlerOnContext(r,e,n,o,s){if(o==-1)return!1;let a=r.state.doc.resolve(o);for(let l=a.depth+1;l>0;l--)if(r.someProp(e,c=>l>a.depth?c(r,n,a.nodeAfter,a.before(l),s,!0):c(r,n,a.node(l),a.before(l),s,!1)))return!0;return!1}function updateSelection(r,e,n){if(r.focused||r.focus(),r.state.selection.eq(e))return;let o=r.state.tr.setSelection(e);o.setMeta("pointer",!0),r.dispatch(o)}function selectClickedLeaf(r,e){if(e==-1)return!1;let n=r.state.doc.resolve(e),o=n.nodeAfter;return o&&o.isAtom&&NodeSelection.isSelectable(o)?(updateSelection(r,new NodeSelection(n)),!0):!1}function selectClickedNode(r,e){if(e==-1)return!1;let n=r.state.selection,o,s;n instanceof NodeSelection&&(o=n.node);let a=r.state.doc.resolve(e);for(let l=a.depth+1;l>0;l--){let c=l>a.depth?a.nodeAfter:a.node(l);if(NodeSelection.isSelectable(c)){o&&n.$from.depth>0&&l>=n.$from.depth&&a.before(n.$from.depth+1)==n.$from.pos?s=a.before(n.$from.depth):s=a.before(l);break}}return s!=null?(updateSelection(r,NodeSelection.create(r.state.doc,s)),!0):!1}function handleSingleClick(r,e,n,o,s){return runHandlerOnContext(r,"handleClickOn",e,n,o)||r.someProp("handleClick",a=>a(r,e,o))||(s?selectClickedNode(r,n):selectClickedLeaf(r,n))}function handleDoubleClick(r,e,n,o){return runHandlerOnContext(r,"handleDoubleClickOn",e,n,o)||r.someProp("handleDoubleClick",s=>s(r,e,o))}function handleTripleClick(r,e,n,o){return runHandlerOnContext(r,"handleTripleClickOn",e,n,o)||r.someProp("handleTripleClick",s=>s(r,e,o))||defaultTripleClick(r,n,o)}function defaultTripleClick(r,e,n){if(n.button!=0)return!1;let o=r.state.doc;if(e==-1)return o.inlineContent?(updateSelection(r,TextSelection.create(o,0,o.content.size)),!0):!1;let s=o.resolve(e);for(let a=s.depth+1;a>0;a--){let l=a>s.depth?s.nodeAfter:s.node(a),c=s.before(a);if(l.inlineContent)updateSelection(r,TextSelection.create(o,c+1,c+1+l.content.size));else if(NodeSelection.isSelectable(l))updateSelection(r,NodeSelection.create(o,c));else continue;return!0}}function forceDOMFlush(r){return endComposition(r)}const selectNodeModifier=mac$2?"metaKey":"ctrlKey";handlers$1.mousedown=(r,e)=>{let n=e;r.input.shiftKey=n.shiftKey;let o=forceDOMFlush(r),s=Date.now(),a="singleClick";s-r.input.lastClick.time<500&&isNear(n,r.input.lastClick)&&!n[selectNodeModifier]&&(r.input.lastClick.type=="singleClick"?a="doubleClick":r.input.lastClick.type=="doubleClick"&&(a="tripleClick")),r.input.lastClick={time:s,x:n.clientX,y:n.clientY,type:a};let l=r.posAtCoords(eventCoords(n));l&&(a=="singleClick"?(r.input.mouseDown&&r.input.mouseDown.done(),r.input.mouseDown=new MouseDown(r,l,n,!!o)):(a=="doubleClick"?handleDoubleClick:handleTripleClick)(r,l.pos,l.inside,n)?n.preventDefault():setSelectionOrigin(r,"pointer"))};class MouseDown{constructor(e,n,o,s){this.view=e,this.pos=n,this.event=o,this.flushed=s,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!o[selectNodeModifier],this.allowDefault=o.shiftKey;let a,l;if(n.inside>-1)a=e.state.doc.nodeAt(n.inside),l=n.inside;else{let m=e.state.doc.resolve(n.pos);a=m.parent,l=m.depth?m.before():0}const c=s?null:o.target,d=c?e.docView.nearestDesc(c,!0):null;this.target=d&&d.dom.nodeType==1?d.dom:null;let{selection:u}=e.state;(o.button==0&&a.type.spec.draggable&&a.type.spec.selectable!==!1||u instanceof NodeSelection&&u.from<=l&&u.to>l)&&(this.mightDrag={node:a,pos:l,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&gecko$1&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),setSelectionOrigin(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>selectionToDOM(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let n=this.pos;this.view.state.doc!=this.startDoc&&(n=this.view.posAtCoords(eventCoords(e))),this.updateAllowDefault(e),this.allowDefault||!n?setSelectionOrigin(this.view,"pointer"):handleSingleClick(this.view,n.pos,n.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||safari$1&&this.mightDrag&&!this.mightDrag.node.isAtom||chrome$1&&!this.view.state.selection.visible&&Math.min(Math.abs(n.pos-this.view.state.selection.from),Math.abs(n.pos-this.view.state.selection.to))<=2)?(updateSelection(this.view,Selection.near(this.view.state.doc.resolve(n.pos))),e.preventDefault()):setSelectionOrigin(this.view,"pointer")}move(e){this.updateAllowDefault(e),setSelectionOrigin(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}handlers$1.touchstart=r=>{r.input.lastTouch=Date.now(),forceDOMFlush(r),setSelectionOrigin(r,"pointer")},handlers$1.touchmove=r=>{r.input.lastTouch=Date.now(),setSelectionOrigin(r,"pointer")},handlers$1.contextmenu=r=>forceDOMFlush(r);function inOrNearComposition(r,e){return r.composing?!0:safari$1&&Math.abs(e.timeStamp-r.input.compositionEndedAt)<500?(r.input.compositionEndedAt=-2e8,!0):!1}const timeoutComposition=android$1?5e3:-1;editHandlers.compositionstart=editHandlers.compositionupdate=r=>{if(!r.composing){r.domObserver.flush();let{state:e}=r,n=e.selection.$to;if(e.selection instanceof TextSelection&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(o=>o.type.spec.inclusive===!1)))r.markCursor=r.state.storedMarks||n.marks(),endComposition(r,!0),r.markCursor=null;else if(endComposition(r,!e.selection.empty),gecko$1&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let o=r.domSelectionRange();for(let s=o.focusNode,a=o.focusOffset;s&&s.nodeType==1&&a!=0;){let l=a<0?s.lastChild:s.childNodes[a-1];if(!l)break;if(l.nodeType==3){let c=r.domSelection();c&&c.collapse(l,l.nodeValue.length);break}else s=l,a=-1}}r.input.composing=!0}scheduleComposeEnd(r,timeoutComposition)},editHandlers.compositionend=(r,e)=>{r.composing&&(r.input.composing=!1,r.input.compositionEndedAt=e.timeStamp,r.input.compositionPendingChanges=r.domObserver.pendingRecords().length?r.input.compositionID:0,r.input.compositionNode=null,r.input.compositionPendingChanges&&Promise.resolve().then(()=>r.domObserver.flush()),r.input.compositionID++,scheduleComposeEnd(r,20))};function scheduleComposeEnd(r,e){clearTimeout(r.input.composingTimeout),e>-1&&(r.input.composingTimeout=setTimeout(()=>endComposition(r),e))}function clearComposition(r){for(r.composing&&(r.input.composing=!1,r.input.compositionEndedAt=timestampFromCustomEvent());r.input.compositionNodes.length>0;)r.input.compositionNodes.pop().markParentsDirty()}function findCompositionNode$1(r){let e=r.domSelectionRange();if(!e.focusNode)return null;let n=textNodeBefore$1(e.focusNode,e.focusOffset),o=textNodeAfter$1(e.focusNode,e.focusOffset);if(n&&o&&n!=o){let s=o.pmViewDesc,a=r.domObserver.lastChangedTextNode;if(n==a||o==a)return a;if(!s||!s.isText(o.nodeValue))return o;if(r.input.compositionNode==o){let l=n.pmViewDesc;if(!(!l||!l.isText(n.nodeValue)))return o}}return n||o}function timestampFromCustomEvent(){let r=document.createEvent("Event");return r.initEvent("event",!0,!0),r.timeStamp}function endComposition(r,e=!1){if(!(android$1&&r.domObserver.flushingSoon>=0)){if(r.domObserver.forceFlush(),clearComposition(r),e||r.docView&&r.docView.dirty){let n=selectionFromDOM(r);return n&&!n.eq(r.state.selection)?r.dispatch(r.state.tr.setSelection(n)):(r.markCursor||e)&&!r.state.selection.empty?r.dispatch(r.state.tr.deleteSelection()):r.updateState(r.state),!0}return!1}}function captureCopy$1(r,e){if(!r.dom.parentNode)return;let n=r.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";let o=getSelection(),s=document.createRange();s.selectNodeContents(e),r.dom.blur(),o.removeAllRanges(),o.addRange(s),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),r.focus()},50)}const brokenClipboardAPI$1=ie$2&&ie_version<15||ios$1&&webkit_version<604;handlers$1.copy=editHandlers.cut=(r,e)=>{let n=e,o=r.state.selection,s=n.type=="cut";if(o.empty)return;let a=brokenClipboardAPI$1?null:n.clipboardData,l=o.content(),{dom:c,text:d}=serializeForClipboard(r,l);a?(n.preventDefault(),a.clearData(),a.setData("text/html",c.innerHTML),a.setData("text/plain",d)):captureCopy$1(r,c),s&&r.dispatch(r.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function sliceSingleNode(r){return r.openStart==0&&r.openEnd==0&&r.content.childCount==1?r.content.firstChild:null}function capturePaste$1(r,e){if(!r.dom.parentNode)return;let n=r.input.shiftKey||r.state.selection.$from.parent.type.spec.code,o=r.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(o.contentEditable="true"),o.style.cssText="position: fixed; left: -10000px; top: 10px",o.focus();let s=r.input.shiftKey&&r.input.lastKeyCode!=45;setTimeout(()=>{r.focus(),o.parentNode&&o.parentNode.removeChild(o),n?doPaste$1(r,o.value,null,s,e):doPaste$1(r,o.textContent,o.innerHTML,s,e)},50)}function doPaste$1(r,e,n,o,s){let a=parseFromClipboard(r,e,n,o,r.state.selection.$from);if(r.someProp("handlePaste",d=>d(r,s,a||Slice.empty)))return!0;if(!a)return!1;let l=sliceSingleNode(a),c=l?r.state.tr.replaceSelectionWith(l,o):r.state.tr.replaceSelection(a);return r.dispatch(c.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function getText(r){let e=r.getData("text/plain")||r.getData("Text");if(e)return e;let n=r.getData("text/uri-list");return n?n.replace(/\r?\n/g," "):""}editHandlers.paste=(r,e)=>{let n=e;if(r.composing&&!android$1)return;let o=brokenClipboardAPI$1?null:n.clipboardData,s=r.input.shiftKey&&r.input.lastKeyCode!=45;o&&doPaste$1(r,getText(o),o.getData("text/html"),s,n)?n.preventDefault():capturePaste$1(r,n)};class Dragging{constructor(e,n,o){this.slice=e,this.move=n,this.node=o}}const dragCopyModifier=mac$2?"altKey":"ctrlKey";handlers$1.dragstart=(r,e)=>{let n=e,o=r.input.mouseDown;if(o&&o.done(),!n.dataTransfer)return;let s=r.state.selection,a=s.empty?null:r.posAtCoords(eventCoords(n)),l;if(!(a&&a.pos>=s.from&&a.pos<=(s instanceof NodeSelection?s.to-1:s.to))){if(o&&o.mightDrag)l=NodeSelection.create(r.state.doc,o.mightDrag.pos);else if(n.target&&n.target.nodeType==1){let f=r.docView.nearestDesc(n.target,!0);f&&f.node.type.spec.draggable&&f!=r.docView&&(l=NodeSelection.create(r.state.doc,f.posBefore))}}let c=(l||r.state.selection).content(),{dom:d,text:u,slice:m}=serializeForClipboard(r,c);(!n.dataTransfer.files.length||!chrome$1||chrome_version>120)&&n.dataTransfer.clearData(),n.dataTransfer.setData(brokenClipboardAPI$1?"Text":"text/html",d.innerHTML),n.dataTransfer.effectAllowed="copyMove",brokenClipboardAPI$1||n.dataTransfer.setData("text/plain",u),r.dragging=new Dragging(m,!n[dragCopyModifier],l)},handlers$1.dragend=r=>{let e=r.dragging;window.setTimeout(()=>{r.dragging==e&&(r.dragging=null)},50)},editHandlers.dragover=editHandlers.dragenter=(r,e)=>e.preventDefault(),editHandlers.drop=(r,e)=>{let n=e,o=r.dragging;if(r.dragging=null,!n.dataTransfer)return;let s=r.posAtCoords(eventCoords(n));if(!s)return;let a=r.state.doc.resolve(s.pos),l=o&&o.slice;l?r.someProp("transformPasted",y=>{l=y(l,r)}):l=parseFromClipboard(r,getText(n.dataTransfer),brokenClipboardAPI$1?null:n.dataTransfer.getData("text/html"),!1,a);let c=!!(o&&!n[dragCopyModifier]);if(r.someProp("handleDrop",y=>y(r,n,l||Slice.empty,c))){n.preventDefault();return}if(!l)return;n.preventDefault();let d=l?dropPoint(r.state.doc,a.pos,l):a.pos;d==null&&(d=a.pos);let u=r.state.tr;if(c){let{node:y}=o;y?y.replace(u):u.deleteSelection()}let m=u.mapping.map(d),f=l.openStart==0&&l.openEnd==0&&l.content.childCount==1,p=u.doc;if(f?u.replaceRangeWith(m,m,l.content.firstChild):u.replaceRange(m,m,l),u.doc.eq(p))return;let g=u.doc.resolve(m);if(f&&NodeSelection.isSelectable(l.content.firstChild)&&g.nodeAfter&&g.nodeAfter.sameMarkup(l.content.firstChild))u.setSelection(new NodeSelection(g));else{let y=u.mapping.map(d);u.mapping.maps[u.mapping.maps.length-1].forEach((b,k,w,B)=>y=B),u.setSelection(selectionBetween(r,g,u.doc.resolve(y)))}r.focus(),r.dispatch(u.setMeta("uiEvent","drop"))},handlers$1.focus=r=>{r.input.lastFocus=Date.now(),r.focused||(r.domObserver.stop(),r.dom.classList.add("ProseMirror-focused"),r.domObserver.start(),r.focused=!0,setTimeout(()=>{r.docView&&r.hasFocus()&&!r.domObserver.currentSelection.eq(r.domSelectionRange())&&selectionToDOM(r)},20))},handlers$1.blur=(r,e)=>{let n=e;r.focused&&(r.domObserver.stop(),r.dom.classList.remove("ProseMirror-focused"),r.domObserver.start(),n.relatedTarget&&r.dom.contains(n.relatedTarget)&&r.domObserver.currentSelection.clear(),r.focused=!1)},handlers$1.beforeinput=(r,e)=>{if(chrome$1&&android$1&&e.inputType=="deleteContentBackward"){r.domObserver.flushSoon();let{domChangeCount:n}=r.input;setTimeout(()=>{if(r.input.domChangeCount!=n||(r.dom.blur(),r.focus(),r.someProp("handleKeyDown",s=>s(r,keyEvent(8,"Backspace")))))return;let{$cursor:o}=r.state.selection;o&&o.pos>0&&r.dispatch(r.state.tr.delete(o.pos-1,o.pos).scrollIntoView())},50)}};for(let r in editHandlers)handlers$1[r]=editHandlers[r];function compareObjs(r,e){if(r==e)return!0;for(let n in r)if(r[n]!==e[n])return!1;for(let n in e)if(!(n in r))return!1;return!0}let WidgetType$1=class De{constructor(e,n){this.toDOM=e,this.spec=n||noSpec,this.side=this.spec.side||0}map(e,n,o,s){let{pos:a,deleted:l}=e.mapResult(n.from+s,this.side<0?-1:1);return l?null:new Decoration$1(a-o,a-o,this)}valid(){return!0}eq(e){return this==e||e instanceof De&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&compareObjs(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}};class InlineType{constructor(e,n){this.attrs=e,this.spec=n||noSpec}map(e,n,o,s){let a=e.map(n.from+s,this.spec.inclusiveStart?-1:1)-o,l=e.map(n.to+s,this.spec.inclusiveEnd?1:-1)-o;return a>=l?null:new Decoration$1(a,l,this)}valid(e,n){return n.from<n.to}eq(e){return this==e||e instanceof InlineType&&compareObjs(this.attrs,e.attrs)&&compareObjs(this.spec,e.spec)}static is(e){return e.type instanceof InlineType}destroy(){}}let NodeType$1=class Ee{constructor(e,n){this.attrs=e,this.spec=n||noSpec}map(e,n,o,s){let a=e.mapResult(n.from+s,1);if(a.deleted)return null;let l=e.mapResult(n.to+s,-1);return l.deleted||l.pos<=a.pos?null:new Decoration$1(a.pos-o,l.pos-o,this)}valid(e,n){let{index:o,offset:s}=e.content.findIndex(n.from),a;return s==n.from&&!(a=e.child(o)).isText&&s+a.nodeSize==n.to}eq(e){return this==e||e instanceof Ee&&compareObjs(this.attrs,e.attrs)&&compareObjs(this.spec,e.spec)}destroy(){}},Decoration$1=class we{constructor(e,n,o){this.from=e,this.to=n,this.type=o}copy(e,n){return new we(e,n,this.type)}eq(e,n=0){return this.type.eq(e.type)&&this.from+n==e.from&&this.to+n==e.to}map(e,n,o){return this.type.map(e,this,n,o)}static widget(e,n,o){return new we(e,e,new WidgetType$1(n,o))}static inline(e,n,o,s){return new we(e,n,new InlineType(o,s))}static node(e,n,o,s){return new we(e,n,new NodeType$1(o,s))}get spec(){return this.type.spec}get inline(){return this.type instanceof InlineType}get widget(){return this.type instanceof WidgetType$1}};const none$2=[],noSpec={};class DecorationSet{constructor(e,n){this.local=e.length?e:none$2,this.children=n.length?n:none$2}static create(e,n){return n.length?buildTree$2(n,e,0,noSpec):empty}find(e,n,o){let s=[];return this.findInner(e??0,n??1e9,s,0,o),s}findInner(e,n,o,s,a){for(let l=0;l<this.local.length;l++){let c=this.local[l];c.from<=n&&c.to>=e&&(!a||a(c.spec))&&o.push(c.copy(c.from+s,c.to+s))}for(let l=0;l<this.children.length;l+=3)if(this.children[l]<n&&this.children[l+1]>e){let c=this.children[l]+1;this.children[l+2].findInner(e-c,n-c,o,s+c,a)}}map(e,n,o){return this==empty||e.maps.length==0?this:this.mapInner(e,n,0,0,o||noSpec)}mapInner(e,n,o,s,a){let l;for(let c=0;c<this.local.length;c++){let d=this.local[c].map(e,o,s);d&&d.type.valid(n,d)?(l||(l=[])).push(d):a.onRemove&&a.onRemove(this.local[c].spec)}return this.children.length?mapChildren(this.children,l||[],e,n,o,s,a):l?new DecorationSet(l.sort(byPos),none$2):empty}add(e,n){return n.length?this==empty?DecorationSet.create(e,n):this.addInner(e,n,0):this}addInner(e,n,o){let s,a=0;e.forEach((c,d)=>{let u=d+o,m;if(m=takeSpansForNode(n,c,u)){for(s||(s=this.children.slice());a<s.length&&s[a]<d;)a+=3;s[a]==d?s[a+2]=s[a+2].addInner(c,m,u+1):s.splice(a,0,d,d+c.nodeSize,buildTree$2(m,c,u+1,noSpec)),a+=3}});let l=moveSpans(a?withoutNulls(n):n,-o);for(let c=0;c<l.length;c++)l[c].type.valid(e,l[c])||l.splice(c--,1);return new DecorationSet(l.length?this.local.concat(l).sort(byPos):this.local,s||this.children)}remove(e){return e.length==0||this==empty?this:this.removeInner(e,0)}removeInner(e,n){let o=this.children,s=this.local;for(let a=0;a<o.length;a+=3){let l,c=o[a]+n,d=o[a+1]+n;for(let m=0,f;m<e.length;m++)(f=e[m])&&f.from>c&&f.to<d&&(e[m]=null,(l||(l=[])).push(f));if(!l)continue;o==this.children&&(o=this.children.slice());let u=o[a+2].removeInner(l,c+1);u!=empty?o[a+2]=u:(o.splice(a,3),a-=3)}if(s.length){for(let a=0,l;a<e.length;a++)if(l=e[a])for(let c=0;c<s.length;c++)s[c].eq(l,n)&&(s==this.local&&(s=this.local.slice()),s.splice(c--,1))}return o==this.children&&s==this.local?this:s.length||o.length?new DecorationSet(s,o):empty}forChild(e,n){if(this==empty)return this;if(n.isLeaf)return DecorationSet.empty;let o,s;for(let c=0;c<this.children.length;c+=3)if(this.children[c]>=e){this.children[c]==e&&(o=this.children[c+2]);break}let a=e+1,l=a+n.content.size;for(let c=0;c<this.local.length;c++){let d=this.local[c];if(d.from<l&&d.to>a&&d.type instanceof InlineType){let u=Math.max(a,d.from)-a,m=Math.min(l,d.to)-a;u<m&&(s||(s=[])).push(d.copy(u,m))}}if(s){let c=new DecorationSet(s.sort(byPos),none$2);return o?new DecorationGroup([c,o]):c}return o||empty}eq(e){if(this==e)return!0;if(!(e instanceof DecorationSet)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let n=0;n<this.local.length;n++)if(!this.local[n].eq(e.local[n]))return!1;for(let n=0;n<this.children.length;n+=3)if(this.children[n]!=e.children[n]||this.children[n+1]!=e.children[n+1]||!this.children[n+2].eq(e.children[n+2]))return!1;return!0}locals(e){return removeOverlap(this.localsInner(e))}localsInner(e){if(this==empty)return none$2;if(e.inlineContent||!this.local.some(InlineType.is))return this.local;let n=[];for(let o=0;o<this.local.length;o++)this.local[o].type instanceof InlineType||n.push(this.local[o]);return n}forEachSet(e){e(this)}}DecorationSet.empty=new DecorationSet([],[]),DecorationSet.removeOverlap=removeOverlap;const empty=DecorationSet.empty;class DecorationGroup{constructor(e){this.members=e}map(e,n){const o=this.members.map(s=>s.map(e,n,noSpec));return DecorationGroup.from(o)}forChild(e,n){if(n.isLeaf)return DecorationSet.empty;let o=[];for(let s=0;s<this.members.length;s++){let a=this.members[s].forChild(e,n);a!=empty&&(a instanceof DecorationGroup?o=o.concat(a.members):o.push(a))}return DecorationGroup.from(o)}eq(e){if(!(e instanceof DecorationGroup)||e.members.length!=this.members.length)return!1;for(let n=0;n<this.members.length;n++)if(!this.members[n].eq(e.members[n]))return!1;return!0}locals(e){let n,o=!0;for(let s=0;s<this.members.length;s++){let a=this.members[s].localsInner(e);if(a.length)if(!n)n=a;else{o&&(n=n.slice(),o=!1);for(let l=0;l<a.length;l++)n.push(a[l])}}return n?removeOverlap(o?n:n.sort(byPos)):none$2}static from(e){switch(e.length){case 0:return empty;case 1:return e[0];default:return new DecorationGroup(e.every(n=>n instanceof DecorationSet)?e:e.reduce((n,o)=>n.concat(o instanceof DecorationSet?o:o.members),[]))}}forEachSet(e){for(let n=0;n<this.members.length;n++)this.members[n].forEachSet(e)}}function mapChildren(r,e,n,o,s,a,l){let c=r.slice();for(let u=0,m=a;u<n.maps.length;u++){let f=0;n.maps[u].forEach((p,g,y,b)=>{let k=b-y-(g-p);for(let w=0;w<c.length;w+=3){let B=c[w+1];if(B<0||p>B+m-f)continue;let M=c[w]+m-f;g>=M?c[w+1]=p<=M?-2:-1:p>=m&&k&&(c[w]+=k,c[w+1]+=k)}f+=k}),m=n.maps[u].map(m,-1)}let d=!1;for(let u=0;u<c.length;u+=3)if(c[u+1]<0){if(c[u+1]==-2){d=!0,c[u+1]=-1;continue}let m=n.map(r[u]+a),f=m-s;if(f<0||f>=o.content.size){d=!0;continue}let p=n.map(r[u+1]+a,-1),g=p-s,{index:y,offset:b}=o.content.findIndex(f),k=o.maybeChild(y);if(k&&b==f&&b+k.nodeSize==g){let w=c[u+2].mapInner(n,k,m+1,r[u]+a+1,l);w!=empty?(c[u]=f,c[u+1]=g,c[u+2]=w):(c[u+1]=-2,d=!0)}else d=!0}if(d){let u=mapAndGatherRemainingDecorations(c,r,e,n,s,a,l),m=buildTree$2(u,o,0,l);e=m.local;for(let f=0;f<c.length;f+=3)c[f+1]<0&&(c.splice(f,3),f-=3);for(let f=0,p=0;f<m.children.length;f+=3){let g=m.children[f];for(;p<c.length&&c[p]<g;)p+=3;c.splice(p,0,m.children[f],m.children[f+1],m.children[f+2])}}return new DecorationSet(e.sort(byPos),c)}function moveSpans(r,e){if(!e||!r.length)return r;let n=[];for(let o=0;o<r.length;o++){let s=r[o];n.push(new Decoration$1(s.from+e,s.to+e,s.type))}return n}function mapAndGatherRemainingDecorations(r,e,n,o,s,a,l){function c(d,u){for(let m=0;m<d.local.length;m++){let f=d.local[m].map(o,s,u);f?n.push(f):l.onRemove&&l.onRemove(d.local[m].spec)}for(let m=0;m<d.children.length;m+=3)c(d.children[m+2],d.children[m]+u+1)}for(let d=0;d<r.length;d+=3)r[d+1]==-1&&c(r[d+2],e[d]+a+1);return n}function takeSpansForNode(r,e,n){if(e.isLeaf)return null;let o=n+e.nodeSize,s=null;for(let a=0,l;a<r.length;a++)(l=r[a])&&l.from>n&&l.to<o&&((s||(s=[])).push(l),r[a]=null);return s}function withoutNulls(r){let e=[];for(let n=0;n<r.length;n++)r[n]!=null&&e.push(r[n]);return e}function buildTree$2(r,e,n,o){let s=[],a=!1;e.forEach((c,d)=>{let u=takeSpansForNode(r,c,d+n);if(u){a=!0;let m=buildTree$2(u,c,n+d+1,o);m!=empty&&s.push(d,d+c.nodeSize,m)}});let l=moveSpans(a?withoutNulls(r):r,-n).sort(byPos);for(let c=0;c<l.length;c++)l[c].type.valid(e,l[c])||(o.onRemove&&o.onRemove(l[c].spec),l.splice(c--,1));return l.length||s.length?new DecorationSet(l,s):empty}function byPos(r,e){return r.from-e.from||r.to-e.to}function removeOverlap(r){let e=r;for(let n=0;n<e.length-1;n++){let o=e[n];if(o.from!=o.to)for(let s=n+1;s<e.length;s++){let a=e[s];if(a.from==o.from){a.to!=o.to&&(e==r&&(e=r.slice()),e[s]=a.copy(a.from,o.to),insertAhead(e,s+1,a.copy(o.to,a.to)));continue}else{a.from<o.to&&(e==r&&(e=r.slice()),e[n]=o.copy(o.from,a.from),insertAhead(e,s,o.copy(a.from,o.to)));break}}}return e}function insertAhead(r,e,n){for(;e<r.length&&byPos(n,r[e])>0;)e++;r.splice(e,0,n)}function viewDecorations(r){let e=[];return r.someProp("decorations",n=>{let o=n(r.state);o&&o!=empty&&e.push(o)}),r.cursorWrapper&&e.push(DecorationSet.create(r.state.doc,[r.cursorWrapper.deco])),DecorationGroup.from(e)}const observeOptions$1={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},useCharData$1=ie$2&&ie_version<=11;class SelectionState{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}let DOMObserver$1=class{constructor(r,e){this.view=r,this.handleDOMChange=e,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new SelectionState,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(n=>{for(let o=0;o<n.length;o++)this.queue.push(n[o]);ie$2&&ie_version<=11&&n.some(o=>o.type=="childList"&&o.removedNodes.length||o.type=="characterData"&&o.oldValue.length>o.target.nodeValue.length)?this.flushSoon():this.flush()}),useCharData$1&&(this.onCharData=n=>{this.queue.push({target:n.target,type:"characterData",oldValue:n.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,observeOptions$1)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let r=this.observer.takeRecords();if(r.length){for(let e=0;e<r.length;e++)this.queue.push(r[e]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(hasFocusAndSelection(this.view)){if(this.suppressingSelectionUpdates)return selectionToDOM(this.view);if(ie$2&&ie_version<=11&&!this.view.state.selection.empty){let r=this.view.domSelectionRange();if(r.focusNode&&isEquivalentPosition$1(r.focusNode,r.focusOffset,r.anchorNode,r.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(r){if(!r.focusNode)return!0;let e=new Set,n;for(let s=r.focusNode;s;s=parentNode(s))e.add(s);for(let s=r.anchorNode;s;s=parentNode(s))if(e.has(s)){n=s;break}let o=n&&this.view.docView.nearestDesc(n);if(o&&o.ignoreMutation({type:"selection",target:n.nodeType==3?n.parentNode:n}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let r of this.observer.takeRecords())this.queue.push(r);return this.queue}flush(){let{view:r}=this;if(!r.docView||this.flushingSoon>-1)return;let e=this.pendingRecords();e.length&&(this.queue=[]);let n=r.domSelectionRange(),o=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(n)&&hasFocusAndSelection(r)&&!this.ignoreSelectionChange(n),s=-1,a=-1,l=!1,c=[];if(r.editable)for(let u=0;u<e.length;u++){let m=this.registerMutation(e[u],c);m&&(s=s<0?m.from:Math.min(m.from,s),a=a<0?m.to:Math.max(m.to,a),m.typeOver&&(l=!0))}if(gecko$1&&c.length){let u=c.filter(m=>m.nodeName=="BR");if(u.length==2){let[m,f]=u;m.parentNode&&m.parentNode.parentNode==f.parentNode?f.remove():m.remove()}else{let{focusNode:m}=this.currentSelection;for(let f of u){let p=f.parentNode;p&&p.nodeName=="LI"&&(!m||blockParent(r,m)!=p)&&f.remove()}}}let d=null;s<0&&o&&r.input.lastFocus>Date.now()-200&&Math.max(r.input.lastTouch,r.input.lastClick.time)<Date.now()-300&&selectionCollapsed(n)&&(d=selectionFromDOM(r))&&d.eq(Selection.near(r.state.doc.resolve(0),1))?(r.input.lastFocus=0,selectionToDOM(r),this.currentSelection.set(n),r.scrollToSelection()):(s>-1||o)&&(s>-1&&(r.docView.markDirty(s,a),checkCSS(r)),this.handleDOMChange(s,a,l,c),r.docView&&r.docView.dirty?r.updateState(r.state):this.currentSelection.eq(n)||selectionToDOM(r),this.currentSelection.set(n))}registerMutation(r,e){if(e.indexOf(r.target)>-1)return null;let n=this.view.docView.nearestDesc(r.target);if(r.type=="attributes"&&(n==this.view.docView||r.attributeName=="contenteditable"||r.attributeName=="style"&&!r.oldValue&&!r.target.getAttribute("style"))||!n||n.ignoreMutation(r))return null;if(r.type=="childList"){for(let u=0;u<r.addedNodes.length;u++){let m=r.addedNodes[u];e.push(m),m.nodeType==3&&(this.lastChangedTextNode=m)}if(n.contentDOM&&n.contentDOM!=n.dom&&!n.contentDOM.contains(r.target))return{from:n.posBefore,to:n.posAfter};let o=r.previousSibling,s=r.nextSibling;if(ie$2&&ie_version<=11&&r.addedNodes.length)for(let u=0;u<r.addedNodes.length;u++){let{previousSibling:m,nextSibling:f}=r.addedNodes[u];(!m||Array.prototype.indexOf.call(r.addedNodes,m)<0)&&(o=m),(!f||Array.prototype.indexOf.call(r.addedNodes,f)<0)&&(s=f)}let a=o&&o.parentNode==r.target?domIndex$1(o)+1:0,l=n.localPosFromDOM(r.target,a,-1),c=s&&s.parentNode==r.target?domIndex$1(s):r.target.childNodes.length,d=n.localPosFromDOM(r.target,c,1);return{from:l,to:d}}else return r.type=="attributes"?{from:n.posAtStart-n.border,to:n.posAtEnd+n.border}:(this.lastChangedTextNode=r.target,{from:n.posAtStart,to:n.posAtEnd,typeOver:r.target.nodeValue==r.oldValue})}},cssChecked=new WeakMap,cssCheckWarned=!1;function checkCSS(r){if(!cssChecked.has(r)&&(cssChecked.set(r,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(r.dom).whiteSpace)!==-1)){if(r.requiresGeckoHackNode=gecko$1,cssCheckWarned)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),cssCheckWarned=!0}}function rangeToSelectionRange(r,e){let n=e.startContainer,o=e.startOffset,s=e.endContainer,a=e.endOffset,l=r.domAtPos(r.state.selection.anchor);return isEquivalentPosition$1(l.node,l.offset,s,a)&&([n,o,s,a]=[s,a,n,o]),{anchorNode:n,anchorOffset:o,focusNode:s,focusOffset:a}}function safariShadowSelectionRange(r,e){if(e.getComposedRanges){let s=e.getComposedRanges(r.root)[0];if(s)return rangeToSelectionRange(r,s)}let n;function o(s){s.preventDefault(),s.stopImmediatePropagation(),n=s.getTargetRanges()[0]}return r.dom.addEventListener("beforeinput",o,!0),document.execCommand("indent"),r.dom.removeEventListener("beforeinput",o,!0),n?rangeToSelectionRange(r,n):null}function blockParent(r,e){for(let n=e.parentNode;n&&n!=r.dom;n=n.parentNode){let o=r.docView.nearestDesc(n,!0);if(o&&o.node.isBlock)return n}return null}function parseBetween(r,e,n){let{node:o,fromOffset:s,toOffset:a,from:l,to:c}=r.docView.parseRange(e,n),d=r.domSelectionRange(),u,m=d.anchorNode;if(m&&r.dom.contains(m.nodeType==1?m:m.parentNode)&&(u=[{node:m,offset:d.anchorOffset}],selectionCollapsed(d)||u.push({node:d.focusNode,offset:d.focusOffset})),chrome$1&&r.input.lastKeyCode===8)for(let k=a;k>s;k--){let w=o.childNodes[k-1],B=w.pmViewDesc;if(w.nodeName=="BR"&&!B){a=k;break}if(!B||B.size)break}let f=r.state.doc,p=r.someProp("domParser")||DOMParser$1.fromSchema(r.state.schema),g=f.resolve(l),y=null,b=p.parse(o,{topNode:g.parent,topMatch:g.parent.contentMatchAt(g.index()),topOpen:!0,from:s,to:a,preserveWhitespace:g.parent.type.whitespace=="pre"?"full":!0,findPositions:u,ruleFromNode,context:g});if(u&&u[0].pos!=null){let k=u[0].pos,w=u[1]&&u[1].pos;w==null&&(w=k),y={anchor:k+l,head:w+l}}return{doc:b,sel:y,from:l,to:c}}function ruleFromNode(r){let e=r.pmViewDesc;if(e)return e.parseRule();if(r.nodeName=="BR"&&r.parentNode){if(safari$1&&/^(ul|ol)$/i.test(r.parentNode.nodeName)){let n=document.createElement("div");return n.appendChild(document.createElement("li")),{skip:n}}else if(r.parentNode.lastChild==r||safari$1&&/^(tr|table)$/i.test(r.parentNode.nodeName))return{ignore:!0}}else if(r.nodeName=="IMG"&&r.getAttribute("mark-placeholder"))return{ignore:!0};return null}const isInline=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function readDOMChange(r,e,n,o,s){let a=r.input.compositionPendingChanges||(r.composing?r.input.compositionID:0);if(r.input.compositionPendingChanges=0,e<0){let I=r.input.lastSelectionTime>Date.now()-50?r.input.lastSelectionOrigin:null,L=selectionFromDOM(r,I);if(L&&!r.state.selection.eq(L)){if(chrome$1&&android$1&&r.input.lastKeyCode===13&&Date.now()-100<r.input.lastKeyCodeTime&&r.someProp("handleKeyDown",F=>F(r,keyEvent(13,"Enter"))))return;let A=r.state.tr.setSelection(L);I=="pointer"?A.setMeta("pointer",!0):I=="key"&&A.scrollIntoView(),a&&A.setMeta("composition",a),r.dispatch(A)}return}let l=r.state.doc.resolve(e),c=l.sharedDepth(n);e=l.before(c+1),n=r.state.doc.resolve(n).after(c+1);let d=r.state.selection,u=parseBetween(r,e,n),m=r.state.doc,f=m.slice(u.from,u.to),p,g;r.input.lastKeyCode===8&&Date.now()-100<r.input.lastKeyCodeTime?(p=r.state.selection.to,g="end"):(p=r.state.selection.from,g="start"),r.input.lastKeyCode=null;let y=findDiff$1(f.content,u.doc.content,u.from,p,g);if(y&&r.input.domChangeCount++,(ios$1&&r.input.lastIOSEnter>Date.now()-225||android$1)&&s.some(I=>I.nodeType==1&&!isInline.test(I.nodeName))&&(!y||y.endA>=y.endB)&&r.someProp("handleKeyDown",I=>I(r,keyEvent(13,"Enter")))){r.input.lastIOSEnter=0;return}if(!y)if(o&&d instanceof TextSelection&&!d.empty&&d.$head.sameParent(d.$anchor)&&!r.composing&&!(u.sel&&u.sel.anchor!=u.sel.head))y={start:d.from,endA:d.to,endB:d.to};else{if(u.sel){let I=resolveSelection(r,r.state.doc,u.sel);if(I&&!I.eq(r.state.selection)){let L=r.state.tr.setSelection(I);a&&L.setMeta("composition",a),r.dispatch(L)}}return}r.state.selection.from<r.state.selection.to&&y.start==y.endB&&r.state.selection instanceof TextSelection&&(y.start>r.state.selection.from&&y.start<=r.state.selection.from+2&&r.state.selection.from>=u.from?y.start=r.state.selection.from:y.endA<r.state.selection.to&&y.endA>=r.state.selection.to-2&&r.state.selection.to<=u.to&&(y.endB+=r.state.selection.to-y.endA,y.endA=r.state.selection.to)),ie$2&&ie_version<=11&&y.endB==y.start+1&&y.endA==y.start&&y.start>u.from&&u.doc.textBetween(y.start-u.from-1,y.start-u.from+1)==" \xA0"&&(y.start--,y.endA--,y.endB--);let b=u.doc.resolveNoCache(y.start-u.from),k=u.doc.resolveNoCache(y.endB-u.from),w=m.resolve(y.start),B=b.sameParent(k)&&b.parent.inlineContent&&w.end()>=y.endA,M;if((ios$1&&r.input.lastIOSEnter>Date.now()-225&&(!B||s.some(I=>I.nodeName=="DIV"||I.nodeName=="P"))||!B&&b.pos<u.doc.content.size&&!b.sameParent(k)&&(M=Selection.findFrom(u.doc.resolve(b.pos+1),1,!0))&&M.head==k.pos)&&r.someProp("handleKeyDown",I=>I(r,keyEvent(13,"Enter")))){r.input.lastIOSEnter=0;return}if(r.state.selection.anchor>y.start&&looksLikeBackspace(m,y.start,y.endA,b,k)&&r.someProp("handleKeyDown",I=>I(r,keyEvent(8,"Backspace")))){android$1&&chrome$1&&r.domObserver.suppressSelectionUpdates();return}chrome$1&&y.endB==y.start&&(r.input.lastChromeDelete=Date.now()),android$1&&!B&&b.start()!=k.start()&&k.parentOffset==0&&b.depth==k.depth&&u.sel&&u.sel.anchor==u.sel.head&&u.sel.head==y.endA&&(y.endB-=2,k=u.doc.resolveNoCache(y.endB-u.from),setTimeout(()=>{r.someProp("handleKeyDown",function(I){return I(r,keyEvent(13,"Enter"))})},20));let x=y.start,v=y.endA,_,E,N;if(B){if(b.pos==k.pos)ie$2&&ie_version<=11&&b.parentOffset==0&&(r.domObserver.suppressSelectionUpdates(),setTimeout(()=>selectionToDOM(r),20)),_=r.state.tr.delete(x,v),E=m.resolve(y.start).marksAcross(m.resolve(y.endA));else if(y.endA==y.endB&&(N=isMarkChange(b.parent.content.cut(b.parentOffset,k.parentOffset),w.parent.content.cut(w.parentOffset,y.endA-w.start()))))_=r.state.tr,N.type=="add"?_.addMark(x,v,N.mark):_.removeMark(x,v,N.mark);else if(b.parent.child(b.index()).isText&&b.index()==k.index()-(k.textOffset?0:1)){let I=b.parent.textBetween(b.parentOffset,k.parentOffset);if(r.someProp("handleTextInput",L=>L(r,x,v,I)))return;_=r.state.tr.insertText(I,x,v)}}if(_||(_=r.state.tr.replace(x,v,u.doc.slice(y.start-u.from,y.endB-u.from))),u.sel){let I=resolveSelection(r,_.doc,u.sel);I&&!(chrome$1&&r.composing&&I.empty&&(y.start!=y.endB||r.input.lastChromeDelete<Date.now()-100)&&(I.head==x||I.head==_.mapping.map(v)-1)||ie$2&&I.empty&&I.head==x)&&_.setSelection(I)}E&&_.ensureMarks(E),a&&_.setMeta("composition",a),r.dispatch(_.scrollIntoView())}function resolveSelection(r,e,n){return Math.max(n.anchor,n.head)>e.content.size?null:selectionBetween(r,e.resolve(n.anchor),e.resolve(n.head))}function isMarkChange(r,e){let n=r.firstChild.marks,o=e.firstChild.marks,s=n,a=o,l,c,d;for(let m=0;m<o.length;m++)s=o[m].removeFromSet(s);for(let m=0;m<n.length;m++)a=n[m].removeFromSet(a);if(s.length==1&&a.length==0)c=s[0],l="add",d=m=>m.mark(c.addToSet(m.marks));else if(s.length==0&&a.length==1)c=a[0],l="remove",d=m=>m.mark(c.removeFromSet(m.marks));else return null;let u=[];for(let m=0;m<e.childCount;m++)u.push(d(e.child(m)));if(Fragment.from(u).eq(r))return{mark:c,type:l}}function looksLikeBackspace(r,e,n,o,s){if(n-e<=s.pos-o.pos||skipClosingAndOpening(o,!0,!1)<s.pos)return!1;let a=r.resolve(e);if(!o.parent.isTextblock){let c=a.nodeAfter;return c!=null&&n==e+c.nodeSize}if(a.parentOffset<a.parent.content.size||!a.parent.isTextblock)return!1;let l=r.resolve(skipClosingAndOpening(a,!0,!0));return!l.parent.isTextblock||l.pos>n||skipClosingAndOpening(l,!0,!1)<n?!1:o.parent.content.cut(o.parentOffset).eq(l.parent.content)}function skipClosingAndOpening(r,e,n){let o=r.depth,s=e?r.end():r.pos;for(;o>0&&(e||r.indexAfter(o)==r.node(o).childCount);)o--,s++,e=!1;if(n){let a=r.node(o).maybeChild(r.indexAfter(o));for(;a&&!a.isLeaf;)a=a.firstChild,s++}return s}function findDiff$1(r,e,n,o,s){let a=r.findDiffStart(e,n);if(a==null)return null;let{a:l,b:c}=r.findDiffEnd(e,n+r.size,n+e.size);if(s=="end"){let d=Math.max(0,a-Math.min(l,c));o-=l+d-a}if(l<a&&r.size<e.size){let d=o<=a&&o>=l?a-o:0;a-=d,a&&a<e.size&&isSurrogatePair(e.textBetween(a-1,a+1))&&(a+=d?1:-1),c=a+(c-l),l=a}else if(c<a){let d=o<=a&&o>=c?a-o:0;a-=d,a&&a<r.size&&isSurrogatePair(r.textBetween(a-1,a+1))&&(a+=d?1:-1),l=a+(l-c),c=a}return{start:a,endA:l,endB:c}}function isSurrogatePair(r){if(r.length!=2)return!1;let e=r.charCodeAt(0),n=r.charCodeAt(1);return e>=56320&&e<=57343&&n>=55296&&n<=56319}let EditorView$1=class{constructor(r,e){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new InputState$1,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=e,this.state=e.state,this.directPlugins=e.plugins||[],this.directPlugins.forEach(checkStateComponent),this.dispatch=this.dispatch.bind(this),this.dom=r&&r.mount||document.createElement("div"),r&&(r.appendChild?r.appendChild(this.dom):typeof r=="function"?r(this.dom):r.mount&&(this.mounted=!0)),this.editable=getEditable(this),updateCursorWrapper(this),this.nodeViews=buildNodeViews(this),this.docView=docViewDesc(this.state.doc,computeDocDeco(this),viewDecorations(this),this.dom,this),this.domObserver=new DOMObserver$1(this,(n,o,s,a)=>readDOMChange(this,n,o,s,a)),this.domObserver.start(),initInput(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let r=this._props;this._props={};for(let e in r)this._props[e]=r[e];this._props.state=this.state}return this._props}update(r){r.handleDOMEvents!=this._props.handleDOMEvents&&ensureListeners(this);let e=this._props;this._props=r,r.plugins&&(r.plugins.forEach(checkStateComponent),this.directPlugins=r.plugins),this.updateStateInner(r.state,e)}setProps(r){let e={};for(let n in this._props)e[n]=this._props[n];e.state=this.state;for(let n in r)e[n]=r[n];this.update(e)}updateState(r){this.updateStateInner(r,this._props)}updateStateInner(r,e){var n;let o=this.state,s=!1,a=!1;r.storedMarks&&this.composing&&(clearComposition(this),a=!0),this.state=r;let l=o.plugins!=r.plugins||this._props.plugins!=e.plugins;if(l||this._props.plugins!=e.plugins||this._props.nodeViews!=e.nodeViews){let p=buildNodeViews(this);changedNodeViews(p,this.nodeViews)&&(this.nodeViews=p,s=!0)}(l||e.handleDOMEvents!=this._props.handleDOMEvents)&&ensureListeners(this),this.editable=getEditable(this),updateCursorWrapper(this);let c=viewDecorations(this),d=computeDocDeco(this),u=o.plugins!=r.plugins&&!o.doc.eq(r.doc)?"reset":r.scrollToSelection>o.scrollToSelection?"to selection":"preserve",m=s||!this.docView.matchesNode(r.doc,d,c);(m||!r.selection.eq(o.selection))&&(a=!0);let f=u=="preserve"&&a&&this.dom.style.overflowAnchor==null&&storeScrollPos(this);if(a){this.domObserver.stop();let p=m&&(ie$2||chrome$1)&&!this.composing&&!o.selection.empty&&!r.selection.empty&&selectionContextChanged(o.selection,r.selection);if(m){let g=chrome$1?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=findCompositionNode$1(this)),(s||!this.docView.update(r.doc,d,c,this))&&(this.docView.updateOuterDeco(d),this.docView.destroy(),this.docView=docViewDesc(r.doc,d,c,this.dom,this)),g&&!this.trackWrites&&(p=!0)}p||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&anchorInRightPlace(this))?selectionToDOM(this,p):(syncNodeSelection(this,r.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(o),!((n=this.dragging)===null||n===void 0)&&n.node&&!o.doc.eq(r.doc)&&this.updateDraggedNode(this.dragging,o),u=="reset"?this.dom.scrollTop=0:u=="to selection"?this.scrollToSelection():f&&resetScrollPos(f)}scrollToSelection(){let r=this.domSelectionRange().focusNode;if(!this.someProp("handleScrollToSelection",e=>e(this)))if(this.state.selection instanceof NodeSelection){let e=this.docView.domAfterPos(this.state.selection.from);e.nodeType==1&&scrollRectIntoView$1(this,e.getBoundingClientRect(),r)}else scrollRectIntoView$1(this,this.coordsAtPos(this.state.selection.head,1),r)}destroyPluginViews(){let r;for(;r=this.pluginViews.pop();)r.destroy&&r.destroy()}updatePluginViews(r){if(!r||r.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let e=0;e<this.directPlugins.length;e++){let n=this.directPlugins[e];n.spec.view&&this.pluginViews.push(n.spec.view(this))}for(let e=0;e<this.state.plugins.length;e++){let n=this.state.plugins[e];n.spec.view&&this.pluginViews.push(n.spec.view(this))}}else for(let e=0;e<this.pluginViews.length;e++){let n=this.pluginViews[e];n.update&&n.update(this,r)}}updateDraggedNode(r,e){let n=r.node,o=-1;if(this.state.doc.nodeAt(n.from)==n.node)o=n.from;else{let s=n.from+(this.state.doc.content.size-e.doc.content.size);(s>0&&this.state.doc.nodeAt(s))==n.node&&(o=s)}this.dragging=new Dragging(r.slice,r.move,o<0?void 0:NodeSelection.create(this.state.doc,o))}someProp(r,e){let n=this._props&&this._props[r],o;if(n!=null&&(o=e?e(n):n))return o;for(let a=0;a<this.directPlugins.length;a++){let l=this.directPlugins[a].props[r];if(l!=null&&(o=e?e(l):l))return o}let s=this.state.plugins;if(s)for(let a=0;a<s.length;a++){let l=s[a].props[r];if(l!=null&&(o=e?e(l):l))return o}}hasFocus(){if(ie$2){let r=this.root.activeElement;if(r==this.dom)return!0;if(!r||!this.dom.contains(r))return!1;for(;r&&this.dom!=r&&this.dom.contains(r);){if(r.contentEditable=="false")return!1;r=r.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&focusPreventScroll$1(this.dom),selectionToDOM(this),this.domObserver.start()}get root(){let r=this._root;if(r==null){for(let e=this.dom.parentNode;e;e=e.parentNode)if(e.nodeType==9||e.nodeType==11&&e.host)return e.getSelection||(Object.getPrototypeOf(e).getSelection=()=>e.ownerDocument.getSelection()),this._root=e}return r||document}updateRoot(){this._root=null}posAtCoords(r){return posAtCoords$1(this,r)}coordsAtPos(r,e=1){return coordsAtPos(this,r,e)}domAtPos(r,e=0){return this.docView.domFromPos(r,e)}nodeDOM(r){let e=this.docView.descAt(r);return e?e.nodeDOM:null}posAtDOM(r,e,n=-1){let o=this.docView.posFromDOM(r,e,n);if(o==null)throw new RangeError("DOM position not inside the editor");return o}endOfTextblock(r,e){return endOfTextblock(this,e||this.state,r)}pasteHTML(r,e){return doPaste$1(this,"",r,!1,e||new ClipboardEvent("paste"))}pasteText(r,e){return doPaste$1(this,r,null,!0,e||new ClipboardEvent("paste"))}destroy(){this.docView&&(destroyInput(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],viewDecorations(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,clearReusedRange())}get isDestroyed(){return this.docView==null}dispatchEvent(r){return dispatchEvent(this,r)}dispatch(r){let e=this._props.dispatchTransaction;e?e.call(this,r):this.updateState(this.state.apply(r))}domSelectionRange(){let r=this.domSelection();return r?safari$1&&this.root.nodeType===11&&deepActiveElement(this.dom.ownerDocument)==this.dom&&safariShadowSelectionRange(this,r)||r:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}};function computeDocDeco(r){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(r.editable),r.someProp("attributes",n=>{if(typeof n=="function"&&(n=n(r.state)),n)for(let o in n)o=="class"?e.class+=" "+n[o]:o=="style"?e.style=(e.style?e.style+";":"")+n[o]:!e[o]&&o!="contenteditable"&&o!="nodeName"&&(e[o]=String(n[o]))}),e.translate||(e.translate="no"),[Decoration$1.node(0,r.state.doc.content.size,e)]}function updateCursorWrapper(r){if(r.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),r.cursorWrapper={dom:e,deco:Decoration$1.widget(r.state.selection.from,e,{raw:!0,marks:r.markCursor})}}else r.cursorWrapper=null}function getEditable(r){return!r.someProp("editable",e=>e(r.state)===!1)}function selectionContextChanged(r,e){let n=Math.min(r.$anchor.sharedDepth(r.head),e.$anchor.sharedDepth(e.head));return r.$anchor.start(n)!=e.$anchor.start(n)}function buildNodeViews(r){let e=Object.create(null);function n(o){for(let s in o)Object.prototype.hasOwnProperty.call(e,s)||(e[s]=o[s])}return r.someProp("nodeViews",n),r.someProp("markViews",n),e}function changedNodeViews(r,e){let n=0,o=0;for(let s in r){if(r[s]!=e[s])return!0;n++}for(let s in e)o++;return n!=o}function checkStateComponent(r){if(r.spec.state||r.spec.filterTransaction||r.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}let rangeFrom=[],rangeTo=[];(()=>{let r="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(e=>e?parseInt(e,36):1);for(let e=0,n=0;e<r.length;e++)(e%2?rangeTo:rangeFrom).push(n=n+r[e])})();function isExtendingChar(r){if(r<768)return!1;for(let e=0,n=rangeFrom.length;;){let o=e+n>>1;if(r<rangeFrom[o])n=o;else if(r>=rangeTo[o])e=o+1;else return!0;if(e==n)return!1}}function isRegionalIndicator(r){return r>=127462&&r<=127487}const ZWJ=8205;function findClusterBreak$1(r,e,n=!0,o=!0){return(n?nextClusterBreak:prevClusterBreak)(r,e,o)}function nextClusterBreak(r,e,n){if(e==r.length)return e;e&&surrogateLow$1(r.charCodeAt(e))&&surrogateHigh$1(r.charCodeAt(e-1))&&e--;let o=codePointAt$1(r,e);for(e+=codePointSize$1(o);e<r.length;){let s=codePointAt$1(r,e);if(o==ZWJ||s==ZWJ||n&&isExtendingChar(s))e+=codePointSize$1(s),o=s;else if(isRegionalIndicator(s)){let a=0,l=e-2;for(;l>=0&&isRegionalIndicator(codePointAt$1(r,l));)a++,l-=2;if(a%2==0)break;e+=2}else break}return e}function prevClusterBreak(r,e,n){for(;e>0;){let o=nextClusterBreak(r,e-2,n);if(o<e)return o;e--}return 0}function codePointAt$1(r,e){let n=r.charCodeAt(e);if(!surrogateHigh$1(n)||e+1==r.length)return n;let o=r.charCodeAt(e+1);return surrogateLow$1(o)?(n-55296<<10)+(o-56320)+65536:n}function surrogateLow$1(r){return r>=56320&&r<57344}function surrogateHigh$1(r){return r>=55296&&r<56320}function codePointSize$1(r){return r<65536?1:2}class Text{lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,n,o){[e,n]=clip$1(this,e,n);let s=[];return this.decompose(0,e,s,2),o.length&&o.decompose(0,o.length,s,3),this.decompose(n,this.length,s,1),TextNode$1.from(s,this.length-(n-e)+o.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,n=this.length){[e,n]=clip$1(this,e,n);let o=[];return this.decompose(e,n,o,0),TextNode$1.from(o,n-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let n=this.scanIdentical(e,1),o=this.length-this.scanIdentical(e,-1),s=new RawTextCursor(this),a=new RawTextCursor(e);for(let l=n,c=n;;){if(s.next(l),a.next(l),l=0,s.lineBreak!=a.lineBreak||s.done!=a.done||s.value!=a.value)return!1;if(c+=s.value.length,s.done||c>=o)return!0}}iter(e=1){return new RawTextCursor(this,e)}iterRange(e,n=this.length){return new PartialTextCursor(this,e,n)}iterLines(e,n){let o;if(e==null)o=this.iter();else{n==null&&(n=this.lines+1);let s=this.line(e).from;o=this.iterRange(s,Math.max(s,n==this.lines+1?this.length:n<=1?0:this.line(n-1).to))}return new LineCursor(o)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}constructor(){}static of(e){if(e.length==0)throw new RangeError("A document must have at least one line");return e.length==1&&!e[0]?Text.empty:e.length<=32?new TextLeaf(e):TextNode$1.from(TextLeaf.split(e,[]))}}class TextLeaf extends Text{constructor(e,n=textLength(e)){super(),this.text=e,this.length=n}get lines(){return this.text.length}get children(){return null}lineInner(e,n,o,s){for(let a=0;;a++){let l=this.text[a],c=s+l.length;if((n?o:c)>=e)return new Line(s,c,o,l);s=c+1,o++}}decompose(e,n,o,s){let a=e<=0&&n>=this.length?this:new TextLeaf(sliceText(this.text,e,n),Math.min(n,this.length)-Math.max(0,e));if(s&1){let l=o.pop(),c=appendText(a.text,l.text.slice(),0,a.length);if(c.length<=32)o.push(new TextLeaf(c,l.length+a.length));else{let d=c.length>>1;o.push(new TextLeaf(c.slice(0,d)),new TextLeaf(c.slice(d)))}}else o.push(a)}replace(e,n,o){if(!(o instanceof TextLeaf))return super.replace(e,n,o);[e,n]=clip$1(this,e,n);let s=appendText(this.text,appendText(o.text,sliceText(this.text,0,e)),n),a=this.length+o.length-(n-e);return s.length<=32?new TextLeaf(s,a):TextNode$1.from(TextLeaf.split(s,[]),a)}sliceString(e,n=this.length,o=`
`){[e,n]=clip$1(this,e,n);let s="";for(let a=0,l=0;a<=n&&l<this.text.length;l++){let c=this.text[l],d=a+c.length;a>e&&l&&(s+=o),e<d&&n>a&&(s+=c.slice(Math.max(0,e-a),n-a)),a=d+1}return s}flatten(e){for(let n of this.text)e.push(n)}scanIdentical(){return 0}static split(e,n){let o=[],s=-1;for(let a of e)o.push(a),s+=a.length+1,o.length==32&&(n.push(new TextLeaf(o,s)),o=[],s=-1);return s>-1&&n.push(new TextLeaf(o,s)),n}}let TextNode$1=class ke extends Text{constructor(e,n){super(),this.children=e,this.length=n,this.lines=0;for(let o of e)this.lines+=o.lines}lineInner(e,n,o,s){for(let a=0;;a++){let l=this.children[a],c=s+l.length,d=o+l.lines-1;if((n?d:c)>=e)return l.lineInner(e,n,o,s);s=c+1,o=d+1}}decompose(e,n,o,s){for(let a=0,l=0;l<=n&&a<this.children.length;a++){let c=this.children[a],d=l+c.length;if(e<=d&&n>=l){let u=s&((l<=e?1:0)|(d>=n?2:0));l>=e&&d<=n&&!u?o.push(c):c.decompose(e-l,n-l,o,u)}l=d+1}}replace(e,n,o){if([e,n]=clip$1(this,e,n),o.lines<this.lines)for(let s=0,a=0;s<this.children.length;s++){let l=this.children[s],c=a+l.length;if(e>=a&&n<=c){let d=l.replace(e-a,n-a,o),u=this.lines-l.lines+d.lines;if(d.lines<u>>4&&d.lines>u>>6){let m=this.children.slice();return m[s]=d,new ke(m,this.length-(n-e)+o.length)}return super.replace(a,c,d)}a=c+1}return super.replace(e,n,o)}sliceString(e,n=this.length,o=`
`){[e,n]=clip$1(this,e,n);let s="";for(let a=0,l=0;a<this.children.length&&l<=n;a++){let c=this.children[a],d=l+c.length;l>e&&a&&(s+=o),e<d&&n>l&&(s+=c.sliceString(e-l,n-l,o)),l=d+1}return s}flatten(e){for(let n of this.children)n.flatten(e)}scanIdentical(e,n){if(!(e instanceof ke))return 0;let o=0,[s,a,l,c]=n>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;s+=n,a+=n){if(s==l||a==c)return o;let d=this.children[s],u=e.children[a];if(d!=u)return o+d.scanIdentical(u,n);o+=d.length+1}}static from(e,n=e.reduce((o,s)=>o+s.length+1,-1)){let o=0;for(let g of e)o+=g.lines;if(o<32){let g=[];for(let y of e)y.flatten(g);return new TextLeaf(g,n)}let s=Math.max(32,o>>5),a=s<<1,l=s>>1,c=[],d=0,u=-1,m=[];function f(g){let y;if(g.lines>a&&g instanceof ke)for(let b of g.children)f(b);else g.lines>l&&(d>l||!d)?(p(),c.push(g)):g instanceof TextLeaf&&d&&(y=m[m.length-1])instanceof TextLeaf&&g.lines+y.lines<=32?(d+=g.lines,u+=g.length+1,m[m.length-1]=new TextLeaf(y.text.concat(g.text),y.length+1+g.length)):(d+g.lines>s&&p(),d+=g.lines,u+=g.length+1,m.push(g))}function p(){d!=0&&(c.push(m.length==1?m[0]:ke.from(m,u)),u=-1,d=m.length=0)}for(let g of e)f(g);return p(),c.length==1?c[0]:new ke(c,n)}};Text.empty=new TextLeaf([""],0);function textLength(r){let e=-1;for(let n of r)e+=n.length+1;return e}function appendText(r,e,n=0,o=1e9){for(let s=0,a=0,l=!0;a<r.length&&s<=o;a++){let c=r[a],d=s+c.length;d>=n&&(d>o&&(c=c.slice(0,o-s)),s<n&&(c=c.slice(n-s)),l?(e[e.length-1]+=c,l=!1):e.push(c)),s=d+1}return e}function sliceText(r,e,n){return appendText(r,[""],e,n)}class RawTextCursor{constructor(e,n=1){this.dir=n,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[n>0?1:(e instanceof TextLeaf?e.text.length:e.children.length)<<1]}nextInner(e,n){for(this.done=this.lineBreak=!1;;){let o=this.nodes.length-1,s=this.nodes[o],a=this.offsets[o],l=a>>1,c=s instanceof TextLeaf?s.text.length:s.children.length;if(l==(n>0?c:0)){if(o==0)return this.done=!0,this.value="",this;n>0&&this.offsets[o-1]++,this.nodes.pop(),this.offsets.pop()}else if((a&1)==(n>0?0:1)){if(this.offsets[o]+=n,e==0)return this.lineBreak=!0,this.value=`
`,this;e--}else if(s instanceof TextLeaf){let d=s.text[l+(n<0?-1:0)];if(this.offsets[o]+=n,d.length>Math.max(0,e))return this.value=e==0?d:n>0?d.slice(e):d.slice(0,d.length-e),this;e-=d.length}else{let d=s.children[l+(n<0?-1:0)];e>d.length?(e-=d.length,this.offsets[o]+=n):(n<0&&this.offsets[o]--,this.nodes.push(d),this.offsets.push(n>0?1:(d instanceof TextLeaf?d.text.length:d.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}}class PartialTextCursor{constructor(e,n,o){this.value="",this.done=!1,this.cursor=new RawTextCursor(e,n>o?-1:1),this.pos=n>o?e.length:0,this.from=Math.min(n,o),this.to=Math.max(n,o)}nextInner(e,n){if(n<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,n<0?this.pos-this.to:this.from-this.pos);let o=n<0?this.pos-this.from:this.to-this.pos;e>o&&(e=o),o-=e;let{value:s}=this.cursor.next(e);return this.pos+=(s.length+e)*n,this.value=s.length<=o?s:n<0?s.slice(s.length-o):s.slice(0,o),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}}class LineCursor{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:n,lineBreak:o,value:s}=this.inner.next(e);return n&&this.afterBreak?(this.value="",this.afterBreak=!1):n?(this.done=!0,this.value=""):o?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=s,this.afterBreak=!1),this}get lineBreak(){return!1}}typeof Symbol<"u"&&(Text.prototype[Symbol.iterator]=function(){return this.iter()},RawTextCursor.prototype[Symbol.iterator]=PartialTextCursor.prototype[Symbol.iterator]=LineCursor.prototype[Symbol.iterator]=function(){return this});class Line{constructor(e,n,o,s){this.from=e,this.to=n,this.number=o,this.text=s}get length(){return this.to-this.from}}function clip$1(r,e,n){return e=Math.max(0,Math.min(r.length,e)),[e,Math.max(e,Math.min(r.length,n))]}function findClusterBreak(r,e,n=!0,o=!0){return findClusterBreak$1(r,e,n,o)}function surrogateLow(r){return r>=56320&&r<57344}function surrogateHigh(r){return r>=55296&&r<56320}function codePointAt(r,e){let n=r.charCodeAt(e);if(!surrogateHigh(n)||e+1==r.length)return n;let o=r.charCodeAt(e+1);return surrogateLow(o)?(n-55296<<10)+(o-56320)+65536:n}function fromCodePoint(r){return r<=65535?String.fromCharCode(r):(r-=65536,String.fromCharCode((r>>10)+55296,(r&1023)+56320))}function codePointSize(r){return r<65536?1:2}const DefaultSplit=/\r\n?|\n/;var MapMode=function(r){return r[r.Simple=0]="Simple",r[r.TrackDel=1]="TrackDel",r[r.TrackBefore=2]="TrackBefore",r[r.TrackAfter=3]="TrackAfter",r}(MapMode||(MapMode={}));class ChangeDesc{constructor(e){this.sections=e}get length(){let e=0;for(let n=0;n<this.sections.length;n+=2)e+=this.sections[n];return e}get newLength(){let e=0;for(let n=0;n<this.sections.length;n+=2){let o=this.sections[n+1];e+=o<0?this.sections[n]:o}return e}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(e){for(let n=0,o=0,s=0;n<this.sections.length;){let a=this.sections[n++],l=this.sections[n++];l<0?(e(o,s,a),s+=a):s+=l,o+=a}}iterChangedRanges(e,n=!1){iterChanges(this,e,n)}get invertedDesc(){let e=[];for(let n=0;n<this.sections.length;){let o=this.sections[n++],s=this.sections[n++];s<0?e.push(o,s):e.push(s,o)}return new ChangeDesc(e)}composeDesc(e){return this.empty?e:e.empty?this:composeSets(this,e)}mapDesc(e,n=!1){return e.empty?this:mapSet(this,e,n)}mapPos(e,n=-1,o=MapMode.Simple){let s=0,a=0;for(let l=0;l<this.sections.length;){let c=this.sections[l++],d=this.sections[l++],u=s+c;if(d<0){if(u>e)return a+(e-s);a+=c}else{if(o!=MapMode.Simple&&u>=e&&(o==MapMode.TrackDel&&s<e&&u>e||o==MapMode.TrackBefore&&s<e||o==MapMode.TrackAfter&&u>e))return null;if(u>e||u==e&&n<0&&!c)return e==s||n<0?a:a+d;a+=d}s=u}if(e>s)throw new RangeError(`Position ${e} is out of range for changeset of length ${s}`);return a}touchesRange(e,n=e){for(let o=0,s=0;o<this.sections.length&&s<=n;){let a=this.sections[o++],l=this.sections[o++],c=s+a;if(l>=0&&s<=n&&c>=e)return s<e&&c>n?"cover":!0;s=c}return!1}toString(){let e="";for(let n=0;n<this.sections.length;){let o=this.sections[n++],s=this.sections[n++];e+=(e?" ":"")+o+(s>=0?":"+s:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some(n=>typeof n!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new ChangeDesc(e)}static create(e){return new ChangeDesc(e)}}class ChangeSet extends ChangeDesc{constructor(e,n){super(e),this.inserted=n}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return iterChanges(this,(n,o,s,a,l)=>e=e.replace(s,s+(o-n),l),!1),e}mapDesc(e,n=!1){return mapSet(this,e,n,!0)}invert(e){let n=this.sections.slice(),o=[];for(let s=0,a=0;s<n.length;s+=2){let l=n[s],c=n[s+1];if(c>=0){n[s]=c,n[s+1]=l;let d=s>>1;for(;o.length<d;)o.push(Text.empty);o.push(l?e.slice(a,a+l):Text.empty)}a+=l}return new ChangeSet(n,o)}compose(e){return this.empty?e:e.empty?this:composeSets(this,e,!0)}map(e,n=!1){return e.empty?this:mapSet(this,e,n,!0)}iterChanges(e,n=!1){iterChanges(this,e,n)}get desc(){return ChangeDesc.create(this.sections)}filter(e){let n=[],o=[],s=[],a=new SectionIter(this);e:for(let l=0,c=0;;){let d=l==e.length?1e9:e[l++];for(;c<d||c==d&&a.len==0;){if(a.done)break e;let m=Math.min(a.len,d-c);addSection(s,m,-1);let f=a.ins==-1?-1:a.off==0?a.ins:0;addSection(n,m,f),f>0&&addInsert(o,n,a.text),a.forward(m),c+=m}let u=e[l++];for(;c<u;){if(a.done)break e;let m=Math.min(a.len,u-c);addSection(n,m,-1),addSection(s,m,a.ins==-1?-1:a.off==0?a.ins:0),a.forward(m),c+=m}}return{changes:new ChangeSet(n,o),filtered:ChangeDesc.create(s)}}toJSON(){let e=[];for(let n=0;n<this.sections.length;n+=2){let o=this.sections[n],s=this.sections[n+1];s<0?e.push(o):s==0?e.push([o]):e.push([o].concat(this.inserted[n>>1].toJSON()))}return e}static of(e,n,o){let s=[],a=[],l=0,c=null;function d(m=!1){if(!m&&!s.length)return;l<n&&addSection(s,n-l,-1);let f=new ChangeSet(s,a);c=c?c.compose(f.map(c)):f,s=[],a=[],l=0}function u(m){if(Array.isArray(m))for(let f of m)u(f);else if(m instanceof ChangeSet){if(m.length!=n)throw new RangeError(`Mismatched change set length (got ${m.length}, expected ${n})`);d(),c=c?c.compose(m.map(c)):m}else{let{from:f,to:p=f,insert:g}=m;if(f>p||f<0||p>n)throw new RangeError(`Invalid change range ${f} to ${p} (in doc of length ${n})`);let y=g?typeof g=="string"?Text.of(g.split(o||DefaultSplit)):g:Text.empty,b=y.length;if(f==p&&b==0)return;f<l&&d(),f>l&&addSection(s,f-l,-1),addSection(s,p-f,b),addInsert(a,s,y),l=p}}return u(e),d(!c),c}static empty(e){return new ChangeSet(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let n=[],o=[];for(let s=0;s<e.length;s++){let a=e[s];if(typeof a=="number")n.push(a,-1);else{if(!Array.isArray(a)||typeof a[0]!="number"||a.some((l,c)=>c&&typeof l!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(a.length==1)n.push(a[0],0);else{for(;o.length<s;)o.push(Text.empty);o[s]=Text.of(a.slice(1)),n.push(a[0],o[s].length)}}}return new ChangeSet(n,o)}static createSet(e,n){return new ChangeSet(e,n)}}function addSection(r,e,n,o=!1){if(e==0&&n<=0)return;let s=r.length-2;s>=0&&n<=0&&n==r[s+1]?r[s]+=e:s>=0&&e==0&&r[s]==0?r[s+1]+=n:o?(r[s]+=e,r[s+1]+=n):r.push(e,n)}function addInsert(r,e,n){if(n.length==0)return;let o=e.length-2>>1;if(o<r.length)r[r.length-1]=r[r.length-1].append(n);else{for(;r.length<o;)r.push(Text.empty);r.push(n)}}function iterChanges(r,e,n){let o=r.inserted;for(let s=0,a=0,l=0;l<r.sections.length;){let c=r.sections[l++],d=r.sections[l++];if(d<0)s+=c,a+=c;else{let u=s,m=a,f=Text.empty;for(;u+=c,m+=d,d&&o&&(f=f.append(o[l-2>>1])),!(n||l==r.sections.length||r.sections[l+1]<0);)c=r.sections[l++],d=r.sections[l++];e(s,u,a,m,f),s=u,a=m}}}function mapSet(r,e,n,o=!1){let s=[],a=o?[]:null,l=new SectionIter(r),c=new SectionIter(e);for(let d=-1;;){if(l.done&&c.len||c.done&&l.len)throw new Error("Mismatched change set lengths");if(l.ins==-1&&c.ins==-1){let u=Math.min(l.len,c.len);addSection(s,u,-1),l.forward(u),c.forward(u)}else if(c.ins>=0&&(l.ins<0||d==l.i||l.off==0&&(c.len<l.len||c.len==l.len&&!n))){let u=c.len;for(addSection(s,c.ins,-1);u;){let m=Math.min(l.len,u);l.ins>=0&&d<l.i&&l.len<=m&&(addSection(s,0,l.ins),a&&addInsert(a,s,l.text),d=l.i),l.forward(m),u-=m}c.next()}else if(l.ins>=0){let u=0,m=l.len;for(;m;)if(c.ins==-1){let f=Math.min(m,c.len);u+=f,m-=f,c.forward(f)}else if(c.ins==0&&c.len<m)m-=c.len,c.next();else break;addSection(s,u,d<l.i?l.ins:0),a&&d<l.i&&addInsert(a,s,l.text),d=l.i,l.forward(l.len-m)}else{if(l.done&&c.done)return a?ChangeSet.createSet(s,a):ChangeDesc.create(s);throw new Error("Mismatched change set lengths")}}}function composeSets(r,e,n=!1){let o=[],s=n?[]:null,a=new SectionIter(r),l=new SectionIter(e);for(let c=!1;;){if(a.done&&l.done)return s?ChangeSet.createSet(o,s):ChangeDesc.create(o);if(a.ins==0)addSection(o,a.len,0,c),a.next();else if(l.len==0&&!l.done)addSection(o,0,l.ins,c),s&&addInsert(s,o,l.text),l.next();else{if(a.done||l.done)throw new Error("Mismatched change set lengths");{let d=Math.min(a.len2,l.len),u=o.length;if(a.ins==-1){let m=l.ins==-1?-1:l.off?0:l.ins;addSection(o,d,m,c),s&&m&&addInsert(s,o,l.text)}else l.ins==-1?(addSection(o,a.off?0:a.len,d,c),s&&addInsert(s,o,a.textBit(d))):(addSection(o,a.off?0:a.len,l.off?0:l.ins,c),s&&!l.off&&addInsert(s,o,l.text));c=(a.ins>d||l.ins>=0&&l.len>d)&&(c||o.length>u),a.forward2(d),l.forward(d)}}}}class SectionIter{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,n=this.i-2>>1;return n>=e.length?Text.empty:e[n]}textBit(e){let{inserted:n}=this.set,o=this.i-2>>1;return o>=n.length&&!e?Text.empty:n[o].slice(this.off,e==null?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){this.ins==-1?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}}class SelectionRange{constructor(e,n,o){this.from=e,this.to=n,this.flags=o}get anchor(){return this.flags&32?this.to:this.from}get head(){return this.flags&32?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&8?-1:this.flags&16?1:0}get bidiLevel(){let e=this.flags&7;return e==7?null:e}get goalColumn(){let e=this.flags>>6;return e==16777215?void 0:e}map(e,n=-1){let o,s;return this.empty?o=s=e.mapPos(this.from,n):(o=e.mapPos(this.from,1),s=e.mapPos(this.to,-1)),o==this.from&&s==this.to?this:new SelectionRange(o,s,this.flags)}extend(e,n=e){if(e<=this.anchor&&n>=this.anchor)return EditorSelection.range(e,n);let o=Math.abs(e-this.anchor)>Math.abs(n-this.anchor)?e:n;return EditorSelection.range(this.anchor,o)}eq(e,n=!1){return this.anchor==e.anchor&&this.head==e.head&&(!n||!this.empty||this.assoc==e.assoc)}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return EditorSelection.range(e.anchor,e.head)}static create(e,n,o){return new SelectionRange(e,n,o)}}EditorSelection=class{constructor(r,e){this.ranges=r,this.mainIndex=e}map(r,e=-1){return r.empty?this:EditorSelection.create(this.ranges.map(n=>n.map(r,e)),this.mainIndex)}eq(r,e=!1){if(this.ranges.length!=r.ranges.length||this.mainIndex!=r.mainIndex)return!1;for(let n=0;n<this.ranges.length;n++)if(!this.ranges[n].eq(r.ranges[n],e))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new EditorSelection([this.main],0)}addRange(r,e=!0){return EditorSelection.create([r].concat(this.ranges),e?0:this.mainIndex+1)}replaceRange(r,e=this.mainIndex){let n=this.ranges.slice();return n[e]=r,EditorSelection.create(n,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(r=>r.toJSON()),main:this.mainIndex}}static fromJSON(r){if(!r||!Array.isArray(r.ranges)||typeof r.main!="number"||r.main>=r.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new EditorSelection(r.ranges.map(e=>SelectionRange.fromJSON(e)),r.main)}static single(r,e=r){return new EditorSelection([EditorSelection.range(r,e)],0)}static create(r,e=0){if(r.length==0)throw new RangeError("A selection needs at least one range");for(let n=0,o=0;o<r.length;o++){let s=r[o];if(s.empty?s.from<=n:s.from<n)return EditorSelection.normalized(r.slice(),e);n=s.to}return new EditorSelection(r,e)}static cursor(r,e=0,n,o){return SelectionRange.create(r,r,(e==0?0:e<0?8:16)|(n==null?7:Math.min(6,n))|(o??16777215)<<6)}static range(r,e,n,o){let s=(n??16777215)<<6|(o==null?7:Math.min(6,o));return e<r?SelectionRange.create(e,r,48|s):SelectionRange.create(r,e,(e>r?8:0)|s)}static normalized(r,e=0){let n=r[e];r.sort((o,s)=>o.from-s.from),e=r.indexOf(n);for(let o=1;o<r.length;o++){let s=r[o],a=r[o-1];if(s.empty?s.from<=a.to:s.from<a.to){let l=a.from,c=Math.max(s.to,a.to);o<=e&&e--,r.splice(--o,2,s.anchor>s.head?EditorSelection.range(c,l):EditorSelection.range(l,c))}}return new EditorSelection(r,e)}};function checkSelection(r,e){for(let n of r.ranges)if(n.to>e)throw new RangeError("Selection points outside of document")}let nextID=0;class Facet{constructor(e,n,o,s,a){this.combine=e,this.compareInput=n,this.compare=o,this.isStatic=s,this.id=nextID++,this.default=e([]),this.extensions=typeof a=="function"?a(this):a}get reader(){return this}static define(e={}){return new Facet(e.combine||(n=>n),e.compareInput||((n,o)=>n===o),e.compare||(e.combine?(n,o)=>n===o:sameArray$1),!!e.static,e.enables)}of(e){return new FacetProvider([],this,0,e)}compute(e,n){if(this.isStatic)throw new Error("Can't compute a static facet");return new FacetProvider(e,this,1,n)}computeN(e,n){if(this.isStatic)throw new Error("Can't compute a static facet");return new FacetProvider(e,this,2,n)}from(e,n){return n||(n=o=>o),this.compute([e],o=>n(o.field(e)))}}function sameArray$1(r,e){return r==e||r.length==e.length&&r.every((n,o)=>n===e[o])}class FacetProvider{constructor(e,n,o,s){this.dependencies=e,this.facet=n,this.type=o,this.value=s,this.id=nextID++}dynamicSlot(e){var n;let o=this.value,s=this.facet.compareInput,a=this.id,l=e[a]>>1,c=this.type==2,d=!1,u=!1,m=[];for(let f of this.dependencies)f=="doc"?d=!0:f=="selection"?u=!0:((n=e[f.id])!==null&&n!==void 0?n:1)&1||m.push(e[f.id]);return{create(f){return f.values[l]=o(f),1},update(f,p){if(d&&p.docChanged||u&&(p.docChanged||p.selection)||ensureAll(f,m)){let g=o(f);if(c?!compareArray(g,f.values[l],s):!s(g,f.values[l]))return f.values[l]=g,1}return 0},reconfigure:(f,p)=>{let g,y=p.config.address[a];if(y!=null){let b=getAddr(p,y);if(this.dependencies.every(k=>k instanceof Facet?p.facet(k)===f.facet(k):k instanceof StateField?p.field(k,!1)==f.field(k,!1):!0)||(c?compareArray(g=o(f),b,s):s(g=o(f),b)))return f.values[l]=b,0}else g=o(f);return f.values[l]=g,1}}}}function compareArray(r,e,n){if(r.length!=e.length)return!1;for(let o=0;o<r.length;o++)if(!n(r[o],e[o]))return!1;return!0}function ensureAll(r,e){let n=!1;for(let o of e)ensureAddr(r,o)&1&&(n=!0);return n}function dynamicFacetSlot(r,e,n){let o=n.map(d=>r[d.id]),s=n.map(d=>d.type),a=o.filter(d=>!(d&1)),l=r[e.id]>>1;function c(d){let u=[];for(let m=0;m<o.length;m++){let f=getAddr(d,o[m]);if(s[m]==2)for(let p of f)u.push(p);else u.push(f)}return e.combine(u)}return{create(d){for(let u of o)ensureAddr(d,u);return d.values[l]=c(d),1},update(d,u){if(!ensureAll(d,a))return 0;let m=c(d);return e.compare(m,d.values[l])?0:(d.values[l]=m,1)},reconfigure(d,u){let m=ensureAll(d,o),f=u.config.facets[e.id],p=u.facet(e);if(f&&!m&&sameArray$1(n,f))return d.values[l]=p,0;let g=c(d);return e.compare(g,p)?(d.values[l]=p,0):(d.values[l]=g,1)}}}const initField=Facet.define({static:!0});class StateField{constructor(e,n,o,s,a){this.id=e,this.createF=n,this.updateF=o,this.compareF=s,this.spec=a,this.provides=void 0}static define(e){let n=new StateField(nextID++,e.create,e.update,e.compare||((o,s)=>o===s),e);return e.provide&&(n.provides=e.provide(n)),n}create(e){let n=e.facet(initField).find(o=>o.field==this);return((n==null?void 0:n.create)||this.createF)(e)}slot(e){let n=e[this.id]>>1;return{create:o=>(o.values[n]=this.create(o),1),update:(o,s)=>{let a=o.values[n],l=this.updateF(a,s);return this.compareF(a,l)?0:(o.values[n]=l,1)},reconfigure:(o,s)=>s.config.address[this.id]!=null?(o.values[n]=s.field(this),0):(o.values[n]=this.create(o),1)}}init(e){return[this,initField.of({field:this,create:e})]}get extension(){return this}}const Prec_={lowest:4,low:3,default:2,high:1,highest:0};function prec(r){return e=>new PrecExtension(e,r)}Prec={highest:prec(Prec_.highest),high:prec(Prec_.high),default:prec(Prec_.default),low:prec(Prec_.low),lowest:prec(Prec_.lowest)};class PrecExtension{constructor(e,n){this.inner=e,this.prec=n}}class Compartment{of(e){return new CompartmentInstance(this,e)}reconfigure(e){return Compartment.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}}class CompartmentInstance{constructor(e,n){this.compartment=e,this.inner=n}}class Configuration{constructor(e,n,o,s,a,l){for(this.base=e,this.compartments=n,this.dynamicSlots=o,this.address=s,this.staticValues=a,this.facets=l,this.statusTemplate=[];this.statusTemplate.length<o.length;)this.statusTemplate.push(0)}staticFacet(e){let n=this.address[e.id];return n==null?e.default:this.staticValues[n>>1]}static resolve(e,n,o){let s=[],a=Object.create(null),l=new Map;for(let p of flatten(e,n,l))p instanceof StateField?s.push(p):(a[p.facet.id]||(a[p.facet.id]=[])).push(p);let c=Object.create(null),d=[],u=[];for(let p of s)c[p.id]=u.length<<1,u.push(g=>p.slot(g));let m=o==null?void 0:o.config.facets;for(let p in a){let g=a[p],y=g[0].facet,b=m&&m[p]||[];if(g.every(k=>k.type==0))if(c[y.id]=d.length<<1|1,sameArray$1(b,g))d.push(o.facet(y));else{let k=y.combine(g.map(w=>w.value));d.push(o&&y.compare(k,o.facet(y))?o.facet(y):k)}else{for(let k of g)k.type==0?(c[k.id]=d.length<<1|1,d.push(k.value)):(c[k.id]=u.length<<1,u.push(w=>k.dynamicSlot(w)));c[y.id]=u.length<<1,u.push(k=>dynamicFacetSlot(k,y,g))}}let f=u.map(p=>p(c));return new Configuration(e,l,f,c,d,a)}}function flatten(r,e,n){let o=[[],[],[],[],[]],s=new Map;function a(l,c){let d=s.get(l);if(d!=null){if(d<=c)return;let u=o[d].indexOf(l);u>-1&&o[d].splice(u,1),l instanceof CompartmentInstance&&n.delete(l.compartment)}if(s.set(l,c),Array.isArray(l))for(let u of l)a(u,c);else if(l instanceof CompartmentInstance){if(n.has(l.compartment))throw new RangeError("Duplicate use of compartment in extensions");let u=e.get(l.compartment)||l.inner;n.set(l.compartment,u),a(u,c)}else if(l instanceof PrecExtension)a(l.inner,l.prec);else if(l instanceof StateField)o[c].push(l),l.provides&&a(l.provides,c);else if(l instanceof FacetProvider)o[c].push(l),l.facet.extensions&&a(l.facet.extensions,Prec_.default);else{let u=l.extension;if(!u)throw new Error(`Unrecognized extension value in extension set (${l}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);a(u,c)}}return a(r,Prec_.default),o.reduce((l,c)=>l.concat(c))}function ensureAddr(r,e){if(e&1)return 2;let n=e>>1,o=r.status[n];if(o==4)throw new Error("Cyclic dependency between fields and/or facets");if(o&2)return o;r.status[n]=4;let s=r.computeSlot(r,r.config.dynamicSlots[n]);return r.status[n]=2|s}function getAddr(r,e){return e&1?r.config.staticValues[e>>1]:r.values[e>>1]}const languageData=Facet.define(),allowMultipleSelections=Facet.define({combine:r=>r.some(e=>e),static:!0}),lineSeparator=Facet.define({combine:r=>r.length?r[0]:void 0,static:!0}),changeFilter=Facet.define(),transactionFilter=Facet.define(),transactionExtender=Facet.define(),readOnly=Facet.define({combine:r=>r.length?r[0]:!1});class Annotation{constructor(e,n){this.type=e,this.value=n}static define(){return new AnnotationType}}class AnnotationType{of(e){return new Annotation(this,e)}}class StateEffectType{constructor(e){this.map=e}of(e){return new StateEffect(this,e)}}class StateEffect{constructor(e,n){this.type=e,this.value=n}map(e){let n=this.type.map(this.value,e);return n===void 0?void 0:n==this.value?this:new StateEffect(this.type,n)}is(e){return this.type==e}static define(e={}){return new StateEffectType(e.map||(n=>n))}static mapEffects(e,n){if(!e.length)return e;let o=[];for(let s of e){let a=s.map(n);a&&o.push(a)}return o}}StateEffect.reconfigure=StateEffect.define(),StateEffect.appendConfig=StateEffect.define();class Transaction{constructor(e,n,o,s,a,l){this.startState=e,this.changes=n,this.selection=o,this.effects=s,this.annotations=a,this.scrollIntoView=l,this._doc=null,this._state=null,o&&checkSelection(o,n.newLength),a.some(c=>c.type==Transaction.time)||(this.annotations=a.concat(Transaction.time.of(Date.now())))}static create(e,n,o,s,a,l){return new Transaction(e,n,o,s,a,l)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let n of this.annotations)if(n.type==e)return n.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let n=this.annotation(Transaction.userEvent);return!!(n&&(n==e||n.length>e.length&&n.slice(0,e.length)==e&&n[e.length]=="."))}}Transaction.time=Annotation.define(),Transaction.userEvent=Annotation.define(),Transaction.addToHistory=Annotation.define(),Transaction.remote=Annotation.define();function joinRanges(r,e){let n=[];for(let o=0,s=0;;){let a,l;if(o<r.length&&(s==e.length||e[s]>=r[o]))a=r[o++],l=r[o++];else if(s<e.length)a=e[s++],l=e[s++];else return n;!n.length||n[n.length-1]<a?n.push(a,l):n[n.length-1]<l&&(n[n.length-1]=l)}}function mergeTransaction(r,e,n){var o;let s,a,l;return n?(s=e.changes,a=ChangeSet.empty(e.changes.length),l=r.changes.compose(e.changes)):(s=e.changes.map(r.changes),a=r.changes.mapDesc(e.changes,!0),l=r.changes.compose(s)),{changes:l,selection:e.selection?e.selection.map(a):(o=r.selection)===null||o===void 0?void 0:o.map(s),effects:StateEffect.mapEffects(r.effects,s).concat(StateEffect.mapEffects(e.effects,a)),annotations:r.annotations.length?r.annotations.concat(e.annotations):e.annotations,scrollIntoView:r.scrollIntoView||e.scrollIntoView}}function resolveTransactionInner(r,e,n){let o=e.selection,s=asArray(e.annotations);return e.userEvent&&(s=s.concat(Transaction.userEvent.of(e.userEvent))),{changes:e.changes instanceof ChangeSet?e.changes:ChangeSet.of(e.changes||[],n,r.facet(lineSeparator)),selection:o&&(o instanceof EditorSelection?o:EditorSelection.single(o.anchor,o.head)),effects:asArray(e.effects),annotations:s,scrollIntoView:!!e.scrollIntoView}}function resolveTransaction(r,e,n){let o=resolveTransactionInner(r,e.length?e[0]:{},r.doc.length);e.length&&e[0].filter===!1&&(n=!1);for(let a=1;a<e.length;a++){e[a].filter===!1&&(n=!1);let l=!!e[a].sequential;o=mergeTransaction(o,resolveTransactionInner(r,e[a],l?o.changes.newLength:r.doc.length),l)}let s=Transaction.create(r,o.changes,o.selection,o.effects,o.annotations,o.scrollIntoView);return extendTransaction(n?filterTransaction(s):s)}function filterTransaction(r){let e=r.startState,n=!0;for(let s of e.facet(changeFilter)){let a=s(r);if(a===!1){n=!1;break}Array.isArray(a)&&(n=n===!0?a:joinRanges(n,a))}if(n!==!0){let s,a;if(n===!1)a=r.changes.invertedDesc,s=ChangeSet.empty(e.doc.length);else{let l=r.changes.filter(n);s=l.changes,a=l.filtered.mapDesc(l.changes).invertedDesc}r=Transaction.create(e,s,r.selection&&r.selection.map(a),StateEffect.mapEffects(r.effects,a),r.annotations,r.scrollIntoView)}let o=e.facet(transactionFilter);for(let s=o.length-1;s>=0;s--){let a=o[s](r);a instanceof Transaction?r=a:Array.isArray(a)&&a.length==1&&a[0]instanceof Transaction?r=a[0]:r=resolveTransaction(e,asArray(a),!1)}return r}function extendTransaction(r){let e=r.startState,n=e.facet(transactionExtender),o=r;for(let s=n.length-1;s>=0;s--){let a=n[s](r);a&&Object.keys(a).length&&(o=mergeTransaction(o,resolveTransactionInner(e,a,r.changes.newLength),!0))}return o==r?r:Transaction.create(e,r.changes,r.selection,o.effects,o.annotations,o.scrollIntoView)}const none$1=[];function asArray(r){return r==null?none$1:Array.isArray(r)?r:[r]}var CharCategory=function(r){return r[r.Word=0]="Word",r[r.Space=1]="Space",r[r.Other=2]="Other",r}(CharCategory||(CharCategory={}));const nonASCIISingleCaseWordChar=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let wordChar;try{wordChar=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function hasWordChar(r){if(wordChar)return wordChar.test(r);for(let e=0;e<r.length;e++){let n=r[e];if(/\w/.test(n)||n>"\x80"&&(n.toUpperCase()!=n.toLowerCase()||nonASCIISingleCaseWordChar.test(n)))return!0}return!1}function makeCategorizer(r){return e=>{if(!/\S/.test(e))return CharCategory.Space;if(hasWordChar(e))return CharCategory.Word;for(let n=0;n<r.length;n++)if(e.indexOf(r[n])>-1)return CharCategory.Word;return CharCategory.Other}}EditorState=class{constructor(r,e,n,o,s,a){this.config=r,this.doc=e,this.selection=n,this.values=o,this.status=r.statusTemplate.slice(),this.computeSlot=s,a&&(a._state=this);for(let l=0;l<this.config.dynamicSlots.length;l++)ensureAddr(this,l<<1);this.computeSlot=null}field(r,e=!0){let n=this.config.address[r.id];if(n==null){if(e)throw new RangeError("Field is not present in this state");return}return ensureAddr(this,n),getAddr(this,n)}update(...r){return resolveTransaction(this,r,!0)}applyTransaction(r){let e=this.config,{base:n,compartments:o}=e;for(let l of r.effects)l.is(Compartment.reconfigure)?(e&&(o=new Map,e.compartments.forEach((c,d)=>o.set(d,c)),e=null),o.set(l.value.compartment,l.value.extension)):l.is(StateEffect.reconfigure)?(e=null,n=l.value):l.is(StateEffect.appendConfig)&&(e=null,n=asArray(n).concat(l.value));let s;e?s=r.startState.values.slice():(e=Configuration.resolve(n,o,this),s=new EditorState(e,this.doc,this.selection,e.dynamicSlots.map(()=>null),(l,c)=>c.reconfigure(l,this),null).values);let a=r.startState.facet(allowMultipleSelections)?r.newSelection:r.newSelection.asSingle();new EditorState(e,r.newDoc,a,s,(l,c)=>c.update(l,r),r)}replaceSelection(r){return typeof r=="string"&&(r=this.toText(r)),this.changeByRange(e=>({changes:{from:e.from,to:e.to,insert:r},range:EditorSelection.cursor(e.from+r.length)}))}changeByRange(r){let e=this.selection,n=r(e.ranges[0]),o=this.changes(n.changes),s=[n.range],a=asArray(n.effects);for(let l=1;l<e.ranges.length;l++){let c=r(e.ranges[l]),d=this.changes(c.changes),u=d.map(o);for(let f=0;f<l;f++)s[f]=s[f].map(u);let m=o.mapDesc(d,!0);s.push(c.range.map(m)),o=o.compose(u),a=StateEffect.mapEffects(a,u).concat(StateEffect.mapEffects(asArray(c.effects),m))}return{changes:o,selection:EditorSelection.create(s,e.mainIndex),effects:a}}changes(r=[]){return r instanceof ChangeSet?r:ChangeSet.of(r,this.doc.length,this.facet(EditorState.lineSeparator))}toText(r){return Text.of(r.split(this.facet(EditorState.lineSeparator)||DefaultSplit))}sliceDoc(r=0,e=this.doc.length){return this.doc.sliceString(r,e,this.lineBreak)}facet(r){let e=this.config.address[r.id];return e==null?r.default:(ensureAddr(this,e),getAddr(this,e))}toJSON(r){let e={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(r)for(let n in r){let o=r[n];o instanceof StateField&&this.config.address[o.id]!=null&&(e[n]=o.spec.toJSON(this.field(r[n]),this))}return e}static fromJSON(r,e={},n){if(!r||typeof r.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let o=[];if(n){for(let s in n)if(Object.prototype.hasOwnProperty.call(r,s)){let a=n[s],l=r[s];o.push(a.init(c=>a.spec.fromJSON(l,c)))}}return EditorState.create({doc:r.doc,selection:EditorSelection.fromJSON(r.selection),extensions:e.extensions?o.concat([e.extensions]):o})}static create(r={}){let e=Configuration.resolve(r.extensions||[],new Map),n=r.doc instanceof Text?r.doc:Text.of((r.doc||"").split(e.staticFacet(EditorState.lineSeparator)||DefaultSplit)),o=r.selection?r.selection instanceof EditorSelection?r.selection:EditorSelection.single(r.selection.anchor,r.selection.head):EditorSelection.single(0);return checkSelection(o,n.length),e.staticFacet(allowMultipleSelections)||(o=o.asSingle()),new EditorState(e,n,o,e.dynamicSlots.map(()=>null),(s,a)=>a.create(s),null)}get tabSize(){return this.facet(EditorState.tabSize)}get lineBreak(){return this.facet(EditorState.lineSeparator)||`
`}get readOnly(){return this.facet(readOnly)}phrase(r,...e){for(let n of this.facet(EditorState.phrases))if(Object.prototype.hasOwnProperty.call(n,r)){r=n[r];break}return e.length&&(r=r.replace(/\$(\$|\d*)/g,(n,o)=>{if(o=="$")return"$";let s=+(o||1);return!s||s>e.length?n:e[s-1]})),r}languageDataAt(r,e,n=-1){let o=[];for(let s of this.facet(languageData))for(let a of s(this,e,n))Object.prototype.hasOwnProperty.call(a,r)&&o.push(a[r]);return o}charCategorizer(r){return makeCategorizer(this.languageDataAt("wordChars",r).join(""))}wordAt(r){let{text:e,from:n,length:o}=this.doc.lineAt(r),s=this.charCategorizer(r),a=r-n,l=r-n;for(;a>0;){let c=findClusterBreak(e,a,!1);if(s(e.slice(c,a))!=CharCategory.Word)break;a=c}for(;l<o;){let c=findClusterBreak(e,l);if(s(e.slice(l,c))!=CharCategory.Word)break;l=c}return a==l?null:EditorSelection.range(a+n,l+n)}},EditorState.allowMultipleSelections=allowMultipleSelections,EditorState.tabSize=Facet.define({combine:r=>r.length?r[0]:4}),EditorState.lineSeparator=lineSeparator,EditorState.readOnly=readOnly,EditorState.phrases=Facet.define({compare(r,e){let n=Object.keys(r),o=Object.keys(e);return n.length==o.length&&n.every(s=>r[s]==e[s])}}),EditorState.languageData=languageData,EditorState.changeFilter=changeFilter,EditorState.transactionFilter=transactionFilter,EditorState.transactionExtender=transactionExtender,Compartment.reconfigure=StateEffect.define();function combineConfig(r,e,n={}){let o={};for(let s of r)for(let a of Object.keys(s)){let l=s[a],c=o[a];if(c===void 0)o[a]=l;else if(!(c===l||l===void 0))if(Object.hasOwnProperty.call(n,a))o[a]=n[a](c,l);else throw new Error("Config merge conflict for field "+a)}for(let s in e)o[s]===void 0&&(o[s]=e[s]);return o}class RangeValue{eq(e){return this==e}range(e,n=e){return Range$1.create(e,n,this)}}RangeValue.prototype.startSide=RangeValue.prototype.endSide=0,RangeValue.prototype.point=!1,RangeValue.prototype.mapMode=MapMode.TrackDel;let Range$1=class Ne{constructor(e,n,o){this.from=e,this.to=n,this.value=o}static create(e,n,o){return new Ne(e,n,o)}};function cmpRange(r,e){return r.from-e.from||r.value.startSide-e.value.startSide}class Chunk{constructor(e,n,o,s){this.from=e,this.to=n,this.value=o,this.maxPoint=s}get length(){return this.to[this.to.length-1]}findIndex(e,n,o,s=0){let a=o?this.to:this.from;for(let l=s,c=a.length;;){if(l==c)return l;let d=l+c>>1,u=a[d]-e||(o?this.value[d].endSide:this.value[d].startSide)-n;if(d==l)return u>=0?l:c;u>=0?c=d:l=d+1}}between(e,n,o,s){for(let a=this.findIndex(n,-1e9,!0),l=this.findIndex(o,1e9,!1,a);a<l;a++)if(s(this.from[a]+e,this.to[a]+e,this.value[a])===!1)return!1}map(e,n){let o=[],s=[],a=[],l=-1,c=-1;for(let d=0;d<this.value.length;d++){let u=this.value[d],m=this.from[d]+e,f=this.to[d]+e,p,g;if(m==f){let y=n.mapPos(m,u.startSide,u.mapMode);if(y==null||(p=g=y,u.startSide!=u.endSide&&(g=n.mapPos(m,u.endSide),g<p)))continue}else if(p=n.mapPos(m,u.startSide),g=n.mapPos(f,u.endSide),p>g||p==g&&u.startSide>0&&u.endSide<=0)continue;(g-p||u.endSide-u.startSide)<0||(l<0&&(l=p),u.point&&(c=Math.max(c,g-p)),o.push(u),s.push(p-l),a.push(g-l))}return{mapped:o.length?new Chunk(s,a,o,c):null,pos:l}}}class RangeSet{constructor(e,n,o,s){this.chunkPos=e,this.chunk=n,this.nextLayer=o,this.maxPoint=s}static create(e,n,o,s){return new RangeSet(e,n,o,s)}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let n of this.chunk)e+=n.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(e){let{add:n=[],sort:o=!1,filterFrom:s=0,filterTo:a=this.length}=e,l=e.filter;if(n.length==0&&!l)return this;if(o&&(n=n.slice().sort(cmpRange)),this.isEmpty)return n.length?RangeSet.of(n):this;let c=new LayerCursor(this,null,-1).goto(0),d=0,u=[],m=new RangeSetBuilder;for(;c.value||d<n.length;)if(d<n.length&&(c.from-n[d].from||c.startSide-n[d].value.startSide)>=0){let f=n[d++];m.addInner(f.from,f.to,f.value)||u.push(f)}else c.rangeIndex==1&&c.chunkIndex<this.chunk.length&&(d==n.length||this.chunkEnd(c.chunkIndex)<n[d].from)&&(!l||s>this.chunkEnd(c.chunkIndex)||a<this.chunkPos[c.chunkIndex])&&m.addChunk(this.chunkPos[c.chunkIndex],this.chunk[c.chunkIndex])?c.nextChunk():((!l||s>c.to||a<c.from||l(c.from,c.to,c.value))&&(m.addInner(c.from,c.to,c.value)||u.push(Range$1.create(c.from,c.to,c.value))),c.next());return m.finishInner(this.nextLayer.isEmpty&&!u.length?RangeSet.empty:this.nextLayer.update({add:u,filter:l,filterFrom:s,filterTo:a}))}map(e){if(e.empty||this.isEmpty)return this;let n=[],o=[],s=-1;for(let l=0;l<this.chunk.length;l++){let c=this.chunkPos[l],d=this.chunk[l],u=e.touchesRange(c,c+d.length);if(u===!1)s=Math.max(s,d.maxPoint),n.push(d),o.push(e.mapPos(c));else if(u===!0){let{mapped:m,pos:f}=d.map(c,e);m&&(s=Math.max(s,m.maxPoint),n.push(m),o.push(f))}}let a=this.nextLayer.map(e);return n.length==0?a:new RangeSet(o,n,a||RangeSet.empty,s)}between(e,n,o){if(!this.isEmpty){for(let s=0;s<this.chunk.length;s++){let a=this.chunkPos[s],l=this.chunk[s];if(n>=a&&e<=a+l.length&&l.between(a,e-a,n-a,o)===!1)return}this.nextLayer.between(e,n,o)}}iter(e=0){return HeapCursor.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,n=0){return HeapCursor.from(e).goto(n)}static compare(e,n,o,s,a=-1){let l=e.filter(f=>f.maxPoint>0||!f.isEmpty&&f.maxPoint>=a),c=n.filter(f=>f.maxPoint>0||!f.isEmpty&&f.maxPoint>=a),d=findSharedChunks(l,c,o),u=new SpanCursor(l,d,a),m=new SpanCursor(c,d,a);o.iterGaps((f,p,g)=>compare(u,f,m,p,g,s)),o.empty&&o.length==0&&compare(u,0,m,0,0,s)}static eq(e,n,o=0,s){s==null&&(s=999999999);let a=e.filter(m=>!m.isEmpty&&n.indexOf(m)<0),l=n.filter(m=>!m.isEmpty&&e.indexOf(m)<0);if(a.length!=l.length)return!1;if(!a.length)return!0;let c=findSharedChunks(a,l),d=new SpanCursor(a,c,0).goto(o),u=new SpanCursor(l,c,0).goto(o);for(;;){if(d.to!=u.to||!sameValues(d.active,u.active)||d.point&&(!u.point||!d.point.eq(u.point)))return!1;if(d.to>s)return!0;d.next(),u.next()}}static spans(e,n,o,s,a=-1){let l=new SpanCursor(e,null,a).goto(n),c=n,d=l.openStart;for(;;){let u=Math.min(l.to,o);if(l.point){let m=l.activeForPoint(l.to),f=l.pointFrom<n?m.length+1:l.point.startSide<0?m.length:Math.min(m.length,d);s.point(c,u,l.point,m,f,l.pointRank),d=Math.min(l.openEnd(u),m.length)}else u>c&&(s.span(c,u,l.active,d),d=l.openEnd(u));if(l.to>o)return d+(l.point&&l.to>o?1:0);c=l.to,l.next()}}static of(e,n=!1){let o=new RangeSetBuilder;for(let s of e instanceof Range$1?[e]:n?lazySort(e):e)o.add(s.from,s.to,s.value);return o.finish()}static join(e){if(!e.length)return RangeSet.empty;let n=e[e.length-1];for(let o=e.length-2;o>=0;o--)for(let s=e[o];s!=RangeSet.empty;s=s.nextLayer)n=new RangeSet(s.chunkPos,s.chunk,n,Math.max(s.maxPoint,n.maxPoint));return n}}RangeSet.empty=new RangeSet([],[],null,-1);function lazySort(r){if(r.length>1)for(let e=r[0],n=1;n<r.length;n++){let o=r[n];if(cmpRange(e,o)>0)return r.slice().sort(cmpRange);e=o}return r}RangeSet.empty.nextLayer=RangeSet.empty;class RangeSetBuilder{finishChunk(e){this.chunks.push(new Chunk(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[])}constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}add(e,n,o){this.addInner(e,n,o)||(this.nextLayer||(this.nextLayer=new RangeSetBuilder)).add(e,n,o)}addInner(e,n,o){let s=e-this.lastTo||o.startSide-this.last.endSide;if(s<=0&&(e-this.lastFrom||o.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return s<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(n-this.chunkStart),this.last=o,this.lastFrom=e,this.lastTo=n,this.value.push(o),o.point&&(this.maxPoint=Math.max(this.maxPoint,n-e)),!0)}addChunk(e,n){if((e-this.lastTo||n.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,n.maxPoint),this.chunks.push(n),this.chunkPos.push(e);let o=n.value.length-1;return this.last=n.value[o],this.lastFrom=n.from[o]+e,this.lastTo=n.to[o]+e,!0}finish(){return this.finishInner(RangeSet.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return e;let n=RangeSet.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,n}}function findSharedChunks(r,e,n){let o=new Map;for(let a of r)for(let l=0;l<a.chunk.length;l++)a.chunk[l].maxPoint<=0&&o.set(a.chunk[l],a.chunkPos[l]);let s=new Set;for(let a of e)for(let l=0;l<a.chunk.length;l++){let c=o.get(a.chunk[l]);c!=null&&(n?n.mapPos(c):c)==a.chunkPos[l]&&!(n!=null&&n.touchesRange(c,c+a.chunk[l].length))&&s.add(a.chunk[l])}return s}class LayerCursor{constructor(e,n,o,s=0){this.layer=e,this.skip=n,this.minPoint=o,this.rank=s}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,n=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,n,!1),this}gotoInner(e,n,o){for(;this.chunkIndex<this.layer.chunk.length;){let s=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(s)||this.layer.chunkEnd(this.chunkIndex)<e||s.maxPoint<this.minPoint))break;this.chunkIndex++,o=!1}if(this.chunkIndex<this.layer.chunk.length){let s=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],n,!0);(!o||this.rangeIndex<s)&&this.setRangeIndex(s)}this.next()}forward(e,n){(this.to-e||this.endSide-n)<0&&this.gotoInner(e,n,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let e=this.layer.chunkPos[this.chunkIndex],n=this.layer.chunk[this.chunkIndex],o=e+n.from[this.rangeIndex];if(this.from=o,this.to=e+n.to[this.rangeIndex],this.value=n.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=e}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(e){return this.from-e.from||this.startSide-e.startSide||this.rank-e.rank||this.to-e.to||this.endSide-e.endSide}}class HeapCursor{constructor(e){this.heap=e}static from(e,n=null,o=-1){let s=[];for(let a=0;a<e.length;a++)for(let l=e[a];!l.isEmpty;l=l.nextLayer)l.maxPoint>=o&&s.push(new LayerCursor(l,n,o,a));return s.length==1?s[0]:new HeapCursor(s)}get startSide(){return this.value?this.value.startSide:0}goto(e,n=-1e9){for(let o of this.heap)o.goto(e,n);for(let o=this.heap.length>>1;o>=0;o--)heapBubble(this.heap,o);return this.next(),this}forward(e,n){for(let o of this.heap)o.forward(e,n);for(let o=this.heap.length>>1;o>=0;o--)heapBubble(this.heap,o);(this.to-e||this.value.endSide-n)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),heapBubble(this.heap,0)}}}function heapBubble(r,e){for(let n=r[e];;){let o=(e<<1)+1;if(o>=r.length)break;let s=r[o];if(o+1<r.length&&s.compare(r[o+1])>=0&&(s=r[o+1],o++),n.compare(s)<0)break;r[o]=n,r[e]=s,e=o}}class SpanCursor{constructor(e,n,o){this.minPoint=o,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=HeapCursor.from(e,n,o)}goto(e,n=-1e9){return this.cursor.goto(e,n),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=n,this.openStart=-1,this.next(),this}forward(e,n){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-n)<0;)this.removeActive(this.minActive);this.cursor.forward(e,n)}removeActive(e){remove(this.active,e),remove(this.activeTo,e),remove(this.activeRank,e),this.minActive=findMinIndex(this.active,this.activeTo)}addActive(e){let n=0,{value:o,to:s,rank:a}=this.cursor;for(;n<this.activeRank.length&&(a-this.activeRank[n]||s-this.activeTo[n])>0;)n++;insert(this.active,n,o),insert(this.activeTo,n,s),insert(this.activeRank,n,a),e&&insert(e,n,this.cursor.from),this.minActive=findMinIndex(this.active,this.activeTo)}next(){let e=this.to,n=this.point;this.point=null;let o=this.openStart<0?[]:null;for(;;){let s=this.minActive;if(s>-1&&(this.activeTo[s]-this.cursor.from||this.active[s].endSide-this.cursor.startSide)<0){if(this.activeTo[s]>e){this.to=this.activeTo[s],this.endSide=this.active[s].endSide;break}this.removeActive(s),o&&remove(o,s)}else if(this.cursor.value)if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let a=this.cursor.value;if(!a.point)this.addActive(o),this.cursor.next();else if(n&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=a,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=a.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(o){this.openStart=0;for(let s=o.length-1;s>=0&&o[s]<e;s--)this.openStart++}}activeForPoint(e){if(!this.active.length)return this.active;let n=[];for(let o=this.active.length-1;o>=0&&!(this.activeRank[o]<this.pointRank);o--)(this.activeTo[o]>e||this.activeTo[o]==e&&this.active[o].endSide>=this.point.endSide)&&n.push(this.active[o]);return n.reverse()}openEnd(e){let n=0;for(let o=this.activeTo.length-1;o>=0&&this.activeTo[o]>e;o--)n++;return n}}function compare(r,e,n,o,s,a){r.goto(e),n.goto(o);let l=o+s,c=o,d=o-e;for(;;){let u=r.to+d-n.to,m=u||r.endSide-n.endSide,f=m<0?r.to+d:n.to,p=Math.min(f,l);if(r.point||n.point?r.point&&n.point&&(r.point==n.point||r.point.eq(n.point))&&sameValues(r.activeForPoint(r.to),n.activeForPoint(n.to))||a.comparePoint(c,p,r.point,n.point):p>c&&!sameValues(r.active,n.active)&&a.compareRange(c,p,r.active,n.active),f>l)break;(u||r.openEnd!=n.openEnd)&&a.boundChange&&a.boundChange(f),c=f,m<=0&&r.next(),m>=0&&n.next()}}function sameValues(r,e){if(r.length!=e.length)return!1;for(let n=0;n<r.length;n++)if(r[n]!=e[n]&&!r[n].eq(e[n]))return!1;return!0}function remove(r,e){for(let n=e,o=r.length-1;n<o;n++)r[n]=r[n+1];r.pop()}function insert(r,e,n){for(let o=r.length-1;o>=e;o--)r[o+1]=r[o];r[e]=n}function findMinIndex(r,e){let n=-1,o=1e9;for(let s=0;s<e.length;s++)(e[s]-o||r[s].endSide-r[n].endSide)<0&&(n=s,o=e[s]);return n}countColumn=function(r,e,n=r.length){let o=0;for(let s=0;s<n;)r.charCodeAt(s)==9?(o+=e-o%e,s++):(o++,s=findClusterBreak(r,s));return o};function findColumn(r,e,n,o){for(let s=0,a=0;;){if(a>=e)return s;if(s==r.length)break;a+=r.charCodeAt(s)==9?n-a%n:1,s=findClusterBreak(r,s)}return o===!0?-1:r.length}const C="\u037C",COUNT=typeof Symbol>"u"?"__"+C:Symbol.for(C),SET=typeof Symbol>"u"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),top=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{};class StyleModule{constructor(e,n){this.rules=[];let{finish:o}=n||{};function s(l){return/^@/.test(l)?[l]:l.split(/,\s*/)}function a(l,c,d,u){let m=[],f=/^@(\w+)\b/.exec(l[0]),p=f&&f[1]=="keyframes";if(f&&c==null)return d.push(l[0]+";");for(let g in c){let y=c[g];if(/&/.test(g))a(g.split(/,\s*/).map(b=>l.map(k=>b.replace(/&/,k))).reduce((b,k)=>b.concat(k)),y,d);else if(y&&typeof y=="object"){if(!f)throw new RangeError("The value of a property ("+g+") should be a primitive value.");a(s(g),y,m,p)}else y!=null&&m.push(g.replace(/_.*/,"").replace(/[A-Z]/g,b=>"-"+b.toLowerCase())+": "+y+";")}(m.length||p)&&d.push((o&&!f&&!u?l.map(o):l).join(", ")+" {"+m.join(" ")+"}")}for(let l in e)a(s(l),e[l],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let e=top[COUNT]||1;return top[COUNT]=e+1,C+e.toString(36)}static mount(e,n,o){let s=e[SET],a=o&&o.nonce;s?a&&s.setNonce(a):s=new StyleSet(e,a),s.mount(Array.isArray(n)?n:[n],e)}}let adoptedSet=new Map;class StyleSet{constructor(e,n){let o=e.ownerDocument||e,s=o.defaultView;if(!e.head&&e.adoptedStyleSheets&&s.CSSStyleSheet){let a=adoptedSet.get(o);if(a)return e[SET]=a;this.sheet=new s.CSSStyleSheet,adoptedSet.set(o,this)}else this.styleTag=o.createElement("style"),n&&this.styleTag.setAttribute("nonce",n);this.modules=[],e[SET]=this}mount(e,n){let o=this.sheet,s=0,a=0;for(let l=0;l<e.length;l++){let c=e[l],d=this.modules.indexOf(c);if(d<a&&d>-1&&(this.modules.splice(d,1),a--,d=-1),d==-1){if(this.modules.splice(a++,0,c),o)for(let u=0;u<c.rules.length;u++)o.insertRule(c.rules[u],s++)}else{for(;a<d;)s+=this.modules[a++].rules.length;s+=c.rules.length,a++}}if(o)n.adoptedStyleSheets.indexOf(this.sheet)<0&&(n.adoptedStyleSheets=[this.sheet,...n.adoptedStyleSheets]);else{let l="";for(let d=0;d<this.modules.length;d++)l+=this.modules[d].getRules()+`
`;this.styleTag.textContent=l;let c=n.head||n;this.styleTag.parentNode!=c&&c.insertBefore(this.styleTag,c.firstChild)}}setNonce(e){this.styleTag&&this.styleTag.getAttribute("nonce")!=e&&this.styleTag.setAttribute("nonce",e)}}for(var base={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},shift={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},mac$1=typeof navigator<"u"&&/Mac/.test(navigator.platform),ie$1=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),i$1=0;i$1<10;i$1++)base[48+i$1]=base[96+i$1]=String(i$1);for(var i$1=1;i$1<=24;i$1++)base[i$1+111]="F"+i$1;for(var i$1=65;i$1<=90;i$1++)base[i$1]=String.fromCharCode(i$1+32),shift[i$1]=String.fromCharCode(i$1);for(var code in base)shift.hasOwnProperty(code)||(shift[code]=base[code]);function keyName(r){var e=mac$1&&r.metaKey&&r.shiftKey&&!r.ctrlKey&&!r.altKey||ie$1&&r.shiftKey&&r.key&&r.key.length==1||r.key=="Unidentified",n=!e&&r.key||(r.shiftKey?shift:base)[r.keyCode]||r.key||"Unidentified";return n=="Esc"&&(n="Escape"),n=="Del"&&(n="Delete"),n=="Left"&&(n="ArrowLeft"),n=="Up"&&(n="ArrowUp"),n=="Right"&&(n="ArrowRight"),n=="Down"&&(n="ArrowDown"),n}function getSelection$1(r){let e;return r.nodeType==11?e=r.getSelection?r:r.ownerDocument:e=r,e.getSelection()}function contains$1(r,e){return e?r==e||r.contains(e.nodeType!=1?e.parentNode:e):!1}function hasSelection(r,e){if(!e.anchorNode)return!1;try{return contains$1(r,e.anchorNode)}catch{return!1}}function clientRectsFor(r){return r.nodeType==3?textRange(r,0,r.nodeValue.length).getClientRects():r.nodeType==1?r.getClientRects():[]}function isEquivalentPosition(r,e,n,o){return n?scanFor(r,e,n,o,-1)||scanFor(r,e,n,o,1):!1}function domIndex(r){for(var e=0;;e++)if(r=r.previousSibling,!r)return e}function isBlockElement(r){return r.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(r.nodeName)}function scanFor(r,e,n,o,s){for(;;){if(r==n&&e==o)return!0;if(e==(s<0?0:maxOffset(r))){if(r.nodeName=="DIV")return!1;let a=r.parentNode;if(!a||a.nodeType!=1)return!1;e=domIndex(r)+(s<0?0:1),r=a}else if(r.nodeType==1){if(r=r.childNodes[e+(s<0?-1:0)],r.nodeType==1&&r.contentEditable=="false")return!1;e=s<0?maxOffset(r):0}else return!1}}function maxOffset(r){return r.nodeType==3?r.nodeValue.length:r.childNodes.length}function flattenRect(r,e){let n=e?r.left:r.right;return{left:n,right:n,top:r.top,bottom:r.bottom}}function windowRect(r){let e=r.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:r.innerWidth,top:0,bottom:r.innerHeight}}function getScale(r,e){let n=e.width/r.offsetWidth,o=e.height/r.offsetHeight;return(n>.995&&n<1.005||!isFinite(n)||Math.abs(e.width-r.offsetWidth)<1)&&(n=1),(o>.995&&o<1.005||!isFinite(o)||Math.abs(e.height-r.offsetHeight)<1)&&(o=1),{scaleX:n,scaleY:o}}function scrollRectIntoView(r,e,n,o,s,a,l,c){let d=r.ownerDocument,u=d.defaultView||window;for(let m=r,f=!1;m&&!f;)if(m.nodeType==1){let p,g=m==d.body,y=1,b=1;if(g)p=windowRect(u);else{if(/^(fixed|sticky)$/.test(getComputedStyle(m).position)&&(f=!0),m.scrollHeight<=m.clientHeight&&m.scrollWidth<=m.clientWidth){m=m.assignedSlot||m.parentNode;continue}let B=m.getBoundingClientRect();({scaleX:y,scaleY:b}=getScale(m,B)),p={left:B.left,right:B.left+m.clientWidth*y,top:B.top,bottom:B.top+m.clientHeight*b}}let k=0,w=0;if(s=="nearest")e.top<p.top?(w=-(p.top-e.top+l),n>0&&e.bottom>p.bottom+w&&(w=e.bottom-p.bottom+w+l)):e.bottom>p.bottom&&(w=e.bottom-p.bottom+l,n<0&&e.top-w<p.top&&(w=-(p.top+w-e.top+l)));else{let B=e.bottom-e.top,M=p.bottom-p.top;w=(s=="center"&&B<=M?e.top+B/2-M/2:s=="start"||s=="center"&&n<0?e.top-l:e.bottom-M+l)-p.top}if(o=="nearest"?e.left<p.left?(k=-(p.left-e.left+a),n>0&&e.right>p.right+k&&(k=e.right-p.right+k+a)):e.right>p.right&&(k=e.right-p.right+a,n<0&&e.left<p.left+k&&(k=-(p.left+k-e.left+a))):k=(o=="center"?e.left+(e.right-e.left)/2-(p.right-p.left)/2:o=="start"==c?e.left-a:e.right-(p.right-p.left)+a)-p.left,k||w)if(g)u.scrollBy(k,w);else{let B=0,M=0;if(w){let x=m.scrollTop;m.scrollTop+=w/b,M=(m.scrollTop-x)*b}if(k){let x=m.scrollLeft;m.scrollLeft+=k/y,B=(m.scrollLeft-x)*y}e={left:e.left-B,top:e.top-M,right:e.right-B,bottom:e.bottom-M},B&&Math.abs(B-k)<1&&(o="nearest"),M&&Math.abs(M-w)<1&&(s="nearest")}if(g)break;m=m.assignedSlot||m.parentNode}else if(m.nodeType==11)m=m.host;else break}function scrollableParents(r){let e=r.ownerDocument,n,o;for(let s=r.parentNode;s&&!(s==e.body||n&&o);)if(s.nodeType==1)!o&&s.scrollHeight>s.clientHeight&&(o=s),!n&&s.scrollWidth>s.clientWidth&&(n=s),s=s.assignedSlot||s.parentNode;else if(s.nodeType==11)s=s.host;else break;return{x:n,y:o}}class DOMSelectionState{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){let{anchorNode:n,focusNode:o}=e;this.set(n,Math.min(e.anchorOffset,n?maxOffset(n):0),o,Math.min(e.focusOffset,o?maxOffset(o):0))}set(e,n,o,s){this.anchorNode=e,this.anchorOffset=n,this.focusNode=o,this.focusOffset=s}}let preventScrollSupported=null;function focusPreventScroll(r){if(r.setActive)return r.setActive();if(preventScrollSupported)return r.focus(preventScrollSupported);let e=[];for(let n=r;n&&(e.push(n,n.scrollTop,n.scrollLeft),n!=n.ownerDocument);n=n.parentNode);if(r.focus(preventScrollSupported==null?{get preventScroll(){return preventScrollSupported={preventScroll:!0},!0}}:void 0),!preventScrollSupported){preventScrollSupported=!1;for(let n=0;n<e.length;){let o=e[n++],s=e[n++],a=e[n++];o.scrollTop!=s&&(o.scrollTop=s),o.scrollLeft!=a&&(o.scrollLeft=a)}}}let scratchRange;function textRange(r,e,n=e){let o=scratchRange||(scratchRange=document.createRange());return o.setEnd(r,n),o.setStart(r,e),o}function dispatchKey(r,e,n,o){let s={key:e,code:e,keyCode:n,which:n,cancelable:!0};o&&({altKey:s.altKey,ctrlKey:s.ctrlKey,shiftKey:s.shiftKey,metaKey:s.metaKey}=o);let a=new KeyboardEvent("keydown",s);a.synthetic=!0,r.dispatchEvent(a);let l=new KeyboardEvent("keyup",s);return l.synthetic=!0,r.dispatchEvent(l),a.defaultPrevented||l.defaultPrevented}function getRoot(r){for(;r;){if(r&&(r.nodeType==9||r.nodeType==11&&r.host))return r;r=r.assignedSlot||r.parentNode}return null}function clearAttributes(r){for(;r.attributes.length;)r.removeAttributeNode(r.attributes[0])}function atElementStart(r,e){let n=e.focusNode,o=e.focusOffset;if(!n||e.anchorNode!=n||e.anchorOffset!=o)return!1;for(o=Math.min(o,maxOffset(n));;)if(o){if(n.nodeType!=1)return!1;let s=n.childNodes[o-1];s.contentEditable=="false"?o--:(n=s,o=maxOffset(n))}else{if(n==r)return!0;o=domIndex(n),n=n.parentNode}}function isScrolledToBottom(r){return r.scrollTop>Math.max(1,r.scrollHeight-r.clientHeight-4)}function textNodeBefore(r,e){for(let n=r,o=e;;){if(n.nodeType==3&&o>0)return{node:n,offset:o};if(n.nodeType==1&&o>0){if(n.contentEditable=="false")return null;n=n.childNodes[o-1],o=maxOffset(n)}else if(n.parentNode&&!isBlockElement(n))o=domIndex(n),n=n.parentNode;else return null}}function textNodeAfter(r,e){for(let n=r,o=e;;){if(n.nodeType==3&&o<n.nodeValue.length)return{node:n,offset:o};if(n.nodeType==1&&o<n.childNodes.length){if(n.contentEditable=="false")return null;n=n.childNodes[o],o=0}else if(n.parentNode&&!isBlockElement(n))o=domIndex(n)+1,n=n.parentNode;else return null}}class DOMPos{constructor(e,n,o=!0){this.node=e,this.offset=n,this.precise=o}static before(e,n){return new DOMPos(e.parentNode,domIndex(e),n)}static after(e,n){return new DOMPos(e.parentNode,domIndex(e)+1,n)}}const noChildren=[];class ContentView{constructor(){this.parent=null,this.dom=null,this.flags=2}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e){let n=this.posAtStart;for(let o of this.children){if(o==e)return n;n+=o.length+o.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}sync(e,n){if(this.flags&2){let o=this.dom,s=null,a;for(let l of this.children){if(l.flags&7){if(!l.dom&&(a=s?s.nextSibling:o.firstChild)){let c=ContentView.get(a);(!c||!c.parent&&c.canReuseDOM(l))&&l.reuseDOM(a)}l.sync(e,n),l.flags&=-8}if(a=s?s.nextSibling:o.firstChild,n&&!n.written&&n.node==o&&a!=l.dom&&(n.written=!0),l.dom.parentNode==o)for(;a&&a!=l.dom;)a=rm$1(a);else o.insertBefore(l.dom,a);s=l.dom}for(a=s?s.nextSibling:o.firstChild,a&&n&&n.node==o&&(n.written=!0);a;)a=rm$1(a)}else if(this.flags&1)for(let o of this.children)o.flags&7&&(o.sync(e,n),o.flags&=-8)}reuseDOM(e){}localPosFromDOM(e,n){let o;if(e==this.dom)o=this.dom.childNodes[n];else{let s=maxOffset(e)==0?0:n==0?-1:1;for(;;){let a=e.parentNode;if(a==this.dom)break;s==0&&a.firstChild!=a.lastChild&&(e==a.firstChild?s=-1:s=1),e=a}s<0?o=e:o=e.nextSibling}if(o==this.dom.firstChild)return 0;for(;o&&!ContentView.get(o);)o=o.nextSibling;if(!o)return this.length;for(let s=0,a=0;;s++){let l=this.children[s];if(l.dom==o)return a;a+=l.length+l.breakAfter}}domBoundsAround(e,n,o=0){let s=-1,a=-1,l=-1,c=-1;for(let d=0,u=o,m=o;d<this.children.length;d++){let f=this.children[d],p=u+f.length;if(u<e&&p>n)return f.domBoundsAround(e,n,u);if(p>=e&&s==-1&&(s=d,a=u),u>n&&f.dom.parentNode==this.dom){l=d,c=m;break}m=p,u=p+f.breakAfter}return{from:a,to:c<0?o+this.length:c,startDOM:(s?this.children[s-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:l<this.children.length&&l>=0?this.children[l].dom:null}}markDirty(e=!1){this.flags|=2,this.markParentsDirty(e)}markParentsDirty(e){for(let n=this.parent;n;n=n.parent){if(e&&(n.flags|=2),n.flags&1)return;n.flags|=1,e=!1}}setParent(e){this.parent!=e&&(this.parent=e,this.flags&7&&this.markParentsDirty(!0))}setDOM(e){this.dom!=e&&(this.dom&&(this.dom.cmView=null),this.dom=e,e.cmView=this)}get rootView(){for(let e=this;;){let n=e.parent;if(!n)return e;e=n}}replaceChildren(e,n,o=noChildren){this.markDirty();for(let s=e;s<n;s++){let a=this.children[s];a.parent==this&&o.indexOf(a)<0&&a.destroy()}o.length<250?this.children.splice(e,n-e,...o):this.children=[].concat(this.children.slice(0,e),o,this.children.slice(n));for(let s=0;s<o.length;s++)o[s].setParent(this)}ignoreMutation(e){return!1}ignoreEvent(e){return!1}childCursor(e=this.length){return new ChildCursor(this.children,e,this.children.length)}childPos(e,n=1){return this.childCursor().findPos(e,n)}toString(){let e=this.constructor.name.replace("View","");return e+(this.children.length?"("+this.children.join()+")":this.length?"["+(e=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(e){return e.cmView}get isEditable(){return!0}get isWidget(){return!1}get isHidden(){return!1}merge(e,n,o,s,a,l){return!1}become(e){return!1}canReuseDOM(e){return e.constructor==this.constructor&&!((this.flags|e.flags)&8)}getSide(){return 0}destroy(){for(let e of this.children)e.parent==this&&e.destroy();this.parent=null}}ContentView.prototype.breakAfter=0;function rm$1(r){let e=r.nextSibling;return r.parentNode.removeChild(r),e}class ChildCursor{constructor(e,n,o){this.children=e,this.pos=n,this.i=o,this.off=0}findPos(e,n=1){for(;;){if(e>this.pos||e==this.pos&&(n>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=e-this.pos,this;let o=this.children[--this.i];this.pos-=o.length+o.breakAfter}}}function replaceRange(r,e,n,o,s,a,l,c,d){let{children:u}=r,m=u.length?u[e]:null,f=a.length?a[a.length-1]:null,p=f?f.breakAfter:l;if(!(e==o&&m&&!l&&!p&&a.length<2&&m.merge(n,s,a.length?f:null,n==0,c,d))){if(o<u.length){let g=u[o];g&&(s<g.length||g.breakAfter&&(f!=null&&f.breakAfter))?(e==o&&(g=g.split(s),s=0),!p&&f&&g.merge(0,s,f,!0,0,d)?a[a.length-1]=g:((s||g.children.length&&!g.children[0].length)&&g.merge(0,s,null,!1,0,d),a.push(g))):g!=null&&g.breakAfter&&(f?f.breakAfter=1:l=1),o++}for(m&&(m.breakAfter=l,n>0&&(!l&&a.length&&m.merge(n,m.length,a[0],!1,c,0)?m.breakAfter=a.shift().breakAfter:(n<m.length||m.children.length&&m.children[m.children.length-1].length==0)&&m.merge(n,m.length,null,!1,c,0),e++));e<o&&a.length;)if(u[o-1].become(a[a.length-1]))o--,a.pop(),d=a.length?0:c;else if(u[e].become(a[0]))e++,a.shift(),c=a.length?0:d;else break;!a.length&&e&&o<u.length&&!u[e-1].breakAfter&&u[o].merge(0,0,u[e-1],!1,c,d)&&e--,(e<o||a.length)&&r.replaceChildren(e,o,a)}}function mergeChildrenInto(r,e,n,o,s,a){let l=r.childCursor(),{i:c,off:d}=l.findPos(n,1),{i:u,off:m}=l.findPos(e,-1),f=e-n;for(let p of o)f+=p.length;r.length+=f,replaceRange(r,u,m,c,d,o,0,s,a)}let nav=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},doc=typeof document<"u"?document:{documentElement:{style:{}}};const ie_edge=/Edge\/(\d+)/.exec(nav.userAgent),ie_upto10=/MSIE \d/.test(nav.userAgent),ie_11up=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(nav.userAgent),ie=!!(ie_upto10||ie_11up||ie_edge),gecko=!ie&&/gecko\/(\d+)/i.test(nav.userAgent),chrome=!ie&&/Chrome\/(\d+)/.exec(nav.userAgent),webkit="webkitFontSmoothing"in doc.documentElement.style,safari=!ie&&/Apple Computer/.test(nav.vendor),ios=safari&&(/Mobile\/\w+/.test(nav.userAgent)||nav.maxTouchPoints>2);var browser={mac:ios||/Mac/.test(nav.platform),windows:/Win/.test(nav.platform),linux:/Linux|X11/.test(nav.platform),ie,ie_version:ie_upto10?doc.documentMode||6:ie_11up?+ie_11up[1]:ie_edge?+ie_edge[1]:0,gecko,gecko_version:gecko?+(/Firefox\/(\d+)/.exec(nav.userAgent)||[0,0])[1]:0,chrome:!!chrome,chrome_version:chrome?+chrome[1]:0,ios,android:/Android\b/.test(nav.userAgent),webkit,safari,webkit_version:webkit?+(/\bAppleWebKit\/(\d+)/.exec(nav.userAgent)||[0,0])[1]:0,tabSize:doc.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};const MaxJoinLen=256;class TextView extends ContentView{constructor(e){super(),this.text=e}get length(){return this.text.length}createDOM(e){this.setDOM(e||document.createTextNode(this.text))}sync(e,n){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(n&&n.node==this.dom&&(n.written=!0),this.dom.nodeValue=this.text)}reuseDOM(e){e.nodeType==3&&this.createDOM(e)}merge(e,n,o){return this.flags&8||o&&(!(o instanceof TextView)||this.length-(n-e)+o.length>MaxJoinLen||o.flags&8)?!1:(this.text=this.text.slice(0,e)+(o?o.text:"")+this.text.slice(n),this.markDirty(),!0)}split(e){let n=new TextView(this.text.slice(e));return this.text=this.text.slice(0,e),this.markDirty(),n.flags|=this.flags&8,n}localPosFromDOM(e,n){return e==this.dom?n:n?this.text.length:0}domAtPos(e){return new DOMPos(this.dom,e)}domBoundsAround(e,n,o){return{from:o,to:o+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(e,n){return textCoords(this.dom,e,n)}}class MarkView extends ContentView{constructor(e,n=[],o=0){super(),this.mark=e,this.children=n,this.length=o;for(let s of n)s.setParent(this)}setAttrs(e){if(clearAttributes(e),this.mark.class&&(e.className=this.mark.class),this.mark.attrs)for(let n in this.mark.attrs)e.setAttribute(n,this.mark.attrs[n]);return e}canReuseDOM(e){return super.canReuseDOM(e)&&!((this.flags|e.flags)&8)}reuseDOM(e){e.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(e),this.flags|=6)}sync(e,n){this.dom?this.flags&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(e,n)}merge(e,n,o,s,a,l){return o&&(!(o instanceof MarkView&&o.mark.eq(this.mark))||e&&a<=0||n<this.length&&l<=0)?!1:(mergeChildrenInto(this,e,n,o?o.children.slice():[],a-1,l-1),this.markDirty(),!0)}split(e){let n=[],o=0,s=-1,a=0;for(let c of this.children){let d=o+c.length;d>e&&n.push(o<e?c.split(e-o):c),s<0&&o>=e&&(s=a),o=d,a++}let l=this.length-e;return this.length=e,s>-1&&(this.children.length=s,this.markDirty()),new MarkView(this.mark,n,l)}domAtPos(e){return inlineDOMAtPos(this,e)}coordsAt(e,n){return coordsInChildren(this,e,n)}}function textCoords(r,e,n){let o=r.nodeValue.length;e>o&&(e=o);let s=e,a=e,l=0;e==0&&n<0||e==o&&n>=0?browser.chrome||browser.gecko||(e?(s--,l=1):a<o&&(a++,l=-1)):n<0?s--:a<o&&a++;let c=textRange(r,s,a).getClientRects();if(!c.length)return null;let d=c[(l?l<0:n>=0)?0:c.length-1];return browser.safari&&!l&&d.width==0&&(d=Array.prototype.find.call(c,u=>u.width)||d),l?flattenRect(d,l<0):d||null}class WidgetView extends ContentView{static create(e,n,o){return new WidgetView(e,n,o)}constructor(e,n,o){super(),this.widget=e,this.length=n,this.side=o,this.prevWidget=null}split(e){let n=WidgetView.create(this.widget,this.length-e,this.side);return this.length-=e,n}sync(e){(!this.dom||!this.widget.updateDOM(this.dom,e))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.widget.editable||(this.dom.contentEditable="false"))}getSide(){return this.side}merge(e,n,o,s,a,l){return o&&(!(o instanceof WidgetView)||!this.widget.compare(o.widget)||e>0&&a<=0||n<this.length&&l<=0)?!1:(this.length=e+(o?o.length:0)+(this.length-n),!0)}become(e){return e instanceof WidgetView&&e.side==this.side&&this.widget.constructor==e.widget.constructor?(this.widget.compare(e.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get overrideDOMText(){if(this.length==0)return Text.empty;let e=this;for(;e.parent;)e=e.parent;let{view:n}=e,o=n&&n.state.doc,s=this.posAtStart;return o?o.slice(s,s+this.length):Text.empty}domAtPos(e){return(this.length?e==0:this.side>0)?DOMPos.before(this.dom):DOMPos.after(this.dom,e==this.length)}domBoundsAround(){return null}coordsAt(e,n){let o=this.widget.coordsAt(this.dom,e,n);if(o)return o;let s=this.dom.getClientRects(),a=null;if(!s.length)return null;let l=this.side?this.side<0:e>0;for(let c=l?s.length-1:0;a=s[c],!(e>0?c==0:c==s.length-1||a.top<a.bottom);c+=l?-1:1);return flattenRect(a,!l)}get isEditable(){return!1}get isWidget(){return!0}get isHidden(){return this.widget.isHidden}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class WidgetBufferView extends ContentView{constructor(e){super(),this.side=e}get length(){return 0}merge(){return!1}become(e){return e instanceof WidgetBufferView&&e.side==this.side}split(){return new WidgetBufferView(this.side)}sync(){if(!this.dom){let e=document.createElement("img");e.className="cm-widgetBuffer",e.setAttribute("aria-hidden","true"),this.setDOM(e)}}getSide(){return this.side}domAtPos(e){return this.side>0?DOMPos.before(this.dom):DOMPos.after(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(e){return this.dom.getBoundingClientRect()}get overrideDOMText(){return Text.empty}get isHidden(){return!0}}TextView.prototype.children=WidgetView.prototype.children=WidgetBufferView.prototype.children=noChildren;function inlineDOMAtPos(r,e){let n=r.dom,{children:o}=r,s=0;for(let a=0;s<o.length;s++){let l=o[s],c=a+l.length;if(!(c==a&&l.getSide()<=0)){if(e>a&&e<c&&l.dom.parentNode==n)return l.domAtPos(e-a);if(e<=a)break;a=c}}for(let a=s;a>0;a--){let l=o[a-1];if(l.dom.parentNode==n)return l.domAtPos(l.length)}for(let a=s;a<o.length;a++){let l=o[a];if(l.dom.parentNode==n)return l.domAtPos(0)}return new DOMPos(n,0)}function joinInlineInto(r,e,n){let o,{children:s}=r;n>0&&e instanceof MarkView&&s.length&&(o=s[s.length-1])instanceof MarkView&&o.mark.eq(e.mark)?joinInlineInto(o,e.children[0],n-1):(s.push(e),e.setParent(r)),r.length+=e.length}function coordsInChildren(r,e,n){let o=null,s=-1,a=null,l=-1;function c(u,m){for(let f=0,p=0;f<u.children.length&&p<=m;f++){let g=u.children[f],y=p+g.length;y>=m&&(g.children.length?c(g,m-p):(!a||a.isHidden&&n>0)&&(y>m||p==y&&g.getSide()>0)?(a=g,l=m-p):(p<m||p==y&&g.getSide()<0&&!g.isHidden)&&(o=g,s=m-p)),p=y}}c(r,e);let d=(n<0?o:a)||o||a;return d?d.coordsAt(Math.max(0,d==o?s:l),n):fallbackRect(r)}function fallbackRect(r){let e=r.dom.lastChild;if(!e)return r.dom.getBoundingClientRect();let n=clientRectsFor(e);return n[n.length-1]||null}function combineAttrs(r,e){for(let n in r)n=="class"&&e.class?e.class+=" "+r.class:n=="style"&&e.style?e.style+=";"+r.style:e[n]=r[n];return e}const noAttrs=Object.create(null);function attrsEq(r,e,n){if(r==e)return!0;r||(r=noAttrs),e||(e=noAttrs);let o=Object.keys(r),s=Object.keys(e);if(o.length-(n&&o.indexOf(n)>-1?1:0)!=s.length-(n&&s.indexOf(n)>-1?1:0))return!1;for(let a of o)if(a!=n&&(s.indexOf(a)==-1||r[a]!==e[a]))return!1;return!0}function updateAttrs(r,e,n){let o=!1;if(e)for(let s in e)n&&s in n||(o=!0,s=="style"?r.style.cssText="":r.removeAttribute(s));if(n)for(let s in n)e&&e[s]==n[s]||(o=!0,s=="style"?r.style.cssText=n[s]:r.setAttribute(s,n[s]));return o}function getAttrs(r){let e=Object.create(null);for(let n=0;n<r.attributes.length;n++){let o=r.attributes[n];e[o.name]=o.value}return e}class WidgetType{eq(e){return!1}updateDOM(e,n){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}get lineBreaks(){return 0}ignoreEvent(e){return!0}coordsAt(e,n,o){return null}get isHidden(){return!1}get editable(){return!1}destroy(e){}}var BlockType=function(r){return r[r.Text=0]="Text",r[r.WidgetBefore=1]="WidgetBefore",r[r.WidgetAfter=2]="WidgetAfter",r[r.WidgetRange=3]="WidgetRange",r}(BlockType||(BlockType={}));class Decoration extends RangeValue{constructor(e,n,o,s){super(),this.startSide=e,this.endSide=n,this.widget=o,this.spec=s}get heightRelevant(){return!1}static mark(e){return new MarkDecoration(e)}static widget(e){let n=Math.max(-1e4,Math.min(1e4,e.side||0)),o=!!e.block;return n+=o&&!e.inlineOrder?n>0?3e8:-4e8:n>0?1e8:-1e8,new PointDecoration(e,n,n,o,e.widget||null,!1)}static replace(e){let n=!!e.block,o,s;if(e.isBlockGap)o=-5e8,s=4e8;else{let{start:a,end:l}=getInclusive(e,n);o=(a?n?-3e8:-1:5e8)-1,s=(l?n?2e8:1:-6e8)+1}return new PointDecoration(e,o,s,n,e.widget||null,!0)}static line(e){return new LineDecoration(e)}static set(e,n=!1){return RangeSet.of(e,n)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}}Decoration.none=RangeSet.empty;class MarkDecoration extends Decoration{constructor(e){let{start:n,end:o}=getInclusive(e);super(n?-1:5e8,o?1:-6e8,null,e),this.tagName=e.tagName||"span",this.class=e.class||"",this.attrs=e.attributes||null}eq(e){var n,o;return this==e||e instanceof MarkDecoration&&this.tagName==e.tagName&&(this.class||((n=this.attrs)===null||n===void 0?void 0:n.class))==(e.class||((o=e.attrs)===null||o===void 0?void 0:o.class))&&attrsEq(this.attrs,e.attrs,"class")}range(e,n=e){if(e>=n)throw new RangeError("Mark decorations may not be empty");return super.range(e,n)}}MarkDecoration.prototype.point=!1;class LineDecoration extends Decoration{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof LineDecoration&&this.spec.class==e.spec.class&&attrsEq(this.spec.attributes,e.spec.attributes)}range(e,n=e){if(n!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,n)}}LineDecoration.prototype.mapMode=MapMode.TrackBefore,LineDecoration.prototype.point=!0;class PointDecoration extends Decoration{constructor(e,n,o,s,a,l){super(n,o,a,e),this.block=s,this.isReplace=l,this.mapMode=s?n<=0?MapMode.TrackBefore:MapMode.TrackAfter:MapMode.TrackDel}get type(){return this.startSide!=this.endSide?BlockType.WidgetRange:this.startSide<=0?BlockType.WidgetBefore:BlockType.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&(this.widget.estimatedHeight>=5||this.widget.lineBreaks>0)}eq(e){return e instanceof PointDecoration&&widgetsEq(this.widget,e.widget)&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide}range(e,n=e){if(this.isReplace&&(e>n||e==n&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&n!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,n)}}PointDecoration.prototype.point=!0;function getInclusive(r,e=!1){let{inclusiveStart:n,inclusiveEnd:o}=r;return n==null&&(n=r.inclusive),o==null&&(o=r.inclusive),{start:n??e,end:o??e}}function widgetsEq(r,e){return r==e||!!(r&&e&&r.compare(e))}function addRange(r,e,n,o=0){let s=n.length-1;s>=0&&n[s]+o>=r?n[s]=Math.max(n[s],e):n.push(r,e)}class LineView extends ContentView{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(e,n,o,s,a,l){if(o){if(!(o instanceof LineView))return!1;this.dom||o.transferDOM(this)}return s&&this.setDeco(o?o.attrs:null),mergeChildrenInto(this,e,n,o?o.children.slice():[],a,l),!0}split(e){let n=new LineView;if(n.breakAfter=this.breakAfter,this.length==0)return n;let{i:o,off:s}=this.childPos(e);s&&(n.append(this.children[o].split(s),0),this.children[o].merge(s,this.children[o].length,null,!1,0,0),o++);for(let a=o;a<this.children.length;a++)n.append(this.children[a],0);for(;o>0&&this.children[o-1].length==0;)this.children[--o].destroy();return this.children.length=o,this.markDirty(),this.length=e,n}transferDOM(e){this.dom&&(this.markDirty(),e.setDOM(this.dom),e.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(e){attrsEq(this.attrs,e)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=e)}append(e,n){joinInlineInto(this,e,n)}addLineDeco(e){let n=e.spec.attributes,o=e.spec.class;n&&(this.attrs=combineAttrs(n,this.attrs||{})),o&&(this.attrs=combineAttrs({class:o},this.attrs||{}))}domAtPos(e){return inlineDOMAtPos(this,e)}reuseDOM(e){e.nodeName=="DIV"&&(this.setDOM(e),this.flags|=6)}sync(e,n){var o;this.dom?this.flags&4&&(clearAttributes(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(updateAttrs(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(e,n);let s=this.dom.lastChild;for(;s&&ContentView.get(s)instanceof MarkView;)s=s.lastChild;if(!s||!this.length||s.nodeName!="BR"&&((o=ContentView.get(s))===null||o===void 0?void 0:o.isEditable)==!1&&(!browser.ios||!this.children.some(a=>a instanceof TextView))){let a=document.createElement("BR");a.cmIgnore=!0,this.dom.appendChild(a)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let e=0,n;for(let o of this.children){if(!(o instanceof TextView)||/[^ -~]/.test(o.text))return null;let s=clientRectsFor(o.dom);if(s.length!=1)return null;e+=s[0].width,n=s[0].height}return e?{lineHeight:this.dom.getBoundingClientRect().height,charWidth:e/this.length,textHeight:n}:null}coordsAt(e,n){let o=coordsInChildren(this,e,n);if(!this.children.length&&o&&this.parent){let{heightOracle:s}=this.parent.view.viewState,a=o.bottom-o.top;if(Math.abs(a-s.lineHeight)<2&&s.textHeight<a){let l=(a-s.textHeight)/2;return{top:o.top+l,bottom:o.bottom-l,left:o.left,right:o.left}}}return o}become(e){return e instanceof LineView&&this.children.length==0&&e.children.length==0&&attrsEq(this.attrs,e.attrs)&&this.breakAfter==e.breakAfter}covers(){return!0}static find(e,n){for(let o=0,s=0;o<e.children.length;o++){let a=e.children[o],l=s+a.length;if(l>=n){if(a instanceof LineView)return a;if(l>n)break}s=l+a.breakAfter}return null}}class BlockWidgetView extends ContentView{constructor(e,n,o){super(),this.widget=e,this.length=n,this.deco=o,this.breakAfter=0,this.prevWidget=null}merge(e,n,o,s,a,l){return o&&(!(o instanceof BlockWidgetView)||!this.widget.compare(o.widget)||e>0&&a<=0||n<this.length&&l<=0)?!1:(this.length=e+(o?o.length:0)+(this.length-n),!0)}domAtPos(e){return e==0?DOMPos.before(this.dom):DOMPos.after(this.dom,e==this.length)}split(e){let n=this.length-e;this.length=e;let o=new BlockWidgetView(this.widget,n,this.deco);return o.breakAfter=this.breakAfter,o}get children(){return noChildren}sync(e){(!this.dom||!this.widget.updateDOM(this.dom,e))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.widget.editable||(this.dom.contentEditable="false"))}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):Text.empty}domBoundsAround(){return null}become(e){return e instanceof BlockWidgetView&&e.widget.constructor==this.widget.constructor?(e.widget.compare(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,this.deco=e.deco,this.breakAfter=e.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get isEditable(){return!1}get isWidget(){return!0}coordsAt(e,n){return this.widget.coordsAt(this.dom,e,n)||(this.widget instanceof BlockGapWidget?null:flattenRect(this.dom.getBoundingClientRect(),this.length?e==0:n<=0))}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}covers(e){let{startSide:n,endSide:o}=this.deco;return n==o?!1:e<0?n<0:o>0}}class BlockGapWidget extends WidgetType{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return e.className="cm-gap",this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get editable(){return!0}get estimatedHeight(){return this.height}ignoreEvent(){return!1}}class ContentBuilder{constructor(e,n,o,s){this.doc=e,this.pos=n,this.end=o,this.disallowBlockEffectsFor=s,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.bufferMarks=[],this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=e.iter(),this.skip=n}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let e=this.content[this.content.length-1];return!(e.breakAfter||e instanceof BlockWidgetView&&e.deco.endSide<0)}getLine(){return this.curLine||(this.content.push(this.curLine=new LineView),this.atCursorPos=!0),this.curLine}flushBuffer(e=this.bufferMarks){this.pendingBuffer&&(this.curLine.append(wrapMarks(new WidgetBufferView(-1),e),e.length),this.pendingBuffer=0)}addBlockWidget(e){this.flushBuffer(),this.curLine=null,this.content.push(e)}finish(e){this.pendingBuffer&&e<=this.bufferMarks.length?this.flushBuffer():this.pendingBuffer=0,!this.posCovered()&&!(e&&this.content.length&&this.content[this.content.length-1]instanceof BlockWidgetView)&&this.getLine()}buildText(e,n,o){for(;e>0;){if(this.textOff==this.text.length){let{value:a,lineBreak:l,done:c}=this.cursor.next(this.skip);if(this.skip=0,c)throw new Error("Ran out of text content when drawing inline views");if(l){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer(),this.curLine=null,this.atCursorPos=!0,e--;continue}else this.text=a,this.textOff=0}let s=Math.min(this.text.length-this.textOff,e,512);this.flushBuffer(n.slice(n.length-o)),this.getLine().append(wrapMarks(new TextView(this.text.slice(this.textOff,this.textOff+s)),n),o),this.atCursorPos=!0,this.textOff+=s,e-=s,o=0}}span(e,n,o,s){this.buildText(n-e,o,s),this.pos=n,this.openStart<0&&(this.openStart=s)}point(e,n,o,s,a,l){if(this.disallowBlockEffectsFor[l]&&o instanceof PointDecoration){if(o.block)throw new RangeError("Block decorations may not be specified via plugins");if(n>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let c=n-e;if(o instanceof PointDecoration)if(o.block)o.startSide>0&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new BlockWidgetView(o.widget||NullWidget.block,c,o));else{let d=WidgetView.create(o.widget||NullWidget.inline,c,c?0:o.startSide),u=this.atCursorPos&&!d.isEditable&&a<=s.length&&(e<n||o.startSide>0),m=!d.isEditable&&(e<n||a>s.length||o.startSide<=0),f=this.getLine();this.pendingBuffer==2&&!u&&!d.isEditable&&(this.pendingBuffer=0),this.flushBuffer(s),u&&(f.append(wrapMarks(new WidgetBufferView(1),s),a),a=s.length+Math.max(0,a-s.length)),f.append(wrapMarks(d,s),a),this.atCursorPos=m,this.pendingBuffer=m?e<n||a>s.length?1:2:0,this.pendingBuffer&&(this.bufferMarks=s.slice())}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(o);c&&(this.textOff+c<=this.text.length?this.textOff+=c:(this.skip+=c-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=n),this.openStart<0&&(this.openStart=a)}static build(e,n,o,s,a){let l=new ContentBuilder(e,n,o,a);return l.openEnd=RangeSet.spans(s,n,o,l),l.openStart<0&&(l.openStart=l.openEnd),l.finish(l.openEnd),l}}function wrapMarks(r,e){for(let n of e)r=new MarkView(n,[r],r.length);return r}class NullWidget extends WidgetType{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}get isHidden(){return!0}}NullWidget.inline=new NullWidget("span"),NullWidget.block=new NullWidget("div");var Direction=function(r){return r[r.LTR=0]="LTR",r[r.RTL=1]="RTL",r}(Direction||(Direction={}));const LTR=Direction.LTR,RTL=Direction.RTL;function dec(r){let e=[];for(let n=0;n<r.length;n++)e.push(1<<+r[n]);return e}const LowTypes=dec("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),ArabicTypes=dec("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),Brackets=Object.create(null),BracketStack=[];for(let r of["()","[]","{}"]){let e=r.charCodeAt(0),n=r.charCodeAt(1);Brackets[e]=n,Brackets[n]=-e}function charType(r){return r<=247?LowTypes[r]:1424<=r&&r<=1524?2:1536<=r&&r<=1785?ArabicTypes[r-1536]:1774<=r&&r<=2220?4:8192<=r&&r<=8204?256:64336<=r&&r<=65023?4:1}const BidiRE=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class BidiSpan{get dir(){return this.level%2?RTL:LTR}constructor(e,n,o){this.from=e,this.to=n,this.level=o}side(e,n){return this.dir==n==e?this.to:this.from}forward(e,n){return e==(this.dir==n)}static find(e,n,o,s){let a=-1;for(let l=0;l<e.length;l++){let c=e[l];if(c.from<=n&&c.to>=n){if(c.level==o)return l;(a<0||(s!=0?s<0?c.from<n:c.to>n:e[a].level>c.level))&&(a=l)}}if(a<0)throw new RangeError("Index out of range");return a}}function isolatesEq(r,e){if(r.length!=e.length)return!1;for(let n=0;n<r.length;n++){let o=r[n],s=e[n];if(o.from!=s.from||o.to!=s.to||o.direction!=s.direction||!isolatesEq(o.inner,s.inner))return!1}return!0}const types=[];function computeCharTypes(r,e,n,o,s){for(let a=0;a<=o.length;a++){let l=a?o[a-1].to:e,c=a<o.length?o[a].from:n,d=a?256:s;for(let u=l,m=d,f=d;u<c;u++){let p=charType(r.charCodeAt(u));p==512?p=m:p==8&&f==4&&(p=16),types[u]=p==4?2:p,p&7&&(f=p),m=p}for(let u=l,m=d,f=d;u<c;u++){let p=types[u];if(p==128)u<c-1&&m==types[u+1]&&m&24?p=types[u]=m:types[u]=256;else if(p==64){let g=u+1;for(;g<c&&types[g]==64;)g++;let y=u&&m==8||g<n&&types[g]==8?f==1?1:8:256;for(let b=u;b<g;b++)types[b]=y;u=g-1}else p==8&&f==1&&(types[u]=1);m=p,p&7&&(f=p)}}}function processBracketPairs(r,e,n,o,s){let a=s==1?2:1;for(let l=0,c=0,d=0;l<=o.length;l++){let u=l?o[l-1].to:e,m=l<o.length?o[l].from:n;for(let f=u,p,g,y;f<m;f++)if(g=Brackets[p=r.charCodeAt(f)])if(g<0){for(let b=c-3;b>=0;b-=3)if(BracketStack[b+1]==-g){let k=BracketStack[b+2],w=k&2?s:k&4?k&1?a:s:0;w&&(types[f]=types[BracketStack[b]]=w),c=b;break}}else{if(BracketStack.length==189)break;BracketStack[c++]=f,BracketStack[c++]=p,BracketStack[c++]=d}else if((y=types[f])==2||y==1){let b=y==s;d=b?0:1;for(let k=c-3;k>=0;k-=3){let w=BracketStack[k+2];if(w&2)break;if(b)BracketStack[k+2]|=2;else{if(w&4)break;BracketStack[k+2]|=4}}}}}function processNeutrals(r,e,n,o){for(let s=0,a=o;s<=n.length;s++){let l=s?n[s-1].to:r,c=s<n.length?n[s].from:e;for(let d=l;d<c;){let u=types[d];if(u==256){let m=d+1;for(;;)if(m==c){if(s==n.length)break;m=n[s++].to,c=s<n.length?n[s].from:e}else if(types[m]==256)m++;else break;let f=a==1,p=(m<e?types[m]:o)==1,g=f==p?f?1:2:o;for(let y=m,b=s,k=b?n[b-1].to:r;y>d;)y==k&&(y=n[--b].from,k=b?n[b-1].to:r),types[--y]=g;d=m}else a=u,d++}}}function emitSpans(r,e,n,o,s,a,l){let c=o%2?2:1;if(o%2==s%2)for(let d=e,u=0;d<n;){let m=!0,f=!1;if(u==a.length||d<a[u].from){let b=types[d];b!=c&&(m=!1,f=b==16)}let p=!m&&c==1?[]:null,g=m?o:o+1,y=d;e:for(;;)if(u<a.length&&y==a[u].from){if(f)break e;let b=a[u];if(!m)for(let k=b.to,w=u+1;;){if(k==n)break e;if(w<a.length&&a[w].from==k)k=a[w++].to;else{if(types[k]==c)break e;break}}if(u++,p)p.push(b);else{b.from>d&&l.push(new BidiSpan(d,b.from,g));let k=b.direction==LTR!=!(g%2);computeSectionOrder(r,k?o+1:o,s,b.inner,b.from,b.to,l),d=b.to}y=b.to}else{if(y==n||(m?types[y]!=c:types[y]==c))break;y++}p?emitSpans(r,d,y,o+1,s,p,l):d<y&&l.push(new BidiSpan(d,y,g)),d=y}else for(let d=n,u=a.length;d>e;){let m=!0,f=!1;if(!u||d>a[u-1].to){let b=types[d-1];b!=c&&(m=!1,f=b==16)}let p=!m&&c==1?[]:null,g=m?o:o+1,y=d;e:for(;;)if(u&&y==a[u-1].to){if(f)break e;let b=a[--u];if(!m)for(let k=b.from,w=u;;){if(k==e)break e;if(w&&a[w-1].to==k)k=a[--w].from;else{if(types[k-1]==c)break e;break}}if(p)p.push(b);else{b.to<d&&l.push(new BidiSpan(b.to,d,g));let k=b.direction==LTR!=!(g%2);computeSectionOrder(r,k?o+1:o,s,b.inner,b.from,b.to,l),d=b.from}y=b.from}else{if(y==e||(m?types[y-1]!=c:types[y-1]==c))break;y--}p?emitSpans(r,y,d,o+1,s,p,l):y<d&&l.push(new BidiSpan(y,d,g)),d=y}}function computeSectionOrder(r,e,n,o,s,a,l){let c=e%2?2:1;computeCharTypes(r,s,a,o,c),processBracketPairs(r,s,a,o,c),processNeutrals(s,a,o,c),emitSpans(r,s,a,e,n,o,l)}function computeOrder(r,e,n){if(!r)return[new BidiSpan(0,0,e==RTL?1:0)];if(e==LTR&&!n.length&&!BidiRE.test(r))return trivialOrder(r.length);if(n.length)for(;r.length>types.length;)types[types.length]=256;let o=[],s=e==LTR?0:1;return computeSectionOrder(r,s,s,n,0,r.length,o),o}function trivialOrder(r){return[new BidiSpan(0,r,0)]}let movedOver="";function moveVisually(r,e,n,o,s){var a;let l=o.head-r.from,c=BidiSpan.find(e,l,(a=o.bidiLevel)!==null&&a!==void 0?a:-1,o.assoc),d=e[c],u=d.side(s,n);if(l==u){let p=c+=s?1:-1;if(p<0||p>=e.length)return null;d=e[c=p],l=d.side(!s,n),u=d.side(s,n)}let m=findClusterBreak(r.text,l,d.forward(s,n));(m<d.from||m>d.to)&&(m=u),movedOver=r.text.slice(Math.min(l,m),Math.max(l,m));let f=c==(s?e.length-1:0)?null:e[c+(s?1:-1)];return f&&m==u&&f.level+(s?0:1)<d.level?EditorSelection.cursor(f.side(!s,n)+r.from,f.forward(s,n)?1:-1,f.level):EditorSelection.cursor(m+r.from,d.forward(s,n)?-1:1,d.level)}function autoDirection(r,e,n){for(let o=e;o<n;o++){let s=charType(r.charCodeAt(o));if(s==1)return LTR;if(s==2||s==4)return RTL}return LTR}const clickAddsSelectionRange=Facet.define(),dragMovesSelection$1=Facet.define(),mouseSelectionStyle=Facet.define(),exceptionSink=Facet.define(),updateListener=Facet.define(),inputHandler$1=Facet.define(),focusChangeEffect=Facet.define(),clipboardInputFilter=Facet.define(),clipboardOutputFilter=Facet.define(),perLineTextDirection=Facet.define({combine:r=>r.some(e=>e)}),nativeSelectionHidden=Facet.define({combine:r=>r.some(e=>e)}),scrollHandler=Facet.define();class ScrollTarget{constructor(e,n="nearest",o="nearest",s=5,a=5,l=!1){this.range=e,this.y=n,this.x=o,this.yMargin=s,this.xMargin=a,this.isSnapshot=l}map(e){return e.empty?this:new ScrollTarget(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}clip(e){return this.range.to<=e.doc.length?this:new ScrollTarget(EditorSelection.cursor(e.doc.length),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}}const scrollIntoView=StateEffect.define({map:(r,e)=>r.map(e)}),setEditContextFormatting=StateEffect.define();function logException(r,e,n){let o=r.facet(exceptionSink);o.length?o[0](e):window.onerror?window.onerror(String(e),n,void 0,void 0,e):n?console.error(n+":",e):console.error(e)}const editable=Facet.define({combine:r=>r.length?r[0]:!0});let nextPluginID=0;const viewPlugin=Facet.define();class ViewPlugin{constructor(e,n,o,s,a){this.id=e,this.create=n,this.domEventHandlers=o,this.domEventObservers=s,this.extension=a(this)}static define(e,n){const{eventHandlers:o,eventObservers:s,provide:a,decorations:l}=n||{};return new ViewPlugin(nextPluginID++,e,o,s,c=>{let d=[viewPlugin.of(c)];return l&&d.push(decorations.of(u=>{let m=u.plugin(c);return m?l(m):Decoration.none})),a&&d.push(a(c)),d})}static fromClass(e,n){return ViewPlugin.define(o=>new e(o),n)}}class PluginInstance{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}update(e){if(this.value){if(this.mustUpdate){let n=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(n)}catch(o){if(logException(n.state,o,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(e)}catch(n){logException(e.state,n,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var n;if(!((n=this.value)===null||n===void 0)&&n.destroy)try{this.value.destroy()}catch(o){logException(e.state,o,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const editorAttributes=Facet.define(),contentAttributes=Facet.define(),decorations=Facet.define(),outerDecorations=Facet.define(),atomicRanges=Facet.define(),bidiIsolatedRanges=Facet.define();function getIsolatedRanges(r,e){let n=r.state.facet(bidiIsolatedRanges);if(!n.length)return n;let o=n.map(a=>a instanceof Function?a(r):a),s=[];return RangeSet.spans(o,e.from,e.to,{point(){},span(a,l,c,d){let u=a-e.from,m=l-e.from,f=s;for(let p=c.length-1;p>=0;p--,d--){let g=c[p].spec.bidiIsolate,y;if(g==null&&(g=autoDirection(e.text,u,m)),d>0&&f.length&&(y=f[f.length-1]).to==u&&y.direction==g)y.to=m,f=y.inner;else{let b={from:u,to:m,direction:g,inner:[]};f.push(b),f=b.inner}}}}),s}const scrollMargins=Facet.define();function getScrollMargins(r){let e=0,n=0,o=0,s=0;for(let a of r.state.facet(scrollMargins)){let l=a(r);l&&(l.left!=null&&(e=Math.max(e,l.left)),l.right!=null&&(n=Math.max(n,l.right)),l.top!=null&&(o=Math.max(o,l.top)),l.bottom!=null&&(s=Math.max(s,l.bottom)))}return{left:e,right:n,top:o,bottom:s}}const styleModule=Facet.define();class ChangedRange{constructor(e,n,o,s){this.fromA=e,this.toA=n,this.fromB=o,this.toB=s}join(e){return new ChangedRange(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let n=e.length,o=this;for(;n>0;n--){let s=e[n-1];if(!(s.fromA>o.toA)){if(s.toA<o.fromA)break;o=o.join(s),e.splice(n-1,1)}}return e.splice(n,0,o),e}static extendWithRanges(e,n){if(n.length==0)return e;let o=[];for(let s=0,a=0,l=0,c=0;;s++){let d=s==e.length?null:e[s],u=l-c,m=d?d.fromB:1e9;for(;a<n.length&&n[a]<m;){let f=n[a],p=n[a+1],g=Math.max(c,f),y=Math.min(m,p);if(g<=y&&new ChangedRange(g+u,y+u,g,y).addToSet(o),p>m)break;a+=2}if(!d)return o;new ChangedRange(d.fromA,d.toA,d.fromB,d.toB).addToSet(o),l=d.toA,c=d.toB}}}class ViewUpdate{constructor(e,n,o){this.view=e,this.state=n,this.transactions=o,this.flags=0,this.startState=e.state,this.changes=ChangeSet.empty(this.startState.doc.length);for(let a of o)this.changes=this.changes.compose(a.changes);let s=[];this.changes.iterChangedRanges((a,l,c,d)=>s.push(new ChangedRange(a,l,c,d))),this.changedRanges=s}static create(e,n,o){return new ViewUpdate(e,n,o)}get viewportChanged(){return(this.flags&4)>0}get viewportMoved(){return(this.flags&8)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&18)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(e=>e.selection)}get empty(){return this.flags==0&&this.transactions.length==0}}class DocView extends ContentView{get length(){return this.view.state.doc.length}constructor(e){super(),this.view=e,this.decorations=[],this.dynamicDecorationMap=[!1],this.domChanged=null,this.hasComposition=null,this.markedForComposition=new Set,this.editContextFormatting=Decoration.none,this.lastCompositionAfterCursor=!1,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(e.contentDOM),this.children=[new LineView],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new ChangedRange(0,0,0,e.state.doc.length)],0,null)}update(e){var n;let o=e.changedRanges;this.minWidth>0&&o.length&&(o.every(({fromA:u,toA:m})=>m<this.minWidthFrom||u>this.minWidthTo)?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.updateEditContextFormatting(e);let s=-1;this.view.inputState.composing>=0&&!this.view.observer.editContext&&(!((n=this.domChanged)===null||n===void 0)&&n.newSel?s=this.domChanged.newSel.head:!touchesComposition(e.changes,this.hasComposition)&&!e.selectionSet&&(s=e.state.selection.main.head));let a=s>-1?findCompositionRange(this.view,e.changes,s):null;if(this.domChanged=null,this.hasComposition){this.markedForComposition.clear();let{from:u,to:m}=this.hasComposition;o=new ChangedRange(u,m,e.changes.mapPos(u,-1),e.changes.mapPos(m,1)).addToSet(o.slice())}this.hasComposition=a?{from:a.range.fromB,to:a.range.toB}:null,(browser.ie||browser.chrome)&&!a&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let l=this.decorations,c=this.updateDeco(),d=findChangedDeco(l,c,e.changes);return o=ChangedRange.extendWithRanges(o,d),!(this.flags&7)&&o.length==0?!1:(this.updateInner(o,e.startState.doc.length,a),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,n,o){this.view.viewState.mustMeasureContent=!0,this.updateChildren(e,n,o);let{observer:s}=this.view;s.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight/this.view.scaleY+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let l=browser.chrome||browser.ios?{node:s.selectionRange.focusNode,written:!1}:void 0;this.sync(this.view,l),this.flags&=-8,l&&(l.written||s.selectionRange.focusNode!=l.node)&&(this.forceSelection=!0),this.dom.style.height=""}),this.markedForComposition.forEach(l=>l.flags&=-9);let a=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let l of this.children)l instanceof BlockWidgetView&&l.widget instanceof BlockGapWidget&&a.push(l.dom);s.updateGaps(a)}updateChildren(e,n,o){let s=o?o.range.addToSet(e.slice()):e,a=this.childCursor(n);for(let l=s.length-1;;l--){let c=l>=0?s[l]:null;if(!c)break;let{fromA:d,toA:u,fromB:m,toB:f}=c,p,g,y,b;if(o&&o.range.fromB<f&&o.range.toB>m){let x=ContentBuilder.build(this.view.state.doc,m,o.range.fromB,this.decorations,this.dynamicDecorationMap),v=ContentBuilder.build(this.view.state.doc,o.range.toB,f,this.decorations,this.dynamicDecorationMap);g=x.breakAtStart,y=x.openStart,b=v.openEnd;let _=this.compositionView(o);v.breakAtStart?_.breakAfter=1:v.content.length&&_.merge(_.length,_.length,v.content[0],!1,v.openStart,0)&&(_.breakAfter=v.content[0].breakAfter,v.content.shift()),x.content.length&&_.merge(0,0,x.content[x.content.length-1],!0,0,x.openEnd)&&x.content.pop(),p=x.content.concat(_).concat(v.content)}else({content:p,breakAtStart:g,openStart:y,openEnd:b}=ContentBuilder.build(this.view.state.doc,m,f,this.decorations,this.dynamicDecorationMap));let{i:k,off:w}=a.findPos(u,1),{i:B,off:M}=a.findPos(d,-1);replaceRange(this,B,M,k,w,p,g,y,b)}o&&this.fixCompositionDOM(o)}updateEditContextFormatting(e){this.editContextFormatting=this.editContextFormatting.map(e.changes);for(let n of e.transactions)for(let o of n.effects)o.is(setEditContextFormatting)&&(this.editContextFormatting=o.value)}compositionView(e){let n=new TextView(e.text.nodeValue);n.flags|=8;for(let{deco:s}of e.marks)n=new MarkView(s,[n],n.length);let o=new LineView;return o.append(n,0),o}fixCompositionDOM(e){let n=(a,l)=>{l.flags|=8|(l.children.some(d=>d.flags&7)?1:0),this.markedForComposition.add(l);let c=ContentView.get(a);c&&c!=l&&(c.dom=null),l.setDOM(a)},o=this.childPos(e.range.fromB,1),s=this.children[o.i];n(e.line,s);for(let a=e.marks.length-1;a>=-1;a--)o=s.childPos(o.off,1),s=s.children[o.i],n(a>=0?e.marks[a].node:e.text,s)}updateSelection(e=!1,n=!1){(e||!this.view.observer.selectionRange.focusNode)&&this.view.observer.readSelectionRange();let o=this.view.root.activeElement,s=o==this.dom,a=!s&&!(this.view.state.facet(editable)||this.dom.tabIndex>-1)&&hasSelection(this.dom,this.view.observer.selectionRange)&&!(o&&this.dom.contains(o));if(!(s||n||a))return;let l=this.forceSelection;this.forceSelection=!1;let c=this.view.state.selection.main,d=this.moveToLine(this.domAtPos(c.anchor)),u=c.empty?d:this.moveToLine(this.domAtPos(c.head));if(browser.gecko&&c.empty&&!this.hasComposition&&betweenUneditable(d)){let f=document.createTextNode("");this.view.observer.ignore(()=>d.node.insertBefore(f,d.node.childNodes[d.offset]||null)),d=u=new DOMPos(f,0),l=!0}let m=this.view.observer.selectionRange;(l||!m.focusNode||(!isEquivalentPosition(d.node,d.offset,m.anchorNode,m.anchorOffset)||!isEquivalentPosition(u.node,u.offset,m.focusNode,m.focusOffset))&&!this.suppressWidgetCursorChange(m,c))&&(this.view.observer.ignore(()=>{browser.android&&browser.chrome&&this.dom.contains(m.focusNode)&&inUneditable(m.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let f=getSelection$1(this.view.root);if(f)if(c.empty){if(browser.gecko){let p=nextToUneditable(d.node,d.offset);if(p&&p!=3){let g=(p==1?textNodeBefore:textNodeAfter)(d.node,d.offset);g&&(d=new DOMPos(g.node,g.offset))}}f.collapse(d.node,d.offset),c.bidiLevel!=null&&f.caretBidiLevel!==void 0&&(f.caretBidiLevel=c.bidiLevel)}else if(f.extend){f.collapse(d.node,d.offset);try{f.extend(u.node,u.offset)}catch{}}else{let p=document.createRange();c.anchor>c.head&&([d,u]=[u,d]),p.setEnd(u.node,u.offset),p.setStart(d.node,d.offset),f.removeAllRanges(),f.addRange(p)}a&&this.view.root.activeElement==this.dom&&(this.dom.blur(),o&&o.focus())}),this.view.observer.setSelectionRange(d,u)),this.impreciseAnchor=d.precise?null:new DOMPos(m.anchorNode,m.anchorOffset),this.impreciseHead=u.precise?null:new DOMPos(m.focusNode,m.focusOffset)}suppressWidgetCursorChange(e,n){return this.hasComposition&&n.empty&&isEquivalentPosition(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset)&&this.posFromDOM(e.focusNode,e.focusOffset)==n.head}enforceCursorAssoc(){if(this.hasComposition)return;let{view:e}=this,n=e.state.selection.main,o=getSelection$1(e.root),{anchorNode:s,anchorOffset:a}=e.observer.selectionRange;if(!o||!n.empty||!n.assoc||!o.modify)return;let l=LineView.find(this,n.head);if(!l)return;let c=l.posAtStart;if(n.head==c||n.head==c+l.length)return;let d=this.coordsAt(n.head,-1),u=this.coordsAt(n.head,1);if(!d||!u||d.bottom>u.top)return;let m=this.domAtPos(n.head+n.assoc);o.collapse(m.node,m.offset),o.modify("move",n.assoc<0?"forward":"backward","lineboundary"),e.observer.readSelectionRange();let f=e.observer.selectionRange;e.docView.posFromDOM(f.anchorNode,f.anchorOffset)!=n.from&&o.collapse(s,a)}moveToLine(e){let n=this.dom,o;if(e.node!=n)return e;for(let s=e.offset;!o&&s<n.childNodes.length;s++){let a=ContentView.get(n.childNodes[s]);a instanceof LineView&&(o=a.domAtPos(0))}for(let s=e.offset-1;!o&&s>=0;s--){let a=ContentView.get(n.childNodes[s]);a instanceof LineView&&(o=a.domAtPos(a.length))}return o?new DOMPos(o.node,o.offset,!0):e}nearest(e){for(let n=e;n;){let o=ContentView.get(n);if(o&&o.rootView==this)return o;n=n.parentNode}return null}posFromDOM(e,n){let o=this.nearest(e);if(!o)throw new RangeError("Trying to find position for a DOM position outside of the document");return o.localPosFromDOM(e,n)+o.posAtStart}domAtPos(e){let{i:n,off:o}=this.childCursor().findPos(e,-1);for(;n<this.children.length-1;){let s=this.children[n];if(o<s.length||s instanceof LineView)break;n++,o=0}return this.children[n].domAtPos(o)}coordsAt(e,n){let o=null,s=0;for(let a=this.length,l=this.children.length-1;l>=0;l--){let c=this.children[l],d=a-c.breakAfter,u=d-c.length;if(d<e)break;if(u<=e&&(u<e||c.covers(-1))&&(d>e||c.covers(1))&&(!o||c instanceof LineView&&!(o instanceof LineView&&n>=0)))o=c,s=u;else if(o&&u==e&&d==e&&c instanceof BlockWidgetView&&Math.abs(n)<2){if(c.deco.startSide<0)break;l&&(o=null)}a=u}return o?o.coordsAt(e-s,n):null}coordsForChar(e){let{i:n,off:o}=this.childPos(e,1),s=this.children[n];if(!(s instanceof LineView))return null;for(;s.children.length;){let{i:c,off:d}=s.childPos(o,1);for(;;c++){if(c==s.children.length)return null;if((s=s.children[c]).length)break}o=d}if(!(s instanceof TextView))return null;let a=findClusterBreak(s.text,o);if(a==o)return null;let l=textRange(s.dom,o,a).getClientRects();for(let c=0;c<l.length;c++){let d=l[c];if(c==l.length-1||d.top<d.bottom&&d.left<d.right)return d}return null}measureVisibleLineHeights(e){let n=[],{from:o,to:s}=e,a=this.view.contentDOM.clientWidth,l=a>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,c=-1,d=this.view.textDirection==Direction.LTR;for(let u=0,m=0;m<this.children.length;m++){let f=this.children[m],p=u+f.length;if(p>s)break;if(u>=o){let g=f.dom.getBoundingClientRect();if(n.push(g.height),l){let y=f.dom.lastChild,b=y?clientRectsFor(y):[];if(b.length){let k=b[b.length-1],w=d?k.right-g.left:g.right-k.left;w>c&&(c=w,this.minWidth=a,this.minWidthFrom=u,this.minWidthTo=p)}}}u=p+f.breakAfter}return n}textDirectionAt(e){let{i:n}=this.childPos(e,1);return getComputedStyle(this.children[n].dom).direction=="rtl"?Direction.RTL:Direction.LTR}measureTextSize(){for(let a of this.children)if(a instanceof LineView){let l=a.measureTextSize();if(l)return l}let e=document.createElement("div"),n,o,s;return e.className="cm-line",e.style.width="99999px",e.style.position="absolute",e.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(e);let a=clientRectsFor(e.firstChild)[0];n=e.getBoundingClientRect().height,o=a?a.width/27:7,s=a?a.height:n,e.remove()}),{lineHeight:n,charWidth:o,textHeight:s}}childCursor(e=this.length){let n=this.children.length;return n&&(e-=this.children[--n].length),new ChildCursor(this.children,e,n)}computeBlockGapDeco(){let e=[],n=this.view.viewState;for(let o=0,s=0;;s++){let a=s==n.viewports.length?null:n.viewports[s],l=a?a.from-1:this.length;if(l>o){let c=(n.lineBlockAt(l).bottom-n.lineBlockAt(o).top)/this.view.scaleY;e.push(Decoration.replace({widget:new BlockGapWidget(c),block:!0,inclusive:!0,isBlockGap:!0}).range(o,l))}if(!a)break;o=a.to+1}return Decoration.set(e)}updateDeco(){let e=1,n=this.view.state.facet(decorations).map(a=>(this.dynamicDecorationMap[e++]=typeof a=="function")?a(this.view):a),o=!1,s=this.view.state.facet(outerDecorations).map((a,l)=>{let c=typeof a=="function";return c&&(o=!0),c?a(this.view):a});for(s.length&&(this.dynamicDecorationMap[e++]=o,n.push(RangeSet.join(s))),this.decorations=[this.editContextFormatting,...n,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco];e<this.decorations.length;)this.dynamicDecorationMap[e++]=!1;return this.decorations}scrollIntoView(e){if(e.isSnapshot){let u=this.view.viewState.lineBlockAt(e.range.head);this.view.scrollDOM.scrollTop=u.top-e.yMargin,this.view.scrollDOM.scrollLeft=e.xMargin;return}for(let u of this.view.state.facet(scrollHandler))try{if(u(this.view,e.range,e))return!0}catch(m){logException(this.view.state,m,"scroll handler")}let{range:n}=e,o=this.coordsAt(n.head,n.empty?n.assoc:n.head>n.anchor?-1:1),s;if(!o)return;!n.empty&&(s=this.coordsAt(n.anchor,n.anchor>n.head?-1:1))&&(o={left:Math.min(o.left,s.left),top:Math.min(o.top,s.top),right:Math.max(o.right,s.right),bottom:Math.max(o.bottom,s.bottom)});let a=getScrollMargins(this.view),l={left:o.left-a.left,top:o.top-a.top,right:o.right+a.right,bottom:o.bottom+a.bottom},{offsetWidth:c,offsetHeight:d}=this.view.scrollDOM;scrollRectIntoView(this.view.scrollDOM,l,n.head<n.anchor?-1:1,e.x,e.y,Math.max(Math.min(e.xMargin,c),-c),Math.max(Math.min(e.yMargin,d),-d),this.view.textDirection==Direction.LTR)}}function betweenUneditable(r){return r.node.nodeType==1&&r.node.firstChild&&(r.offset==0||r.node.childNodes[r.offset-1].contentEditable=="false")&&(r.offset==r.node.childNodes.length||r.node.childNodes[r.offset].contentEditable=="false")}function findCompositionNode(r,e){let n=r.observer.selectionRange;if(!n.focusNode)return null;let o=textNodeBefore(n.focusNode,n.focusOffset),s=textNodeAfter(n.focusNode,n.focusOffset),a=o||s;if(s&&o&&s.node!=o.node){let c=ContentView.get(s.node);if(!c||c instanceof TextView&&c.text!=s.node.nodeValue)a=s;else if(r.docView.lastCompositionAfterCursor){let d=ContentView.get(o.node);!d||d instanceof TextView&&d.text!=o.node.nodeValue||(a=s)}}if(r.docView.lastCompositionAfterCursor=a!=o,!a)return null;let l=e-a.offset;return{from:l,to:l+a.node.nodeValue.length,node:a.node}}function findCompositionRange(r,e,n){let o=findCompositionNode(r,n);if(!o)return null;let{node:s,from:a,to:l}=o,c=s.nodeValue;if(/[\n\r]/.test(c)||r.state.doc.sliceString(o.from,o.to)!=c)return null;let d=e.invertedDesc,u=new ChangedRange(d.mapPos(a),d.mapPos(l),a,l),m=[];for(let f=s.parentNode;;f=f.parentNode){let p=ContentView.get(f);if(p instanceof MarkView)m.push({node:f,deco:p.mark});else{if(p instanceof LineView||f.nodeName=="DIV"&&f.parentNode==r.contentDOM)return{range:u,text:s,marks:m,line:f};if(f!=r.contentDOM)m.push({node:f,deco:new MarkDecoration({inclusive:!0,attributes:getAttrs(f),tagName:f.tagName.toLowerCase()})});else return null}}}function nextToUneditable(r,e){return r.nodeType!=1?0:(e&&r.childNodes[e-1].contentEditable=="false"?1:0)|(e<r.childNodes.length&&r.childNodes[e].contentEditable=="false"?2:0)}let DecorationComparator$1=class{constructor(){this.changes=[]}compareRange(r,e){addRange(r,e,this.changes)}comparePoint(r,e){addRange(r,e,this.changes)}boundChange(r){addRange(r,r,this.changes)}};function findChangedDeco(r,e,n){let o=new DecorationComparator$1;return RangeSet.compare(r,e,n,o),o.changes}function inUneditable(r,e){for(let n=r;n&&n!=e;n=n.assignedSlot||n.parentNode)if(n.nodeType==1&&n.contentEditable=="false")return!0;return!1}function touchesComposition(r,e){let n=!1;return e&&r.iterChangedRanges((o,s)=>{o<e.to&&s>e.from&&(n=!0)}),n}function groupAt(r,e,n=1){let o=r.charCategorizer(e),s=r.doc.lineAt(e),a=e-s.from;if(s.length==0)return EditorSelection.cursor(e);a==0?n=1:a==s.length&&(n=-1);let l=a,c=a;n<0?l=findClusterBreak(s.text,a,!1):c=findClusterBreak(s.text,a);let d=o(s.text.slice(l,c));for(;l>0;){let u=findClusterBreak(s.text,l,!1);if(o(s.text.slice(u,l))!=d)break;l=u}for(;c<s.length;){let u=findClusterBreak(s.text,c);if(o(s.text.slice(c,u))!=d)break;c=u}return EditorSelection.range(l+s.from,c+s.from)}function getdx(r,e){return e.left>r?e.left-r:Math.max(0,r-e.right)}function getdy(r,e){return e.top>r?e.top-r:Math.max(0,r-e.bottom)}function yOverlap(r,e){return r.top<e.bottom-1&&r.bottom>e.top+1}function upTop(r,e){return e<r.top?{top:e,left:r.left,right:r.right,bottom:r.bottom}:r}function upBot(r,e){return e>r.bottom?{top:r.top,left:r.left,right:r.right,bottom:e}:r}function domPosAtCoords(r,e,n){let o,s,a,l,c=!1,d,u,m,f;for(let y=r.firstChild;y;y=y.nextSibling){let b=clientRectsFor(y);for(let k=0;k<b.length;k++){let w=b[k];s&&yOverlap(s,w)&&(w=upTop(upBot(w,s.bottom),s.top));let B=getdx(e,w),M=getdy(n,w);if(B==0&&M==0)return y.nodeType==3?domPosInText(y,e,n):domPosAtCoords(y,e,n);if(!o||l>M||l==M&&a>B){o=y,s=w,a=B,l=M;let x=M?n<w.top?-1:1:B?e<w.left?-1:1:0;c=!x||(x>0?k<b.length-1:k>0)}B==0?n>w.bottom&&(!m||m.bottom<w.bottom)?(d=y,m=w):n<w.top&&(!f||f.top>w.top)&&(u=y,f=w):m&&yOverlap(m,w)?m=upBot(m,w.bottom):f&&yOverlap(f,w)&&(f=upTop(f,w.top))}}if(m&&m.bottom>=n?(o=d,s=m):f&&f.top<=n&&(o=u,s=f),!o)return{node:r,offset:0};let p=Math.max(s.left,Math.min(s.right,e));if(o.nodeType==3)return domPosInText(o,p,n);if(c&&o.contentEditable!="false")return domPosAtCoords(o,p,n);let g=Array.prototype.indexOf.call(r.childNodes,o)+(e>=(s.left+s.right)/2?1:0);return{node:r,offset:g}}function domPosInText(r,e,n){let o=r.nodeValue.length,s=-1,a=1e9,l=0;for(let c=0;c<o;c++){let d=textRange(r,c,c+1).getClientRects();for(let u=0;u<d.length;u++){let m=d[u];if(m.top==m.bottom)continue;l||(l=e-m.left);let f=(m.top>n?m.top-n:n-m.bottom)-1;if(m.left-1<=e&&m.right+1>=e&&f<a){let p=e>=(m.left+m.right)/2,g=p;if((browser.chrome||browser.gecko)&&textRange(r,c).getBoundingClientRect().left==m.right&&(g=!p),f<=0)return{node:r,offset:c+(g?1:0)};s=c+(g?1:0),a=f}}}return{node:r,offset:s>-1?s:l>0?r.nodeValue.length:0}}function posAtCoords(r,e,n,o=-1){var s,a;let l=r.contentDOM.getBoundingClientRect(),c=l.top+r.viewState.paddingTop,d,{docHeight:u}=r.viewState,{x:m,y:f}=e,p=f-c;if(p<0)return 0;if(p>u)return r.state.doc.length;for(let x=r.viewState.heightOracle.textHeight/2,v=!1;d=r.elementAtHeight(p),d.type!=BlockType.Text;)for(;p=o>0?d.bottom+x:d.top-x,!(p>=0&&p<=u);){if(v)return n?null:0;v=!0,o=-o}f=c+p;let g=d.from;if(g<r.viewport.from)return r.viewport.from==0?0:n?null:posAtCoordsImprecise(r,l,d,m,f);if(g>r.viewport.to)return r.viewport.to==r.state.doc.length?r.state.doc.length:n?null:posAtCoordsImprecise(r,l,d,m,f);let y=r.dom.ownerDocument,b=r.root.elementFromPoint?r.root:y,k=b.elementFromPoint(m,f);k&&!r.contentDOM.contains(k)&&(k=null),k||(m=Math.max(l.left+1,Math.min(l.right-1,m)),k=b.elementFromPoint(m,f),k&&!r.contentDOM.contains(k)&&(k=null));let w,B=-1;if(k&&((s=r.docView.nearest(k))===null||s===void 0?void 0:s.isEditable)!=!1){if(y.caretPositionFromPoint){let x=y.caretPositionFromPoint(m,f);x&&({offsetNode:w,offset:B}=x)}else if(y.caretRangeFromPoint){let x=y.caretRangeFromPoint(m,f);x&&({startContainer:w,startOffset:B}=x,(!r.contentDOM.contains(w)||browser.safari&&isSuspiciousSafariCaretResult(w,B,m)||browser.chrome&&isSuspiciousChromeCaretResult(w,B,m))&&(w=void 0))}w&&(B=Math.min(maxOffset(w),B))}if(!w||!r.docView.dom.contains(w)){let x=LineView.find(r.docView,g);if(!x)return p>d.top+d.height/2?d.to:d.from;({node:w,offset:B}=domPosAtCoords(x.dom,m,f))}let M=r.docView.nearest(w);if(!M)return null;if(M.isWidget&&((a=M.dom)===null||a===void 0?void 0:a.nodeType)==1){let x=M.dom.getBoundingClientRect();return e.y<x.top||e.y<=x.bottom&&e.x<=(x.left+x.right)/2?M.posAtStart:M.posAtEnd}else return M.localPosFromDOM(w,B)+M.posAtStart}function posAtCoordsImprecise(r,e,n,o,s){let a=Math.round((o-e.left)*r.defaultCharacterWidth);if(r.lineWrapping&&n.height>r.defaultLineHeight*1.5){let c=r.viewState.heightOracle.textHeight,d=Math.floor((s-n.top-(r.defaultLineHeight-c)*.5)/c);a+=d*r.viewState.heightOracle.lineLength}let l=r.state.sliceDoc(n.from,n.to);return n.from+findColumn(l,a,r.state.tabSize)}function isSuspiciousSafariCaretResult(r,e,n){let o;if(r.nodeType!=3||e!=(o=r.nodeValue.length))return!1;for(let s=r.nextSibling;s;s=s.nextSibling)if(s.nodeType!=1||s.nodeName!="BR")return!1;return textRange(r,o-1,o).getBoundingClientRect().left>n}function isSuspiciousChromeCaretResult(r,e,n){if(e!=0)return!1;for(let s=r;;){let a=s.parentNode;if(!a||a.nodeType!=1||a.firstChild!=s)return!1;if(a.classList.contains("cm-line"))break;s=a}let o=r.nodeType==1?r.getBoundingClientRect():textRange(r,0,Math.max(r.nodeValue.length,1)).getBoundingClientRect();return n-o.left>5}function blockAt(r,e){let n=r.lineBlockAt(e);if(Array.isArray(n.type)){for(let o of n.type)if(o.to>e||o.to==e&&(o.to==n.to||o.type==BlockType.Text))return o}return n}function moveToLineBoundary(r,e,n,o){let s=blockAt(r,e.head),a=!o||s.type!=BlockType.Text||!(r.lineWrapping||s.widgetLineBreaks)?null:r.coordsAtPos(e.assoc<0&&e.head>s.from?e.head-1:e.head);if(a){let l=r.dom.getBoundingClientRect(),c=r.textDirectionAt(s.from),d=r.posAtCoords({x:n==(c==Direction.LTR)?l.right-1:l.left+1,y:(a.top+a.bottom)/2});if(d!=null)return EditorSelection.cursor(d,n?-1:1)}return EditorSelection.cursor(n?s.to:s.from,n?-1:1)}function moveByChar(r,e,n,o){let s=r.state.doc.lineAt(e.head),a=r.bidiSpans(s),l=r.textDirectionAt(s.from);for(let c=e,d=null;;){let u=moveVisually(s,a,l,c,n),m=movedOver;if(!u){if(s.number==(n?r.state.doc.lines:1))return c;m=`
`,s=r.state.doc.line(s.number+(n?1:-1)),a=r.bidiSpans(s),u=r.visualLineSide(s,!n)}if(d){if(!d(m))return c}else{if(!o)return u;d=o(m)}c=u}}function byGroup(r,e,n){let o=r.state.charCategorizer(e),s=o(n);return a=>{let l=o(a);return s==CharCategory.Space&&(s=l),s==l}}function moveVertically(r,e,n,o){let s=e.head,a=n?1:-1;if(s==(n?r.state.doc.length:0))return EditorSelection.cursor(s,e.assoc);let l=e.goalColumn,c,d=r.contentDOM.getBoundingClientRect(),u=r.coordsAtPos(s,e.assoc||-1),m=r.documentTop;if(u)l==null&&(l=u.left-d.left),c=a<0?u.top:u.bottom;else{let g=r.viewState.lineBlockAt(s);l==null&&(l=Math.min(d.right-d.left,r.defaultCharacterWidth*(s-g.from))),c=(a<0?g.top:g.bottom)+m}let f=d.left+l,p=o??r.viewState.heightOracle.textHeight>>1;for(let g=0;;g+=10){let y=c+(p+g)*a,b=posAtCoords(r,{x:f,y},!1,a);if(y<d.top||y>d.bottom||(a<0?b<s:b>s)){let k=r.docView.coordsForChar(b),w=!k||y<k.top?-1:1;return EditorSelection.cursor(b,w,void 0,l)}}}function skipAtomicRanges(r,e,n){for(;;){let o=0;for(let s of r)s.between(e-1,e+1,(a,l,c)=>{if(e>a&&e<l){let d=o||n||(e-a<l-e?-1:1);e=d<0?a:l,o=d}});if(!o)return e}}function skipAtoms(r,e,n){let o=skipAtomicRanges(r.state.facet(atomicRanges).map(s=>s(r)),n.from,e.head>n.from?-1:1);return o==n.from?n:EditorSelection.cursor(o,o<n.from?1:-1)}const LineBreakPlaceholder="\uFFFF";class DOMReader{constructor(e,n){this.points=e,this.text="",this.lineSeparator=n.facet(EditorState.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+=LineBreakPlaceholder}readRange(e,n){if(!e)return this;let o=e.parentNode;for(let s=e;;){this.findPointBefore(o,s);let a=this.text.length;this.readNode(s);let l=s.nextSibling;if(l==n)break;let c=ContentView.get(s),d=ContentView.get(l);(c&&d?c.breakAfter:(c?c.breakAfter:isBlockElement(s))||isBlockElement(l)&&(s.nodeName!="BR"||s.cmIgnore)&&this.text.length>a)&&this.lineBreak(),s=l}return this.findPointBefore(o,n),this}readTextNode(e){let n=e.nodeValue;for(let o of this.points)o.node==e&&(o.pos=this.text.length+Math.min(o.offset,n.length));for(let o=0,s=this.lineSeparator?null:/\r\n?|\n/g;;){let a=-1,l=1,c;if(this.lineSeparator?(a=n.indexOf(this.lineSeparator,o),l=this.lineSeparator.length):(c=s.exec(n))&&(a=c.index,l=c[0].length),this.append(n.slice(o,a<0?n.length:a)),a<0)break;if(this.lineBreak(),l>1)for(let d of this.points)d.node==e&&d.pos>this.text.length&&(d.pos-=l-1);o=a+l}}readNode(e){if(e.cmIgnore)return;let n=ContentView.get(e),o=n&&n.overrideDOMText;if(o!=null){this.findPointInside(e,o.length);for(let s=o.iter();!s.next().done;)s.lineBreak?this.lineBreak():this.append(s.value)}else e.nodeType==3?this.readTextNode(e):e.nodeName=="BR"?e.nextSibling&&this.lineBreak():e.nodeType==1&&this.readRange(e.firstChild,null)}findPointBefore(e,n){for(let o of this.points)o.node==e&&e.childNodes[o.offset]==n&&(o.pos=this.text.length)}findPointInside(e,n){for(let o of this.points)(e.nodeType==3?o.node==e:e.contains(o.node))&&(o.pos=this.text.length+(isAtEnd(e,o.node,o.offset)?n:0))}}function isAtEnd(r,e,n){for(;;){if(!e||n<maxOffset(e))return!1;if(e==r)return!0;n=domIndex(e)+1,e=e.parentNode}}class DOMPoint{constructor(e,n){this.node=e,this.offset=n,this.pos=-1}}class DOMChange{constructor(e,n,o,s){this.typeOver=s,this.bounds=null,this.text="",this.domChanged=n>-1;let{impreciseHead:a,impreciseAnchor:l}=e.docView;if(e.state.readOnly&&n>-1)this.newSel=null;else if(n>-1&&(this.bounds=e.docView.domBoundsAround(n,o,0))){let c=a||l?[]:selectionPoints(e),d=new DOMReader(c,e.state);d.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=d.text,this.newSel=selectionFromPoints(c,this.bounds.from)}else{let c=e.observer.selectionRange,d=a&&a.node==c.focusNode&&a.offset==c.focusOffset||!contains$1(e.contentDOM,c.focusNode)?e.state.selection.main.head:e.docView.posFromDOM(c.focusNode,c.focusOffset),u=l&&l.node==c.anchorNode&&l.offset==c.anchorOffset||!contains$1(e.contentDOM,c.anchorNode)?e.state.selection.main.anchor:e.docView.posFromDOM(c.anchorNode,c.anchorOffset),m=e.viewport;if((browser.ios||browser.chrome)&&e.state.selection.main.empty&&d!=u&&(m.from>0||m.to<e.state.doc.length)){let f=Math.min(d,u),p=Math.max(d,u),g=m.from-f,y=m.to-p;(g==0||g==1||f==0)&&(y==0||y==-1||p==e.state.doc.length)&&(d=0,u=e.state.doc.length)}this.newSel=EditorSelection.single(u,d)}}}function applyDOMChange(r,e){let n,{newSel:o}=e,s=r.state.selection.main,a=r.inputState.lastKeyTime>Date.now()-100?r.inputState.lastKeyCode:-1;if(e.bounds){let{from:l,to:c}=e.bounds,d=s.from,u=null;(a===8||browser.android&&e.text.length<c-l)&&(d=s.to,u="end");let m=findDiff(r.state.doc.sliceString(l,c,LineBreakPlaceholder),e.text,d-l,u);m&&(browser.chrome&&a==13&&m.toB==m.from+2&&e.text.slice(m.from,m.toB)==LineBreakPlaceholder+LineBreakPlaceholder&&m.toB--,n={from:l+m.from,to:l+m.toA,insert:Text.of(e.text.slice(m.from,m.toB).split(LineBreakPlaceholder))})}else o&&(!r.hasFocus&&r.state.facet(editable)||o.main.eq(s))&&(o=null);if(!n&&!o)return!1;if(!n&&e.typeOver&&!s.empty&&o&&o.main.empty?n={from:s.from,to:s.to,insert:r.state.doc.slice(s.from,s.to)}:n&&n.from>=s.from&&n.to<=s.to&&(n.from!=s.from||n.to!=s.to)&&s.to-s.from-(n.to-n.from)<=4?n={from:s.from,to:s.to,insert:r.state.doc.slice(s.from,n.from).append(n.insert).append(r.state.doc.slice(n.to,s.to))}:(browser.mac||browser.android)&&n&&n.from==n.to&&n.from==s.head-1&&/^\. ?$/.test(n.insert.toString())&&r.contentDOM.getAttribute("autocorrect")=="off"?(o&&n.insert.length==2&&(o=EditorSelection.single(o.main.anchor-1,o.main.head-1)),n={from:s.from,to:s.to,insert:Text.of([" "])}):browser.chrome&&n&&n.from==n.to&&n.from==s.head&&n.insert.toString()==`
 `&&r.lineWrapping&&(o&&(o=EditorSelection.single(o.main.anchor-1,o.main.head-1)),n={from:s.from,to:s.to,insert:Text.of([" "])}),n)return applyDOMChangeInner(r,n,o,a);if(o&&!o.main.eq(s)){let l=!1,c="select";return r.inputState.lastSelectionTime>Date.now()-50&&(r.inputState.lastSelectionOrigin=="select"&&(l=!0),c=r.inputState.lastSelectionOrigin),r.dispatch({selection:o,scrollIntoView:l,userEvent:c}),!0}else return!1}function applyDOMChangeInner(r,e,n,o=-1){if(browser.ios&&r.inputState.flushIOSKey(e))return!0;let s=r.state.selection.main;if(browser.android&&(e.to==s.to&&(e.from==s.from||e.from==s.from-1&&r.state.sliceDoc(e.from,s.from)==" ")&&e.insert.length==1&&e.insert.lines==2&&dispatchKey(r.contentDOM,"Enter",13)||(e.from==s.from-1&&e.to==s.to&&e.insert.length==0||o==8&&e.insert.length<e.to-e.from&&e.to>s.head)&&dispatchKey(r.contentDOM,"Backspace",8)||e.from==s.from&&e.to==s.to+1&&e.insert.length==0&&dispatchKey(r.contentDOM,"Delete",46)))return!0;let a=e.insert.toString();r.inputState.composing>=0&&r.inputState.composing++;let l,c=()=>l||(l=applyDefaultInsert(r,e,n));return r.state.facet(inputHandler$1).some(d=>d(r,e.from,e.to,a,c))||r.dispatch(c()),!0}function applyDefaultInsert(r,e,n){let o,s=r.state,a=s.selection.main;if(e.from>=a.from&&e.to<=a.to&&e.to-e.from>=(a.to-a.from)/3&&(!n||n.main.empty&&n.main.from==e.from+e.insert.length)&&r.inputState.composing<0){let c=a.from<e.from?s.sliceDoc(a.from,e.from):"",d=a.to>e.to?s.sliceDoc(e.to,a.to):"";o=s.replaceSelection(r.state.toText(c+e.insert.sliceString(0,void 0,r.state.lineBreak)+d))}else{let c=s.changes(e),d=n&&n.main.to<=c.newLength?n.main:void 0;if(s.selection.ranges.length>1&&r.inputState.composing>=0&&e.to<=a.to&&e.to>=a.to-10){let u=r.state.sliceDoc(e.from,e.to),m,f=n&&findCompositionNode(r,n.main.head);if(f){let y=e.insert.length-(e.to-e.from);m={from:f.from,to:f.to-y}}else m=r.state.doc.lineAt(a.head);let p=a.to-e.to,g=a.to-a.from;o=s.changeByRange(y=>{if(y.from==a.from&&y.to==a.to)return{changes:c,range:d||y.map(c)};let b=y.to-p,k=b-u.length;if(y.to-y.from!=g||r.state.sliceDoc(k,b)!=u||y.to>=m.from&&y.from<=m.to)return{range:y};let w=s.changes({from:k,to:b,insert:e.insert}),B=y.to-a.to;return{changes:w,range:d?EditorSelection.range(Math.max(0,d.anchor+B),Math.max(0,d.head+B)):y.map(w)}})}else o={changes:c,selection:d&&s.selection.replaceRange(d)}}let l="input.type";return(r.composing||r.inputState.compositionPendingChange&&r.inputState.compositionEndedAt>Date.now()-50)&&(r.inputState.compositionPendingChange=!1,l+=".compose",r.inputState.compositionFirstChange&&(l+=".start",r.inputState.compositionFirstChange=!1)),s.update(o,{userEvent:l,scrollIntoView:!0})}function findDiff(r,e,n,o){let s=Math.min(r.length,e.length),a=0;for(;a<s&&r.charCodeAt(a)==e.charCodeAt(a);)a++;if(a==s&&r.length==e.length)return null;let l=r.length,c=e.length;for(;l>0&&c>0&&r.charCodeAt(l-1)==e.charCodeAt(c-1);)l--,c--;if(o=="end"){let d=Math.max(0,a-Math.min(l,c));n-=l+d-a}if(l<a&&r.length<e.length){let d=n<=a&&n>=l?a-n:0;a-=d,c=a+(c-l),l=a}else if(c<a){let d=n<=a&&n>=c?a-n:0;a-=d,l=a+(l-c),c=a}return{from:a,toA:l,toB:c}}function selectionPoints(r){let e=[];if(r.root.activeElement!=r.contentDOM)return e;let{anchorNode:n,anchorOffset:o,focusNode:s,focusOffset:a}=r.observer.selectionRange;return n&&(e.push(new DOMPoint(n,o)),(s!=n||a!=o)&&e.push(new DOMPoint(s,a))),e}function selectionFromPoints(r,e){if(r.length==0)return null;let n=r[0].pos,o=r.length==2?r[1].pos:n;return n>-1&&o>-1?EditorSelection.single(n+e,o+e):null}class InputState{setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}constructor(e){this.view=e,this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.pendingIOSKey=void 0,this.tabFocusMode=-1,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastContextMenu=0,this.scrollHandlers=[],this.handlers=Object.create(null),this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.compositionPendingKey=!1,this.compositionPendingChange=!1,this.mouseSelection=null,this.draggedContent=null,this.handleEvent=this.handleEvent.bind(this),this.notifiedFocused=e.hasFocus,browser.safari&&e.contentDOM.addEventListener("input",()=>null),browser.gecko&&firefoxCopyCutHack(e.contentDOM.ownerDocument)}handleEvent(e){!eventBelongsToEditor(this.view,e)||this.ignoreDuringComposition(e)||e.type=="keydown"&&this.keydown(e)||this.runHandlers(e.type,e)}runHandlers(e,n){let o=this.handlers[e];if(o){for(let s of o.observers)s(this.view,n);for(let s of o.handlers){if(n.defaultPrevented)break;if(s(this.view,n)){n.preventDefault();break}}}}ensureHandlers(e){let n=computeHandlers(e),o=this.handlers,s=this.view.contentDOM;for(let a in n)if(a!="scroll"){let l=!n[a].handlers.length,c=o[a];c&&l!=!c.handlers.length&&(s.removeEventListener(a,this.handleEvent),c=null),c||s.addEventListener(a,this.handleEvent,{passive:l})}for(let a in o)a!="scroll"&&!n[a]&&s.removeEventListener(a,this.handleEvent);this.handlers=n}keydown(e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),e.keyCode==9&&this.tabFocusMode>-1&&(!this.tabFocusMode||Date.now()<=this.tabFocusMode))return!0;if(this.tabFocusMode>0&&e.keyCode!=27&&modifierCodes.indexOf(e.keyCode)<0&&(this.tabFocusMode=-1),browser.android&&browser.chrome&&!e.synthetic&&(e.keyCode==13||e.keyCode==8))return this.view.observer.delayAndroidKey(e.key,e.keyCode),!0;let n;return browser.ios&&!e.synthetic&&!e.altKey&&!e.metaKey&&((n=PendingKeys.find(o=>o.keyCode==e.keyCode))&&!e.ctrlKey||EmacsyPendingKeys.indexOf(e.key)>-1&&e.ctrlKey&&!e.shiftKey)?(this.pendingIOSKey=n||e,setTimeout(()=>this.flushIOSKey(),250),!0):(e.keyCode!=229&&this.view.observer.forceFlush(),!1)}flushIOSKey(e){let n=this.pendingIOSKey;return!n||n.key=="Enter"&&e&&e.from<e.to&&/^\S+$/.test(e.insert.toString())?!1:(this.pendingIOSKey=void 0,dispatchKey(this.view.contentDOM,n.key,n.keyCode,n instanceof KeyboardEvent?n:void 0))}ignoreDuringComposition(e){return/^key/.test(e.type)?this.composing>0?!0:browser.safari&&!browser.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100?(this.compositionPendingKey=!1,!0):!1:!1}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.view.observer.update(e),this.mouseSelection&&this.mouseSelection.update(e),this.draggedContent&&e.docChanged&&(this.draggedContent=this.draggedContent.map(e.changes)),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}function bindHandler(r,e){return(n,o)=>{try{return e.call(r,o,n)}catch(s){logException(n.state,s)}}}function computeHandlers(r){let e=Object.create(null);function n(o){return e[o]||(e[o]={observers:[],handlers:[]})}for(let o of r){let s=o.spec;if(s&&s.domEventHandlers)for(let a in s.domEventHandlers){let l=s.domEventHandlers[a];l&&n(a).handlers.push(bindHandler(o.value,l))}if(s&&s.domEventObservers)for(let a in s.domEventObservers){let l=s.domEventObservers[a];l&&n(a).observers.push(bindHandler(o.value,l))}}for(let o in handlers)n(o).handlers.push(handlers[o]);for(let o in observers)n(o).observers.push(observers[o]);return e}const PendingKeys=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Enter",keyCode:13,inputType:"insertLineBreak"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],EmacsyPendingKeys="dthko",modifierCodes=[16,17,18,20,91,92,224,225],dragScrollMargin=6;function dragScrollSpeed(r){return Math.max(0,r)*.7+8}function dist(r,e){return Math.max(Math.abs(r.clientX-e.clientX),Math.abs(r.clientY-e.clientY))}class MouseSelection{constructor(e,n,o,s){this.view=e,this.startEvent=n,this.style=o,this.mustSelect=s,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=n,this.scrollParents=scrollableParents(e.contentDOM),this.atoms=e.state.facet(atomicRanges).map(l=>l(e));let a=e.contentDOM.ownerDocument;a.addEventListener("mousemove",this.move=this.move.bind(this)),a.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=n.shiftKey,this.multiple=e.state.facet(EditorState.allowMultipleSelections)&&addsSelectionRange(e,n),this.dragging=isInPrimarySelection(e,n)&&getClickType(n)==1?null:!1}start(e){this.dragging===!1&&this.select(e)}move(e){if(e.buttons==0)return this.destroy();if(this.dragging||this.dragging==null&&dist(this.startEvent,e)<10)return;this.select(this.lastEvent=e);let n=0,o=0,s=0,a=0,l=this.view.win.innerWidth,c=this.view.win.innerHeight;this.scrollParents.x&&({left:s,right:l}=this.scrollParents.x.getBoundingClientRect()),this.scrollParents.y&&({top:a,bottom:c}=this.scrollParents.y.getBoundingClientRect());let d=getScrollMargins(this.view);e.clientX-d.left<=s+dragScrollMargin?n=-dragScrollSpeed(s-e.clientX):e.clientX+d.right>=l-dragScrollMargin&&(n=dragScrollSpeed(e.clientX-l)),e.clientY-d.top<=a+dragScrollMargin?o=-dragScrollSpeed(a-e.clientY):e.clientY+d.bottom>=c-dragScrollMargin&&(o=dragScrollSpeed(e.clientY-c)),this.setScrollSpeed(n,o)}up(e){this.dragging==null&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=this.view.inputState.draggedContent=null}setScrollSpeed(e,n){this.scrollSpeed={x:e,y:n},e||n?this.scrolling<0&&(this.scrolling=setInterval(()=>this.scroll(),50)):this.scrolling>-1&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){let{x:e,y:n}=this.scrollSpeed;e&&this.scrollParents.x&&(this.scrollParents.x.scrollLeft+=e,e=0),n&&this.scrollParents.y&&(this.scrollParents.y.scrollTop+=n,n=0),(e||n)&&this.view.win.scrollBy(e,n),this.dragging===!1&&this.select(this.lastEvent)}skipAtoms(e){let n=null;for(let o=0;o<e.ranges.length;o++){let s=e.ranges[o],a=null;if(s.empty){let l=skipAtomicRanges(this.atoms,s.from,0);l!=s.from&&(a=EditorSelection.cursor(l,-1))}else{let l=skipAtomicRanges(this.atoms,s.from,-1),c=skipAtomicRanges(this.atoms,s.to,1);(l!=s.from||c!=s.to)&&(a=EditorSelection.range(s.from==s.anchor?l:c,s.from==s.head?l:c))}a&&(n||(n=e.ranges.slice()),n[o]=a)}return n?EditorSelection.create(n,e.mainIndex):e}select(e){let{view:n}=this,o=this.skipAtoms(this.style.get(e,this.extend,this.multiple));(this.mustSelect||!o.eq(n.state.selection,this.dragging===!1))&&this.view.dispatch({selection:o,userEvent:"select.pointer"}),this.mustSelect=!1}update(e){e.transactions.some(n=>n.isUserEvent("input.type"))?this.destroy():this.style.update(e)&&setTimeout(()=>this.select(this.lastEvent),20)}}function addsSelectionRange(r,e){let n=r.state.facet(clickAddsSelectionRange);return n.length?n[0](e):browser.mac?e.metaKey:e.ctrlKey}function dragMovesSelection(r,e){let n=r.state.facet(dragMovesSelection$1);return n.length?n[0](e):browser.mac?!e.altKey:!e.ctrlKey}function isInPrimarySelection(r,e){let{main:n}=r.state.selection;if(n.empty)return!1;let o=getSelection$1(r.root);if(!o||o.rangeCount==0)return!0;let s=o.getRangeAt(0).getClientRects();for(let a=0;a<s.length;a++){let l=s[a];if(l.left<=e.clientX&&l.right>=e.clientX&&l.top<=e.clientY&&l.bottom>=e.clientY)return!0}return!1}function eventBelongsToEditor(r,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let n=e.target,o;n!=r.contentDOM;n=n.parentNode)if(!n||n.nodeType==11||(o=ContentView.get(n))&&o.ignoreEvent(e))return!1;return!0}const handlers=Object.create(null),observers=Object.create(null),brokenClipboardAPI=browser.ie&&browser.ie_version<15||browser.ios&&browser.webkit_version<604;function capturePaste(r){let e=r.dom.parentNode;if(!e)return;let n=e.appendChild(document.createElement("textarea"));n.style.cssText="position: fixed; left: -10000px; top: 10px",n.focus(),setTimeout(()=>{r.focus(),n.remove(),doPaste(r,n.value)},50)}function textFilter(r,e,n){for(let o of r.facet(e))n=o(n,r);return n}function doPaste(r,e){e=textFilter(r.state,clipboardInputFilter,e);let{state:n}=r,o,s=1,a=n.toText(e),l=a.lines==n.selection.ranges.length;if(lastLinewiseCopy!=null&&n.selection.ranges.every(c=>c.empty)&&lastLinewiseCopy==a.toString()){let c=-1;o=n.changeByRange(d=>{let u=n.doc.lineAt(d.from);if(u.from==c)return{range:d};c=u.from;let m=n.toText((l?a.line(s++).text:e)+n.lineBreak);return{changes:{from:u.from,insert:m},range:EditorSelection.cursor(d.from+m.length)}})}else l?o=n.changeByRange(c=>{let d=a.line(s++);return{changes:{from:c.from,to:c.to,insert:d.text},range:EditorSelection.cursor(c.from+d.length)}}):o=n.replaceSelection(a);r.dispatch(o,{userEvent:"input.paste",scrollIntoView:!0})}observers.scroll=r=>{r.inputState.lastScrollTop=r.scrollDOM.scrollTop,r.inputState.lastScrollLeft=r.scrollDOM.scrollLeft},handlers.keydown=(r,e)=>(r.inputState.setSelectionOrigin("select"),e.keyCode==27&&r.inputState.tabFocusMode!=0&&(r.inputState.tabFocusMode=Date.now()+2e3),!1),observers.touchstart=(r,e)=>{r.inputState.lastTouchTime=Date.now(),r.inputState.setSelectionOrigin("select.pointer")},observers.touchmove=r=>{r.inputState.setSelectionOrigin("select.pointer")},handlers.mousedown=(r,e)=>{if(r.observer.flush(),r.inputState.lastTouchTime>Date.now()-2e3)return!1;let n=null;for(let o of r.state.facet(mouseSelectionStyle))if(n=o(r,e),n)break;if(!n&&e.button==0&&(n=basicMouseSelection(r,e)),n){let o=!r.hasFocus;r.inputState.startMouseSelection(new MouseSelection(r,e,n,o)),o&&r.observer.ignore(()=>{focusPreventScroll(r.contentDOM);let a=r.root.activeElement;a&&!a.contains(r.contentDOM)&&a.blur()});let s=r.inputState.mouseSelection;if(s)return s.start(e),s.dragging===!1}return!1};function rangeForClick(r,e,n,o){if(o==1)return EditorSelection.cursor(e,n);if(o==2)return groupAt(r.state,e,n);{let s=LineView.find(r.docView,e),a=r.state.doc.lineAt(s?s.posAtEnd:e),l=s?s.posAtStart:a.from,c=s?s.posAtEnd:a.to;return c<r.state.doc.length&&c==a.to&&c++,EditorSelection.range(l,c)}}let inside=(r,e,n)=>e>=n.top&&e<=n.bottom&&r>=n.left&&r<=n.right;function findPositionSide(r,e,n,o){let s=LineView.find(r.docView,e);if(!s)return 1;let a=e-s.posAtStart;if(a==0)return 1;if(a==s.length)return-1;let l=s.coordsAt(a,-1);if(l&&inside(n,o,l))return-1;let c=s.coordsAt(a,1);return c&&inside(n,o,c)?1:l&&l.bottom>=o?-1:1}function queryPos(r,e){let n=r.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:n,bias:findPositionSide(r,n,e.clientX,e.clientY)}}const BadMouseDetail=browser.ie&&browser.ie_version<=11;let lastMouseDown=null,lastMouseDownCount=0,lastMouseDownTime=0;function getClickType(r){if(!BadMouseDetail)return r.detail;let e=lastMouseDown,n=lastMouseDownTime;return lastMouseDown=r,lastMouseDownTime=Date.now(),lastMouseDownCount=!e||n>Date.now()-400&&Math.abs(e.clientX-r.clientX)<2&&Math.abs(e.clientY-r.clientY)<2?(lastMouseDownCount+1)%3:1}function basicMouseSelection(r,e){let n=queryPos(r,e),o=getClickType(e),s=r.state.selection;return{update(a){a.docChanged&&(n.pos=a.changes.mapPos(n.pos),s=s.map(a.changes))},get(a,l,c){let d=queryPos(r,a),u,m=rangeForClick(r,d.pos,d.bias,o);if(n.pos!=d.pos&&!l){let f=rangeForClick(r,n.pos,n.bias,o),p=Math.min(f.from,m.from),g=Math.max(f.to,m.to);m=p<m.from?EditorSelection.range(p,g):EditorSelection.range(g,p)}return l?s.replaceRange(s.main.extend(m.from,m.to)):c&&o==1&&s.ranges.length>1&&(u=removeRangeAround(s,d.pos))?u:c?s.addRange(m):EditorSelection.create([m])}}}function removeRangeAround(r,e){for(let n=0;n<r.ranges.length;n++){let{from:o,to:s}=r.ranges[n];if(o<=e&&s>=e)return EditorSelection.create(r.ranges.slice(0,n).concat(r.ranges.slice(n+1)),r.mainIndex==n?0:r.mainIndex-(r.mainIndex>n?1:0))}return null}handlers.dragstart=(r,e)=>{let{selection:{main:n}}=r.state;if(e.target.draggable){let s=r.docView.nearest(e.target);if(s&&s.isWidget){let a=s.posAtStart,l=a+s.length;(a>=n.to||l<=n.from)&&(n=EditorSelection.range(a,l))}}let{inputState:o}=r;return o.mouseSelection&&(o.mouseSelection.dragging=!0),o.draggedContent=n,e.dataTransfer&&(e.dataTransfer.setData("Text",textFilter(r.state,clipboardOutputFilter,r.state.sliceDoc(n.from,n.to))),e.dataTransfer.effectAllowed="copyMove"),!1},handlers.dragend=r=>(r.inputState.draggedContent=null,!1);function dropText(r,e,n,o){if(n=textFilter(r.state,clipboardInputFilter,n),!n)return;let s=r.posAtCoords({x:e.clientX,y:e.clientY},!1),{draggedContent:a}=r.inputState,l=o&&a&&dragMovesSelection(r,e)?{from:a.from,to:a.to}:null,c={from:s,insert:n},d=r.state.changes(l?[l,c]:c);r.focus(),r.dispatch({changes:d,selection:{anchor:d.mapPos(s,-1),head:d.mapPos(s,1)},userEvent:l?"move.drop":"input.drop"}),r.inputState.draggedContent=null}handlers.drop=(r,e)=>{if(!e.dataTransfer)return!1;if(r.state.readOnly)return!0;let n=e.dataTransfer.files;if(n&&n.length){let o=Array(n.length),s=0,a=()=>{++s==n.length&&dropText(r,e,o.filter(l=>l!=null).join(r.state.lineBreak),!1)};for(let l=0;l<n.length;l++){let c=new FileReader;c.onerror=a,c.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(c.result)||(o[l]=c.result),a()},c.readAsText(n[l])}return!0}else{let o=e.dataTransfer.getData("Text");if(o)return dropText(r,e,o,!0),!0}return!1},handlers.paste=(r,e)=>{if(r.state.readOnly)return!0;r.observer.flush();let n=brokenClipboardAPI?null:e.clipboardData;return n?(doPaste(r,n.getData("text/plain")||n.getData("text/uri-list")),!0):(capturePaste(r),!1)};function captureCopy(r,e){let n=r.dom.parentNode;if(!n)return;let o=n.appendChild(document.createElement("textarea"));o.style.cssText="position: fixed; left: -10000px; top: 10px",o.value=e,o.focus(),o.selectionEnd=e.length,o.selectionStart=0,setTimeout(()=>{o.remove(),r.focus()},50)}function copiedRange(r){let e=[],n=[],o=!1;for(let s of r.selection.ranges)s.empty||(e.push(r.sliceDoc(s.from,s.to)),n.push(s));if(!e.length){let s=-1;for(let{from:a}of r.selection.ranges){let l=r.doc.lineAt(a);l.number>s&&(e.push(l.text),n.push({from:l.from,to:Math.min(r.doc.length,l.to+1)})),s=l.number}o=!0}return{text:textFilter(r,clipboardOutputFilter,e.join(r.lineBreak)),ranges:n,linewise:o}}let lastLinewiseCopy=null;handlers.copy=handlers.cut=(r,e)=>{let{text:n,ranges:o,linewise:s}=copiedRange(r.state);if(!n&&!s)return!1;lastLinewiseCopy=s?n:null,e.type=="cut"&&!r.state.readOnly&&r.dispatch({changes:o,scrollIntoView:!0,userEvent:"delete.cut"});let a=brokenClipboardAPI?null:e.clipboardData;return a?(a.clearData(),a.setData("text/plain",n),!0):(captureCopy(r,n),!1)};const isFocusChange=Annotation.define();function focusChangeTransaction(r,e){let n=[];for(let o of r.facet(focusChangeEffect)){let s=o(r,e);s&&n.push(s)}return n?r.update({effects:n,annotations:isFocusChange.of(!0)}):null}function updateForFocusChange(r){setTimeout(()=>{let e=r.hasFocus;if(e!=r.inputState.notifiedFocused){let n=focusChangeTransaction(r.state,e);n?r.dispatch(n):r.update([])}},10)}observers.focus=r=>{r.inputState.lastFocusTime=Date.now(),!r.scrollDOM.scrollTop&&(r.inputState.lastScrollTop||r.inputState.lastScrollLeft)&&(r.scrollDOM.scrollTop=r.inputState.lastScrollTop,r.scrollDOM.scrollLeft=r.inputState.lastScrollLeft),updateForFocusChange(r)},observers.blur=r=>{r.observer.clearSelectionRange(),updateForFocusChange(r)},observers.compositionstart=observers.compositionupdate=r=>{r.observer.editContext||(r.inputState.compositionFirstChange==null&&(r.inputState.compositionFirstChange=!0),r.inputState.composing<0&&(r.inputState.composing=0))},observers.compositionend=r=>{r.observer.editContext||(r.inputState.composing=-1,r.inputState.compositionEndedAt=Date.now(),r.inputState.compositionPendingKey=!0,r.inputState.compositionPendingChange=r.observer.pendingRecords().length>0,r.inputState.compositionFirstChange=null,browser.chrome&&browser.android?r.observer.flushSoon():r.inputState.compositionPendingChange?Promise.resolve().then(()=>r.observer.flush()):setTimeout(()=>{r.inputState.composing<0&&r.docView.hasComposition&&r.update([])},50))},observers.contextmenu=r=>{r.inputState.lastContextMenu=Date.now()},handlers.beforeinput=(r,e)=>{var n,o;if(e.inputType=="insertReplacementText"&&r.observer.editContext){let a=(n=e.dataTransfer)===null||n===void 0?void 0:n.getData("text/plain"),l=e.getTargetRanges();if(a&&l.length){let c=l[0],d=r.posAtDOM(c.startContainer,c.startOffset),u=r.posAtDOM(c.endContainer,c.endOffset);return applyDOMChangeInner(r,{from:d,to:u,insert:r.state.toText(a)},null),!0}}let s;if(browser.chrome&&browser.android&&(s=PendingKeys.find(a=>a.inputType==e.inputType))&&(r.observer.delayAndroidKey(s.key,s.keyCode),s.key=="Backspace"||s.key=="Delete")){let a=((o=window.visualViewport)===null||o===void 0?void 0:o.height)||0;setTimeout(()=>{var l;(((l=window.visualViewport)===null||l===void 0?void 0:l.height)||0)>a+10&&r.hasFocus&&(r.contentDOM.blur(),r.focus())},100)}return browser.ios&&e.inputType=="deleteContentForward"&&r.observer.flushSoon(),browser.safari&&e.inputType=="insertText"&&r.inputState.composing>=0&&setTimeout(()=>observers.compositionend(r,e),20),!1};const appliedFirefoxHack=new Set;function firefoxCopyCutHack(r){appliedFirefoxHack.has(r)||(appliedFirefoxHack.add(r),r.addEventListener("copy",()=>{}),r.addEventListener("cut",()=>{}))}const wrappingWhiteSpace=["pre-wrap","normal","pre-line","break-spaces"];let heightChangeFlag=!1;function clearHeightChangeFlag(){heightChangeFlag=!1}class HeightOracle{constructor(e){this.lineWrapping=e,this.doc=Text.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.textHeight=14,this.lineLength=30}heightForGap(e,n){let o=this.doc.lineAt(n).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(o+=Math.max(0,Math.ceil((n-e-o*this.lineLength*.5)/this.lineLength))),this.lineHeight*o}heightForLine(e){return this.lineWrapping?(1+Math.max(0,Math.ceil((e-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForWrapping(e){return wrappingWhiteSpace.indexOf(e)>-1!=this.lineWrapping}mustRefreshForHeights(e){let n=!1;for(let o=0;o<e.length;o++){let s=e[o];s<0?o++:this.heightSamples[Math.floor(s*10)]||(n=!0,this.heightSamples[Math.floor(s*10)]=!0)}return n}refresh(e,n,o,s,a,l){let c=wrappingWhiteSpace.indexOf(e)>-1,d=Math.round(n)!=Math.round(this.lineHeight)||this.lineWrapping!=c;if(this.lineWrapping=c,this.lineHeight=n,this.charWidth=o,this.textHeight=s,this.lineLength=a,d){this.heightSamples={};for(let u=0;u<l.length;u++){let m=l[u];m<0?u++:this.heightSamples[Math.floor(m*10)]=!0}}return d}}class MeasuredHeights{constructor(e,n){this.from=e,this.heights=n,this.index=0}get more(){return this.index<this.heights.length}}class BlockInfo{constructor(e,n,o,s,a){this.from=e,this.length=n,this.top=o,this.height=s,this._content=a}get type(){return typeof this._content=="number"?BlockType.Text:Array.isArray(this._content)?this._content:this._content.type}get to(){return this.from+this.length}get bottom(){return this.top+this.height}get widget(){return this._content instanceof PointDecoration?this._content.widget:null}get widgetLineBreaks(){return typeof this._content=="number"?this._content:0}join(e){let n=(Array.isArray(this._content)?this._content:[this]).concat(Array.isArray(e._content)?e._content:[e]);return new BlockInfo(this.from,this.length+e.length,this.top,this.height+e.height,n)}}var QueryType=function(r){return r[r.ByPos=0]="ByPos",r[r.ByHeight=1]="ByHeight",r[r.ByPosNoHeight=2]="ByPosNoHeight",r}(QueryType||(QueryType={}));const Epsilon=.001;class HeightMap{constructor(e,n,o=2){this.length=e,this.height=n,this.flags=o}get outdated(){return(this.flags&2)>0}set outdated(e){this.flags=(e?2:0)|this.flags&-3}setHeight(e){this.height!=e&&(Math.abs(this.height-e)>Epsilon&&(heightChangeFlag=!0),this.height=e)}replace(e,n,o){return HeightMap.of(o)}decomposeLeft(e,n){n.push(this)}decomposeRight(e,n){n.push(this)}applyChanges(e,n,o,s){let a=this,l=o.doc;for(let c=s.length-1;c>=0;c--){let{fromA:d,toA:u,fromB:m,toB:f}=s[c],p=a.lineAt(d,QueryType.ByPosNoHeight,o.setDoc(n),0,0),g=p.to>=u?p:a.lineAt(u,QueryType.ByPosNoHeight,o,0,0);for(f+=g.to-u,u=g.to;c>0&&p.from<=s[c-1].toA;)d=s[c-1].fromA,m=s[c-1].fromB,c--,d<p.from&&(p=a.lineAt(d,QueryType.ByPosNoHeight,o,0,0));m+=p.from-d,d=p.from;let y=NodeBuilder.build(o.setDoc(l),e,m,f);a=replace$1(a,a.replace(d,u,y))}return a.updateHeight(o,0)}static empty(){return new HeightMapText(0,0)}static of(e){if(e.length==1)return e[0];let n=0,o=e.length,s=0,a=0;for(;;)if(n==o)if(s>a*2){let c=e[n-1];c.break?e.splice(--n,1,c.left,null,c.right):e.splice(--n,1,c.left,c.right),o+=1+c.break,s-=c.size}else if(a>s*2){let c=e[o];c.break?e.splice(o,1,c.left,null,c.right):e.splice(o,1,c.left,c.right),o+=2+c.break,a-=c.size}else break;else if(s<a){let c=e[n++];c&&(s+=c.size)}else{let c=e[--o];c&&(a+=c.size)}let l=0;return e[n-1]==null?(l=1,n--):e[n]==null&&(l=1,o++),new HeightMapBranch(HeightMap.of(e.slice(0,n)),l,HeightMap.of(e.slice(o)))}}function replace$1(r,e){return r==e?r:(r.constructor!=e.constructor&&(heightChangeFlag=!0),e)}HeightMap.prototype.size=1;class HeightMapBlock extends HeightMap{constructor(e,n,o){super(e,n),this.deco=o}blockAt(e,n,o,s){return new BlockInfo(s,this.length,o,this.height,this.deco||0)}lineAt(e,n,o,s,a){return this.blockAt(0,o,s,a)}forEachLine(e,n,o,s,a,l){e<=a+this.length&&n>=a&&l(this.blockAt(0,o,s,a))}updateHeight(e,n=0,o=!1,s){return s&&s.from<=n&&s.more&&this.setHeight(s.heights[s.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class HeightMapText extends HeightMapBlock{constructor(e,n){super(e,n,null),this.collapsed=0,this.widgetHeight=0,this.breaks=0}blockAt(e,n,o,s){return new BlockInfo(s,this.length,o,this.height,this.breaks)}replace(e,n,o){let s=o[0];return o.length==1&&(s instanceof HeightMapText||s instanceof HeightMapGap&&s.flags&4)&&Math.abs(this.length-s.length)<10?(s instanceof HeightMapGap?s=new HeightMapText(s.length,this.height):s.height=this.height,this.outdated||(s.outdated=!1),s):HeightMap.of(o)}updateHeight(e,n=0,o=!1,s){return s&&s.from<=n&&s.more?this.setHeight(s.heights[s.index++]):(o||this.outdated)&&this.setHeight(Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))+this.breaks*e.lineHeight),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class HeightMapGap extends HeightMap{constructor(e){super(e,0)}heightMetrics(e,n){let o=e.doc.lineAt(n).number,s=e.doc.lineAt(n+this.length).number,a=s-o+1,l,c=0;if(e.lineWrapping){let d=Math.min(this.height,e.lineHeight*a);l=d/a,this.length>a+1&&(c=(this.height-d)/(this.length-a-1))}else l=this.height/a;return{firstLine:o,lastLine:s,perLine:l,perChar:c}}blockAt(e,n,o,s){let{firstLine:a,lastLine:l,perLine:c,perChar:d}=this.heightMetrics(n,s);if(n.lineWrapping){let u=s+(e<n.lineHeight?0:Math.round(Math.max(0,Math.min(1,(e-o)/this.height))*this.length)),m=n.doc.lineAt(u),f=c+m.length*d,p=Math.max(o,e-f/2);return new BlockInfo(m.from,m.length,p,f,0)}else{let u=Math.max(0,Math.min(l-a,Math.floor((e-o)/c))),{from:m,length:f}=n.doc.line(a+u);return new BlockInfo(m,f,o+c*u,c,0)}}lineAt(e,n,o,s,a){if(n==QueryType.ByHeight)return this.blockAt(e,o,s,a);if(n==QueryType.ByPosNoHeight){let{from:g,to:y}=o.doc.lineAt(e);return new BlockInfo(g,y-g,0,0,0)}let{firstLine:l,perLine:c,perChar:d}=this.heightMetrics(o,a),u=o.doc.lineAt(e),m=c+u.length*d,f=u.number-l,p=s+c*f+d*(u.from-a-f);return new BlockInfo(u.from,u.length,Math.max(s,Math.min(p,s+this.height-m)),m,0)}forEachLine(e,n,o,s,a,l){e=Math.max(e,a),n=Math.min(n,a+this.length);let{firstLine:c,perLine:d,perChar:u}=this.heightMetrics(o,a);for(let m=e,f=s;m<=n;){let p=o.doc.lineAt(m);if(m==e){let y=p.number-c;f+=d*y+u*(e-a-y)}let g=d+u*p.length;l(new BlockInfo(p.from,p.length,f,g,0)),f+=g,m=p.to+1}}replace(e,n,o){let s=this.length-n;if(s>0){let a=o[o.length-1];a instanceof HeightMapGap?o[o.length-1]=new HeightMapGap(a.length+s):o.push(null,new HeightMapGap(s-1))}if(e>0){let a=o[0];a instanceof HeightMapGap?o[0]=new HeightMapGap(e+a.length):o.unshift(new HeightMapGap(e-1),null)}return HeightMap.of(o)}decomposeLeft(e,n){n.push(new HeightMapGap(e-1),null)}decomposeRight(e,n){n.push(null,new HeightMapGap(this.length-e-1))}updateHeight(e,n=0,o=!1,s){let a=n+this.length;if(s&&s.from<=n+this.length&&s.more){let l=[],c=Math.max(n,s.from),d=-1;for(s.from>n&&l.push(new HeightMapGap(s.from-n-1).updateHeight(e,n));c<=a&&s.more;){let m=e.doc.lineAt(c).length;l.length&&l.push(null);let f=s.heights[s.index++];d==-1?d=f:Math.abs(f-d)>=Epsilon&&(d=-2);let p=new HeightMapText(m,f);p.outdated=!1,l.push(p),c+=m+1}c<=a&&l.push(null,new HeightMapGap(a-c).updateHeight(e,c));let u=HeightMap.of(l);return(d<0||Math.abs(u.height-this.height)>=Epsilon||Math.abs(d-this.heightMetrics(e,n).perLine)>=Epsilon)&&(heightChangeFlag=!0),replace$1(this,u)}else(o||this.outdated)&&(this.setHeight(e.heightForGap(n,n+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}}class HeightMapBranch extends HeightMap{constructor(e,n,o){super(e.length+n+o.length,e.height+o.height,n|(e.outdated||o.outdated?2:0)),this.left=e,this.right=o,this.size=e.size+o.size}get break(){return this.flags&1}blockAt(e,n,o,s){let a=o+this.left.height;return e<a?this.left.blockAt(e,n,o,s):this.right.blockAt(e,n,a,s+this.left.length+this.break)}lineAt(e,n,o,s,a){let l=s+this.left.height,c=a+this.left.length+this.break,d=n==QueryType.ByHeight?e<l:e<c,u=d?this.left.lineAt(e,n,o,s,a):this.right.lineAt(e,n,o,l,c);if(this.break||(d?u.to<c:u.from>c))return u;let m=n==QueryType.ByPosNoHeight?QueryType.ByPosNoHeight:QueryType.ByPos;return d?u.join(this.right.lineAt(c,m,o,l,c)):this.left.lineAt(c,m,o,s,a).join(u)}forEachLine(e,n,o,s,a,l){let c=s+this.left.height,d=a+this.left.length+this.break;if(this.break)e<d&&this.left.forEachLine(e,n,o,s,a,l),n>=d&&this.right.forEachLine(e,n,o,c,d,l);else{let u=this.lineAt(d,QueryType.ByPos,o,s,a);e<u.from&&this.left.forEachLine(e,u.from-1,o,s,a,l),u.to>=e&&u.from<=n&&l(u),n>u.to&&this.right.forEachLine(u.to+1,n,o,c,d,l)}}replace(e,n,o){let s=this.left.length+this.break;if(n<s)return this.balanced(this.left.replace(e,n,o),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-s,n-s,o));let a=[];e>0&&this.decomposeLeft(e,a);let l=a.length;for(let c of o)a.push(c);if(e>0&&mergeGaps(a,l-1),n<this.length){let c=a.length;this.decomposeRight(n,a),mergeGaps(a,c)}return HeightMap.of(a)}decomposeLeft(e,n){let o=this.left.length;if(e<=o)return this.left.decomposeLeft(e,n);n.push(this.left),this.break&&(o++,e>=o&&n.push(null)),e>o&&this.right.decomposeLeft(e-o,n)}decomposeRight(e,n){let o=this.left.length,s=o+this.break;if(e>=s)return this.right.decomposeRight(e-s,n);e<o&&this.left.decomposeRight(e,n),this.break&&e<s&&n.push(null),n.push(this.right)}balanced(e,n){return e.size>2*n.size||n.size>2*e.size?HeightMap.of(this.break?[e,null,n]:[e,n]):(this.left=replace$1(this.left,e),this.right=replace$1(this.right,n),this.setHeight(e.height+n.height),this.outdated=e.outdated||n.outdated,this.size=e.size+n.size,this.length=e.length+this.break+n.length,this)}updateHeight(e,n=0,o=!1,s){let{left:a,right:l}=this,c=n+a.length+this.break,d=null;return s&&s.from<=n+a.length&&s.more?d=a=a.updateHeight(e,n,o,s):a.updateHeight(e,n,o),s&&s.from<=c+l.length&&s.more?d=l=l.updateHeight(e,c,o,s):l.updateHeight(e,c,o),d?this.balanced(a,l):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function mergeGaps(r,e){let n,o;r[e]==null&&(n=r[e-1])instanceof HeightMapGap&&(o=r[e+1])instanceof HeightMapGap&&r.splice(e-1,3,new HeightMapGap(n.length+1+o.length))}const relevantWidgetHeight=5;class NodeBuilder{constructor(e,n){this.pos=e,this.oracle=n,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,n){if(this.lineStart>-1){let o=Math.min(n,this.lineEnd),s=this.nodes[this.nodes.length-1];s instanceof HeightMapText?s.length+=o-this.pos:(o>this.pos||!this.isCovered)&&this.nodes.push(new HeightMapText(o-this.pos,-1)),this.writtenTo=o,n>o&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=n}point(e,n,o){if(e<n||o.heightRelevant){let s=o.widget?o.widget.estimatedHeight:0,a=o.widget?o.widget.lineBreaks:0;s<0&&(s=this.oracle.lineHeight);let l=n-e;o.block?this.addBlock(new HeightMapBlock(l,s,o)):(l||a||s>=relevantWidgetHeight)&&this.addLineDeco(s,a,l)}else n>e&&this.span(e,n);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:n}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=n,this.writtenTo<e&&((this.writtenTo<e-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new HeightMapText(this.pos-e,-1)),this.writtenTo=this.pos}blankContent(e,n){let o=new HeightMapGap(n-e);return this.oracle.doc.lineAt(e).to==n&&(o.flags|=4),o}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof HeightMapText)return e;let n=new HeightMapText(0,-1);return this.nodes.push(n),n}addBlock(e){this.enterLine();let n=e.deco;n&&n.startSide>0&&!this.isCovered&&this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,n&&n.endSide>0&&(this.covering=e)}addLineDeco(e,n,o){let s=this.ensureLine();s.length+=o,s.collapsed+=o,s.widgetHeight=Math.max(s.widgetHeight,e),s.breaks+=n,this.writtenTo=this.pos=this.pos+o}finish(e){let n=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(n instanceof HeightMapText)&&!this.isCovered?this.nodes.push(new HeightMapText(0,-1)):(this.writtenTo<this.pos||n==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let o=e;for(let s of this.nodes)s instanceof HeightMapText&&s.updateHeight(this.oracle,o),o+=s?s.length:1;return this.nodes}static build(e,n,o,s){let a=new NodeBuilder(o,e);return RangeSet.spans(n,o,s,a,0),a.finish(o)}}function heightRelevantDecoChanges(r,e,n){let o=new DecorationComparator;return RangeSet.compare(r,e,n,o,0),o.changes}class DecorationComparator{constructor(){this.changes=[]}compareRange(){}comparePoint(e,n,o,s){(e<n||o&&o.heightRelevant||s&&s.heightRelevant)&&addRange(e,n,this.changes,5)}}function visiblePixelRange(r,e){let n=r.getBoundingClientRect(),o=r.ownerDocument,s=o.defaultView||window,a=Math.max(0,n.left),l=Math.min(s.innerWidth,n.right),c=Math.max(0,n.top),d=Math.min(s.innerHeight,n.bottom);for(let u=r.parentNode;u&&u!=o.body;)if(u.nodeType==1){let m=u,f=window.getComputedStyle(m);if((m.scrollHeight>m.clientHeight||m.scrollWidth>m.clientWidth)&&f.overflow!="visible"){let p=m.getBoundingClientRect();a=Math.max(a,p.left),l=Math.min(l,p.right),c=Math.max(c,p.top),d=Math.min(u==r.parentNode?s.innerHeight:d,p.bottom)}u=f.position=="absolute"||f.position=="fixed"?m.offsetParent:m.parentNode}else if(u.nodeType==11)u=u.host;else break;return{left:a-n.left,right:Math.max(a,l)-n.left,top:c-(n.top+e),bottom:Math.max(c,d)-(n.top+e)}}function fullPixelRange(r,e){let n=r.getBoundingClientRect();return{left:0,right:n.right-n.left,top:e,bottom:n.bottom-(n.top+e)}}class LineGap{constructor(e,n,o,s){this.from=e,this.to=n,this.size=o,this.displaySize=s}static same(e,n){if(e.length!=n.length)return!1;for(let o=0;o<e.length;o++){let s=e[o],a=n[o];if(s.from!=a.from||s.to!=a.to||s.size!=a.size)return!1}return!0}draw(e,n){return Decoration.replace({widget:new LineGapWidget(this.displaySize*(n?e.scaleY:e.scaleX),n)}).range(this.from,this.to)}}class LineGapWidget extends WidgetType{constructor(e,n){super(),this.size=e,this.vertical=n}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}}class ViewState{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scrollTop=0,this.scrolledToBottom=!1,this.scaleX=1,this.scaleY=1,this.scrollAnchorPos=0,this.scrollAnchorHeight=-1,this.scaler=IdScaler,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=Direction.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let n=e.facet(contentAttributes).some(o=>typeof o!="function"&&o.class=="cm-lineWrapping");this.heightOracle=new HeightOracle(n),this.stateDeco=e.facet(decorations).filter(o=>typeof o!="function"),this.heightMap=HeightMap.empty().applyChanges(this.stateDeco,Text.empty,this.heightOracle.setDoc(e.doc),[new ChangedRange(0,0,0,e.doc.length)]);for(let o=0;o<2&&(this.viewport=this.getViewport(0,null),!!this.updateForViewport());o++);this.updateViewportLines(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=Decoration.set(this.lineGaps.map(o=>o.draw(this,!1))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:n}=this.state.selection;for(let o=0;o<=1;o++){let s=o?n.head:n.anchor;if(!e.some(({from:a,to:l})=>s>=a&&s<=l)){let{from:a,to:l}=this.lineBlockAt(s);e.push(new Viewport(a,l))}}return this.viewports=e.sort((o,s)=>o.from-s.from),this.updateScaler()}updateScaler(){let e=this.scaler;return this.scaler=this.heightMap.height<=7e6?IdScaler:new BigScaler(this.heightOracle,this.heightMap,this.viewports),e.eq(this.scaler)?0:2}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,e=>{this.viewportLines.push(scaleBlock(e,this.scaler))})}update(e,n=null){this.state=e.state;let o=this.stateDeco;this.stateDeco=this.state.facet(decorations).filter(m=>typeof m!="function");let s=e.changedRanges,a=ChangedRange.extendWithRanges(s,heightRelevantDecoChanges(o,this.stateDeco,e?e.changes:ChangeSet.empty(this.state.doc.length))),l=this.heightMap.height,c=this.scrolledToBottom?null:this.scrollAnchorAt(this.scrollTop);clearHeightChangeFlag(),this.heightMap=this.heightMap.applyChanges(this.stateDeco,e.startState.doc,this.heightOracle.setDoc(this.state.doc),a),(this.heightMap.height!=l||heightChangeFlag)&&(e.flags|=2),c?(this.scrollAnchorPos=e.changes.mapPos(c.from,-1),this.scrollAnchorHeight=c.top):(this.scrollAnchorPos=-1,this.scrollAnchorHeight=this.heightMap.height);let d=a.length?this.mapViewport(this.viewport,e.changes):this.viewport;(n&&(n.range.head<d.from||n.range.head>d.to)||!this.viewportIsAppropriate(d))&&(d=this.getViewport(0,n));let u=d.from!=this.viewport.from||d.to!=this.viewport.to;this.viewport=d,e.flags|=this.updateForViewport(),(u||!e.changes.empty||e.flags&2)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(e.changes),n&&(this.scrollTarget=n),!this.mustEnforceCursorAssoc&&e.selectionSet&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&!e.state.facet(nativeSelectionHidden)&&(this.mustEnforceCursorAssoc=!0)}measure(e){let n=e.contentDOM,o=window.getComputedStyle(n),s=this.heightOracle,a=o.whiteSpace;this.defaultTextDirection=o.direction=="rtl"?Direction.RTL:Direction.LTR;let l=this.heightOracle.mustRefreshForWrapping(a),c=n.getBoundingClientRect(),d=l||this.mustMeasureContent||this.contentDOMHeight!=c.height;this.contentDOMHeight=c.height,this.mustMeasureContent=!1;let u=0,m=0;if(c.width&&c.height){let{scaleX:x,scaleY:v}=getScale(n,c);(x>.005&&Math.abs(this.scaleX-x)>.005||v>.005&&Math.abs(this.scaleY-v)>.005)&&(this.scaleX=x,this.scaleY=v,u|=16,l=d=!0)}let f=(parseInt(o.paddingTop)||0)*this.scaleY,p=(parseInt(o.paddingBottom)||0)*this.scaleY;(this.paddingTop!=f||this.paddingBottom!=p)&&(this.paddingTop=f,this.paddingBottom=p,u|=18),this.editorWidth!=e.scrollDOM.clientWidth&&(s.lineWrapping&&(d=!0),this.editorWidth=e.scrollDOM.clientWidth,u|=16);let g=e.scrollDOM.scrollTop*this.scaleY;this.scrollTop!=g&&(this.scrollAnchorHeight=-1,this.scrollTop=g),this.scrolledToBottom=isScrolledToBottom(e.scrollDOM);let y=(this.printing?fullPixelRange:visiblePixelRange)(n,this.paddingTop),b=y.top-this.pixelViewport.top,k=y.bottom-this.pixelViewport.bottom;this.pixelViewport=y;let w=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(w!=this.inView&&(this.inView=w,w&&(d=!0)),!this.inView&&!this.scrollTarget)return 0;let B=c.width;if((this.contentDOMWidth!=B||this.editorHeight!=e.scrollDOM.clientHeight)&&(this.contentDOMWidth=c.width,this.editorHeight=e.scrollDOM.clientHeight,u|=16),d){let x=e.docView.measureVisibleLineHeights(this.viewport);if(s.mustRefreshForHeights(x)&&(l=!0),l||s.lineWrapping&&Math.abs(B-this.contentDOMWidth)>s.charWidth){let{lineHeight:v,charWidth:_,textHeight:E}=e.docView.measureTextSize();l=v>0&&s.refresh(a,v,_,E,B/_,x),l&&(e.docView.minWidth=0,u|=16)}b>0&&k>0?m=Math.max(b,k):b<0&&k<0&&(m=Math.min(b,k)),clearHeightChangeFlag();for(let v of this.viewports){let _=v.from==this.viewport.from?x:e.docView.measureVisibleLineHeights(v);this.heightMap=(l?HeightMap.empty().applyChanges(this.stateDeco,Text.empty,this.heightOracle,[new ChangedRange(0,0,0,e.state.doc.length)]):this.heightMap).updateHeight(s,0,l,new MeasuredHeights(v.from,_))}heightChangeFlag&&(u|=2)}let M=!this.viewportIsAppropriate(this.viewport,m)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return M&&(u&2&&(u|=this.updateScaler()),this.viewport=this.getViewport(m,this.scrollTarget),u|=this.updateForViewport()),(u&2||M)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(l?[]:this.lineGaps,e)),u|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),u}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,n){let o=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),s=this.heightMap,a=this.heightOracle,{visibleTop:l,visibleBottom:c}=this,d=new Viewport(s.lineAt(l-o*1e3,QueryType.ByHeight,a,0,0).from,s.lineAt(c+(1-o)*1e3,QueryType.ByHeight,a,0,0).to);if(n){let{head:u}=n.range;if(u<d.from||u>d.to){let m=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),f=s.lineAt(u,QueryType.ByPos,a,0,0),p;n.y=="center"?p=(f.top+f.bottom)/2-m/2:n.y=="start"||n.y=="nearest"&&u<d.from?p=f.top:p=f.bottom-m,d=new Viewport(s.lineAt(p-1e3/2,QueryType.ByHeight,a,0,0).from,s.lineAt(p+m+1e3/2,QueryType.ByHeight,a,0,0).to)}}return d}mapViewport(e,n){let o=n.mapPos(e.from,-1),s=n.mapPos(e.to,1);return new Viewport(this.heightMap.lineAt(o,QueryType.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(s,QueryType.ByPos,this.heightOracle,0,0).to)}viewportIsAppropriate({from:e,to:n},o=0){if(!this.inView)return!0;let{top:s}=this.heightMap.lineAt(e,QueryType.ByPos,this.heightOracle,0,0),{bottom:a}=this.heightMap.lineAt(n,QueryType.ByPos,this.heightOracle,0,0),{visibleTop:l,visibleBottom:c}=this;return(e==0||s<=l-Math.max(10,Math.min(-o,250)))&&(n==this.state.doc.length||a>=c+Math.max(10,Math.min(o,250)))&&s>l-2*1e3&&a<c+2*1e3}mapLineGaps(e,n){if(!e.length||n.empty)return e;let o=[];for(let s of e)n.touchesRange(s.from,s.to)||o.push(new LineGap(n.mapPos(s.from),n.mapPos(s.to),s.size,s.displaySize));return o}ensureLineGaps(e,n){let o=this.heightOracle.lineWrapping,s=o?1e4:2e3,a=s>>1,l=s<<1;if(this.defaultTextDirection!=Direction.LTR&&!o)return[];let c=[],d=(m,f,p,g)=>{if(f-m<a)return;let y=this.state.selection.main,b=[y.from];y.empty||b.push(y.to);for(let w of b)if(w>m&&w<f){d(m,w-10,p,g),d(w+10,f,p,g);return}let k=find(e,w=>w.from>=p.from&&w.to<=p.to&&Math.abs(w.from-m)<a&&Math.abs(w.to-f)<a&&!b.some(B=>w.from<B&&w.to>B));if(!k){if(f<p.to&&n&&o&&n.visibleRanges.some(M=>M.from<=f&&M.to>=f)){let M=n.moveToLineBoundary(EditorSelection.cursor(f),!1,!0).head;M>m&&(f=M)}let w=this.gapSize(p,m,f,g),B=o||w<2e6?w:2e6;k=new LineGap(m,f,w,B)}c.push(k)},u=m=>{if(m.length<l||m.type!=BlockType.Text)return;let f=lineStructure(m.from,m.to,this.stateDeco);if(f.total<l)return;let p=this.scrollTarget?this.scrollTarget.range.head:null,g,y;if(o){let b=s/this.heightOracle.lineLength*this.heightOracle.lineHeight,k,w;if(p!=null){let B=findFraction(f,p),M=((this.visibleBottom-this.visibleTop)/2+b)/m.height;k=B-M,w=B+M}else k=(this.visibleTop-m.top-b)/m.height,w=(this.visibleBottom-m.top+b)/m.height;g=findPosition(f,k),y=findPosition(f,w)}else{let b=f.total*this.heightOracle.charWidth,k=s*this.heightOracle.charWidth,w=0;if(b>2e6)for(let _ of e)_.from>=m.from&&_.from<m.to&&_.size!=_.displaySize&&_.from*this.heightOracle.charWidth+w<this.pixelViewport.left&&(w=_.size-_.displaySize);let B=this.pixelViewport.left+w,M=this.pixelViewport.right+w,x,v;if(p!=null){let _=findFraction(f,p),E=((M-B)/2+k)/b;x=_-E,v=_+E}else x=(B-k)/b,v=(M+k)/b;g=findPosition(f,x),y=findPosition(f,v)}g>m.from&&d(m.from,g,m,f),y<m.to&&d(y,m.to,m,f)};for(let m of this.viewportLines)Array.isArray(m.type)?m.type.forEach(u):u(m);return c}gapSize(e,n,o,s){let a=findFraction(s,o)-findFraction(s,n);return this.heightOracle.lineWrapping?e.height*a:s.total*this.heightOracle.charWidth*a}updateLineGaps(e){LineGap.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=Decoration.set(e.map(n=>n.draw(this,this.heightOracle.lineWrapping))))}computeVisibleRanges(e){let n=this.stateDeco;this.lineGaps.length&&(n=n.concat(this.lineGapDeco));let o=[];RangeSet.spans(n,this.viewport.from,this.viewport.to,{span(a,l){o.push({from:a,to:l})},point(){}},20);let s=0;if(o.length!=this.visibleRanges.length)s=12;else for(let a=0;a<o.length&&!(s&8);a++){let l=this.visibleRanges[a],c=o[a];(l.from!=c.from||l.to!=c.to)&&(s|=4,e&&e.mapPos(l.from,-1)==c.from&&e.mapPos(l.to,1)==c.to||(s|=8))}return this.visibleRanges=o,s}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find(n=>n.from<=e&&n.to>=e)||scaleBlock(this.heightMap.lineAt(e,QueryType.ByPos,this.heightOracle,0,0),this.scaler)}lineBlockAtHeight(e){return e>=this.viewportLines[0].top&&e<=this.viewportLines[this.viewportLines.length-1].bottom&&this.viewportLines.find(n=>n.top<=e&&n.bottom>=e)||scaleBlock(this.heightMap.lineAt(this.scaler.fromDOM(e),QueryType.ByHeight,this.heightOracle,0,0),this.scaler)}scrollAnchorAt(e){let n=this.lineBlockAtHeight(e+8);return n.from>=this.viewport.from||this.viewportLines[0].top-e>200?n:this.viewportLines[0]}elementAtHeight(e){return scaleBlock(this.heightMap.blockAt(this.scaler.fromDOM(e),this.heightOracle,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class Viewport{constructor(e,n){this.from=e,this.to=n}}function lineStructure(r,e,n){let o=[],s=r,a=0;return RangeSet.spans(n,r,e,{span(){},point(l,c){l>s&&(o.push({from:s,to:l}),a+=l-s),s=c}},20),s<e&&(o.push({from:s,to:e}),a+=e-s),{total:a,ranges:o}}function findPosition({total:r,ranges:e},n){if(n<=0)return e[0].from;if(n>=1)return e[e.length-1].to;let o=Math.floor(r*n);for(let s=0;;s++){let{from:a,to:l}=e[s],c=l-a;if(o<=c)return a+o;o-=c}}function findFraction(r,e){let n=0;for(let{from:o,to:s}of r.ranges){if(e<=s){n+=e-o;break}n+=s-o}return n/r.total}function find(r,e){for(let n of r)if(e(n))return n}const IdScaler={toDOM(r){return r},fromDOM(r){return r},scale:1,eq(r){return r==this}};class BigScaler{constructor(e,n,o){let s=0,a=0,l=0;this.viewports=o.map(({from:c,to:d})=>{let u=n.lineAt(c,QueryType.ByPos,e,0,0).top,m=n.lineAt(d,QueryType.ByPos,e,0,0).bottom;return s+=m-u,{from:c,to:d,top:u,bottom:m,domTop:0,domBottom:0}}),this.scale=(7e6-s)/(n.height-s);for(let c of this.viewports)c.domTop=l+(c.top-a)*this.scale,l=c.domBottom=c.domTop+(c.bottom-c.top),a=c.bottom}toDOM(e){for(let n=0,o=0,s=0;;n++){let a=n<this.viewports.length?this.viewports[n]:null;if(!a||e<a.top)return s+(e-o)*this.scale;if(e<=a.bottom)return a.domTop+(e-a.top);o=a.bottom,s=a.domBottom}}fromDOM(e){for(let n=0,o=0,s=0;;n++){let a=n<this.viewports.length?this.viewports[n]:null;if(!a||e<a.domTop)return o+(e-s)/this.scale;if(e<=a.domBottom)return a.top+(e-a.domTop);o=a.bottom,s=a.domBottom}}eq(e){return e instanceof BigScaler?this.scale==e.scale&&this.viewports.length==e.viewports.length&&this.viewports.every((n,o)=>n.from==e.viewports[o].from&&n.to==e.viewports[o].to):!1}}function scaleBlock(r,e){if(e.scale==1)return r;let n=e.toDOM(r.top),o=e.toDOM(r.bottom);return new BlockInfo(r.from,r.length,n,o-n,Array.isArray(r._content)?r._content.map(s=>scaleBlock(s,e)):r._content)}const theme=Facet.define({combine:r=>r.join(" ")}),darkTheme=Facet.define({combine:r=>r.indexOf(!0)>-1}),baseThemeID=StyleModule.newName(),baseLightID=StyleModule.newName(),baseDarkID=StyleModule.newName(),lightDarkIDs={"&light":"."+baseLightID,"&dark":"."+baseDarkID};function buildTheme(r,e,n){return new StyleModule(e,{finish(o){return/&/.test(o)?o.replace(/&\w*/,s=>{if(s=="&")return r;if(!n||!n[s])throw new RangeError(`Unsupported selector: ${s}`);return n[s]}):r+" "+o}})}const baseTheme$1$1=buildTheme("."+baseThemeID,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0,overflowAnchor:"none"},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",minHeight:"100%",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#ddd"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},".cm-iso":{unicodeBidi:"isolate"},".cm-announced":{position:"fixed",top:"-10000px"},"@media print":{".cm-announced":{display:"none"}},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",insetInlineStart:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0,zIndex:300},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-highlightSpace":{backgroundImage:"radial-gradient(circle at 50% 55%, #aaa 20%, transparent 5%)",backgroundPosition:"center"},".cm-highlightTab":{backgroundImage:`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>')`,backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},lightDarkIDs),observeOptions={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},useCharData=browser.ie&&browser.ie_version<=11;class DOMObserver{constructor(e){this.view=e,this.active=!1,this.editContext=null,this.selectionRange=new DOMSelectionState,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.printQuery=null,this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver(n=>{for(let o of n)this.queue.push(o);(browser.ie&&browser.ie_version<=11||browser.ios&&e.composing)&&n.some(o=>o.type=="childList"&&o.removedNodes.length||o.type=="characterData"&&o.oldValue.length>o.target.nodeValue.length)?this.flushSoon():this.flush()}),window.EditContext&&e.constructor.EDIT_CONTEXT!==!1&&!(browser.chrome&&browser.chrome_version<126)&&(this.editContext=new EditContextManager(e),e.state.facet(editable)&&(e.contentDOM.editContext=this.editContext.editContext)),useCharData&&(this.onCharData=n=>{this.queue.push({target:n.target,type:"characterData",oldValue:n.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),window.matchMedia&&(this.printQuery=window.matchMedia("print")),typeof ResizeObserver=="function"&&(this.resizeScroll=new ResizeObserver(()=>{var n;((n=this.view.docView)===null||n===void 0?void 0:n.lastUpdate)<Date.now()-75&&this.onResize()}),this.resizeScroll.observe(e.scrollDOM)),this.addWindowListeners(this.win=e.win),this.start(),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(n=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),n.length>0&&n[n.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{threshold:[0,.001]}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(n=>{n.length>0&&n[n.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(e){this.view.inputState.runHandlers("scroll",e),this.intersecting&&this.view.measure()}onScroll(e){this.intersecting&&this.flush(!1),this.editContext&&this.view.requestMeasure(this.editContext.measureReq),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(e){(e.type=="change"||!e.type)&&!e.matches||(this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500))}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some((n,o)=>n!=e[o]))){this.gapIntersection.disconnect();for(let n of e)this.gapIntersection.observe(n);this.gaps=e}}onSelectionChange(e){let n=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:o}=this,s=this.selectionRange;if(o.state.facet(editable)?o.root.activeElement!=this.dom:!hasSelection(this.dom,s))return;let a=s.anchorNode&&o.docView.nearest(s.anchorNode);if(a&&a.ignoreEvent(e)){n||(this.selectionChanged=!1);return}(browser.ie&&browser.ie_version<=11||browser.android&&browser.chrome)&&!o.state.selection.main.empty&&s.focusNode&&isEquivalentPosition(s.focusNode,s.focusOffset,s.anchorNode,s.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:e}=this,n=getSelection$1(e.root);if(!n)return!1;let o=browser.safari&&e.root.nodeType==11&&e.root.activeElement==this.dom&&safariSelectionRangeHack(this.view,n)||n;if(!o||this.selectionRange.eq(o))return!1;let s=hasSelection(this.dom,o);return s&&!this.selectionChanged&&e.inputState.lastFocusTime>Date.now()-200&&e.inputState.lastTouchTime<Date.now()-300&&atElementStart(this.dom,o)?(this.view.inputState.lastFocusTime=0,e.docView.updateSelection(),!1):(this.selectionRange.setRange(o),s&&(this.selectionChanged=!0),!0)}setSelectionRange(e,n){this.selectionRange.set(e.node,e.offset,n.node,n.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let e=0,n=null;for(let o=this.dom;o;)if(o.nodeType==1)!n&&e<this.scrollTargets.length&&this.scrollTargets[e]==o?e++:n||(n=this.scrollTargets.slice(0,e)),n&&n.push(o),o=o.assignedSlot||o.parentNode;else if(o.nodeType==11)o=o.host;else break;if(e<this.scrollTargets.length&&!n&&(n=this.scrollTargets.slice(0,e)),n){for(let o of this.scrollTargets)o.removeEventListener("scroll",this.onScroll);for(let o of this.scrollTargets=n)o.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,observeOptions),useCharData&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),useCharData&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,n){var o;if(!this.delayedAndroidKey){let s=()=>{let a=this.delayedAndroidKey;a&&(this.clearDelayedAndroidKey(),this.view.inputState.lastKeyCode=a.keyCode,this.view.inputState.lastKeyTime=Date.now(),!this.flush()&&a.force&&dispatchKey(this.dom,a.key,a.keyCode))};this.flushingAndroidKey=this.view.win.requestAnimationFrame(s)}(!this.delayedAndroidKey||e=="Enter")&&(this.delayedAndroidKey={key:e,keyCode:n,force:this.lastChange<Date.now()-50||!!(!((o=this.delayedAndroidKey)===null||o===void 0)&&o.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame(()=>{this.delayedFlush=-1,this.flush()}))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}pendingRecords(){for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}processRecords(){let e=this.pendingRecords();e.length&&(this.queue=[]);let n=-1,o=-1,s=!1;for(let a of e){let l=this.readMutation(a);l&&(l.typeOver&&(s=!0),n==-1?{from:n,to:o}=l:(n=Math.min(l.from,n),o=Math.max(l.to,o)))}return{from:n,to:o,typeOver:s}}readChange(){let{from:e,to:n,typeOver:o}=this.processRecords(),s=this.selectionChanged&&hasSelection(this.dom,this.selectionRange);if(e<0&&!s)return null;e>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1;let a=new DOMChange(this.view,e,n,o);return this.view.docView.domChanged={newSel:a.newSel?a.newSel.main:null},a}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;e&&this.readSelectionRange();let n=this.readChange();if(!n)return this.view.requestMeasure(),!1;let o=this.view.state,s=applyDOMChange(this.view,n);return this.view.state==o&&(n.domChanged||n.newSel&&!n.newSel.main.eq(this.view.state.selection.main))&&this.view.update([]),s}readMutation(e){let n=this.view.docView.nearest(e.target);if(!n||n.ignoreMutation(e))return null;if(n.markDirty(e.type=="attributes"),e.type=="attributes"&&(n.flags|=4),e.type=="childList"){let o=findChild(n,e.previousSibling||e.target.previousSibling,-1),s=findChild(n,e.nextSibling||e.target.nextSibling,1);return{from:o?n.posAfter(o):n.posAtStart,to:s?n.posBefore(s):n.posAtEnd,typeOver:!1}}else return e.type=="characterData"?{from:n.posAtStart,to:n.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}setWindow(e){e!=this.win&&(this.removeWindowListeners(this.win),this.win=e,this.addWindowListeners(this.win))}addWindowListeners(e){e.addEventListener("resize",this.onResize),this.printQuery?this.printQuery.addEventListener?this.printQuery.addEventListener("change",this.onPrint):this.printQuery.addListener(this.onPrint):e.addEventListener("beforeprint",this.onPrint),e.addEventListener("scroll",this.onScroll),e.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(e){e.removeEventListener("scroll",this.onScroll),e.removeEventListener("resize",this.onResize),this.printQuery?this.printQuery.removeEventListener?this.printQuery.removeEventListener("change",this.onPrint):this.printQuery.removeListener(this.onPrint):e.removeEventListener("beforeprint",this.onPrint),e.document.removeEventListener("selectionchange",this.onSelectionChange)}update(e){this.editContext&&(this.editContext.update(e),e.startState.facet(editable)!=e.state.facet(editable)&&(e.view.contentDOM.editContext=e.state.facet(editable)?this.editContext.editContext:null))}destroy(){var e,n,o;this.stop(),(e=this.intersection)===null||e===void 0||e.disconnect(),(n=this.gapIntersection)===null||n===void 0||n.disconnect(),(o=this.resizeScroll)===null||o===void 0||o.disconnect();for(let s of this.scrollTargets)s.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey),this.editContext&&(this.view.contentDOM.editContext=null,this.editContext.destroy())}}function findChild(r,e,n){for(;e;){let o=ContentView.get(e);if(o&&o.parent==r)return o;let s=e.parentNode;e=s!=r.dom?s:n>0?e.nextSibling:e.previousSibling}return null}function buildSelectionRangeFromRange(r,e){let n=e.startContainer,o=e.startOffset,s=e.endContainer,a=e.endOffset,l=r.docView.domAtPos(r.state.selection.main.anchor);return isEquivalentPosition(l.node,l.offset,s,a)&&([n,o,s,a]=[s,a,n,o]),{anchorNode:n,anchorOffset:o,focusNode:s,focusOffset:a}}function safariSelectionRangeHack(r,e){if(e.getComposedRanges){let s=e.getComposedRanges(r.root)[0];if(s)return buildSelectionRangeFromRange(r,s)}let n=null;function o(s){s.preventDefault(),s.stopImmediatePropagation(),n=s.getTargetRanges()[0]}return r.contentDOM.addEventListener("beforeinput",o,!0),r.dom.ownerDocument.execCommand("indent"),r.contentDOM.removeEventListener("beforeinput",o,!0),n?buildSelectionRangeFromRange(r,n):null}class EditContextManager{constructor(e){this.from=0,this.to=0,this.pendingContextChange=null,this.handlers=Object.create(null),this.composing=null,this.resetRange(e.state);let n=this.editContext=new window.EditContext({text:e.state.doc.sliceString(this.from,this.to),selectionStart:this.toContextPos(Math.max(this.from,Math.min(this.to,e.state.selection.main.anchor))),selectionEnd:this.toContextPos(e.state.selection.main.head)});this.handlers.textupdate=o=>{let{anchor:s}=e.state.selection.main,a=this.toEditorPos(o.updateRangeStart),l=this.toEditorPos(o.updateRangeEnd);e.inputState.composing>=0&&!this.composing&&(this.composing={contextBase:o.updateRangeStart,editorBase:a,drifted:!1});let c={from:a,to:l,insert:Text.of(o.text.split(`
`))};if(c.from==this.from&&s<this.from?c.from=s:c.to==this.to&&s>this.to&&(c.to=s),!(c.from==c.to&&!c.insert.length)){if(this.pendingContextChange=c,!e.state.readOnly){let d=this.to-this.from+(c.to-c.from+c.insert.length);applyDOMChangeInner(e,c,EditorSelection.single(this.toEditorPos(o.selectionStart,d),this.toEditorPos(o.selectionEnd,d)))}this.pendingContextChange&&(this.revertPending(e.state),this.setSelection(e.state))}},this.handlers.characterboundsupdate=o=>{let s=[],a=null;for(let l=this.toEditorPos(o.rangeStart),c=this.toEditorPos(o.rangeEnd);l<c;l++){let d=e.coordsForChar(l);a=d&&new DOMRect(d.left,d.top,d.right-d.left,d.bottom-d.top)||a||new DOMRect,s.push(a)}n.updateCharacterBounds(o.rangeStart,s)},this.handlers.textformatupdate=o=>{let s=[];for(let a of o.getTextFormats()){let l=a.underlineStyle,c=a.underlineThickness;if(l!="None"&&c!="None"){let d=this.toEditorPos(a.rangeStart),u=this.toEditorPos(a.rangeEnd);if(d<u){let m=`text-decoration: underline ${l=="Dashed"?"dashed ":l=="Squiggle"?"wavy ":""}${c=="Thin"?1:2}px`;s.push(Decoration.mark({attributes:{style:m}}).range(d,u))}}}e.dispatch({effects:setEditContextFormatting.of(Decoration.set(s))})},this.handlers.compositionstart=()=>{e.inputState.composing<0&&(e.inputState.composing=0,e.inputState.compositionFirstChange=!0)},this.handlers.compositionend=()=>{if(e.inputState.composing=-1,e.inputState.compositionFirstChange=null,this.composing){let{drifted:o}=this.composing;this.composing=null,o&&this.reset(e.state)}};for(let o in this.handlers)n.addEventListener(o,this.handlers[o]);this.measureReq={read:o=>{this.editContext.updateControlBounds(o.contentDOM.getBoundingClientRect());let s=getSelection$1(o.root);s&&s.rangeCount&&this.editContext.updateSelectionBounds(s.getRangeAt(0).getBoundingClientRect())}}}applyEdits(e){let n=0,o=!1,s=this.pendingContextChange;return e.changes.iterChanges((a,l,c,d,u)=>{if(o)return;let m=u.length-(l-a);if(s&&l>=s.to)if(s.from==a&&s.to==l&&s.insert.eq(u)){s=this.pendingContextChange=null,n+=m,this.to+=m;return}else s=null,this.revertPending(e.state);if(a+=n,l+=n,l<=this.from)this.from+=m,this.to+=m;else if(a<this.to){if(a<this.from||l>this.to||this.to-this.from+u.length>3e4){o=!0;return}this.editContext.updateText(this.toContextPos(a),this.toContextPos(l),u.toString()),this.to+=m}n+=m}),s&&!o&&this.revertPending(e.state),!o}update(e){let n=this.pendingContextChange;this.composing&&(this.composing.drifted||e.transactions.some(o=>!o.isUserEvent("input.type")&&o.changes.touchesRange(this.from,this.to)))?(this.composing.drifted=!0,this.composing.editorBase=e.changes.mapPos(this.composing.editorBase)):!this.applyEdits(e)||!this.rangeIsValid(e.state)?(this.pendingContextChange=null,this.reset(e.state)):(e.docChanged||e.selectionSet||n)&&this.setSelection(e.state),(e.geometryChanged||e.docChanged||e.selectionSet)&&e.view.requestMeasure(this.measureReq)}resetRange(e){let{head:n}=e.selection.main;this.from=Math.max(0,n-1e4),this.to=Math.min(e.doc.length,n+1e4)}reset(e){this.resetRange(e),this.editContext.updateText(0,this.editContext.text.length,e.doc.sliceString(this.from,this.to)),this.setSelection(e)}revertPending(e){let n=this.pendingContextChange;this.pendingContextChange=null,this.editContext.updateText(this.toContextPos(n.from),this.toContextPos(n.from+n.insert.length),e.doc.sliceString(n.from,n.to))}setSelection(e){let{main:n}=e.selection,o=this.toContextPos(Math.max(this.from,Math.min(this.to,n.anchor))),s=this.toContextPos(n.head);(this.editContext.selectionStart!=o||this.editContext.selectionEnd!=s)&&this.editContext.updateSelection(o,s)}rangeIsValid(e){let{head:n}=e.selection.main;return!(this.from>0&&n-this.from<500||this.to<e.doc.length&&this.to-n<500||this.to-this.from>1e4*3)}toEditorPos(e,n=this.to-this.from){e=Math.min(e,n);let o=this.composing;return o&&o.drifted?o.editorBase+(e-o.contextBase):e+this.from}toContextPos(e){let n=this.composing;return n&&n.drifted?n.contextBase+(e-n.editorBase):e-this.from}destroy(){for(let e in this.handlers)this.editContext.removeEventListener(e,this.handlers[e])}}EditorView=class{get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}constructor(r={}){var e;this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.className="cm-announced",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),r.parent&&r.parent.appendChild(this.dom);let{dispatch:n}=r;this.dispatchTransactions=r.dispatchTransactions||n&&(o=>o.forEach(s=>n(s,this)))||(o=>this.update(o)),this.dispatch=this.dispatch.bind(this),this._root=r.root||getRoot(r.parent)||document,this.viewState=new ViewState(r.state||EditorState.create(r)),r.scrollTo&&r.scrollTo.is(scrollIntoView)&&(this.viewState.scrollTarget=r.scrollTo.value.clip(this.viewState.state)),this.plugins=this.state.facet(viewPlugin).map(o=>new PluginInstance(o));for(let o of this.plugins)o.update(this);this.observer=new DOMObserver(this),this.inputState=new InputState(this),this.inputState.ensureHandlers(this.plugins),this.docView=new DocView(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),!((e=document.fonts)===null||e===void 0)&&e.ready&&document.fonts.ready.then(()=>this.requestMeasure())}dispatch(...r){let e=r.length==1&&r[0]instanceof Transaction?r:r.length==1&&Array.isArray(r[0])?r[0]:[this.state.update(...r)];this.dispatchTransactions(e,this)}update(r){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let e=!1,n=!1,o,s=this.state;for(let f of r){if(f.startState!=s)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");s=f.state}if(this.destroyed){this.viewState.state=s;return}let a=this.hasFocus,l=0,c=null;r.some(f=>f.annotation(isFocusChange))?(this.inputState.notifiedFocused=a,l=1):a!=this.inputState.notifiedFocused&&(this.inputState.notifiedFocused=a,c=focusChangeTransaction(s,a),c||(l=1));let d=this.observer.delayedAndroidKey,u=null;if(d?(this.observer.clearDelayedAndroidKey(),u=this.observer.readChange(),(u&&!this.state.doc.eq(s.doc)||!this.state.selection.eq(s.selection))&&(u=null)):this.observer.clear(),s.facet(EditorState.phrases)!=this.state.facet(EditorState.phrases))return this.setState(s);o=ViewUpdate.create(this,s,r),o.flags|=l;let m=this.viewState.scrollTarget;try{this.updateState=2;for(let f of r){if(m&&(m=m.map(f.changes)),f.scrollIntoView){let{main:p}=f.state.selection;m=new ScrollTarget(p.empty?p:EditorSelection.cursor(p.head,p.head>p.anchor?-1:1))}for(let p of f.effects)p.is(scrollIntoView)&&(m=p.value.clip(this.state))}this.viewState.update(o,m),this.bidiCache=CachedOrder.update(this.bidiCache,o.changes),o.empty||(this.updatePlugins(o),this.inputState.update(o)),e=this.docView.update(o),this.state.facet(styleModule)!=this.styleModules&&this.mountStyles(),n=this.updateAttrs(),this.showAnnouncements(r),this.docView.updateSelection(e,r.some(f=>f.isUserEvent("select.pointer")))}finally{this.updateState=0}if(o.startState.facet(theme)!=o.state.facet(theme)&&(this.viewState.mustMeasureContent=!0),(e||n||m||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),e&&this.docViewUpdate(),!o.empty)for(let f of this.state.facet(updateListener))try{f(o)}catch(p){logException(this.state,p,"update listener")}(c||u)&&Promise.resolve().then(()=>{c&&this.state==c.startState&&this.dispatch(c),u&&!applyDOMChange(this,u)&&d.force&&dispatchKey(this.contentDOM,d.key,d.keyCode)})}setState(r){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=r;return}this.updateState=2;let e=this.hasFocus;try{for(let n of this.plugins)n.destroy(this);this.viewState=new ViewState(r),this.plugins=r.facet(viewPlugin).map(n=>new PluginInstance(n)),this.pluginMap.clear();for(let n of this.plugins)n.update(this);this.docView.destroy(),this.docView=new DocView(this),this.inputState.ensureHandlers(this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}e&&this.focus(),this.requestMeasure()}updatePlugins(r){let e=r.startState.facet(viewPlugin),n=r.state.facet(viewPlugin);if(e!=n){let o=[];for(let s of n){let a=e.indexOf(s);if(a<0)o.push(new PluginInstance(s));else{let l=this.plugins[a];l.mustUpdate=r,o.push(l)}}for(let s of this.plugins)s.mustUpdate!=r&&s.destroy(this);this.plugins=o,this.pluginMap.clear()}else for(let o of this.plugins)o.mustUpdate=r;for(let o=0;o<this.plugins.length;o++)this.plugins[o].update(this);e!=n&&this.inputState.ensureHandlers(this.plugins)}docViewUpdate(){for(let r of this.plugins){let e=r.value;if(e&&e.docViewUpdate)try{e.docViewUpdate(this)}catch(n){logException(this.state,n,"doc view update listener")}}}measure(r=!0){if(this.destroyed)return;if(this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.observer.delayedAndroidKey){this.measureScheduled=-1,this.requestMeasure();return}this.measureScheduled=0,r&&this.observer.forceFlush();let e=null,n=this.scrollDOM,o=n.scrollTop*this.scaleY,{scrollAnchorPos:s,scrollAnchorHeight:a}=this.viewState;Math.abs(o-this.viewState.scrollTop)>1&&(a=-1),this.viewState.scrollAnchorHeight=-1;try{for(let l=0;;l++){if(a<0)if(isScrolledToBottom(n))s=-1,a=this.viewState.heightMap.height;else{let p=this.viewState.scrollAnchorAt(o);s=p.from,a=p.top}this.updateState=1;let c=this.viewState.measure(this);if(!c&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(l>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let d=[];c&4||([this.measureRequests,d]=[d,this.measureRequests]);let u=d.map(p=>{try{return p.read(this)}catch(g){return logException(this.state,g),BadMeasure}}),m=ViewUpdate.create(this,this.state,[]),f=!1;m.flags|=c,e?e.flags|=c:e=m,this.updateState=2,m.empty||(this.updatePlugins(m),this.inputState.update(m),this.updateAttrs(),f=this.docView.update(m),f&&this.docViewUpdate());for(let p=0;p<d.length;p++)if(u[p]!=BadMeasure)try{let g=d[p];g.write&&g.write(u[p],this)}catch(g){logException(this.state,g)}if(f&&this.docView.updateSelection(!0),!m.viewportChanged&&this.measureRequests.length==0){if(this.viewState.editorHeight)if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,a=-1;continue}else{let p=(s<0?this.viewState.heightMap.height:this.viewState.lineBlockAt(s).top)-a;if(p>1||p<-1){o=o+p,n.scrollTop=o/this.scaleY,a=-1;continue}}break}}}finally{this.updateState=0,this.measureScheduled=-1}if(e&&!e.empty)for(let l of this.state.facet(updateListener))l(e)}get themeClasses(){return baseThemeID+" "+(this.state.facet(darkTheme)?baseDarkID:baseLightID)+" "+this.state.facet(theme)}updateAttrs(){let r=attrsFromFacet(this,editorAttributes,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),e={spellcheck:"false",autocorrect:"off",autocapitalize:"off",writingsuggestions:"false",translate:"no",contenteditable:this.state.facet(editable)?"true":"false",class:"cm-content",style:`${browser.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(e["aria-readonly"]="true"),attrsFromFacet(this,contentAttributes,e);let n=this.observer.ignore(()=>{let o=updateAttrs(this.contentDOM,this.contentAttrs,e),s=updateAttrs(this.dom,this.editorAttrs,r);return o||s});return this.editorAttrs=r,this.contentAttrs=e,n}showAnnouncements(r){let e=!0;for(let n of r)for(let o of n.effects)if(o.is(EditorView.announce)){e&&(this.announceDOM.textContent=""),e=!1;let s=this.announceDOM.appendChild(document.createElement("div"));s.textContent=o.value}}mountStyles(){this.styleModules=this.state.facet(styleModule);let r=this.state.facet(EditorView.cspNonce);StyleModule.mount(this.root,this.styleModules.concat(baseTheme$1$1).reverse(),r?{nonce:r}:void 0)}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(r){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame(()=>this.measure())),r){if(this.measureRequests.indexOf(r)>-1)return;if(r.key!=null){for(let e=0;e<this.measureRequests.length;e++)if(this.measureRequests[e].key===r.key){this.measureRequests[e]=r;return}}this.measureRequests.push(r)}}plugin(r){let e=this.pluginMap.get(r);return(e===void 0||e&&e.spec!=r)&&this.pluginMap.set(r,e=this.plugins.find(n=>n.spec==r)||null),e&&e.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}get scaleX(){return this.viewState.scaleX}get scaleY(){return this.viewState.scaleY}elementAtHeight(r){return this.readMeasured(),this.viewState.elementAtHeight(r)}lineBlockAtHeight(r){return this.readMeasured(),this.viewState.lineBlockAtHeight(r)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(r){return this.viewState.lineBlockAt(r)}get contentHeight(){return this.viewState.contentHeight}moveByChar(r,e,n){return skipAtoms(this,r,moveByChar(this,r,e,n))}moveByGroup(r,e){return skipAtoms(this,r,moveByChar(this,r,e,n=>byGroup(this,r.head,n)))}visualLineSide(r,e){let n=this.bidiSpans(r),o=this.textDirectionAt(r.from),s=n[e?n.length-1:0];return EditorSelection.cursor(s.side(e,o)+r.from,s.forward(!e,o)?1:-1)}moveToLineBoundary(r,e,n=!0){return moveToLineBoundary(this,r,e,n)}moveVertically(r,e,n){return skipAtoms(this,r,moveVertically(this,r,e,n))}domAtPos(r){return this.docView.domAtPos(r)}posAtDOM(r,e=0){return this.docView.posFromDOM(r,e)}posAtCoords(r,e=!0){return this.readMeasured(),posAtCoords(this,r,e)}coordsAtPos(r,e=1){this.readMeasured();let n=this.docView.coordsAt(r,e);if(!n||n.left==n.right)return n;let o=this.state.doc.lineAt(r),s=this.bidiSpans(o),a=s[BidiSpan.find(s,r-o.from,-1,e)];return flattenRect(n,a.dir==Direction.LTR==e>0)}coordsForChar(r){return this.readMeasured(),this.docView.coordsForChar(r)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(r){return!this.state.facet(perLineTextDirection)||r<this.viewport.from||r>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(r))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(r){if(r.length>MaxBidiLine)return trivialOrder(r.length);let e=this.textDirectionAt(r.from),n;for(let s of this.bidiCache)if(s.from==r.from&&s.dir==e&&(s.fresh||isolatesEq(s.isolates,n=getIsolatedRanges(this,r))))return s.order;n||(n=getIsolatedRanges(this,r));let o=computeOrder(r.text,e,n);return this.bidiCache.push(new CachedOrder(r.from,r.to,e,n,!0,o)),o}get hasFocus(){var r;return(this.dom.ownerDocument.hasFocus()||browser.safari&&((r=this.inputState)===null||r===void 0?void 0:r.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{focusPreventScroll(this.contentDOM),this.docView.updateSelection()})}setRoot(r){this._root!=r&&(this._root=r,this.observer.setWindow((r.nodeType==9?r:r.ownerDocument).defaultView||window),this.mountStyles())}destroy(){this.root.activeElement==this.contentDOM&&this.contentDOM.blur();for(let r of this.plugins)r.destroy(this);this.plugins=[],this.inputState.destroy(),this.docView.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(r,e={}){return scrollIntoView.of(new ScrollTarget(typeof r=="number"?EditorSelection.cursor(r):r,e.y,e.x,e.yMargin,e.xMargin))}scrollSnapshot(){let{scrollTop:r,scrollLeft:e}=this.scrollDOM,n=this.viewState.scrollAnchorAt(r);return scrollIntoView.of(new ScrollTarget(EditorSelection.cursor(n.from),"start","start",n.top-r,e,!0))}setTabFocusMode(r){r==null?this.inputState.tabFocusMode=this.inputState.tabFocusMode<0?0:-1:typeof r=="boolean"?this.inputState.tabFocusMode=r?0:-1:this.inputState.tabFocusMode!=0&&(this.inputState.tabFocusMode=Date.now()+r)}static domEventHandlers(r){return ViewPlugin.define(()=>({}),{eventHandlers:r})}static domEventObservers(r){return ViewPlugin.define(()=>({}),{eventObservers:r})}static theme(r,e){let n=StyleModule.newName(),o=[theme.of(n),styleModule.of(buildTheme(`.${n}`,r))];return e&&e.dark&&o.push(darkTheme.of(!0)),o}static baseTheme(r){return Prec.lowest(styleModule.of(buildTheme("."+baseThemeID,r,lightDarkIDs)))}static findFromDOM(r){var e;let n=r.querySelector(".cm-content"),o=n&&ContentView.get(n)||ContentView.get(r);return((e=o==null?void 0:o.rootView)===null||e===void 0?void 0:e.view)||null}},EditorView.styleModule=styleModule,EditorView.inputHandler=inputHandler$1,EditorView.clipboardInputFilter=clipboardInputFilter,EditorView.clipboardOutputFilter=clipboardOutputFilter,EditorView.scrollHandler=scrollHandler,EditorView.focusChangeEffect=focusChangeEffect,EditorView.perLineTextDirection=perLineTextDirection,EditorView.exceptionSink=exceptionSink,EditorView.updateListener=updateListener,EditorView.editable=editable,EditorView.mouseSelectionStyle=mouseSelectionStyle,EditorView.dragMovesSelection=dragMovesSelection$1,EditorView.clickAddsSelectionRange=clickAddsSelectionRange,EditorView.decorations=decorations,EditorView.outerDecorations=outerDecorations,EditorView.atomicRanges=atomicRanges,EditorView.bidiIsolatedRanges=bidiIsolatedRanges,EditorView.scrollMargins=scrollMargins,EditorView.darkTheme=darkTheme,EditorView.cspNonce=Facet.define({combine:r=>r.length?r[0]:""}),EditorView.contentAttributes=contentAttributes,EditorView.editorAttributes=editorAttributes,EditorView.lineWrapping=EditorView.contentAttributes.of({class:"cm-lineWrapping"}),EditorView.announce=StateEffect.define();const MaxBidiLine=4096,BadMeasure={};class CachedOrder{constructor(e,n,o,s,a,l){this.from=e,this.to=n,this.dir=o,this.isolates=s,this.fresh=a,this.order=l}static update(e,n){if(n.empty&&!e.some(a=>a.fresh))return e;let o=[],s=e.length?e[e.length-1].dir:Direction.LTR;for(let a=Math.max(0,e.length-10);a<e.length;a++){let l=e[a];l.dir==s&&!n.touchesRange(l.from,l.to)&&o.push(new CachedOrder(n.mapPos(l.from,1),n.mapPos(l.to,-1),l.dir,l.isolates,!1,l.order))}return o}}function attrsFromFacet(r,e,n){for(let o=r.state.facet(e),s=o.length-1;s>=0;s--){let a=o[s],l=typeof a=="function"?a(r):a;l&&combineAttrs(l,n)}return n}const currentPlatform=browser.mac?"mac":browser.windows?"win":browser.linux?"linux":"key";function normalizeKeyName$1(r,e){const n=r.split(/-(?!$)/);let o=n[n.length-1];o=="Space"&&(o=" ");let s,a,l,c;for(let d=0;d<n.length-1;++d){const u=n[d];if(/^(cmd|meta|m)$/i.test(u))c=!0;else if(/^a(lt)?$/i.test(u))s=!0;else if(/^(c|ctrl|control)$/i.test(u))a=!0;else if(/^s(hift)?$/i.test(u))l=!0;else if(/^mod$/i.test(u))e=="mac"?c=!0:a=!0;else throw new Error("Unrecognized modifier name: "+u)}return s&&(o="Alt-"+o),a&&(o="Ctrl-"+o),c&&(o="Meta-"+o),l&&(o="Shift-"+o),o}function modifiers$1(r,e,n){return e.altKey&&(r="Alt-"+r),e.ctrlKey&&(r="Ctrl-"+r),e.metaKey&&(r="Meta-"+r),n!==!1&&e.shiftKey&&(r="Shift-"+r),r}let handleKeyEvents,Keymaps;handleKeyEvents=Prec.default(EditorView.domEventHandlers({keydown(r,e){return runHandlers(getKeymap(e.state),r,e,"editor")}})),keymap=Facet.define({enables:handleKeyEvents}),Keymaps=new WeakMap;function getKeymap(r){let e=r.facet(keymap),n=Keymaps.get(e);return n||Keymaps.set(e,n=buildKeymap(e.reduce((o,s)=>o.concat(s),[]))),n}let storedPrefix=null;const PrefixTimeout=4e3;function buildKeymap(r,e=currentPlatform){let n=Object.create(null),o=Object.create(null),s=(l,c)=>{let d=o[l];if(d==null)o[l]=c;else if(d!=c)throw new Error("Key binding "+l+" is used both as a regular binding and as a multi-stroke prefix")},a=(l,c,d,u,m)=>{var f,p;let g=n[l]||(n[l]=Object.create(null)),y=c.split(/ (?!$)/).map(w=>normalizeKeyName$1(w,e));for(let w=1;w<y.length;w++){let B=y.slice(0,w).join(" ");s(B,!0),g[B]||(g[B]={preventDefault:!0,stopPropagation:!1,run:[M=>{let x=storedPrefix={view:M,prefix:B,scope:l};return setTimeout(()=>{storedPrefix==x&&(storedPrefix=null)},PrefixTimeout),!0}]})}let b=y.join(" ");s(b,!1);let k=g[b]||(g[b]={preventDefault:!1,stopPropagation:!1,run:((p=(f=g._any)===null||f===void 0?void 0:f.run)===null||p===void 0?void 0:p.slice())||[]});d&&k.run.push(d),u&&(k.preventDefault=!0),m&&(k.stopPropagation=!0)};for(let l of r){let c=l.scope?l.scope.split(" "):["editor"];if(l.any)for(let u of c){let m=n[u]||(n[u]=Object.create(null));m._any||(m._any={preventDefault:!1,stopPropagation:!1,run:[]});let{any:f}=l;for(let p in m)m[p].run.push(g=>f(g,currentKeyEvent))}let d=l[e]||l.key;if(d)for(let u of c)a(u,d,l.run,l.preventDefault,l.stopPropagation),l.shift&&a(u,"Shift-"+d,l.shift,l.preventDefault,l.stopPropagation)}return n}let currentKeyEvent=null;function runHandlers(r,e,n,o){currentKeyEvent=e;let s=keyName(e),a=codePointAt(s,0),l=codePointSize(a)==s.length&&s!=" ",c="",d=!1,u=!1,m=!1;storedPrefix&&storedPrefix.view==n&&storedPrefix.scope==o&&(c=storedPrefix.prefix+" ",modifierCodes.indexOf(e.keyCode)<0&&(u=!0,storedPrefix=null));let f=new Set,p=k=>{if(k){for(let w of k.run)if(!f.has(w)&&(f.add(w),w(n)))return k.stopPropagation&&(m=!0),!0;k.preventDefault&&(k.stopPropagation&&(m=!0),u=!0)}return!1},g=r[o],y,b;return g&&(p(g[c+modifiers$1(s,e,!l)])?d=!0:l&&(e.altKey||e.metaKey||e.ctrlKey)&&!(browser.windows&&e.ctrlKey&&e.altKey)&&(y=base[e.keyCode])&&y!=s?(p(g[c+modifiers$1(y,e,!0)])||e.shiftKey&&(b=shift[e.keyCode])!=s&&b!=y&&p(g[c+modifiers$1(b,e,!1)]))&&(d=!0):l&&e.shiftKey&&p(g[c+modifiers$1(s,e,!0)])&&(d=!0),!d&&p(g._any)&&(d=!0)),u&&(d=!0),d&&m&&e.stopPropagation(),currentKeyEvent=null,d}class RectangleMarker{constructor(e,n,o,s,a){this.className=e,this.left=n,this.top=o,this.width=s,this.height=a}draw(){let e=document.createElement("div");return e.className=this.className,this.adjust(e),e}update(e,n){return n.className!=this.className?!1:(this.adjust(e),!0)}adjust(e){e.style.left=this.left+"px",e.style.top=this.top+"px",this.width!=null&&(e.style.width=this.width+"px"),e.style.height=this.height+"px"}eq(e){return this.left==e.left&&this.top==e.top&&this.width==e.width&&this.height==e.height&&this.className==e.className}static forRange(e,n,o){if(o.empty){let s=e.coordsAtPos(o.head,o.assoc||1);if(!s)return[];let a=getBase(e);return[new RectangleMarker(n,s.left-a.left,s.top-a.top,null,s.bottom-s.top)]}else return rectanglesForRange(e,n,o)}}function getBase(r){let e=r.scrollDOM.getBoundingClientRect();return{left:(r.textDirection==Direction.LTR?e.left:e.right-r.scrollDOM.clientWidth*r.scaleX)-r.scrollDOM.scrollLeft*r.scaleX,top:e.top-r.scrollDOM.scrollTop*r.scaleY}}function wrappedLine(r,e,n,o){let s=r.coordsAtPos(e,n*2);if(!s)return o;let a=r.dom.getBoundingClientRect(),l=(s.top+s.bottom)/2,c=r.posAtCoords({x:a.left+1,y:l}),d=r.posAtCoords({x:a.right-1,y:l});return c==null||d==null?o:{from:Math.max(o.from,Math.min(c,d)),to:Math.min(o.to,Math.max(c,d))}}function rectanglesForRange(r,e,n){if(n.to<=r.viewport.from||n.from>=r.viewport.to)return[];let o=Math.max(n.from,r.viewport.from),s=Math.min(n.to,r.viewport.to),a=r.textDirection==Direction.LTR,l=r.contentDOM,c=l.getBoundingClientRect(),d=getBase(r),u=l.querySelector(".cm-line"),m=u&&window.getComputedStyle(u),f=c.left+(m?parseInt(m.paddingLeft)+Math.min(0,parseInt(m.textIndent)):0),p=c.right-(m?parseInt(m.paddingRight):0),g=blockAt(r,o),y=blockAt(r,s),b=g.type==BlockType.Text?g:null,k=y.type==BlockType.Text?y:null;if(b&&(r.lineWrapping||g.widgetLineBreaks)&&(b=wrappedLine(r,o,1,b)),k&&(r.lineWrapping||y.widgetLineBreaks)&&(k=wrappedLine(r,s,-1,k)),b&&k&&b.from==k.from&&b.to==k.to)return B(M(n.from,n.to,b));{let v=b?M(n.from,null,b):x(g,!1),_=k?M(null,n.to,k):x(y,!0),E=[];return(b||g).to<(k||y).from-(b&&k?1:0)||g.widgetLineBreaks>1&&v.bottom+r.defaultLineHeight/2<_.top?E.push(w(f,v.bottom,p,_.top)):v.bottom<_.top&&r.elementAtHeight((v.bottom+_.top)/2).type==BlockType.Text&&(v.bottom=_.top=(v.bottom+_.top)/2),B(v).concat(E).concat(B(_))}function w(v,_,E,N){return new RectangleMarker(e,v-d.left,_-d.top,E-v,N-_)}function B({top:v,bottom:_,horizontal:E}){let N=[];for(let I=0;I<E.length;I+=2)N.push(w(E[I],v,E[I+1],_));return N}function M(v,_,E){let N=1e9,I=-1e9,L=[];function A(H,V,R,J,Y){let re=r.coordsAtPos(H,H==E.to?-2:2),Q=r.coordsAtPos(R,R==E.from?2:-2);!re||!Q||(N=Math.min(re.top,Q.top,N),I=Math.max(re.bottom,Q.bottom,I),Y==Direction.LTR?L.push(a&&V?f:re.left,a&&J?p:Q.right):L.push(!a&&J?f:Q.left,!a&&V?p:re.right))}let F=v??E.from,se=_??E.to;for(let H of r.visibleRanges)if(H.to>F&&H.from<se)for(let V=Math.max(H.from,F),R=Math.min(H.to,se);;){let J=r.state.doc.lineAt(V);for(let Y of r.bidiSpans(J)){let re=Y.from+J.from,Q=Y.to+J.from;if(re>=R)break;Q>V&&A(Math.max(re,V),v==null&&re<=F,Math.min(Q,R),_==null&&Q>=se,Y.dir)}if(V=J.to+1,V>=R)break}return L.length==0&&A(F,v==null,se,_==null,r.textDirection),{top:N,bottom:I,horizontal:L}}function x(v,_){let E=c.top+(_?v.top:v.bottom);return{top:E,bottom:E,horizontal:[]}}}function sameMarker(r,e){return r.constructor==e.constructor&&r.eq(e)}class LayerView{constructor(e,n){this.view=e,this.layer=n,this.drawn=[],this.scaleX=1,this.scaleY=1,this.measureReq={read:this.measure.bind(this),write:this.draw.bind(this)},this.dom=e.scrollDOM.appendChild(document.createElement("div")),this.dom.classList.add("cm-layer"),n.above&&this.dom.classList.add("cm-layer-above"),n.class&&this.dom.classList.add(n.class),this.scale(),this.dom.setAttribute("aria-hidden","true"),this.setOrder(e.state),e.requestMeasure(this.measureReq),n.mount&&n.mount(this.dom,e)}update(e){e.startState.facet(layerOrder)!=e.state.facet(layerOrder)&&this.setOrder(e.state),(this.layer.update(e,this.dom)||e.geometryChanged)&&(this.scale(),e.view.requestMeasure(this.measureReq))}docViewUpdate(e){this.layer.updateOnDocViewUpdate!==!1&&e.requestMeasure(this.measureReq)}setOrder(e){let n=0,o=e.facet(layerOrder);for(;n<o.length&&o[n]!=this.layer;)n++;this.dom.style.zIndex=String((this.layer.above?150:-1)-n)}measure(){return this.layer.markers(this.view)}scale(){let{scaleX:e,scaleY:n}=this.view;(e!=this.scaleX||n!=this.scaleY)&&(this.scaleX=e,this.scaleY=n,this.dom.style.transform=`scale(${1/e}, ${1/n})`)}draw(e){if(e.length!=this.drawn.length||e.some((n,o)=>!sameMarker(n,this.drawn[o]))){let n=this.dom.firstChild,o=0;for(let s of e)s.update&&n&&s.constructor&&this.drawn[o].constructor&&s.update(n,this.drawn[o])?(n=n.nextSibling,o++):this.dom.insertBefore(s.draw(),n);for(;n;){let s=n.nextSibling;n.remove(),n=s}this.drawn=e}}destroy(){this.layer.destroy&&this.layer.destroy(this.dom,this.view),this.dom.remove()}}const layerOrder=Facet.define();function layer(r){return[ViewPlugin.define(e=>new LayerView(e,r)),layerOrder.of(r)]}const CanHidePrimary=!(browser.ios&&browser.webkit&&browser.webkit_version<534),selectionConfig=Facet.define({combine(r){return combineConfig(r,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(e,n)=>Math.min(e,n),drawRangeCursor:(e,n)=>e||n})}});function drawSelection(r={}){return[selectionConfig.of(r),cursorLayer,selectionLayer,hideNativeSelection,nativeSelectionHidden.of(!0)]}function configChanged(r){return r.startState.facet(selectionConfig)!=r.state.facet(selectionConfig)}const cursorLayer=layer({above:!0,markers(r){let{state:e}=r,n=e.facet(selectionConfig),o=[];for(let s of e.selection.ranges){let a=s==e.selection.main;if(s.empty?!a||CanHidePrimary:n.drawRangeCursor){let l=a?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary",c=s.empty?s:EditorSelection.cursor(s.head,s.head>s.anchor?-1:1);for(let d of RectangleMarker.forRange(r,l,c))o.push(d)}}return o},update(r,e){r.transactions.some(o=>o.selection)&&(e.style.animationName=e.style.animationName=="cm-blink"?"cm-blink2":"cm-blink");let n=configChanged(r);return n&&setBlinkRate(r.state,e),r.docChanged||r.selectionSet||n},mount(r,e){setBlinkRate(e.state,r)},class:"cm-cursorLayer"});function setBlinkRate(r,e){e.style.animationDuration=r.facet(selectionConfig).cursorBlinkRate+"ms"}const selectionLayer=layer({above:!1,markers(r){return r.state.selection.ranges.map(e=>e.empty?[]:RectangleMarker.forRange(r,"cm-selectionBackground",e)).reduce((e,n)=>e.concat(n))},update(r,e){return r.docChanged||r.selectionSet||r.viewportChanged||configChanged(r)},class:"cm-selectionLayer"}),themeSpec={".cm-line":{"& ::selection, &::selection":{backgroundColor:"transparent !important"}},".cm-content":{"& :focus":{caretColor:"initial !important","&::selection, & ::selection":{backgroundColor:"Highlight !important"}}}};CanHidePrimary&&(themeSpec[".cm-line"].caretColor=themeSpec[".cm-content"].caretColor="transparent !important");const hideNativeSelection=Prec.highest(EditorView.theme(themeSpec));function iterMatches(r,e,n,o,s){e.lastIndex=0;for(let a=r.iterRange(n,o),l=n,c;!a.next().done;l+=a.value.length)if(!a.lineBreak)for(;c=e.exec(a.value);)s(l+c.index,c)}function matchRanges(r,e){let n=r.visibleRanges;if(n.length==1&&n[0].from==r.viewport.from&&n[0].to==r.viewport.to)return n;let o=[];for(let{from:s,to:a}of n)s=Math.max(r.state.doc.lineAt(s).from,s-e),a=Math.min(r.state.doc.lineAt(a).to,a+e),o.length&&o[o.length-1].to>=s?o[o.length-1].to=a:o.push({from:s,to:a});return o}class MatchDecorator{constructor(e){const{regexp:n,decoration:o,decorate:s,boundary:a,maxLength:l=1e3}=e;if(!n.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");if(this.regexp=n,s)this.addMatch=(c,d,u,m)=>s(m,u,u+c[0].length,c,d);else if(typeof o=="function")this.addMatch=(c,d,u,m)=>{let f=o(c,d,u);f&&m(u,u+c[0].length,f)};else if(o)this.addMatch=(c,d,u,m)=>m(u,u+c[0].length,o);else throw new RangeError("Either 'decorate' or 'decoration' should be provided to MatchDecorator");this.boundary=a,this.maxLength=l}createDeco(e){let n=new RangeSetBuilder,o=n.add.bind(n);for(let{from:s,to:a}of matchRanges(e,this.maxLength))iterMatches(e.state.doc,this.regexp,s,a,(l,c)=>this.addMatch(c,e,l,o));return n.finish()}updateDeco(e,n){let o=1e9,s=-1;return e.docChanged&&e.changes.iterChanges((a,l,c,d)=>{d>=e.view.viewport.from&&c<=e.view.viewport.to&&(o=Math.min(c,o),s=Math.max(d,s))}),e.viewportMoved||s-o>1e3?this.createDeco(e.view):s>-1?this.updateRange(e.view,n.map(e.changes),o,s):n}updateRange(e,n,o,s){for(let a of e.visibleRanges){let l=Math.max(a.from,o),c=Math.min(a.to,s);if(c>l){let d=e.state.doc.lineAt(l),u=d.to<c?e.state.doc.lineAt(c):d,m=Math.max(a.from,d.from),f=Math.min(a.to,u.to);if(this.boundary){for(;l>d.from;l--)if(this.boundary.test(d.text[l-1-d.from])){m=l;break}for(;c<u.to;c++)if(this.boundary.test(u.text[c-u.from])){f=c;break}}let p=[],g,y=(b,k,w)=>p.push(w.range(b,k));if(d==u)for(this.regexp.lastIndex=m-d.from;(g=this.regexp.exec(d.text))&&g.index<f-d.from;)this.addMatch(g,e,g.index+d.from,y);else iterMatches(e.state.doc,this.regexp,m,f,(b,k)=>this.addMatch(k,e,b,y));n=n.update({filterFrom:m,filterTo:f,filter:(b,k)=>b<m||k>f,add:p})}}return n}}const UnicodeRegexpSupport=/x/.unicode!=null?"gu":"g",Specials=new RegExp(`[\0-\b
-\x7F-\x9F\xAD\u061C\u200B\u200E\u200F\u2028\u2029\u202D\u202E\u2066\u2067\u2069\uFEFF\uFFF9-\uFFFC]`,UnicodeRegexpSupport),Names={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8294:"left-to-right isolate",8295:"right-to-left isolate",8297:"pop directional isolate",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};let _supportsTabSize=null;function supportsTabSize(){var r;if(_supportsTabSize==null&&typeof document<"u"&&document.body){let e=document.body.style;_supportsTabSize=((r=e.tabSize)!==null&&r!==void 0?r:e.MozTabSize)!=null}return _supportsTabSize||!1}const specialCharConfig=Facet.define({combine(r){let e=combineConfig(r,{render:null,specialChars:Specials,addSpecialChars:null});return(e.replaceTabs=!supportsTabSize())&&(e.specialChars=new RegExp("	|"+e.specialChars.source,UnicodeRegexpSupport)),e.addSpecialChars&&(e.specialChars=new RegExp(e.specialChars.source+"|"+e.addSpecialChars.source,UnicodeRegexpSupport)),e}});function highlightSpecialChars(r={}){return[specialCharConfig.of(r),specialCharPlugin()]}let _plugin=null;function specialCharPlugin(){return _plugin||(_plugin=ViewPlugin.fromClass(class{constructor(r){this.view=r,this.decorations=Decoration.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(r.state.facet(specialCharConfig)),this.decorations=this.decorator.createDeco(r)}makeDecorator(r){return new MatchDecorator({regexp:r.specialChars,decoration:(e,n,o)=>{let{doc:s}=n.state,a=codePointAt(e[0],0);if(a==9){let l=s.lineAt(o),c=n.state.tabSize,d=countColumn(l.text,c,o-l.from);return Decoration.replace({widget:new TabWidget((c-d%c)*this.view.defaultCharacterWidth/this.view.scaleX)})}return this.decorationCache[a]||(this.decorationCache[a]=Decoration.replace({widget:new SpecialCharWidget(r,a)}))},boundary:r.replaceTabs?void 0:/[^]/})}update(r){let e=r.state.facet(specialCharConfig);r.startState.facet(specialCharConfig)!=e?(this.decorator=this.makeDecorator(e),this.decorations=this.decorator.createDeco(r.view)):this.decorations=this.decorator.updateDeco(r,this.decorations)}},{decorations:r=>r.decorations}))}const DefaultPlaceholder="\u2022";function placeholder$1(r){return r>=32?DefaultPlaceholder:r==10?"\u2424":String.fromCharCode(9216+r)}class SpecialCharWidget extends WidgetType{constructor(e,n){super(),this.options=e,this.code=n}eq(e){return e.code==this.code}toDOM(e){let n=placeholder$1(this.code),o=e.state.phrase("Control character")+" "+(Names[this.code]||"0x"+this.code.toString(16)),s=this.options.render&&this.options.render(this.code,o,n);if(s)return s;let a=document.createElement("span");return a.textContent=n,a.title=o,a.setAttribute("aria-label",o),a.className="cm-specialChar",a}ignoreEvent(){return!1}}class TabWidget extends WidgetType{constructor(e){super(),this.width=e}eq(e){return e.width==this.width}toDOM(){let e=document.createElement("span");return e.textContent="	",e.className="cm-tab",e.style.width=this.width+"px",e}ignoreEvent(){return!1}}class GutterMarker extends RangeValue{compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}eq(e){return!1}destroy(e){}}GutterMarker.prototype.elementClass="",GutterMarker.prototype.toDOM=void 0,GutterMarker.prototype.mapMode=MapMode.TrackBefore,GutterMarker.prototype.startSide=GutterMarker.prototype.endSide=-1,GutterMarker.prototype.point=!0;function createUndoManager(r){const{createBlockTransaction:e}=r,n=useEventBus(),o=shallowReactive([]),s=shallowReactive([]);let a=0;const l=()=>{s.length=0,o.length=0,a=0},c=()=>{const d=o.length;s.push(d)};return n.on("afterBlocksTrCommit",([d])=>{!d.meta.isUndoRedo&&d.meta.canUndo&&(o.length=a,o.push(d),a=o.length,d.meta.autoAddUndoPoint&&c()),(!d.meta.canUndo||d.origin.type!=="ui")&&l()}),{undo:()=>{var B;const d=s[s.length-1];a>d&&s.push(a);const u=s.indexOf(a);if(u==-1||u==0)return;const m=s[u-1],f=[...o.slice(m,a)];f.reverse(),(B=document.activeElement)==null||B.blur();const p=e({type:"ui"}).setMeta("isUndoRedo",!0);for(const M of f)p.addReverseTransaction(M);p.commit();const g=f[0].meta.envUndoStrategy==="beforeCommit"?f[0].envInfo.beforeCommit:f[0].envInfo.onCreate,{rootBlockId:y,focusedTreeId:b,focusedItemId:k,selection:w}=g??{};setTimeout(()=>{try{if(r.mainRootBlockId.value=y??null,b){const M=r.getBlockTree(b);if(M&&k&&(M.focusDi(k),w!=null)){const x=M.getEditorView(k);if(x instanceof EditorView$1){const v=Selection.fromJSON(x.state.doc,w),_=x.state.tr.setSelection(v);x.dispatch(_)}else if(x instanceof EditorView){const v=EditorSelection.fromJSON(w);x.dispatch({selection:v})}}}}catch{}}),a=m},redo:()=>{var w;const d=s.indexOf(a);if(d==-1)return;if(d==s.length-1){console.warn("Already reached the last state, cannot redo");return}const u=s[d+1],m=[...o.slice(a,u)];(w=document.activeElement)==null||w.blur();const f=e({type:"ui"}).setMeta("isUndoRedo",!0);for(const B of m)f.addTransaction(B);f.commit();const p=m[0].meta.envUndoStrategy==="beforeCommit"?m[0].envInfo.beforeCommit:m[0].envInfo.onCreate,{rootBlockId:g,focusedTreeId:y,focusedItemId:b,selection:k}=p??{};setTimeout(()=>{try{if(r.mainRootBlockId.value=g??null,y){const B=r.getBlockTree(y);if(B&&b&&(B.focusDi(b),k!=null)){const M=B.getEditorView(b);if(M instanceof EditorView$1){const x=Selection.fromJSON(M.state.doc,k),v=M.state.tr.setSelection(x);M.dispatch(v)}else if(M instanceof EditorView){const x=EditorSelection.fromJSON(k);M.dispatch({selection:x})}}}}catch{}}),a=u},addUndoPoint:c,clearUndoRedoHistory:l}}const DI_FILTERS={isBlockDi:r=>r.type==="basic-block"||r.type==="backlink-block"||r.type==="backlink-descendant"||r.type==="potential-links-block"||r.type==="potential-links-descendant"},BlockTreeContext=createContext(()=>{const r=new Map;return{registerBlockTree:e=>{r.set(e.getId(),e)},getBlockTree:e=>r.get(e),unregisterBlockTree:e=>{r.delete(e)}}}),LastFocusContext=createContext(()=>{const r=shallowRef(null),e=shallowRef(null);return{lastFocusedDiId:r,lastFocusedBlockTree:e}}),MainTreeContext=createContext(()=>({mainRootBlockId:useLocalStorage("mainRootBlockId","root")})),INTERNAL_BLOCK_PARENT_ID="_internal";z.any().pipe(z.union([z.object({type:z.literal("ui"),changeSources:z.array(z.string()).optional()}),z.object({type:z.literal("local")}),z.object({type:z.literal("remote")})]));const cloneBlock=r=>r?{type:r.type,id:r.id,parentId:r.parentId,parentRef:r.parentRef,childrenIds:[...r.childrenIds],childrenRefs:[...r.childrenRefs],fold:r.fold,deleted:r.deleted,content:JSON.parse(JSON.stringify(r.content)),ctext:r.ctext,metadata:JSON.parse(JSON.stringify(r.metadata)),mtext:r.mtext,olinks:[...r.olinks],boosting:r.boosting,acturalSrc:r.acturalSrc,...r.type=="normalBlock"?{docId:r.docId}:{},...r.type=="mirrorBlock"?{src:r.src}:{},...r.type=="virtualBlock"?{src:r.src,childrenCreated:r.childrenCreated}:{},origin:r.origin}:null,createBlocksManager=r=>{const e=useEventBus(),n=new Map,o=new Map,s=new Map,a=new Map,l=new Set,{lastFocusedBlockTree:c,lastFocusedDiId:d}=LastFocusContext.useContext(),{mainRootBlockId:u}=MainTreeContext.useContext(),{getBlockTree:m}=BlockTreeContext.useContext(),f=ref(!1),p=ref(new Map);r.on("docSynced",({docId:j,hasSyncEvent:q})=>{q?p.value.set(j,"waitForEventProcessing"):(p.value.set(j,"synced"),f.value==!1&&j==BLOCK_INFO_DOC_NAME&&(f.value=!0))}),r.on("disconnected",()=>{for(const j of p.value.keys())p.value.set(j,"disconnected");f.value=!1});const g={getBlockInfo:new Map,getBlockData:new Map},y=j=>{let q=n.get(j);return q||(q=shallowRef(null),n.set(j,q)),q},b=(j,q=!0)=>{const ee=y(j);return ee.value?q?cloneBlock(ee.value):ee.value:null},k=j=>{const q=b(j);return!q||q.parentId=="null"?null:b(q.acturalSrc)||null},w=j=>{let q=y(j);if(!q)return[];const ee=[];for(;q.value&&(ee.push(q.value),q.value.id!="root");){const G=q.value.parentRef;G.value?q=G:q=y(q.value.parentId)}return ee},B=j=>w(j).length-1,M=({onEachBlock:j,onMissingBlock:q,rootBlockId:ee,afterLeavingChildrens:G,rootBlockLevel:te,nonFoldOnly:ce,includeSelf:W,ignore:U})=>{if(ce??(ce=!0),W??(W=!0),te==null){const $=w(ee);if(!$){console.error("[blocksManager] cannot get path of ",ee);return}te=$.length-1}const P=($,K)=>{const ne=U==null?void 0:U($,K);if(ne!=="ignore-self-and-descendants"&&((W||$.id!=ee)&&j($,K),ne!=="ignore-descendants"&&!(ne!=="keep-self-and-descendants"&&ce&&$.fold)&&typeof $.childrenIds!="string")){for(let oe=0;oe<$.childrenIds.length;oe++){const ae=$.childrenIds[oe],de=$.childrenRefs[oe];if(de.value){const le=toRaw(de.value);P(le,K+1)}else o.set(ae,$.id),q==null||q(ae,$.id,K+1)}G&&G($,K)}},Z=b(ee);if(!Z){console.error("[blocksManager] Cannot find root block",ee);return}P(Z,te)},x=({onEachBlock:j,rootBlockId:q,afterLeavingChildrens:ee,rootBlockLevel:G,nonFoldOnly:te,includeSelf:ce,ignore:W})=>{if(te??(te=!0),ce??(ce=!0),G==null){const Z=w(q);if(!Z){console.error("[blocksManager] cannot get path of ",q);return}G=Z.length-1}const U=(Z,$)=>{const K=W==null?void 0:W(Z,$);if(K!=="ignore-self-and-descendants"&&((ce||Z.id!=q)&&j(Z,$),K!=="ignore-descendants"&&!(K!=="keep-self-and-descendants"&&te&&Z.fold)&&typeof Z.childrenIds!="string")){for(const ne of Z.childrenRefs)if(ne.value&&!ne.value.deleted){const oe=toRaw(ne.value);U(oe,$+1)}ee&&ee(Z,$)}},P=b(q);if(!P){console.error("[blocksManager] Cannot find root block",q);return}U(P,G)},v=(j,q)=>{if(j[0]===BLOCK_CONTENT_TYPES.TEXT){const ee=getPmSchema({getBlockRef:y}),G=Node$1.fromJSON(ee,j[1]),te=[];return G.descendants(ce=>{!q&&ce.type.name=="blockRef_v2"&&ce.attrs.tag||te.push(ce.textContent)}),te.join("")}else return j[0]==BLOCK_CONTENT_TYPES.CODE?`${j[1]} (${j[2]})`:j[0]==BLOCK_CONTENT_TYPES.MATH?j[1]:(console.warn("[blocksManager] unsupported block content type"),"")},_=j=>{const q=te=>/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(te),ee=[],G=["specs","status","no","ncols","paragraph"];for(const[te,ce]of Object.entries(j??{})){if(G.includes(te))continue;ee.push(te),ee.push(": ");let W;if(typeof ce=="string")W=[ce];else if(Array.isArray(ce))W=ce;else continue;for(const U of W){if(q(U)){const P=b(U);if(!P)continue;const Z=v(P.content);ee.push(Z)}else ee.push(U);ee.push(", ")}ee.pop(),ee.push("; ")}return ee.pop(),ee.join("")},E=(j,q="both")=>{const ee=getPmSchema({getBlockRef:y}),G=Node$1.fromJSON(ee,j),te=[];return G.descendants(ce=>{ce.isAtom&&ce.type.name=="blockRef_v2"&&(q==="blockRef"&&!ce.attrs.tag||q==="tag"&&ce.attrs.tag||q==="both")&&te.push(ce.attrs.toBlockId)}),te},N=async j=>{const q=g.getBlockInfo.get(j);q&&await q.promise;let ee=s.get(j)??null;if(!ee){let G,te;const ce=new Promise((W,U)=>{G=W,te=U});g.getBlockInfo.set(j,{promise:ce,resolve:G,reject:te,desc:"getBlockInfo of "+j}),await ce}return ee=s.get(j)??null,ee},I=async(j,q)=>{const ee=g.getBlockData.get(j);ee&&await ee.promise;let G;const te=b(j);if(te?G=[te.content,te.metadata]:G=a.get(j)??null,!G){l.has(q)||(r.loadDataDoc(q),l.add(q));let ce,W;const U=new Promise((P,Z)=>{ce=P,W=Z});g.getBlockData.set(j,{promise:U,resolve:ce,reject:W,desc:"getBlockData of "+j}),await U}return G=a.get(j)??null,G};r.on("blockDataMapChange",({docId:j,origin:q,changes:ee})=>{const G=se(q);if(q.type!="ui"){console.debug("[blocksManager] in app, blockDataMapChange",dayjs().valueOf(),ee);for(const te of ee)if(te.op=="upsert"){if(te.value==null){console.log("[blocksManager] invalid change (no value), ignored!");continue}a.set(te.key,te.value);const ce=g.getBlockData.get(te.key);ce&&(ce.resolve(te.value),g.getBlockData.delete(te.key));const W=y(te.key);if(W.value!=null&&W.value.type==="normalBlock"){const[U,P]=te.value;if(U==null){console.error("[blocksManager] blockDataMap changed, but normal block doesn't have content",te.key);continue}G.updateBlock({...W.value,content:U,metadata:P})}}else te.op=="delete"&&a.delete(te.key);G.patches.length>0&&G.commit(),p.value.set(`${BLOCK_DATA_DOC_NAME_PREFIX}${j}`,"synced")}}),r.on("blockInfoMapChange",({origin:j,changes:q})=>{const ee=se(j);if(j.type==="ui")return;console.debug("[blocksManager] in app, blockInfoMapChange",dayjs().valueOf(),q);const G=[];for(const te of q)if(te.op=="delete")s.delete(te.key),n.get(te.key)&&(console.debug("[blocksManager] Deleting block from loadedBlocks:",te.key),ee.deleteBlock(te.key));else if(te.op=="upsert"){if(te.value==null){console.log("[blocksManager] invalid change (no value), ignored!");continue}const[ce,W,U,P,Z]=te.value,{type:$,fold:K}=extractBlockStatus(ce);if(s.set(te.key,te.value),$=="normalBlock"){if(P==null||!te.value)continue;const ne=(async()=>{const oe=await I(te.key,P);if(!oe){console.error("[blocksManager] Cannot find block data for block",te.key);return}ee.addBlock({type:"normalBlock",id:te.key,parentId:W,childrenIds:U,fold:K,content:oe[0],metadata:oe[1],docId:P})})();G.push(ne)}else{if(!Z||!te.value)continue;const ne=(async()=>{const oe=await N(Z);if(!oe){console.error("[blocksManager] Cannot find block info for block",Z);return}const[ae,de,le,he]=oe,{type:ue,fold:me}=extractBlockStatus(ae);if(ue=="normalBlock"){if(he==null){console.error("[blocksManager] Src doc id is null, this should not happen",te.key);return}if(console.debug("[blocksManager] getBlockDataOrWait",Z,he),!await I(Z,he)){console.error("[blocksManager] Cannot find block data for block",Z);return}ee.addBlock({type:$,id:te.key,parentId:W,childrenIds:U,fold:K,src:Z,...$==="virtualBlock"?{childrenCreated:le.length==U.length}:{}})}else{console.error("[blocksManager] Src type must be normalBlock, but got",ue);return}})();G.push(ne)}}Promise.all(G).then(()=>{console.debug("[blocksManager] in app, all resolved",dayjs().valueOf()),ee.commit(),p.value.set(BLOCK_INFO_DOC_NAME,"synced"),f.value=!0,console.debug("[blocksManager] in app, transaction commit",dayjs().valueOf())})});const L=async()=>{const j=nanoid(),q=getPmSchema({getBlockRef:y});se({type:"ui"}).addBlock({type:"normalBlock",id:j,fold:!1,parentId:"root",childrenIds:[],content:plainTextToTextContent("",q),metadata:{}}).addBlock({type:"normalBlock",id:"root",fold:!1,parentId:"root",childrenIds:[j],content:plainTextToTextContent("",q),metadata:{}}).commit()},A=()=>y("root"),F=()=>{n.clear(),g.getBlockInfo.clear(),g.getBlockData.clear(),e.emit("blocksDestroy")},{createBlockTransaction:se,addBlock:H,updateBlock:V,deleteBlock:R}=useBlockTransaction({blocks:n,yjsLayer:r,latestBlockInfos:s,latestBlockDatas:a,getBlockRef:y,getCtext:v,getMtext:_,getOlinks:E,mainRootBlockId:u,lastFocusedBlockTree:c,lastFocusedDiId:d}),{undo:J,redo:Y,addUndoPoint:re,clearUndoRedoHistory:Q}=createUndoManager({createBlockTransaction:se,mainRootBlockId:u,getBlockTree:m});return{loadedBlocks:n,latestBlockInfos:s,latestBlockDatas:a,pendingTasks:g,missingBlockParents:o,synced:f,getBlock:b,getBlockRef:y,getRootBlockRef:A,getBlockPath:w,getBlockLevel:B,forDescendants:x,forDescendantsWithMissingBlock:M,createBlockTransaction:se,addBlock:H,updateBlock:V,deleteBlock:R,destroy:F,undo:J,redo:Y,getCtext:v,getMtext:_,getOlinks:E,getSrcBlock:k,createNewTree:L,addUndoPoint:re,clearUndoRedoHistory:Q}},createBlocksEditor=(r,e,n)=>{const o=a=>{if("parentId"in a)if(typeof a.childIndex=="string"){const l=r.getBlock(a.parentId);return l?{parentId:a.parentId,childIndex:a.childIndex=="first"?0:a.childIndex=="last"?l.childrenIds.length-1:l.childrenIds.length}:null}else return a;else{const l=r.getBlock(a.baseBlockId);if(!l||l.id=="root")return null;const c=l.parentRef.value;if(!c)return null;const d=c.childrenIds.indexOf(a.baseBlockId);return{parentId:c.id,childIndex:Math.min(c.childrenIds.length,Math.max(0,d+a.offset))}}},s=(a,l)=>{const c=r.getBlock(a);c&&(l??(l=!c.fold),c.fold!=l&&(c.fold=l,r.updateBlock(c,{type:"ui"})))};return{normalizePos:o,changeBlockContent:a=>{let{blockId:l,content:c,tr:d,commit:u}=a;d??(d=r.createBlockTransaction({type:"ui",changeSources:[l]})),u??(u=!0);const m=r.getBlock(l);if(!m)return;const f=n().getOccurs(m.acturalSrc),p=r.getCtext(c),g=c[0]===BLOCK_CONTENT_TYPES.TEXT?r.getOlinks(c[1]):[],y=0;for(const b of f){const k=r.getBlock(b);k&&(k.content=c,k.ctext=p,k.olinks=g,k.boosting=y,d.updateBlock(k))}u&&d.commit()},setBlockMetadata:a=>{let{blockId:l,metadata:c,tr:d,commit:u}=a;d??(d=r.createBlockTransaction({type:"ui",changeSources:[l]})),u??(u=!0);const m=r.getBlock(l);if(!m)return;const f=n().getOccurs(m.acturalSrc);for(const p of f){const g=r.getBlock(p);g&&(g.metadata=c,d.updateBlock(g))}u&&d.commit()},insertNormalBlock:a=>{let{pos:l,content:c,meta:d,childrenIds:u,tr:m,commit:f}=a;u??(u=[]),m??(m=r.createBlockTransaction({type:"ui"})),f??(f=!0);const p=n(),g=o(l);if(!g)return;const{parentId:y,childIndex:b}=g,k=r.getBlock(y);if(!k)return;const w=k.type=="normalBlock"?k:r.getBlock(k.acturalSrc);if(!w)return;const B=nanoid();m.addBlock({id:B,type:"normalBlock",parentId:y,childrenIds:u,fold:!0,content:c,metadata:d??{}}),y==w.id&&w.fold&&(w.fold=!1),w.childrenIds.splice(b,0,B),m.updateBlock(w);const M=p.getOccurs(w.acturalSrc,!1);for(const x of M){const v=r.getBlock(x);if(!v||v.type=="virtualBlock"&&!v.childrenCreated)continue;const _=nanoid();m.addBlock({id:_,type:"virtualBlock",childrenIds:[],fold:!0,parentId:v.id,src:B,childrenCreated:!1}),x==y&&v.fold&&(v.fold=!1),v.childrenIds.splice(b,0,_),m.updateBlock(v)}return f&&m.commit(),{newNormalBlockId:B}},insertNormalBlocks:a=>{let{pos:l,blocks:c,tr:d,commit:u}=a;if(c.length===0)return;d??(d=r.createBlockTransaction({type:"ui"})),u??(u=!0);const m=n();let f;const p=o(l);if(!p)return;const{parentId:g,childIndex:y}=p,b=r.getBlock(g);if(!b)return;const k=b.type=="normalBlock"?b:r.getBlock(b.acturalSrc);if(!k)return;const w=c.map(M=>M.id??nanoid());c.forEach(({content:M,meta:x,childrenIds:v},_)=>{const E=w[_];d.addBlock({id:E,type:"normalBlock",parentId:g,childrenIds:v??[],fold:!1,content:M,metadata:x??{}})}),k.childrenIds.splice(y,0,...w),k.fold&&(k.fold=!1),d.updateBlock(k),g==k.id&&(f=w[0]);const B=m.getOccurs(k.acturalSrc,!1);for(const M of B){const x=r.getBlock(M);if(!x||x.type=="virtualBlock"&&!x.childrenCreated)continue;const v=w.map(_=>{const E=nanoid();return d.addBlock({id:E,type:"virtualBlock",childrenIds:[],fold:!0,parentId:x.id,src:_,childrenCreated:!1}),E});x.childrenIds.splice(y,0,...v),M==g&&(x.fold=!1,f=v[0]),d.updateBlock(x)}return u&&d.commit(),{focusNext:f,newNormalBlockIds:w}},insertMirrorBlock:a=>{let{pos:l,srcBlockId:c,tr:d,commit:u}=a;d??(d=r.createBlockTransaction({type:"ui"})),u??(u=!0);const m=n(),f=o(l);if(!f)return;const{parentId:p,childIndex:g}=f,y=r.getBlock(p);if(!y)return;const b=y.type=="normalBlock"?y:r.getBlock(y.acturalSrc);if(!b)return;const k=r.getBlock(c);if(!k)return;const w=k.type==="normalBlock"?k:r.getBlock(k.acturalSrc);if(!w)return;const B=nanoid(),M=[];for(const _ of w.childrenIds){const E=r.getBlock(_);if(!E)continue;const N={...E,id:nanoid(),parentId:B,type:"virtualBlock",fold:!0,src:_,acturalSrc:"src"in E?E.src:E.id,childrenCreated:!1};d.addBlock(N),M.push(N.id)}const x={...k,id:B,parentId:b.id,type:"mirrorBlock",childrenIds:M,fold:!0,src:w.id};d.addBlock(x),p==b.id&&(b.fold=!1),b.childrenIds.splice(g,0,x.id),d.updateBlock(b);const v=m.getOccurs(b.id,!1);for(const _ of v){const E=r.getBlock(_);if(!E)continue;const N={...x,id:nanoid(),parentId:_,type:"virtualBlock",childrenIds:[],fold:!0,src:x.id,childrenCreated:!1};_==p&&(E.fold=!1),!(E.type==="virtualBlock"&&!E.childrenCreated)&&(E.childrenIds.splice(g,0,N.id),d.updateBlock(E))}return u&&d.commit(),{}},deleteBlock:a=>{let{blockId:l,tr:c,commit:d}=a;d??(d=!0);const u=n(),m=r.getBlock(l);if(!m){const g=r.createBlockTransaction({type:"ui"}),y=r.missingBlockParents.get(l);if(!y)return;const b=r.getBlock(y);if(!b)return;const k=b.childrenIds.indexOf(l);if(k<0)return;const w=u.getOccurs(b.acturalSrc,!0);for(const B of w){const M=r.getBlock(B);M&&(M.childrenIds.splice(k,1),g.updateBlock(M))}g.commit();return}const f=[],p=g=>{if(g.type=="normalBlock"||g.type=="virtualBlock"){const y=u.getOccurs(g.acturalSrc,!0).map(b=>r.getBlock(b)).filter(b=>b!=null);f.push(...y);for(const b of y)for(const k of b.childrenIds){const w=r.getBlock(k);w&&p(w)}}else if(g.type=="mirrorBlock"){f.push(g);for(const y of g.childrenIds){const b=r.getBlock(y);b&&p(b)}}};p(m),c??(c=r.createBlockTransaction({type:"ui"}));for(const g of f)c.deleteBlock(g.id);if(m.type=="normalBlock"||m.type=="virtualBlock"){const g=r.getBlock(m.parentId);if(!g)return;const y=g.childrenIds.indexOf(m.id);if(y<0)return;const b=u.getOccurs(g.acturalSrc,!0);for(const k of b){const w=r.getBlock(k);w&&(w.childrenIds.splice(y,1),c.updateBlock(w))}}else{const g=r.getBlock(m.parentId);if(!g)return;const y=g.childrenIds.indexOf(m.id);if(y<0)return;g.childrenIds.splice(y,1),c.updateBlock(g)}d&&c.commit()},promoteBlock:a=>{let{blockId:l,tr:c,commit:d}=a;c??(c=r.createBlockTransaction({type:"ui"})),d??(d=!0);const u=n(),m=r.getBlock(l);if(!m||m.id=="root")return;const f=r.getBlock(m.acturalSrc);if(!f)return;const p=m.parentRef.value;if(!p)return;const g=r.getBlock(p.acturalSrc);if(!g)return;const y=p.childrenIds.indexOf(m.id);if(y<=0)return;const b=r.getBlock(p.childrenIds[y-1]);if(!b)return;const k=r.getBlock(b.acturalSrc);if(!k)return;const w=g.childrenIds.splice(y,1)[0],B=r.getBlock(w);if(!B)return;c.updateBlock(g),k.childrenIds.push(w),k.id==b.id&&(k.fold=!1),c.updateBlock(k),B.parentId=k.id,c.updateBlock(B);const M=u.getOccurs(g.id,!1);for(const v of M){const _=r.getBlock(v);if(!_||_.type=="virtualBlock"&&!_.childrenCreated)continue;const E=_.childrenIds.splice(y,1)[0];c.updateBlock(_),c.deleteBlock(E)}const x=u.getOccurs(k.id,!1);for(const v of x){const _=r.getBlock(v);if(!_||_.type=="virtualBlock"&&!_.childrenCreated)continue;const E={...f,id:nanoid(),parentId:_.id,type:"virtualBlock",fold:!0,src:f.id,childrenCreated:!1};_.childrenIds.push(E.id),v==b.id&&(_.fold=!1),c.updateBlock(_),c.addBlock(E)}return d&&c.commit(),{}},demoteBlock:a=>{let{blockId:l,tr:c,commit:d}=a;c??(c=r.createBlockTransaction({type:"ui"})),d??(d=!0);const u=n(),m=r.getBlock(l);if(!m||m.parentId=="null")return;const f=r.getBlock(m.acturalSrc);if(!f)return;const p=r.getBlock(m.parentId);if(!p||p.parentId=="null")return;const g=r.getBlock(p.acturalSrc);if(!g)return;const y=r.getBlock(p.parentId);if(!y)return;const b=r.getBlock(y.acturalSrc);if(!b)return;const k=g.childrenIds.indexOf(f.id),w=g.childrenIds.splice(k,1)[0],B=r.getBlock(w);if(!B)return;c.updateBlock(g);let M;p.type=="mirrorBlock"&&y.type=="normalBlock"?(M=y.childrenIds.indexOf(p.id),y.childrenIds.splice(M+1,0,w),c.updateBlock(y),B.parentId=y.id,c.updateBlock(B)):(M=b.childrenIds.indexOf(g.id),b.childrenIds.splice(M+1,0,w),c.updateBlock(b),B.parentId=b.id,c.updateBlock(B));const x=u.getOccurs(g.id,!1);for(const _ of x){const E=r.getBlock(_);if(!E||E.type=="virtualBlock"&&!E.childrenCreated)continue;const N=E.childrenIds.splice(k,1)[0];c.updateBlock(E),c.deleteBlock(N)}const v=u.getOccurs(b.id,!1);for(const _ of v){const E=r.getBlock(_);if(!E||E.type=="virtualBlock"&&!E.childrenCreated)continue;const N={...f,id:nanoid(),parentId:E.id,type:"virtualBlock",fold:!0,src:f.id,childrenCreated:!1};E.childrenIds.splice(M+1,0,N.id),c.updateBlock(E),c.addBlock(N)}return d&&c.commit(),{}},toggleFold:s,moveBlock:a=>{let{blockId:l,pos:c,tr:d,commit:u}=a;u??(u=!0);const m=n(),f=o(c);if(!f)return null;const p=r.getBlock(l);if(!p)return null;const g=r.getBlock(p.acturalSrc);if(!g)return null;const y=r.getBlock(g.parentId);if(!y)return null;const b=r.getBlock(f.parentId);if(!b)return null;const k=r.getBlock(b.acturalSrc);if(!k)return null;const w=y.childrenIds.indexOf(g.id);if(w==-1)return null;let B;if(y.id===k.id?B=w<f.childIndex?f.childIndex-1:f.childIndex:B=f.childIndex,B<0||B>k.childrenIds.length)return null;if(d??(d=r.createBlockTransaction({type:"ui"})),y.id==k.id){if(w==f.childIndex||w+1==f.childIndex)return null;y.childrenIds.splice(w,1),y.childrenIds.splice(B,0,g.id),d.updateBlock(y)}else y.childrenIds.splice(w,1),d.updateBlock(y),k.childrenIds.splice(B,0,g.id),d.updateBlock(k),g.parentId=k.id,d.updateBlock(g);const M=m.getOccurs(y.id,!1);for(const v of M){const _=r.getBlock(v);if(!_||_.type=="virtualBlock"&&!_.childrenCreated)continue;const E=_.childrenIds.splice(w,1)[0];d.updateBlock(_),d.deleteBlock(E)}const x=m.getOccurs(k.id,!1);for(const v of x){const _=r.getBlock(v);if(!_||_.type=="virtualBlock"&&!_.childrenCreated)continue;const E={...structuredClone(g),id:nanoid(),parentId:_.id,type:"virtualBlock",childrenIds:[],fold:!0,src:g.id,childrenCreated:!1};_.childrenIds.splice(B,0,E.id),d.updateBlock(_),d.addBlock(E)}return u&&d.commit(),{}},moveBlocks:a=>{let{blockIds:l,pos:c,tr:d,commit:u}=a;u??(u=!0),d??(d=r.createBlockTransaction({type:"ui"}));const m=n(),f=o(c);if(!f)return null;const p=l[0],g=r.getBlock(p);if(!g)return null;const y=cloneBlock(g.parentRef.value);if(!y)return null;const b=y.childrenIds.indexOf(p);if(b==-1)return null;for(let v=1;v<l.length;v++){const _=l[v],E=y.childrenIds[b+v];if(_!==E)return null}const k=b+l.length-1,w=y.type==="normalBlock"?y:r.getBlock(y.acturalSrc);if(!w)return null;const B=r.getBlock(f.parentId);if(!B)return null;const M=B.type==="normalBlock"?B:r.getBlock(B.acturalSrc);if(!M)return null;let x;if(w.id===M.id){if(f.childIndex>=b&&f.childIndex<=k+1)return null;x=w.childrenIds.splice(b,l.length);const v=f.childIndex<b?f.childIndex:f.childIndex-l.length;w.childrenIds.splice(v,0,...x),d.updateBlock(w);const _=m.getOccurs(w.id,!1);for(const E of _){const N=r.getBlock(E);if(!N||N.type=="virtualBlock"&&!N.childrenCreated)continue;const I=N.childrenIds.splice(b,l.length);N.childrenIds.splice(v,0,...I),d.updateBlock(N)}}else{x=w.childrenIds.splice(b,l.length),d.updateBlock(w),M.childrenIds.splice(f.childIndex,0,...x),d.updateBlock(M);for(const E of x){const N=r.getBlock(E);N&&(N.parentId=M.id,d.updateBlock(N))}const v=m.getOccurs(w.id,!1);for(const E of v){const N=r.getBlock(E);!N||N.type=="virtualBlock"&&!N.childrenCreated||(N.childrenIds.splice(b,l.length),d.updateBlock(N))}const _=m.getOccurs(M.id,!1);for(const E of _){const N=r.getBlock(E);if(!N||N.type=="virtualBlock"&&!N.childrenCreated)continue;const I=[];for(const L of x){const A=r.getBlock(L);if(!A)continue;const F={...A,id:nanoid(),parentId:N.id,type:"virtualBlock",childrenIds:[],fold:!0,src:A.id,childrenCreated:!1};I.push(F.id),d.addBlock(F)}N.childrenIds.splice(f.childIndex,0,...I),d.updateBlock(N)}}return u&&d.commit(),{}},locateBlock:async(a,l)=>{const c=[e.value],d=r.getBlockPath(a);if(d==null)return;let u,m;for(const f of c)if(m=d.findIndex(p=>p.id===f),m!=-1){u=f;break}if(u&&m!=null&&m>0)for(let f=m;f>0;f--){const p=d[f];p.fold&&await s(p.id,!1)}else{if((l==null?void 0:l.getId())!=="main")return;const f=r.getBlockPath(c[0]);if(!f)return;let p=f.length-1,g=d.length-1;for(;p>=0&&g>=0&&f[p].id==d[g].id;)p--,g--;const y=p<0?f[0]:g<0?d[0]:f[p+1],b=p<0?d.slice(0,g+1):g<0?f.slice(0,p+1):d.slice(g);e.value=y.id;for(const k of b)k.fold&&await s(k.id,!1)}}}},kbViewRegistry=createContext(()=>{const r={};return{register:(e,n)=>{r[e]=n},get:e=>r[e]}}),BlocksContext=createContext(()=>{const r=useRouterParams(),{token:e}=ServerInfoContext.useContext(),{get:n}=kbViewRegistry.useContext(),{mainRootBlockId:o}=MainTreeContext.useContext(),s=()=>n("index"),a=createSyncLayer(),l=createBlocksManager(a),c=createBlocksEditor(l,o,s);return watch(r,d=>{a.disconnect();const{serverUrl:u,location:m}=d??{};!u||!m||!e.value||a.connect(decodeURIComponent(u),decodeURIComponent(m),e.value)},{immediate:!0}),{blocksManager:l,blockEditor:c,syncLayer:a,synced:l.synced}}),FocusModeContext=createContext(()=>{const r=ref(!1),e=ref(!1);return{focusModeEnabled:r,focusNow:e}}),SPACE_OR_PUNCTUATION=/[|\n\r\s!"'&()*,\-./:;<=>?@[\\\]^_`{}~\u00A0\u00A1\u00A7\u00AB\u00B6\u00B7\u00BB\u00BF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]+/u,CJK=/[\u4E00-\u9FA5]/,ngramSplit=(r,e)=>{const n=[];for(let o=0;o<r.length-e+1;o++)n.push(r.slice(o<0?0:o,o+e));return n},extractAllPrefixies=r=>{const e=[];for(let n=1;n<=r.length;n++)e.push(r.slice(0,n));return e},splitByCjk=(r,e,n,o={})=>{let s=!1;const a=[],l=(c,d)=>{o.caseSensitive||(c=c.toLowerCase()),d?e(c):n(c)};for(const c of r)if(SPACE_OR_PUNCTUATION.test(c))a.length>0&&(l(a.join(""),s),a.length=0);else if(a.length==0)a.push(c),s=CJK.test(c);else{const d=CJK.test(c);d!=s?(l(a.join(""),s),a.length=0,a.push(c),s=d):a.push(c)}a.length>0&&l(a.join(""),s)},hybridTokenize=(r,e=!1,n=2,o=!0)=>{const s=[];return splitByCjk(r,a=>s.push(...ngramSplit(a,n)),a=>{s.push(a),o&&s.push(...extractAllPrefixies(a).slice(0,-1))},{caseSensitive:e}),s},calcMatchScore=(r,e)=>{let n=0;const o=e.toLowerCase();for(const s of r)o.includes(s)&&(n+=s.length);return n/e.length};function parse_option(r,e){return typeof r<"u"?r:e}function create_object_array(r){const e=Array(r);for(let n=0;n<r;n++)e[n]=create_object();return e}function get_keys(r){return Object.keys(r)}function create_object(){return Object.create(null)}function concat(r){return[].concat.apply([],r)}function sort_by_length_down(r,e){return e.length-r.length}function is_array(r){return r.constructor===Array}function is_string(r){return typeof r=="string"}function is_object(r){return typeof r=="object"}function is_function(r){return typeof r=="function"}function pipeline(r,e,n,o){if(r&&(e&&(r=replace(r,e)),this.matcher&&(r=replace(r,this.matcher)),this.stemmer&&1<r.length&&(r=replace(r,this.stemmer)),o&&1<r.length&&(r=collapse(r)),n||n==="")){const s=r.split(n);return this.filter?filter(s,this.filter):s}return r}const regex_whitespace=/[\p{Z}\p{S}\p{P}\p{C}]+/u;function init_filter(r){const e=create_object();for(let n=0,o=r.length;n<o;n++)e[r[n]]=1;return e}function init_stemmer_or_matcher(r,e){const n=get_keys(r),o=n.length,s=[];let a="",l=0;for(let c=0,d,u;c<o;c++)d=n[c],u=r[d],u?(s[l++]=regex(e?"(?!\\b)"+d+"(\\b|_)":d),s[l++]=u):a+=(a?"|":"")+d;return a&&(s[l++]=regex(e?"(?!\\b)("+a+")(\\b|_)":"("+a+")"),s[l]=""),s}function replace(r,e){for(let n=0,o=e.length;n<o&&(r=r.replace(e[n],e[n+1]),!!r);n+=2);return r}function regex(r){return new RegExp(r,"g")}function collapse(r){let e="",n="";for(let o=0,s=r.length,a;o<s;o++)(a=r[o])!==n&&(e+=n=a);return e}function filter(r,e){const n=r.length,o=[];for(let s=0,a=0;s<n;s++){const l=r[s];l&&!e[l]&&(o[a++]=l)}return o}function encode(r){return pipeline.call(this,(""+r).toLowerCase(),!1,regex_whitespace,!1)}const global_lang={},global_charset={};function apply_async(r){register$1(r,"add"),register$1(r,"append"),register$1(r,"search"),register$1(r,"update"),register$1(r,"remove")}function register$1(r,e){r[e+"Async"]=function(){const n=this,o=arguments,s=o[o.length-1];let a;is_function(s)&&(a=s,delete o[o.length-1]);const l=new Promise(function(c){setTimeout(function(){n.async=!0;const d=n[e].apply(n,o);n.async=!1,c(d)})});return a?(l.then(a),this):l}}function intersect(r,e,n,o){const s=r.length;let a=[],l,c,d=0;o&&(o=[]);for(let u=s-1;0<=u;u--){const m=r[u],f=m.length,p=create_object();let g=!l;for(let y=0;y<f;y++){const b=m[y],k=b.length;if(k)for(let w=0,B,M;w<k;w++)if(M=b[w],l){if(l[M]){if(!u){if(n)n--;else if(a[d++]=M,d===e)return a}(u||o)&&(p[M]=1),g=!0}if(o&&(B=(c[M]||0)+1,c[M]=B,B<s)){const x=o[B-2]||(o[B-2]=[]);x[x.length]=M}}else p[M]=1}if(o)l||(c=p);else if(!g)return[];l=p}if(o)for(let u=o.length-1,m,f;0<=u;u--){m=o[u],f=m.length;for(let p=0,g;p<f;p++)if(g=m[p],!l[g]){if(n)n--;else if(a[d++]=g,d===e)return a;l[g]=1}}return a}function intersect_union(r,e){const n=create_object(),o=create_object(),s=[];for(let a=0;a<r.length;a++)n[r[a]]=1;for(let a=0,l;a<e.length;a++){l=e[a];for(let c=0,d;c<l.length;c++)d=l[c],n[d]&&(o[d]||(o[d]=1,s[s.length]=d))}return s}function CacheClass(r){this.limit=r!==!0&&r,this.cache=create_object(),this.queue=[]}function searchCache(r,e,n){is_object(r)&&(r=r.query);let o=this.cache.get(r);return o||(o=this.search(r,e,n),this.cache.set(r,o)),o}CacheClass.prototype.set=function(r,e){if(!this.cache[r]){let n=this.queue.length;n===this.limit?delete this.cache[this.queue[n-1]]:n++;for(let o=n-1;0<o;o--)this.queue[o]=this.queue[o-1];this.queue[0]=r}this.cache[r]=e},CacheClass.prototype.get=function(r){const e=this.cache[r];if(this.limit&&e){const n=this.queue.indexOf(r);if(n){const o=this.queue[n-1];this.queue[n-1]=this.queue[n],this.queue[n]=o}}return e},CacheClass.prototype.del=function(r){for(let e=0,n,o;e<this.queue.length;e++)o=this.queue[e],n=this.cache[o],n.includes(r)&&(this.queue.splice(e--,1),delete this.cache[o])};const preset={memory:{charset:"latin:extra",resolution:3,minlength:4,fastupdate:!1},performance:{resolution:3,minlength:3,optimize:!1,context:{depth:2,resolution:1}},match:{charset:"latin:extra",tokenize:"reverse"},score:{charset:"latin:advanced",resolution:20,minlength:3,context:{depth:3,resolution:9}},default:{}};function apply_preset(r){if(is_string(r))r=preset[r];else{const e=r.preset;e&&(r=Object.assign({},e[e],r))}return r}function async(r,e,n,o,s,a,l,c){setTimeout(function(){const d=r(n?n+"."+o:o,JSON.stringify(l));d&&d.then?d.then(function(){e.export(r,e,n,s,a+1,c)}):e.export(r,e,n,s,a+1,c)})}function exportIndex(r,e,n,o,s,a){let l=!0;typeof a>"u"&&(l=new Promise(u=>{a=u}));let c,d;switch(s||(s=0)){case 0:if(c="reg",this.fastupdate){d=create_object();for(let u in this.register)d[u]=1}else d=this.register;break;case 1:c="cfg",d={doc:0,opt:this.optimize?1:0};break;case 2:c="map",d=this.map;break;case 3:c="ctx",d=this.ctx;break;default:typeof n>"u"&&a&&a();return}return async(r,e||this,n,c,o,s,d,a),l}function importIndex(r,e){if(e)switch(is_string(e)&&(e=JSON.parse(e)),r){case"cfg":this.optimize=!!e.opt;break;case"reg":this.fastupdate=!1,this.register=e;break;case"map":this.map=e;break;case"ctx":this.ctx=e;break}}function exportDocument(r,e,n,o,s,a){let l;if(typeof a>"u"&&(l=new Promise(c=>{a=c})),s||(s=0),o||(o=0),o<this.field.length){const c=this.field[o],d=this.index[c];e=this,setTimeout(function(){d.export(r,e,s?c:"",o,s++,a)||(o++,s=1,e.export(r,e,c,o,s,a))})}else{let c,d;switch(s){case 1:c="tag",d=this.tagindex,n=null;break;case 2:c="store",d=this.store,n=null;break;default:a();return}async(r,this,n,c,o,s,d,a)}return l}function importDocument(r,e){if(e)switch(is_string(e)&&(e=JSON.parse(e)),r){case"tag":this.tagindex=e;break;case"reg":this.fastupdate=!1,this.register=e;for(let o=0,s;o<this.field.length;o++)s=this.index[this.field[o]],s.register=e,s.fastupdate=!1;break;case"store":this.store=e;break;default:r=r.split(".");const n=r[0];r=r[1],n&&r&&this.index[n].import(r,e)}}function Index(r,e){if(!(this instanceof Index))return new Index(r);let n,o,s;r?(r=apply_preset(r),n=r.charset,o=r.lang,is_string(n)&&(n.indexOf(":")===-1&&(n+=":default"),n=global_charset[n]),is_string(o)&&(o=global_lang[o])):r={};let a,l,c=r.context||{};this.encode=r.encode||n&&n.encode||encode,this.register=e||create_object(),this.resolution=a=r.resolution||9,this.tokenize=s=n&&n.tokenize||r.tokenize||"strict",this.depth=s==="strict"&&c.depth,this.bidirectional=parse_option(c.bidirectional,!0),this.optimize=l=parse_option(r.optimize,!0),this.fastupdate=parse_option(r.fastupdate,!0),this.minlength=r.minlength||1,this.boost=r.boost,this.map=l?create_object_array(a):create_object(),this.resolution_ctx=a=c.resolution||1,this.ctx=l?create_object_array(a):create_object(),this.rtl=n&&n.rtl||r.rtl,this.matcher=(s=r.matcher||o&&o.matcher)&&init_stemmer_or_matcher(s,!1),this.stemmer=(s=r.stemmer||o&&o.stemmer)&&init_stemmer_or_matcher(s,!0),this.filter=(s=r.filter||o&&o.filter)&&init_filter(s),this.cache=(s=r.cache)&&new CacheClass(s)}Index.prototype.append=function(r,e){return this.add(r,e,!0)},Index.prototype.add=function(r,e,n,o){if(e&&(r||r===0)){if(!o&&!n&&this.register[r])return this.update(r,e);e=this.encode(""+e);const s=e.length;if(s){const a=create_object(),l=create_object(),c=this.depth,d=this.resolution;for(let u=0;u<s;u++){let m=e[this.rtl?s-1-u:u],f=m.length;if(m&&f>=this.minlength&&(c||!l[m])){let p=get_score(d,s,u),g="";switch(this.tokenize){case"full":if(2<f){for(let y=0;y<f;y++)for(let b=f;b>y;b--)if(b-y>=this.minlength){const k=get_score(d,s,u,f,y);g=m.substring(y,b),this.push_index(l,g,k,r,n)}break}case"reverse":if(1<f){for(let y=f-1;0<y;y--)if(g=m[y]+g,g.length>=this.minlength){const b=get_score(d,s,u,f,y);this.push_index(l,g,b,r,n)}g=""}case"forward":if(1<f){for(let y=0;y<f;y++)g+=m[y],g.length>=this.minlength&&this.push_index(l,g,p,r,n);break}default:if(this.boost&&(p=Math.min(0|p/this.boost(e,m,u),d-1)),this.push_index(l,m,p,r,n),c&&1<s&&u<s-1){const y=create_object(),b=this.resolution_ctx,k=m,w=Math.min(c+1,s-u);y[k]=1;for(let B=1;B<w;B++)if(m=e[this.rtl?s-1-u-B:u+B],m&&m.length>=this.minlength&&!y[m]){y[m]=1;const M=get_score(b+(s/2>b?0:1),s,u,w-1,B-1),x=this.bidirectional&&m>k;this.push_index(a,x?k:m,M,r,n,x?m:k)}}}}}this.fastupdate||(this.register[r]=1)}}return this};function get_score(r,e,n,o,s){return n&&1<r?e+(o||0)<=r?n+(s||0):0|(r-1)/(e+(o||0))*(n+(s||0))+1:0}Index.prototype.push_index=function(r,e,n,o,s,a){let l=a?this.ctx:this.map;if((!r[e]||a&&!r[e][a])&&(this.optimize&&(l=l[n]),a?(r=r[e]||(r[e]=create_object()),r[a]=1,l=l[a]||(l[a]=create_object())):r[e]=1,l=l[e]||(l[e]=[]),this.optimize||(l=l[n]||(l[n]=[])),(!s||!l.includes(o))&&(l[l.length]=o,this.fastupdate))){const c=this.register[o]||(this.register[o]=[]);c[c.length]=l}},Index.prototype.search=function(r,e,n){n||(!e&&is_object(r)?(n=r,r=n.query):is_object(e)&&(n=e));let o=[],s,a,l,c=0;if(n&&(r=n.query||r,e=n.limit,c=n.offset||0,a=n.context,l=n.suggest),r&&(r=this.encode(""+r),s=r.length,1<s)){const f=create_object(),p=[];for(let g=0,y=0,b;g<s;g++)if(b=r[g],b&&b.length>=this.minlength&&!f[b]){if(!this.optimize&&!l&&!this.map[b])return o;p[y++]=b,f[b]=1}r=p,s=r.length}if(!s)return o;e||(e=100);let d=this.depth&&1<s&&a!==!1,u=0,m;d?(m=r[0],u=1):1<s&&r.sort(sort_by_length_down);for(let f,p;u<s;u++){if(p=r[u],d?(f=this.add_result(o,l,e,c,s===2,p,m),(!l||f!==!1||!o.length)&&(m=p)):f=this.add_result(o,l,e,c,s===1,p),f)return f;if(l&&u==s-1){let g=o.length;if(g){if(g===1)return single_result(o[0],e,c)}else{if(d){d=0,u=-1;continue}return o}}}return intersect(o,e,c,l)},Index.prototype.add_result=function(r,e,n,o,s,a,l){let c=[],d=l?this.ctx:this.map;if(this.optimize||(d=get_array(d,a,l,this.bidirectional)),d){let u=0;const m=Math.min(d.length,l?this.resolution_ctx:this.resolution);for(let f=0,p=0,g,y;f<m&&(g=d[f],!(g&&(this.optimize&&(g=get_array(g,a,l,this.bidirectional)),o&&g&&s&&(y=g.length,y<=o?(o-=y,g=null):(g=g.slice(o),o=0)),g&&(c[u++]=g,s&&(p+=g.length,p>=n)))));f++);if(u){if(s)return single_result(c,n,0);r[r.length]=c;return}}return!e&&c};function single_result(r,e,n){return r.length===1?r=r[0]:r=concat(r),n||r.length>e?r.slice(n,n+e):r}function get_array(r,e,n,o){if(n){const s=o&&e>n;r=r[s?e:n],r=r&&r[s?n:e]}else r=r[e];return r}Index.prototype.contain=function(r){return!!this.register[r]},Index.prototype.update=function(r,e){return this.remove(r).add(r,e)},Index.prototype.remove=function(r,e){const n=this.register[r];if(n){if(this.fastupdate)for(let o=0,s;o<n.length;o++)s=n[o],s.splice(s.indexOf(r),1);else remove_index(this.map,r,this.resolution,this.optimize),this.depth&&remove_index(this.ctx,r,this.resolution_ctx,this.optimize);e||delete this.register[r],this.cache&&this.cache.del(r)}return this};function remove_index(r,e,n,o,s){let a=0;if(is_array(r))if(s){const l=r.indexOf(e);l!==-1?1<r.length&&(r.splice(l,1),a++):a++}else{s=Math.min(r.length,n);for(let l=0,c;l<s;l++)c=r[l],c&&(a=remove_index(c,e,n,o,s),!o&&!a&&delete r[l])}else for(let l in r)a=remove_index(r[l],e,n,o,s),a||delete r[l];return a}Index.prototype.searchCache=searchCache,Index.prototype.export=exportIndex,Index.prototype.import=importIndex,apply_async(Index.prototype);function handler(r){r=r.data;const e=self._index,n=r.args,o=r.task;switch(o){case"init":const s=r.options||{},a=r.factory,l=s.encode;s.cache=!1,l&&l.indexOf("function")===0&&(s.encode=Function("return "+l)()),a?(Function("return "+a)()(self),self._index=new self.FlexSearch.Index(s),delete self.FlexSearch):self._index=new Index(s);break;default:const c=r.id,d=e[o].apply(e,n);postMessage(o==="search"?{id:c,msg:d}:{id:c})}}let pid=0;function WorkerIndex(r){if(!(this instanceof WorkerIndex))return new WorkerIndex(r);let e;r?is_function(e=r.encode)&&(r.encode=e.toString()):r={};let n=(self||window)._factory;n&&(n=n.toString());const o=typeof window>"u"&&self.exports,s=this;this.worker=create(n,o,r.worker),this.resolver=create_object(),this.worker&&(o?this.worker.on("message",function(a){s.resolver[a.id](a.msg),delete s.resolver[a.id]}):this.worker.onmessage=function(a){a=a.data,s.resolver[a.id](a.msg),delete s.resolver[a.id]},this.worker.postMessage({task:"init",factory:n,options:r}))}register("add"),register("append"),register("search"),register("update"),register("remove");function register(r){WorkerIndex.prototype[r]=WorkerIndex.prototype[r+"Async"]=function(){const e=this,n=[].slice.call(arguments),o=n[n.length-1];let s;is_function(o)&&(s=o,n.splice(n.length-1,1));const a=new Promise(function(l){setTimeout(function(){e.resolver[++pid]=l,e.worker.postMessage({task:r,id:pid,args:n})})});return s?(a.then(s),this):a}}function create(factory,is_node_js,worker_path){let worker;try{worker=is_node_js?eval('new (require("worker_threads")["Worker"])(__dirname + "/node/node.js")'):factory?new Worker(URL.createObjectURL(new Blob(["onmessage="+handler.toString()],{type:"text/javascript"}))):new Worker(is_string(worker_path)?worker_path:"worker/worker.js",{type:"module"})}catch(r){}return worker}function Document(r){if(!(this instanceof Document))return new Document(r);const e=r.document||r.doc||r;let n;this.tree=[],this.field=[],this.marker=[],this.register=create_object(),this.key=(n=e.key||e.id)&&parse_tree(n,this.marker)||"id",this.fastupdate=parse_option(r.fastupdate,!0),this.storetree=(n=e.store)&&n!==!0&&[],this.store=n&&create_object(),this.tag=(n=e.tag)&&parse_tree(n,this.marker),this.tagindex=n&&create_object(),this.cache=(n=r.cache)&&new CacheClass(n),r.cache=!1,this.worker=r.worker,this.async=!1,this.index=parse_descriptor.call(this,r,e)}function parse_descriptor(r,e){const n=create_object();let o=e.index||e.field||e;is_string(o)&&(o=[o]);for(let s=0,a,l;s<o.length;s++)a=o[s],is_string(a)||(l=a,a=a.field),l=is_object(l)?Object.assign({},r,l):r,this.worker&&(n[a]=new WorkerIndex(l),n[a].worker||(this.worker=!1)),this.worker||(n[a]=new Index(l,this.register)),this.tree[s]=parse_tree(a,this.marker),this.field[s]=a;if(this.storetree){let s=e.store;is_string(s)&&(s=[s]);for(let a=0;a<s.length;a++)this.storetree[a]=parse_tree(s[a],this.marker)}return n}function parse_tree(r,e){const n=r.split(":");let o=0;for(let s=0;s<n.length;s++)r=n[s],0<=r.indexOf("[]")&&(r=r.substring(0,r.length-2),r&&(e[o]=!0)),r&&(n[o++]=r);return o<n.length&&(n.length=o),1<o?n:n[0]}function parse_simple(r,e){if(is_string(e))r=r[e];else for(let n=0;r&&n<e.length;n++)r=r[e[n]];return r}function store_value(r,e,n,o,s){if(r=r[s],o===n.length-1)e[s]=r;else if(r)if(is_array(r)){e=e[s]=Array(r.length);for(let a=0;a<r.length;a++)store_value(r,e,n,o,a)}else e=e[s]||(e[s]=create_object()),s=n[++o],store_value(r,e,n,o,s)}function add_index(r,e,n,o,s,a,l,c){if(r=r[l],r)if(o===e.length-1){if(is_array(r)){if(n[o]){for(let d=0;d<r.length;d++)s.add(a,r[d],!0,!0);return}r=r.join(" ")}s.add(a,r,c,!0)}else if(is_array(r))for(let d=0;d<r.length;d++)add_index(r,e,n,o,s,a,d,c);else l=e[++o],add_index(r,e,n,o,s,a,l,c)}Document.prototype.add=function(r,e,n){if(is_object(r)&&(e=r,r=parse_simple(e,this.key)),e&&(r||r===0)){if(!n&&this.register[r])return this.update(r,e);for(let o=0,s,a;o<this.field.length;o++)a=this.field[o],s=this.tree[o],is_string(s)&&(s=[s]),add_index(e,s,this.marker,0,this.index[a],r,s[0],n);if(this.tag){let o=parse_simple(e,this.tag),s=create_object();is_string(o)&&(o=[o]);for(let a=0,l,c;a<o.length;a++)if(l=o[a],!s[l]&&(s[l]=1,c=this.tagindex[l]||(this.tagindex[l]=[]),(!n||!c.includes(r))&&(c[c.length]=r,this.fastupdate))){const d=this.register[r]||(this.register[r]=[]);d[d.length]=c}}if(this.store&&(!n||!this.store[r])){let o;if(this.storetree){o=create_object();for(let s=0,a;s<this.storetree.length;s++)a=this.storetree[s],is_string(a)?o[a]=e[a]:store_value(e,o,a,0,a[0])}this.store[r]=o||e}}return this},Document.prototype.append=function(r,e){return this.add(r,e,!0)},Document.prototype.update=function(r,e){return this.remove(r).add(r,e)},Document.prototype.remove=function(r){if(is_object(r)&&(r=parse_simple(r,this.key)),this.register[r]){for(let e=0;e<this.field.length&&(this.index[this.field[e]].remove(r,!this.worker),!this.fastupdate);e++);if(this.tag&&!this.fastupdate)for(let e in this.tagindex){const n=this.tagindex[e],o=n.indexOf(r);o!==-1&&(1<n.length?n.splice(o,1):delete this.tagindex[e])}this.store&&delete this.store[r],delete this.register[r]}return this},Document.prototype.search=function(r,e,n,o){n||(!e&&is_object(r)?(n=r,r=""):is_object(e)&&(n=e,e=0));let s=[],a=[],l,c,d,u,m,f,p=0;if(n)if(is_array(n))d=n,n=null;else{if(r=n.query||r,l=n.pluck,d=l||n.index||n.field,u=n.tag,c=this.store&&n.enrich,m=n.bool==="and",e=n.limit||e||100,f=n.offset||0,u&&(is_string(u)&&(u=[u]),!r)){for(let y=0,b;y<u.length;y++)b=get_tag.call(this,u[y],e,f,c),b&&(s[s.length]=b,p++);return p?s:[]}is_string(d)&&(d=[d])}d||(d=this.field),m=m&&(1<d.length||u&&1<u.length);const g=!o&&(this.worker||this.async)&&[];for(let y=0,b,k,w;y<d.length;y++){let B;if(k=d[y],is_string(k)||(B=k,k=B.field,r=B.query||r,e=B.limit||e,c=B.enrich||c),g){g[y]=this.index[k].searchAsync(r,e,B||n);continue}else o?b=o[y]:b=this.index[k].search(r,e,B||n);if(w=b&&b.length,u&&w){const M=[];let x=0;m&&(M[0]=[b]);for(let v=0,_,E;v<u.length;v++)_=u[v],E=this.tagindex[_],w=E&&E.length,w&&(x++,M[M.length]=m?[E]:E);x&&(m?b=intersect(M,e||100,f||0):b=intersect_union(b,M),w=b.length)}if(w)a[p]=k,s[p++]=b;else if(m)return[]}if(g){const y=this;return new Promise(function(b){Promise.all(g).then(function(k){b(y.search(r,e,n,k))})})}if(!p)return[];if(l&&(!c||!this.store))return s[0];for(let y=0,b;y<a.length;y++){if(b=s[y],b.length&&c&&(b=apply_enrich.call(this,b)),l)return b;s[y]={field:a[y],result:b}}return s};function get_tag(r,e,n){let o=this.tagindex[r];o&&o.length-n}function apply_enrich(r){const e=Array(r.length);for(let n=0,o;n<r.length;n++)o=r[n],e[n]={id:o,doc:this.store[o]};return e}Document.prototype.contain=function(r){return!!this.register[r]},Document.prototype.get=function(r){return this.store[r]},Document.prototype.set=function(r,e){return this.store[r]=e,this},Document.prototype.searchCache=searchCache,Document.prototype.export=exportDocument,Document.prototype.import=importDocument,apply_async(Document.prototype);const IndexContext=createContext(()=>{const r=useEventBus(),{blocksManager:e}=BlocksContext.useContext(),{register:n}=kbViewRegistry.useContext(),o=shallowReactive(new Map),s=shallowReactive(new Map),a=(M,x,v)=>{v=v||o;const _=v.get(M);_?_.add(x):v.set(M,new Set([x]))},l=(M,x,v)=>{v=v||s;const _=v.get(M);_?_.add(x):v.set(M,new Set([x]))},c=(M,x,v)=>{v=v||o;const _=v.get(M);_&&(_.delete(x),_.size==0&&v.delete(M))},d=(M,x,v)=>{v=v||s;const _=v.get(M);_&&(_.delete(x),_.size==0&&v.delete(M))},u=M=>o.get(M)??new Set,m=M=>s.get(M)??new Set,f=(M,x=!0)=>{const v=[];return v.push(...u(M)),v.push(...m(M)),x&&v.push(M),v};r.on("afterBlocksTrCommit",([M])=>{for(let x=0;x<M.patches.length;x++){const v=M.patches[x],_=M.reversePatches[x];if(v.op==="add"){const E=v.block;E.type==="mirrorBlock"?a(E.src,E.id):E.type==="virtualBlock"&&l(E.src,E.id)}else if(v.op==="delete"&&_.op==="add"){const E=_.block;E.type==="mirrorBlock"?c(E.src,E.id):E.type==="virtualBlock"&&d(E.src,E.id)}}}),r.on("blocksDestroy",()=>{o.clear(),s.clear()});const p=ref({}),g=ref({});r.on("afterBlocksTrCommit",([M])=>{var x,v,_,E;for(let N=0;N<M.patches.length;N++){const I=M.patches[N],L=M.reversePatches[N];if(I.op==="delete"){if(delete p.value[I.blockId],delete g.value[I.blockId],L.op!=="add")continue;const A=L.block;if(A.type!=="normalBlock"||A.content[0]!==BLOCK_CONTENT_TYPES.TEXT)continue;const F=e.getOlinks(A.content[1]);for(const se of F)(x=p.value[se])==null||x.delete(A.id),(v=g.value[se])==null||v.delete(A.id)}else if(I.op==="add"||I.op==="update"){const A=I.block;if(A.type!=="normalBlock"||A.content[0]!==BLOCK_CONTENT_TYPES.TEXT)continue;const F=L.op==="delete"?[]:L.block.type!=="normalBlock"||L.block.content[0]!==BLOCK_CONTENT_TYPES.TEXT?[]:e.getOlinks(L.block.content[1],"blockRef"),se=L.op==="delete"?[]:L.block.type!=="normalBlock"||L.block.content[0]!==BLOCK_CONTENT_TYPES.TEXT?[]:e.getOlinks(L.block.content[1],"tag"),H=e.getOlinks(A.content[1],"blockRef"),V=e.getOlinks(A.content[1],"tag"),R=H.filter(Q=>!F.includes(Q)),J=F.filter(Q=>!H.includes(Q));for(const Q of R)p.value[Q]=(p.value[Q]??new Set).add(A.id);for(const Q of J)(_=p.value[Q])==null||_.delete(A.id);const Y=V.filter(Q=>!se.includes(Q)),re=se.filter(Q=>!V.includes(Q));for(const Q of Y)g.value[Q]=(g.value[Q]??new Set).add(A.id);for(const Q of re)(E=g.value[Q])==null||E.delete(A.id)}}}),r.on("blocksDestroy",()=>{p.value={},g.value={}});const y=(M,x="both")=>{if(x==="blockRef")return p.value[M]??new Set;if(x==="tag")return g.value[M]??new Set;{const v=p.value[M]??new Set,_=g.value[M]??new Set;return new Set([...v,..._])}},b=new Document({document:{id:"id",index:"text",store:["text"]},encode:M=>hybridTokenize(M)}),k=new Set;r.on("afterBlocksTrCommit",([M])=>{for(const x of M.patches)x.op==="delete"?k.add(x.blockId):k.add(x.block.id)}),r.on("blocksDestroy",()=>{k.clear()});const w=()=>{if(k.size!==0){for(const M of k){const x=e.getBlock(M);if(x==null&&b.contain(M))b.remove(M);else if(x&&x.type==="normalBlock"){b.contain(M)&&b.remove(M);const v=x.ctext+" "+x.mtext;b.add(M,{id:M,text:v})}}k.clear()}},B={fulltextIndex:b,blockRefsIndex:p,tagIndex:g,search:(M,x=50)=>{var N,I;w();const v=(I=(N=b.search(M,{limit:x,enrich:!0}))==null?void 0:N[0])==null?void 0:I.result;if(!v)return[];const _=hybridTokenize(M,!1,1,!1),E=v.map(L=>{const A=calcMatchScore(_,L.doc.text);return{id:L.id,score:A}});return E.sort((L,A)=>A.score-L.score),E.map(L=>L.id)},getMirrors:u,getVirtuals:m,getOccurs:f,getBacklinks:y};return n("index",B),B}),FusionCommandContext=createContext(()=>{const{blocksManager:r}=BlocksContext.useContext(),{search:e}=IndexContext.useContext(),n=ref(""),o=computed(()=>n.value.startsWith("/")?"searchCommand":"searchBlock"),s=ref([]),a=ref(-1),l=ref(null),c=ref(!1),d=ref(!1),u=ref([!0,!1,!1,!1,!1]),m=computed(()=>n.value.length==0?[]:hybridTokenize(n.value,!1,1,!1)??[]);return{inputText:n,mode:o,blockSearchResult:s,focusIndex:a,contentEl:l,suppressMouseOver:c,open:d,allowedBlockTypes:u,queryTerms:m,updateBlockSearchResult:()=>{const f=n.value.trim();if(f===""){s.value=[];return}s.value=e(f).map(p=>r.getBlock(p)).filter(p=>p!==null).filter(p=>p.type=="normalBlock"&&u.value[p.content[0]]),a.value=s.value.length>0?0:-1},openFusionCommand:f=>{n.value=f,d.value=!0,nextTick(()=>{var g;const p=(g=l.value)==null?void 0:g.querySelector("input");p instanceof HTMLElement&&p.focus()})}}});function markApplies(r,e,n,o){for(let s=0;s<e.length;s++){let{$from:a,$to:l}=e[s],c=a.depth==0?r.inlineContent&&r.type.allowsMarkType(n):!1;if(r.nodesBetween(a.pos,l.pos,(d,u)=>{if(c)return!1;c=d.inlineContent&&d.type.allowsMarkType(n)}),c)return!0}return!1}function toggleMark(r,e=null,n){return function(o,s){let{empty:a,$cursor:l,ranges:c}=o.selection;if(a&&!l||!markApplies(o.doc,c,r))return!1;if(s)if(l)r.isInSet(o.storedMarks||l.marks())?s(o.tr.removeStoredMark(r)):s(o.tr.addStoredMark(r.create(e)));else{let d,u=o.tr;d=!c.some(m=>o.doc.rangeHasMark(m.$from.pos,m.$to.pos,r));for(let m=0;m<c.length;m++){let{$from:f,$to:p}=c[m];if(!d)u.removeMark(f.pos,p.pos,r);else{let g=f.pos,y=p.pos,b=f.nodeAfter,k=p.nodeBefore,w=b&&b.isText?/^\s*/.exec(b.text)[0].length:0,B=k&&k.isText?/\s*$/.exec(k.text)[0].length:0;g+w<y&&(g+=w,y-=B),u.addMark(g,y,r.create(e))}}s(u.scrollIntoView())}return!0}}typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin",DefaultBufferLength=1024;let nextPropID=0;class Range{constructor(e,n){this.from=e,this.to=n}}NodeProp=class{constructor(r={}){this.id=nextPropID++,this.perNode=!!r.perNode,this.deserialize=r.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(r){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof r!="function"&&(r=NodeType.match(r)),e=>{let n=r(e);return n===void 0?null:[this,n]}}},NodeProp.closedBy=new NodeProp({deserialize:r=>r.split(" ")}),NodeProp.openedBy=new NodeProp({deserialize:r=>r.split(" ")}),NodeProp.group=new NodeProp({deserialize:r=>r.split(" ")}),NodeProp.isolate=new NodeProp({deserialize:r=>{if(r&&r!="rtl"&&r!="ltr"&&r!="auto")throw new RangeError("Invalid value for isolate: "+r);return r||"auto"}}),NodeProp.contextHash=new NodeProp({perNode:!0}),NodeProp.lookAhead=new NodeProp({perNode:!0}),NodeProp.mounted=new NodeProp({perNode:!0});class MountedTree{constructor(e,n,o){this.tree=e,this.overlay=n,this.parser=o}static get(e){return e&&e.props&&e.props[NodeProp.mounted.id]}}const noProps=Object.create(null);NodeType=class{constructor(r,e,n,o=0){this.name=r,this.props=e,this.id=n,this.flags=o}static define(r){let e=r.props&&r.props.length?Object.create(null):noProps,n=(r.top?1:0)|(r.skipped?2:0)|(r.error?4:0)|(r.name==null?8:0),o=new NodeType(r.name||"",e,r.id,n);if(r.props){for(let s of r.props)if(Array.isArray(s)||(s=s(o)),s){if(s[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");e[s[0].id]=s[1]}}return o}prop(r){return this.props[r.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(r){if(typeof r=="string"){if(this.name==r)return!0;let e=this.prop(NodeProp.group);return e?e.indexOf(r)>-1:!1}return this.id==r}static match(r){let e=Object.create(null);for(let n in r)for(let o of n.split(" "))e[o]=r[n];return n=>{for(let o=n.prop(NodeProp.group),s=-1;s<(o?o.length:0);s++){let a=e[s<0?n.name:o[s]];if(a)return a}}}},NodeType.none=new NodeType("",Object.create(null),0,8),NodeSet=class{constructor(r){this.types=r;for(let e=0;e<r.length;e++)if(r[e].id!=e)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...r){let e=[];for(let n of this.types){let o=null;for(let s of r){let a=s(n);a&&(o||(o=Object.assign({},n.props)),o[a[0].id]=a[1])}e.push(o?new NodeType(n.name,o,n.id,n.flags):n)}return new NodeSet(e)}};const CachedNode=new WeakMap,CachedInnerNode=new WeakMap;(function(r){r[r.ExcludeBuffers=1]="ExcludeBuffers",r[r.IncludeAnonymous=2]="IncludeAnonymous",r[r.IgnoreMounts=4]="IgnoreMounts",r[r.IgnoreOverlays=8]="IgnoreOverlays"})(IterMode||(IterMode={})),Tree=class{constructor(r,e,n,o,s){if(this.type=r,this.children=e,this.positions=n,this.length=o,this.props=null,s&&s.length){this.props=Object.create(null);for(let[a,l]of s)this.props[typeof a=="number"?a:a.id]=l}}toString(){let r=MountedTree.get(this);if(r&&!r.overlay)return r.tree.toString();let e="";for(let n of this.children){let o=n.toString();o&&(e&&(e+=","),e+=o)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(e.length?"("+e+")":""):e}cursor(r=0){return new TreeCursor(this.topNode,r)}cursorAt(r,e=0,n=0){let o=CachedNode.get(this)||this.topNode,s=new TreeCursor(o);return s.moveTo(r,e),CachedNode.set(this,s._tree),s}get topNode(){return new TreeNode(this,0,0,null)}resolve(r,e=0){let n=resolveNode(CachedNode.get(this)||this.topNode,r,e,!1);return CachedNode.set(this,n),n}resolveInner(r,e=0){let n=resolveNode(CachedInnerNode.get(this)||this.topNode,r,e,!0);return CachedInnerNode.set(this,n),n}resolveStack(r,e=0){return stackIterator(this,r,e)}iterate(r){let{enter:e,leave:n,from:o=0,to:s=this.length}=r,a=r.mode||0,l=(a&IterMode.IncludeAnonymous)>0;for(let c=this.cursor(a|IterMode.IncludeAnonymous);;){let d=!1;if(c.from<=s&&c.to>=o&&(!l&&c.type.isAnonymous||e(c)!==!1)){if(c.firstChild())continue;d=!0}for(;d&&n&&(l||!c.type.isAnonymous)&&n(c),!c.nextSibling();){if(!c.parent())return;d=!0}}}prop(r){return r.perNode?this.props?this.props[r.id]:void 0:this.type.prop(r)}get propValues(){let r=[];if(this.props)for(let e in this.props)r.push([+e,this.props[e]]);return r}balance(r={}){return this.children.length<=8?this:balanceRange(NodeType.none,this.children,this.positions,0,this.children.length,0,this.length,(e,n,o)=>new Tree(this.type,e,n,o,this.propValues),r.makeTree||((e,n,o)=>new Tree(NodeType.none,e,n,o)))}static build(r){return buildTree$1(r)}},Tree.empty=new Tree(NodeType.none,[],[],0);class FlatBufferCursor{constructor(e,n){this.buffer=e,this.index=n}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new FlatBufferCursor(this.buffer,this.index)}}class TreeBuffer{constructor(e,n,o){this.buffer=e,this.length=n,this.set=o}get type(){return NodeType.none}toString(){let e=[];for(let n=0;n<this.buffer.length;)e.push(this.childString(n)),n=this.buffer[n+3];return e.join(",")}childString(e){let n=this.buffer[e],o=this.buffer[e+3],s=this.set.types[n],a=s.name;if(/\W/.test(a)&&!s.isError&&(a=JSON.stringify(a)),e+=4,o==e)return a;let l=[];for(;e<o;)l.push(this.childString(e)),e=this.buffer[e+3];return a+"("+l.join(",")+")"}findChild(e,n,o,s,a){let{buffer:l}=this,c=-1;for(let d=e;d!=n&&!(checkSide(a,s,l[d+1],l[d+2])&&(c=d,o>0));d=l[d+3]);return c}slice(e,n,o){let s=this.buffer,a=new Uint16Array(n-e),l=0;for(let c=e,d=0;c<n;){a[d++]=s[c++],a[d++]=s[c++]-o;let u=a[d++]=s[c++]-o;a[d++]=s[c++]-e,l=Math.max(l,u)}return new TreeBuffer(a,l,this.set)}}function checkSide(r,e,n,o){switch(r){case-2:return n<e;case-1:return o>=e&&n<e;case 0:return n<e&&o>e;case 1:return n<=e&&o>e;case 2:return o>e;case 4:return!0}}function resolveNode(r,e,n,o){for(var s;r.from==r.to||(n<1?r.from>=e:r.from>e)||(n>-1?r.to<=e:r.to<e);){let l=!o&&r instanceof TreeNode&&r.index<0?null:r.parent;if(!l)return r;r=l}let a=o?0:IterMode.IgnoreOverlays;if(o)for(let l=r,c=l.parent;c;l=c,c=l.parent)l instanceof TreeNode&&l.index<0&&((s=c.enter(e,n,a))===null||s===void 0?void 0:s.from)!=l.from&&(r=c);for(;;){let l=r.enter(e,n,a);if(!l)return r;r=l}}class BaseNode{cursor(e=0){return new TreeCursor(this,e)}getChild(e,n=null,o=null){let s=getChildren(this,e,n,o);return s.length?s[0]:null}getChildren(e,n=null,o=null){return getChildren(this,e,n,o)}resolve(e,n=0){return resolveNode(this,e,n,!1)}resolveInner(e,n=0){return resolveNode(this,e,n,!0)}matchContext(e){return matchNodeContext(this.parent,e)}enterUnfinishedNodesBefore(e){let n=this.childBefore(e),o=this;for(;n;){let s=n.lastChild;if(!s||s.to!=n.to)break;s.type.isError&&s.from==s.to?(o=n,n=s.prevSibling):n=s}return o}get node(){return this}get next(){return this.parent}}class TreeNode extends BaseNode{constructor(e,n,o,s){super(),this._tree=e,this.from=n,this.index=o,this._parent=s}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,n,o,s,a=0){for(let l=this;;){for(let{children:c,positions:d}=l._tree,u=n>0?c.length:-1;e!=u;e+=n){let m=c[e],f=d[e]+l.from;if(checkSide(s,o,f,f+m.length)){if(m instanceof TreeBuffer){if(a&IterMode.ExcludeBuffers)continue;let p=m.findChild(0,m.buffer.length,n,o-f,s);if(p>-1)return new BufferNode(new BufferContext(l,m,e,f),null,p)}else if(a&IterMode.IncludeAnonymous||!m.type.isAnonymous||hasChild(m)){let p;if(!(a&IterMode.IgnoreMounts)&&(p=MountedTree.get(m))&&!p.overlay)return new TreeNode(p.tree,f,e,l);let g=new TreeNode(m,f,e,l);return a&IterMode.IncludeAnonymous||!g.type.isAnonymous?g:g.nextChild(n<0?m.children.length-1:0,n,o,s)}}}if(a&IterMode.IncludeAnonymous||!l.type.isAnonymous||(l.index>=0?e=l.index+n:e=n<0?-1:l._parent._tree.children.length,l=l._parent,!l))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,n,o=0){let s;if(!(o&IterMode.IgnoreOverlays)&&(s=MountedTree.get(this._tree))&&s.overlay){let a=e-this.from;for(let{from:l,to:c}of s.overlay)if((n>0?l<=a:l<a)&&(n<0?c>=a:c>a))return new TreeNode(s.tree,s.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,n,o)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get tree(){return this._tree}toTree(){return this._tree}toString(){return this._tree.toString()}}function getChildren(r,e,n,o){let s=r.cursor(),a=[];if(!s.firstChild())return a;if(n!=null){for(let l=!1;!l;)if(l=s.type.is(n),!s.nextSibling())return a}for(;;){if(o!=null&&s.type.is(o))return a;if(s.type.is(e)&&a.push(s.node),!s.nextSibling())return o==null?a:[]}}function matchNodeContext(r,e,n=e.length-1){for(let o=r;n>=0;o=o.parent){if(!o)return!1;if(!o.type.isAnonymous){if(e[n]&&e[n]!=o.name)return!1;n--}}return!0}class BufferContext{constructor(e,n,o,s){this.parent=e,this.buffer=n,this.index=o,this.start=s}}class BufferNode extends BaseNode{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,n,o){super(),this.context=e,this._parent=n,this.index=o,this.type=e.buffer.set.types[e.buffer.buffer[o]]}child(e,n,o){let{buffer:s}=this.context,a=s.findChild(this.index+4,s.buffer[this.index+3],e,n-this.context.start,o);return a<0?null:new BufferNode(this.context,this,a)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,n,o=0){if(o&IterMode.ExcludeBuffers)return null;let{buffer:s}=this.context,a=s.findChild(this.index+4,s.buffer[this.index+3],n>0?1:-1,e-this.context.start,n);return a<0?null:new BufferNode(this.context,this,a)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,n=e.buffer[this.index+3];return n<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new BufferNode(this.context,this._parent,n):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,n=this._parent?this._parent.index+4:0;return this.index==n?this.externalSibling(-1):new BufferNode(this.context,this._parent,e.findChild(n,this.index,-1,0,4))}get tree(){return null}toTree(){let e=[],n=[],{buffer:o}=this.context,s=this.index+4,a=o.buffer[this.index+3];if(a>s){let l=o.buffer[this.index+1];e.push(o.slice(s,a,l)),n.push(0)}return new Tree(this.type,e,n,this.to-this.from)}toString(){return this.context.buffer.childString(this.index)}}function iterStack(r){if(!r.length)return null;let e=0,n=r[0];for(let a=1;a<r.length;a++){let l=r[a];(l.from>n.from||l.to<n.to)&&(n=l,e=a)}let o=n instanceof TreeNode&&n.index<0?null:n.parent,s=r.slice();return o?s[e]=o:s.splice(e,1),new StackIterator(s,n)}class StackIterator{constructor(e,n){this.heads=e,this.node=n}get next(){return iterStack(this.heads)}}function stackIterator(r,e,n){let o=r.resolveInner(e,n),s=null;for(let a=o instanceof TreeNode?o:o.context.parent;a;a=a.parent)if(a.index<0){let l=a.parent;(s||(s=[o])).push(l.resolve(e,n)),a=l}else{let l=MountedTree.get(a.tree);if(l&&l.overlay&&l.overlay[0].from<=e&&l.overlay[l.overlay.length-1].to>=e){let c=new TreeNode(l.tree,l.overlay[0].from+a.from,-1,a);(s||(s=[o])).push(resolveNode(c,e,n,!1))}}return s?iterStack(s):o}class TreeCursor{get name(){return this.type.name}constructor(e,n=0){if(this.mode=n,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof TreeNode)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let o=e._parent;o;o=o._parent)this.stack.unshift(o.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return e?(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0):!1}yieldBuf(e,n){this.index=e;let{start:o,buffer:s}=this.buffer;return this.type=n||s.set.types[s.buffer[e]],this.from=o+s.buffer[e+1],this.to=o+s.buffer[e+2],!0}yield(e){return e?e instanceof TreeNode?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,n,o){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,n,o,this.mode));let{buffer:s}=this.buffer,a=s.findChild(this.index+4,s.buffer[this.index+3],e,n-this.buffer.start,o);return a<0?!1:(this.stack.push(this.index),this.yieldBuf(a))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,n,o=this.mode){return this.buffer?o&IterMode.ExcludeBuffers?!1:this.enterChild(1,e,n):this.yield(this._tree.enter(e,n,o))}parent(){if(!this.buffer)return this.yieldNode(this.mode&IterMode.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&IterMode.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode)):!1;let{buffer:n}=this.buffer,o=this.stack.length-1;if(e<0){let s=o<0?0:this.stack[o]+4;if(this.index!=s)return this.yieldBuf(n.findChild(s,this.index,-1,0,4))}else{let s=n.buffer[this.index+3];if(s<(o<0?n.buffer.length:n.buffer[this.stack[o]+3]))return this.yieldBuf(s)}return o<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let n,o,{buffer:s}=this;if(s){if(e>0){if(this.index<s.buffer.buffer.length)return!1}else for(let a=0;a<this.index;a++)if(s.buffer.buffer[a+3]<this.index)return!1;({index:n,parent:o}=s)}else({index:n,_parent:o}=this._tree);for(;o;{index:n,_parent:o}=o)if(n>-1)for(let a=n+e,l=e<0?-1:o._tree.children.length;a!=l;a+=e){let c=o._tree.children[a];if(this.mode&IterMode.IncludeAnonymous||c instanceof TreeBuffer||!c.type.isAnonymous||hasChild(c))return!1}return!0}move(e,n){if(n&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,n=0){for(;(this.from==this.to||(n<1?this.from>=e:this.from>e)||(n>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,n););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,n=null,o=0;if(e&&e.context==this.buffer)e:for(let s=this.index,a=this.stack.length;a>=0;){for(let l=e;l;l=l._parent)if(l.index==s){if(s==this.index)return l;n=l,o=a+1;break e}s=this.stack[--a]}for(let s=o;s<this.stack.length;s++)n=new BufferNode(this.buffer,n,this.stack[s]);return this.bufferNode=new BufferNode(this.buffer,n,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,n){for(let o=0;;){let s=!1;if(this.type.isAnonymous||e(this)!==!1){if(this.firstChild()){o++;continue}this.type.isAnonymous||(s=!0)}for(;;){if(s&&n&&n(this),s=this.type.isAnonymous,!o)return;if(this.nextSibling())break;this.parent(),o--,s=!0}}}matchContext(e){if(!this.buffer)return matchNodeContext(this.node.parent,e);let{buffer:n}=this.buffer,{types:o}=n.set;for(let s=e.length-1,a=this.stack.length-1;s>=0;a--){if(a<0)return matchNodeContext(this._tree,e,s);let l=o[n.buffer[this.stack[a]]];if(!l.isAnonymous){if(e[s]&&e[s]!=l.name)return!1;s--}}return!0}}function hasChild(r){return r.children.some(e=>e instanceof TreeBuffer||!e.type.isAnonymous||hasChild(e))}function buildTree$1(r){var e;let{buffer:n,nodeSet:o,maxBufferLength:s=DefaultBufferLength,reused:a=[],minRepeatType:l=o.types.length}=r,c=Array.isArray(n)?new FlatBufferCursor(n,n.length):n,d=o.types,u=0,m=0;function f(v,_,E,N,I,L){let{id:A,start:F,end:se,size:H}=c,V=m,R=u;for(;H<0;)if(c.next(),H==-1){let j=a[A];E.push(j),N.push(F-v);return}else if(H==-3){u=A;return}else if(H==-4){m=A;return}else throw new RangeError(`Unrecognized record size: ${H}`);let J=d[A],Y,re,Q=F-v;if(se-F<=s&&(re=k(c.pos-_,I))){let j=new Uint16Array(re.size-re.skip),q=c.pos-re.size,ee=j.length;for(;c.pos>q;)ee=w(re.start,j,ee);Y=new TreeBuffer(j,se-re.start,o),Q=re.start-v}else{let j=c.pos-H;c.next();let q=[],ee=[],G=A>=l?A:-1,te=0,ce=se;for(;c.pos>j;)G>=0&&c.id==G&&c.size>=0?(c.end<=ce-s&&(y(q,ee,F,te,c.end,ce,G,V,R),te=q.length,ce=c.end),c.next()):L>2500?p(F,j,q,ee):f(F,j,q,ee,G,L+1);if(G>=0&&te>0&&te<q.length&&y(q,ee,F,te,F,ce,G,V,R),q.reverse(),ee.reverse(),G>-1&&te>0){let W=g(J,R);Y=balanceRange(J,q,ee,0,q.length,0,se-F,W,W)}else Y=b(J,q,ee,se-F,V-se,R)}E.push(Y),N.push(Q)}function p(v,_,E,N){let I=[],L=0,A=-1;for(;c.pos>_;){let{id:F,start:se,end:H,size:V}=c;if(V>4)c.next();else{if(A>-1&&se<A)break;A<0&&(A=H-s),I.push(F,se,H),L++,c.next()}}if(L){let F=new Uint16Array(L*4),se=I[I.length-2];for(let H=I.length-3,V=0;H>=0;H-=3)F[V++]=I[H],F[V++]=I[H+1]-se,F[V++]=I[H+2]-se,F[V++]=V;E.push(new TreeBuffer(F,I[2]-se,o)),N.push(se-v)}}function g(v,_){return(E,N,I)=>{let L=0,A=E.length-1,F,se;if(A>=0&&(F=E[A])instanceof Tree){if(!A&&F.type==v&&F.length==I)return F;(se=F.prop(NodeProp.lookAhead))&&(L=N[A]+F.length+se)}return b(v,E,N,I,L,_)}}function y(v,_,E,N,I,L,A,F,se){let H=[],V=[];for(;v.length>N;)H.push(v.pop()),V.push(_.pop()+E-I);v.push(b(o.types[A],H,V,L-I,F-L,se)),_.push(I-E)}function b(v,_,E,N,I,L,A){if(L){let F=[NodeProp.contextHash,L];A=A?[F].concat(A):[F]}if(I>25){let F=[NodeProp.lookAhead,I];A=A?[F].concat(A):[F]}return new Tree(v,_,E,N,A)}function k(v,_){let E=c.fork(),N=0,I=0,L=0,A=E.end-s,F={size:0,start:0,skip:0};e:for(let se=E.pos-v;E.pos>se;){let H=E.size;if(E.id==_&&H>=0){F.size=N,F.start=I,F.skip=L,L+=4,N+=4,E.next();continue}let V=E.pos-H;if(H<0||V<se||E.start<A)break;let R=E.id>=l?4:0,J=E.start;for(E.next();E.pos>V;){if(E.size<0)if(E.size==-3)R+=4;else break e;else E.id>=l&&(R+=4);E.next()}I=J,N+=H,L+=R}return(_<0||N==v)&&(F.size=N,F.start=I,F.skip=L),F.size>4?F:void 0}function w(v,_,E){let{id:N,start:I,end:L,size:A}=c;if(c.next(),A>=0&&N<l){let F=E;if(A>4){let se=c.pos-(A-4);for(;c.pos>se;)E=w(v,_,E)}_[--E]=F,_[--E]=L-v,_[--E]=I-v,_[--E]=N}else A==-3?u=N:A==-4&&(m=N);return E}let B=[],M=[];for(;c.pos>0;)f(r.start||0,r.bufferStart||0,B,M,-1,0);let x=(e=r.length)!==null&&e!==void 0?e:B.length?M[0]+B[0].length:0;return new Tree(d[r.topID],B.reverse(),M.reverse(),x)}const nodeSizeCache=new WeakMap;function nodeSize(r,e){if(!r.isAnonymous||e instanceof TreeBuffer||e.type!=r)return 1;let n=nodeSizeCache.get(e);if(n==null){n=1;for(let o of e.children){if(o.type!=r||!(o instanceof Tree)){n=1;break}n+=nodeSize(r,o)}nodeSizeCache.set(e,n)}return n}function balanceRange(r,e,n,o,s,a,l,c,d){let u=0;for(let y=o;y<s;y++)u+=nodeSize(r,e[y]);let m=Math.ceil(u*1.5/8),f=[],p=[];function g(y,b,k,w,B){for(let M=k;M<w;){let x=M,v=b[M],_=nodeSize(r,y[M]);for(M++;M<w;M++){let E=nodeSize(r,y[M]);if(_+E>=m)break;_+=E}if(M==x+1){if(_>m){let E=y[x];g(E.children,E.positions,0,E.children.length,b[x]+B);continue}f.push(y[x])}else{let E=b[M-1]+y[M-1].length-v;f.push(balanceRange(r,y,b,x,M,v,E,null,d))}p.push(v+B-a)}}return g(e,n,o,s,0),(c||d)(f,p,l)}NodeWeakMap=class{constructor(){this.map=new WeakMap}setBuffer(r,e,n){let o=this.map.get(r);o||this.map.set(r,o=new Map),o.set(e,n)}getBuffer(r,e){let n=this.map.get(r);return n&&n.get(e)}set(r,e){r instanceof BufferNode?this.setBuffer(r.context.buffer,r.index,e):r instanceof TreeNode&&this.map.set(r.tree,e)}get(r){return r instanceof BufferNode?this.getBuffer(r.context.buffer,r.index):r instanceof TreeNode?this.map.get(r.tree):void 0}cursorSet(r,e){r.buffer?this.setBuffer(r.buffer.buffer,r.index,e):this.map.set(r.tree,e)}cursorGet(r){return r.buffer?this.getBuffer(r.buffer.buffer,r.index):this.map.get(r.tree)}};class TreeFragment{constructor(e,n,o,s,a=!1,l=!1){this.from=e,this.to=n,this.tree=o,this.offset=s,this.open=(a?1:0)|(l?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(e,n=[],o=!1){let s=[new TreeFragment(0,e.length,e,0,!1,o)];for(let a of n)a.to>e.length&&s.push(a);return s}static applyChanges(e,n,o=128){if(!n.length)return e;let s=[],a=1,l=e.length?e[0]:null;for(let c=0,d=0,u=0;;c++){let m=c<n.length?n[c]:null,f=m?m.fromA:1e9;if(f-d>=o)for(;l&&l.from<f;){let p=l;if(d>=p.from||f<=p.to||u){let g=Math.max(p.from,d)-u,y=Math.min(p.to,f)-u;p=g>=y?null:new TreeFragment(g,y,p.tree,p.offset+u,c>0,!!m)}if(p&&s.push(p),l.to>f)break;l=a<e.length?e[a++]:null}if(!m)break;d=m.toA,u=m.toA-m.toB}return s}}Parser$1=class{startParse(r,e,n){return typeof r=="string"&&(r=new StringInput(r)),n=n?n.length?n.map(o=>new Range(o.from,o.to)):[new Range(0,0)]:[new Range(0,r.length)],this.createParse(r,e||[],n)}parse(r,e,n){let o=this.startParse(r,e,n);for(;;){let s=o.advance();if(s)return s}}};class StringInput{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,n){return this.string.slice(e,n)}}parseMixed=function(r){return(e,n,o,s)=>new MixedParse(e,r,n,o,s)};class InnerParse{constructor(e,n,o,s,a){this.parser=e,this.parse=n,this.overlay=o,this.target=s,this.from=a}}function checkRanges(r){if(!r.length||r.some(e=>e.from>=e.to))throw new RangeError("Invalid inner parse ranges given: "+JSON.stringify(r))}class ActiveOverlay{constructor(e,n,o,s,a,l,c){this.parser=e,this.predicate=n,this.mounts=o,this.index=s,this.start=a,this.target=l,this.prev=c,this.depth=0,this.ranges=[]}}const stoppedInner=new NodeProp({perNode:!0});class MixedParse{constructor(e,n,o,s,a){this.nest=n,this.input=o,this.fragments=s,this.ranges=a,this.inner=[],this.innerDone=0,this.baseTree=null,this.stoppedAt=null,this.baseParse=e}advance(){if(this.baseParse){let o=this.baseParse.advance();if(!o)return null;if(this.baseParse=null,this.baseTree=o,this.startInner(),this.stoppedAt!=null)for(let s of this.inner)s.parse.stopAt(this.stoppedAt)}if(this.innerDone==this.inner.length){let o=this.baseTree;return this.stoppedAt!=null&&(o=new Tree(o.type,o.children,o.positions,o.length,o.propValues.concat([[stoppedInner,this.stoppedAt]]))),o}let e=this.inner[this.innerDone],n=e.parse.advance();if(n){this.innerDone++;let o=Object.assign(Object.create(null),e.target.props);o[NodeProp.mounted.id]=new MountedTree(n,e.overlay,e.parser),e.target.props=o}return null}get parsedPos(){if(this.baseParse)return 0;let e=this.input.length;for(let n=this.innerDone;n<this.inner.length;n++)this.inner[n].from<e&&(e=Math.min(e,this.inner[n].parse.parsedPos));return e}stopAt(e){if(this.stoppedAt=e,this.baseParse)this.baseParse.stopAt(e);else for(let n=this.innerDone;n<this.inner.length;n++)this.inner[n].parse.stopAt(e)}startInner(){let e=new FragmentCursor(this.fragments),n=null,o=null,s=new TreeCursor(new TreeNode(this.baseTree,this.ranges[0].from,0,null),IterMode.IncludeAnonymous|IterMode.IgnoreMounts);e:for(let a,l;;){let c=!0,d;if(this.stoppedAt!=null&&s.from>=this.stoppedAt)c=!1;else if(e.hasNode(s)){if(n){let u=n.mounts.find(m=>m.frag.from<=s.from&&m.frag.to>=s.to&&m.mount.overlay);if(u)for(let m of u.mount.overlay){let f=m.from+u.pos,p=m.to+u.pos;f>=s.from&&p<=s.to&&!n.ranges.some(g=>g.from<p&&g.to>f)&&n.ranges.push({from:f,to:p})}}c=!1}else if(o&&(l=checkCover(o.ranges,s.from,s.to)))c=l!=2;else if(!s.type.isAnonymous&&(a=this.nest(s,this.input))&&(s.from<s.to||!a.overlay)){s.tree||materialize(s);let u=e.findMounts(s.from,a.parser);if(typeof a.overlay=="function")n=new ActiveOverlay(a.parser,a.overlay,u,this.inner.length,s.from,s.tree,n);else{let m=punchRanges(this.ranges,a.overlay||(s.from<s.to?[new Range(s.from,s.to)]:[]));m.length&&checkRanges(m),(m.length||!a.overlay)&&this.inner.push(new InnerParse(a.parser,m.length?a.parser.startParse(this.input,enterFragments(u,m),m):a.parser.startParse(""),a.overlay?a.overlay.map(f=>new Range(f.from-s.from,f.to-s.from)):null,s.tree,m.length?m[0].from:s.from)),a.overlay?m.length&&(o={ranges:m,depth:0,prev:o}):c=!1}}else if(n&&(d=n.predicate(s))&&(d===!0&&(d=new Range(s.from,s.to)),d.from<d.to)){let u=n.ranges.length-1;u>=0&&n.ranges[u].to==d.from?n.ranges[u]={from:n.ranges[u].from,to:d.to}:n.ranges.push(d)}if(c&&s.firstChild())n&&n.depth++,o&&o.depth++;else for(;!s.nextSibling();){if(!s.parent())break e;if(n&&!--n.depth){let u=punchRanges(this.ranges,n.ranges);u.length&&(checkRanges(u),this.inner.splice(n.index,0,new InnerParse(n.parser,n.parser.startParse(this.input,enterFragments(n.mounts,u),u),n.ranges.map(m=>new Range(m.from-n.start,m.to-n.start)),n.target,u[0].from))),n=n.prev}o&&!--o.depth&&(o=o.prev)}}}}function checkCover(r,e,n){for(let o of r){if(o.from>=n)break;if(o.to>e)return o.from<=e&&o.to>=n?2:1}return 0}function sliceBuf(r,e,n,o,s,a){if(e<n){let l=r.buffer[e+1];o.push(r.slice(e,n,l)),s.push(l-a)}}function materialize(r){let{node:e}=r,n=[],o=e.context.buffer;do n.push(r.index),r.parent();while(!r.tree);let s=r.tree,a=s.children.indexOf(o),l=s.children[a],c=l.buffer,d=[a];function u(m,f,p,g,y,b){let k=n[b],w=[],B=[];sliceBuf(l,m,k,w,B,g);let M=c[k+1],x=c[k+2];d.push(w.length);let v=b?u(k+4,c[k+3],l.set.types[c[k]],M,x-M,b-1):e.toTree();return w.push(v),B.push(M-g),sliceBuf(l,c[k+3],f,w,B,g),new Tree(p,w,B,y)}s.children[a]=u(0,c.length,NodeType.none,0,l.length,n.length-1);for(let m of d){let f=r.tree.children[m],p=r.tree.positions[m];r.yield(new TreeNode(f,p+r.from,m,r._tree))}}class StructureCursor{constructor(e,n){this.offset=n,this.done=!1,this.cursor=e.cursor(IterMode.IncludeAnonymous|IterMode.IgnoreMounts)}moveTo(e){let{cursor:n}=this,o=e-this.offset;for(;!this.done&&n.from<o;)n.to>=e&&n.enter(o,1,IterMode.IgnoreOverlays|IterMode.ExcludeBuffers)||n.next(!1)||(this.done=!0)}hasNode(e){if(this.moveTo(e.from),!this.done&&this.cursor.from+this.offset==e.from&&this.cursor.tree)for(let n=this.cursor.tree;;){if(n==e.tree)return!0;if(n.children.length&&n.positions[0]==0&&n.children[0]instanceof Tree)n=n.children[0];else break}return!1}}class FragmentCursor{constructor(e){var n;if(this.fragments=e,this.curTo=0,this.fragI=0,e.length){let o=this.curFrag=e[0];this.curTo=(n=o.tree.prop(stoppedInner))!==null&&n!==void 0?n:o.to,this.inner=new StructureCursor(o.tree,-o.offset)}else this.curFrag=this.inner=null}hasNode(e){for(;this.curFrag&&e.from>=this.curTo;)this.nextFrag();return this.curFrag&&this.curFrag.from<=e.from&&this.curTo>=e.to&&this.inner.hasNode(e)}nextFrag(){var e;if(this.fragI++,this.fragI==this.fragments.length)this.curFrag=this.inner=null;else{let n=this.curFrag=this.fragments[this.fragI];this.curTo=(e=n.tree.prop(stoppedInner))!==null&&e!==void 0?e:n.to,this.inner=new StructureCursor(n.tree,-n.offset)}}findMounts(e,n){var o;let s=[];if(this.inner){this.inner.cursor.moveTo(e,1);for(let a=this.inner.cursor.node;a;a=a.parent){let l=(o=a.tree)===null||o===void 0?void 0:o.prop(NodeProp.mounted);if(l&&l.parser==n)for(let c=this.fragI;c<this.fragments.length;c++){let d=this.fragments[c];if(d.from>=a.to)break;d.tree==this.curFrag.tree&&s.push({frag:d,pos:a.from-d.offset,mount:l})}}}return s}}function punchRanges(r,e){let n=null,o=e;for(let s=1,a=0;s<r.length;s++){let l=r[s-1].to,c=r[s].from;for(;a<o.length;a++){let d=o[a];if(d.from>=c)break;d.to<=l||(n||(o=n=e.slice()),d.from<l?(n[a]=new Range(d.from,l),d.to>c&&n.splice(a+1,0,new Range(c,d.to))):d.to>c?n[a--]=new Range(c,d.to):n.splice(a--,1))}}return o}function findCoverChanges(r,e,n,o){let s=0,a=0,l=!1,c=!1,d=-1e9,u=[];for(;;){let m=s==r.length?1e9:l?r[s].to:r[s].from,f=a==e.length?1e9:c?e[a].to:e[a].from;if(l!=c){let p=Math.max(d,n),g=Math.min(m,f,o);p<g&&u.push(new Range(p,g))}if(d=Math.min(m,f),d==1e9)break;m==d&&(l?(l=!1,s++):l=!0),f==d&&(c?(c=!1,a++):c=!0)}return u}function enterFragments(r,e){let n=[];for(let{pos:o,mount:s,frag:a}of r){let l=o+(s.overlay?s.overlay[0].from:0),c=l+s.tree.length,d=Math.max(a.from,l),u=Math.min(a.to,c);if(s.overlay){let m=s.overlay.map(p=>new Range(p.from+o,p.to+o)),f=findCoverChanges(e,m,d,u);for(let p=0,g=d;;p++){let y=p==f.length,b=y?u:f[p].from;if(b>g&&n.push(new TreeFragment(g,b,s.tree,-l,a.from>=g||a.openStart,a.to<=b||a.openEnd)),y)break;g=f[p].to}}else n.push(new TreeFragment(d,u,s.tree,-l,a.from>=l||a.openStart,a.to<=c||a.openEnd))}return n}let nextTagID=0;Tag=class{constructor(r,e,n,o){this.name=r,this.set=e,this.base=n,this.modified=o,this.id=nextTagID++}toString(){let{name:r}=this;for(let e of this.modified)e.name&&(r=`${e.name}(${r})`);return r}static define(r,e){let n=typeof r=="string"?r:"?";if(r instanceof Tag&&(e=r),e==null?void 0:e.base)throw new Error("Can not derive from a modified tag");let o=new Tag(n,[],null,[]);if(o.set.push(o),e)for(let s of e.set)o.set.push(s);return o}static defineModifier(r){let e=new Modifier(r);return n=>n.modified.indexOf(e)>-1?n:Modifier.get(n.base||n,n.modified.concat(e).sort((o,s)=>o.id-s.id))}};let nextModifierID=0;class Modifier{constructor(e){this.name=e,this.instances=[],this.id=nextModifierID++}static get(e,n){if(!n.length)return e;let o=n[0].instances.find(c=>c.base==e&&sameArray(n,c.modified));if(o)return o;let s=[],a=new Tag(e.name,s,e,n);for(let c of n)c.instances.push(a);let l=powerSet(n);for(let c of e.set)if(!c.modified.length)for(let d of l)s.push(Modifier.get(c,d));return a}}function sameArray(r,e){return r.length==e.length&&r.every((n,o)=>n==e[o])}function powerSet(r){let e=[[]];for(let n=0;n<r.length;n++)for(let o=0,s=e.length;o<s;o++)e.push(e[o].concat(r[n]));return e.sort((n,o)=>o.length-n.length)}styleTags=function(r){let e=Object.create(null);for(let n in r){let o=r[n];Array.isArray(o)||(o=[o]);for(let s of n.split(" "))if(s){let a=[],l=2,c=s;for(let f=0;;){if(c=="..."&&f>0&&f+3==s.length){l=1;break}let p=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(c);if(!p)throw new RangeError("Invalid path: "+s);if(a.push(p[0]=="*"?"":p[0][0]=='"'?JSON.parse(p[0]):p[0]),f+=p[0].length,f==s.length)break;let g=s[f++];if(f==s.length&&g=="!"){l=0;break}if(g!="/")throw new RangeError("Invalid path: "+s);c=s.slice(f)}let d=a.length-1,u=a[d];if(!u)throw new RangeError("Invalid path: "+s);let m=new Rule(o,l,d>0?a.slice(0,d):null);e[u]=m.sort(e[u])}}return ruleNodeProp.add(e)};const ruleNodeProp=new NodeProp;class Rule{constructor(e,n,o,s){this.tags=e,this.mode=n,this.context=o,this.next=s}get opaque(){return this.mode==0}get inherit(){return this.mode==1}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}}Rule.empty=new Rule([],2,null);function tagHighlighter(r,e){let n=Object.create(null);for(let a of r)if(!Array.isArray(a.tag))n[a.tag.id]=a.class;else for(let l of a.tag)n[l.id]=a.class;let{scope:o,all:s=null}=e||{};return{style:a=>{let l=s;for(let c of a)for(let d of c.set){let u=n[d.id];if(u){l=l?l+" "+u:u;break}}return l},scope:o}}function highlightTags(r,e){let n=null;for(let o of r){let s=o.style(e);s&&(n=n?n+" "+s:s)}return n}function highlightTree(r,e,n,o=0,s=r.length){let a=new HighlightBuilder(o,Array.isArray(e)?e:[e],n);a.highlightRange(r.cursor(),o,s,"",a.highlighters),a.flush(s)}class HighlightBuilder{constructor(e,n,o){this.at=e,this.highlighters=n,this.span=o,this.class=""}startSpan(e,n){n!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=n)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,n,o,s,a){let{type:l,from:c,to:d}=e;if(c>=o||d<=n)return;l.isTop&&(a=this.highlighters.filter(g=>!g.scope||g.scope(l)));let u=s,m=getStyleTags(e)||Rule.empty,f=highlightTags(a,m.tags);if(f&&(u&&(u+=" "),u+=f,m.mode==1&&(s+=(s?" ":"")+f)),this.startSpan(Math.max(n,c),u),m.opaque)return;let p=e.tree&&e.tree.prop(NodeProp.mounted);if(p&&p.overlay){let g=e.node.enter(p.overlay[0].from+c,1),y=this.highlighters.filter(k=>!k.scope||k.scope(p.tree.type)),b=e.firstChild();for(let k=0,w=c;;k++){let B=k<p.overlay.length?p.overlay[k]:null,M=B?B.from+c:d,x=Math.max(n,w),v=Math.min(o,M);if(x<v&&b)for(;e.from<v&&(this.highlightRange(e,x,v,s,a),this.startSpan(Math.min(v,e.to),u),!(e.to>=M||!e.nextSibling())););if(!B||M>o)break;w=B.to+c,w>n&&(this.highlightRange(g.cursor(),Math.max(n,B.from+c),Math.min(o,w),"",y),this.startSpan(Math.min(o,w),u))}b&&e.parent()}else if(e.firstChild()){p&&(s="");do if(!(e.to<=n)){if(e.from>=o)break;this.highlightRange(e,n,o,s,a),this.startSpan(Math.min(o,e.to),u)}while(e.nextSibling());e.parent()}}}function getStyleTags(r){let e=r.type.prop(ruleNodeProp);for(;e&&e.context&&!r.matchContext(e.context);)e=e.next;return e||null}let t,comment,name,typeName,propertyName,literal,string,number,content,heading,keyword,operator,punctuation,bracket,meta;t=Tag.define,comment=t(),name=t(),typeName=t(name),propertyName=t(name),literal=t(),string=t(literal),number=t(literal),content=t(),heading=t(content),keyword=t(),operator=t(),punctuation=t(),bracket=t(punctuation),meta=t(),tags={comment,lineComment:t(comment),blockComment:t(comment),docComment:t(comment),name,variableName:t(name),typeName,tagName:t(typeName),propertyName,attributeName:t(propertyName),className:t(name),labelName:t(name),namespace:t(name),macroName:t(name),literal,string,docString:t(string),character:t(string),attributeValue:t(string),number,integer:t(number),float:t(number),bool:t(literal),regexp:t(literal),escape:t(literal),color:t(literal),url:t(literal),keyword,self:t(keyword),null:t(keyword),atom:t(keyword),unit:t(keyword),modifier:t(keyword),operatorKeyword:t(keyword),controlKeyword:t(keyword),definitionKeyword:t(keyword),moduleKeyword:t(keyword),operator,derefOperator:t(operator),arithmeticOperator:t(operator),logicOperator:t(operator),bitwiseOperator:t(operator),compareOperator:t(operator),updateOperator:t(operator),definitionOperator:t(operator),typeOperator:t(operator),controlOperator:t(operator),punctuation,separator:t(punctuation),bracket,angleBracket:t(bracket),squareBracket:t(bracket),paren:t(bracket),brace:t(bracket),content,heading,heading1:t(heading),heading2:t(heading),heading3:t(heading),heading4:t(heading),heading5:t(heading),heading6:t(heading),contentSeparator:t(content),list:t(content),quote:t(content),emphasis:t(content),strong:t(content),link:t(content),monospace:t(content),strikethrough:t(content),inserted:t(),deleted:t(),changed:t(),invalid:t(),meta,documentMeta:t(meta),annotation:t(meta),processingInstruction:t(meta),definition:Tag.defineModifier("definition"),constant:Tag.defineModifier("constant"),function:Tag.defineModifier("function"),standard:Tag.defineModifier("standard"),local:Tag.defineModifier("local"),special:Tag.defineModifier("special")};for(let r in tags){let e=tags[r];e instanceof Tag&&(e.name=r)}tagHighlighter([{tag:tags.link,class:"tok-link"},{tag:tags.heading,class:"tok-heading"},{tag:tags.emphasis,class:"tok-emphasis"},{tag:tags.strong,class:"tok-strong"},{tag:tags.keyword,class:"tok-keyword"},{tag:tags.atom,class:"tok-atom"},{tag:tags.bool,class:"tok-bool"},{tag:tags.url,class:"tok-url"},{tag:tags.labelName,class:"tok-labelName"},{tag:tags.inserted,class:"tok-inserted"},{tag:tags.deleted,class:"tok-deleted"},{tag:tags.literal,class:"tok-literal"},{tag:tags.string,class:"tok-string"},{tag:tags.number,class:"tok-number"},{tag:[tags.regexp,tags.escape,tags.special(tags.string)],class:"tok-string2"},{tag:tags.variableName,class:"tok-variableName"},{tag:tags.local(tags.variableName),class:"tok-variableName tok-local"},{tag:tags.definition(tags.variableName),class:"tok-variableName tok-definition"},{tag:tags.special(tags.variableName),class:"tok-variableName2"},{tag:tags.definition(tags.propertyName),class:"tok-propertyName tok-definition"},{tag:tags.typeName,class:"tok-typeName"},{tag:tags.namespace,class:"tok-namespace"},{tag:tags.className,class:"tok-className"},{tag:tags.macroName,class:"tok-macroName"},{tag:tags.propertyName,class:"tok-propertyName"},{tag:tags.operator,class:"tok-operator"},{tag:tags.comment,class:"tok-comment"},{tag:tags.meta,class:"tok-meta"},{tag:tags.invalid,class:"tok-invalid"},{tag:tags.punctuation,class:"tok-punctuation"}]);var _a;languageDataProp=new NodeProp,defineLanguageFacet=function(r){return Facet.define({combine:r?e=>e.concat(r):void 0})},sublanguageProp=new NodeProp,Language=class{constructor(r,e,n=[],o=""){this.data=r,this.name=o,EditorState.prototype.hasOwnProperty("tree")||Object.defineProperty(EditorState.prototype,"tree",{get(){return syntaxTree(this)}}),this.parser=e,this.extension=[language.of(this),EditorState.languageData.of((s,a,l)=>{let c=topNodeAt(s,a,l),d=c.type.prop(languageDataProp);if(!d)return[];let u=s.facet(d),m=c.type.prop(sublanguageProp);if(m){let f=c.resolve(a-c.from,l);for(let p of m)if(p.test(f,s)){let g=s.facet(p.facet);return p.type=="replace"?g:g.concat(u)}}return u})].concat(n)}isActiveAt(r,e,n=-1){return topNodeAt(r,e,n).type.prop(languageDataProp)==this.data}findRegions(r){let e=r.facet(language);if((e==null?void 0:e.data)==this.data)return[{from:0,to:r.doc.length}];if(!e||!e.allowsNesting)return[];let n=[],o=(s,a)=>{if(s.prop(languageDataProp)==this.data){n.push({from:a,to:a+s.length});return}let l=s.prop(NodeProp.mounted);if(l){if(l.tree.prop(languageDataProp)==this.data){if(l.overlay)for(let c of l.overlay)n.push({from:c.from+a,to:c.to+a});else n.push({from:a,to:a+s.length});return}else if(l.overlay){let c=n.length;if(o(l.tree,l.overlay[0].from+a),n.length>c)return}}for(let c=0;c<s.children.length;c++){let d=s.children[c];d instanceof Tree&&o(d,s.positions[c]+a)}};return o(syntaxTree(r),0),n}get allowsNesting(){return!0}},Language.setState=StateEffect.define();function topNodeAt(r,e,n){let o=r.facet(language),s=syntaxTree(r).topNode;if(!o||o.allowsNesting)for(let a=s;a;a=a.enter(e,n,IterMode.ExcludeBuffers))a.type.isTop&&(s=a);return s}LRLanguage=class extends Language{constructor(r,e,n){super(r,e,[],n),this.parser=e}static define(r){let e=defineLanguageFacet(r.languageData);return new LRLanguage(e,r.parser.configure({props:[languageDataProp.add(n=>n.isTop?e:void 0)]}),r.name)}configure(r,e){return new LRLanguage(this.data,this.parser.configure(r),e||this.name)}get allowsNesting(){return this.parser.hasWrappers()}},syntaxTree=function(r){let e=r.field(Language.state,!1);return e?e.tree:Tree.empty};class DocInput{constructor(e){this.doc=e,this.cursorPos=0,this.string="",this.cursor=e.iter()}get length(){return this.doc.length}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,n){let o=this.cursorPos-this.string.length;return e<o||n>=this.cursorPos?this.doc.sliceString(e,n):this.string.slice(e-o,n-o)}}let currentContext=null;ParseContext=class{constructor(r,e,n=[],o,s,a,l,c){this.parser=r,this.state=e,this.fragments=n,this.tree=o,this.treeLen=s,this.viewport=a,this.skipped=l,this.scheduleOn=c,this.parse=null,this.tempSkipped=[]}static create(r,e,n){return new ParseContext(r,e,[],Tree.empty,0,n,[],null)}startParse(){return this.parser.startParse(new DocInput(this.state.doc),this.fragments)}work(r,e){return e!=null&&e>=this.state.doc.length&&(e=void 0),this.tree!=Tree.empty&&this.isDone(e??this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var n;if(typeof r=="number"){let o=Date.now()+r;r=()=>Date.now()>o}for(this.parse||(this.parse=this.startParse()),e!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&e<this.state.doc.length&&this.parse.stopAt(e);;){let o=this.parse.advance();if(o)if(this.fragments=this.withoutTempSkipped(TreeFragment.addTree(o,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(n=this.parse.stoppedAt)!==null&&n!==void 0?n:this.state.doc.length,this.tree=o,this.parse=null,this.treeLen<(e??this.state.doc.length))this.parse=this.startParse();else return!0;if(r())return!1}})}takeTree(){let r,e;this.parse&&(r=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>r)&&this.parse.stopAt(r),this.withContext(()=>{for(;!(e=this.parse.advance()););}),this.treeLen=r,this.tree=e,this.fragments=this.withoutTempSkipped(TreeFragment.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(r){let e=currentContext;currentContext=this;try{return r()}finally{currentContext=e}}withoutTempSkipped(r){for(let e;e=this.tempSkipped.pop();)r=cutFragments(r,e.from,e.to);return r}changes(r,e){let{fragments:n,tree:o,treeLen:s,viewport:a,skipped:l}=this;if(this.takeTree(),!r.empty){let c=[];if(r.iterChangedRanges((d,u,m,f)=>c.push({fromA:d,toA:u,fromB:m,toB:f})),n=TreeFragment.applyChanges(n,c),o=Tree.empty,s=0,a={from:r.mapPos(a.from,-1),to:r.mapPos(a.to,1)},this.skipped.length){l=[];for(let d of this.skipped){let u=r.mapPos(d.from,1),m=r.mapPos(d.to,-1);u<m&&l.push({from:u,to:m})}}}return new ParseContext(this.parser,e,n,o,s,a,l,this.scheduleOn)}updateViewport(r){if(this.viewport.from==r.from&&this.viewport.to==r.to)return!1;this.viewport=r;let e=this.skipped.length;for(let n=0;n<this.skipped.length;n++){let{from:o,to:s}=this.skipped[n];o<r.to&&s>r.from&&(this.fragments=cutFragments(this.fragments,o,s),this.skipped.splice(n--,1))}return this.skipped.length>=e?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(r,e){this.skipped.push({from:r,to:e})}static getSkippingParser(r){return new class extends Parser$1{createParse(e,n,o){let s=o[0].from,a=o[o.length-1].to;return{parsedPos:s,advance(){let l=currentContext;if(l){for(let c of o)l.tempSkipped.push(c);r&&(l.scheduleOn=l.scheduleOn?Promise.all([l.scheduleOn,r]):r)}return this.parsedPos=a,new Tree(NodeType.none,[],[],a-s)},stoppedAt:null,stopAt(){}}}}}isDone(r){r=Math.min(r,this.state.doc.length);let e=this.fragments;return this.treeLen>=r&&e.length&&e[0].from==0&&e[0].to>=r}static get(){return currentContext}};function cutFragments(r,e,n){return TreeFragment.applyChanges(r,[{fromA:e,toA:n,fromB:e,toB:n}])}class LanguageState{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let n=this.context.changes(e.changes,e.state),o=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),n.viewport.to);return n.work(20,o)||n.takeTree(),new LanguageState(n)}static init(e){let n=Math.min(3e3,e.doc.length),o=ParseContext.create(e.facet(language).parser,e,{from:0,to:n});return o.work(20,n)||o.takeTree(),new LanguageState(o)}}Language.state=StateField.define({create:LanguageState.init,update(r,e){for(let n of e.effects)if(n.is(Language.setState))return n.value;return e.startState.facet(language)!=e.state.facet(language)?LanguageState.init(e.state):r.apply(e)}});let requestIdle=r=>{let e=setTimeout(()=>r(),500);return()=>clearTimeout(e)};typeof requestIdleCallback<"u"&&(requestIdle=r=>{let e=-1,n=setTimeout(()=>{e=requestIdleCallback(r,{timeout:400})},100);return()=>e<0?clearTimeout(n):cancelIdleCallback(e)});const isInputPending=typeof navigator<"u"&&!((_a=navigator.scheduling)===null||_a===void 0)&&_a.isInputPending?()=>navigator.scheduling.isInputPending():null,parseWorker=ViewPlugin.fromClass(class{constructor(r){this.view=r,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(r){let e=this.view.state.field(Language.state).context;(e.updateViewport(r.view.viewport)||this.view.viewport.to>e.treeLen)&&this.scheduleWork(),(r.docChanged||r.selectionSet)&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(e)}scheduleWork(){if(this.working)return;let{state:r}=this.view,e=r.field(Language.state);(e.tree!=e.context.tree||!e.context.isDone(r.doc.length))&&(this.working=requestIdle(this.work))}work(r){this.working=null;let e=Date.now();if(this.chunkEnd<e&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=e+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:n,viewport:{to:o}}=this.view,s=n.field(Language.state);if(s.tree==s.context.tree&&s.context.isDone(o+1e5))return;let a=Date.now()+Math.min(this.chunkBudget,100,r&&!isInputPending?Math.max(25,r.timeRemaining()-5):1e9),l=s.context.treeLen<o&&n.doc.length>o+1e3,c=s.context.work(()=>isInputPending&&isInputPending()||Date.now()>a,o+(l?0:1e5));this.chunkBudget-=Date.now()-e,(c||this.chunkBudget<=0)&&(s.context.takeTree(),this.view.dispatch({effects:Language.setState.of(new LanguageState(s.context))})),this.chunkBudget>0&&!(c&&!l)&&this.scheduleWork(),this.checkAsyncSchedule(s.context)}checkAsyncSchedule(r){r.scheduleOn&&(this.workScheduled++,r.scheduleOn.then(()=>this.scheduleWork()).catch(e=>logException(this.view.state,e)).then(()=>this.workScheduled--),r.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),language=Facet.define({combine(r){return r.length?r[0]:null},enables:r=>[Language.state,parseWorker,EditorView.contentAttributes.compute([r],e=>{let n=e.facet(r);return n&&n.name?{"data-language":n.name}:{}})]});LanguageSupport=class{constructor(r,e=[]){this.language=r,this.support=e,this.extension=[r,e]}},LanguageDescription=class{constructor(r,e,n,o,s,a=void 0){this.name=r,this.alias=e,this.extensions=n,this.filename=o,this.loadFunc=s,this.support=a,this.loading=null}load(){return this.loading||(this.loading=this.loadFunc().then(r=>this.support=r,r=>{throw this.loading=null,r}))}static of(r){let{load:e,support:n}=r;if(!e){if(!n)throw new RangeError("Must pass either 'load' or 'support' to LanguageDescription.of");e=()=>Promise.resolve(n)}return new LanguageDescription(r.name,(r.alias||[]).concat(r.name).map(o=>o.toLowerCase()),r.extensions||[],r.filename,e,n)}static matchFilename(r,e){for(let o of r)if(o.filename&&o.filename.test(e))return o;let n=/\.([^.]+)$/.exec(e);if(n){for(let o of r)if(o.extensions.indexOf(n[1])>-1)return o}return null}static matchLanguageName(r,e,n=!0){e=e.toLowerCase();for(let o of r)if(o.alias.some(s=>s==e))return o;if(n)for(let o of r)for(let s of o.alias){let a=e.indexOf(s);if(a>-1&&(s.length>2||!/\w/.test(e[a-1])&&!/\w/.test(e[a+s.length])))return o}return null}};let indentService;indentService=Facet.define(),indentUnit=Facet.define({combine:r=>{if(!r.length)return"  ";let e=r[0];if(!e||/\S/.test(e)||Array.from(e).some(n=>n!=e[0]))throw new Error("Invalid indent unit: "+JSON.stringify(r[0]));return e}});function getIndentUnit(r){let e=r.facet(indentUnit);return e.charCodeAt(0)==9?r.tabSize*e.length:e.length}function indentString(r,e){let n="",o=r.tabSize,s=r.facet(indentUnit)[0];if(s=="	"){for(;e>=o;)n+="	",e-=o;s=" "}for(let a=0;a<e;a++)n+=s;return n}function getIndentation(r,e){r instanceof EditorState&&(r=new IndentContext(r));for(let o of r.state.facet(indentService)){let s=o(r,e);if(s!==void 0)return s}let n=syntaxTree(r.state);return n.length>=e?syntaxIndentation(r,n,e):null}class IndentContext{constructor(e,n={}){this.state=e,this.options=n,this.unit=getIndentUnit(e)}lineAt(e,n=1){let o=this.state.doc.lineAt(e),{simulateBreak:s,simulateDoubleBreak:a}=this.options;return s!=null&&s>=o.from&&s<=o.to?a&&s==e?{text:"",from:e}:(n<0?s<e:s<=e)?{text:o.text.slice(s-o.from),from:s}:{text:o.text.slice(0,s-o.from),from:o.from}:o}textAfterPos(e,n=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:o,from:s}=this.lineAt(e,n);return o.slice(e-s,Math.min(o.length,e+100-s))}column(e,n=1){let{text:o,from:s}=this.lineAt(e,n),a=this.countColumn(o,e-s),l=this.options.overrideIndentation?this.options.overrideIndentation(s):-1;return l>-1&&(a+=l-this.countColumn(o,o.search(/\S|$/))),a}countColumn(e,n=e.length){return countColumn(e,this.state.tabSize,n)}lineIndent(e,n=1){let{text:o,from:s}=this.lineAt(e,n),a=this.options.overrideIndentation;if(a){let l=a(s);if(l>-1)return l}return this.countColumn(o,o.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}indentNodeProp=new NodeProp;function syntaxIndentation(r,e,n){let o=e.resolveStack(n),s=e.resolveInner(n,-1).resolve(n,0).enterUnfinishedNodesBefore(n);if(s!=o.node){let a=[];for(let l=s;l&&!(l.from==o.node.from&&l.type==o.node.type);l=l.parent)a.push(l);for(let l=a.length-1;l>=0;l--)o={node:a[l],next:o}}return indentFor(o,r,n)}function indentFor(r,e,n){for(let o=r;o;o=o.next){let s=indentStrategy(o.node);if(s)return s(TreeIndentContext.create(e,n,o))}return 0}function ignoreClosed(r){return r.pos==r.options.simulateBreak&&r.options.simulateDoubleBreak}function indentStrategy(r){let e=r.type.prop(indentNodeProp);if(e)return e;let n=r.firstChild,o;if(n&&(o=n.type.prop(NodeProp.closedBy))){let s=r.lastChild,a=s&&o.indexOf(s.name)>-1;return l=>delimitedStrategy(l,!0,1,void 0,a&&!ignoreClosed(l)?s.from:void 0)}return r.parent==null?topIndent:null}function topIndent(){return 0}class TreeIndentContext extends IndentContext{constructor(e,n,o){super(e.state,e.options),this.base=e,this.pos=n,this.context=o}get node(){return this.context.node}static create(e,n,o){return new TreeIndentContext(e,n,o)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(e){let n=this.state.doc.lineAt(e.from);for(;;){let o=e.resolve(n.from);for(;o.parent&&o.parent.from==o.from;)o=o.parent;if(isParent(o,e))break;n=this.state.doc.lineAt(o.from)}return this.lineIndent(n.from)}continue(){return indentFor(this.context.next,this.base,this.pos)}}function isParent(r,e){for(let n=e;n;n=n.parent)if(r==n)return!0;return!1}function bracketedAligned(r){let e=r.node,n=e.childAfter(e.from),o=e.lastChild;if(!n)return null;let s=r.options.simulateBreak,a=r.state.doc.lineAt(n.from),l=s==null||s<=a.from?a.to:Math.min(a.to,s);for(let c=n.to;;){let d=e.childAfter(c);if(!d||d==o)return null;if(!d.type.isSkipped){if(d.from>=l)return null;let u=/^ */.exec(a.text.slice(n.to-a.from))[0].length;return{from:n.from,to:n.to+u}}c=d.to}}delimitedIndent=function({closing:r,align:e=!0,units:n=1}){return o=>delimitedStrategy(o,e,n,r)};function delimitedStrategy(r,e,n,o,s){let a=r.textAfter,l=a.match(/^\s*/)[0].length,c=o&&a.slice(l,l+o.length)==o||s==r.pos+l,d=e?bracketedAligned(r):null;return d?c?r.column(d.from):r.column(d.to):r.baseIndent+(c?0:r.unit*n)}flatIndent=r=>r.baseIndent,continuedIndent=function({except:r,units:e=1}={}){return n=>{let o=r&&r.test(n.textAfter);return n.baseIndent+(o?0:e*n.unit)}};const DontIndentBeyond=200;function indentOnInput(){return EditorState.transactionFilter.of(r=>{if(!r.docChanged||!r.isUserEvent("input.type")&&!r.isUserEvent("input.complete"))return r;let e=r.startState.languageDataAt("indentOnInput",r.startState.selection.main.head);if(!e.length)return r;let n=r.newDoc,{head:o}=r.newSelection.main,s=n.lineAt(o);if(o>s.from+DontIndentBeyond)return r;let a=n.sliceString(s.from,o);if(!e.some(u=>u.test(a)))return r;let{state:l}=r,c=-1,d=[];for(let{head:u}of l.selection.ranges){let m=l.doc.lineAt(u);if(m.from==c)continue;c=m.from;let f=getIndentation(l,m.from);if(f==null)continue;let p=/^\s*/.exec(m.text)[0],g=indentString(l,f);p!=g&&d.push({from:m.from,to:m.from+p.length,insert:g})}return d.length?[r,{changes:d,sequential:!0}]:r})}foldService=Facet.define(),foldNodeProp=new NodeProp,foldInside=function(r){let e=r.firstChild,n=r.lastChild;return e&&e.to<n.from?{from:e.to,to:n.type.isError?r.to:n.from}:null};class HighlightStyle{constructor(e,n){this.specs=e;let o;function s(c){let d=StyleModule.newName();return(o||(o=Object.create(null)))["."+d]=c,d}const a=typeof n.all=="string"?n.all:n.all?s(n.all):void 0,l=n.scope;this.scope=l instanceof Language?c=>c.prop(languageDataProp)==l.data:l?c=>c==l:void 0,this.style=tagHighlighter(e.map(c=>({tag:c.tag,class:c.class||s(Object.assign({},c,{tag:null}))})),{all:a}).style,this.module=o?new StyleModule(o):null,this.themeType=n.themeType}static define(e,n){return new HighlightStyle(e,n||{})}}const highlighterFacet=Facet.define(),fallbackHighlighter=Facet.define({combine(r){return r.length?[r[0]]:null}});function getHighlighters(r){let e=r.facet(highlighterFacet);return e.length?e:r.facet(fallbackHighlighter)}function syntaxHighlighting(r,e){let n=[treeHighlighter],o;return r instanceof HighlightStyle&&(r.module&&n.push(EditorView.styleModule.of(r.module)),o=r.themeType),e!=null&&e.fallback?n.push(fallbackHighlighter.of(r)):o?n.push(highlighterFacet.computeN([EditorView.darkTheme],s=>s.facet(EditorView.darkTheme)==(o=="dark")?[r]:[])):n.push(highlighterFacet.of(r)),n}class TreeHighlighter{constructor(e){this.markCache=Object.create(null),this.tree=syntaxTree(e.state),this.decorations=this.buildDeco(e,getHighlighters(e.state)),this.decoratedTo=e.viewport.to}update(e){let n=syntaxTree(e.state),o=getHighlighters(e.state),s=o!=getHighlighters(e.startState),{viewport:a}=e.view,l=e.changes.mapPos(this.decoratedTo,1);n.length<a.to&&!s&&n.type==this.tree.type&&l>=a.to?(this.decorations=this.decorations.map(e.changes),this.decoratedTo=l):(n!=this.tree||e.viewportChanged||s)&&(this.tree=n,this.decorations=this.buildDeco(e.view,o),this.decoratedTo=a.to)}buildDeco(e,n){if(!n||!this.tree.length)return Decoration.none;let o=new RangeSetBuilder;for(let{from:s,to:a}of e.visibleRanges)highlightTree(this.tree,n,(l,c,d)=>{o.add(l,c,this.markCache[d]||(this.markCache[d]=Decoration.mark({class:d})))},s,a);return o.finish()}}const treeHighlighter=Prec.high(ViewPlugin.fromClass(TreeHighlighter,{decorations:r=>r.decorations})),defaultHighlightStyle=HighlightStyle.define([{tag:tags.meta,color:"#404740"},{tag:tags.link,textDecoration:"underline"},{tag:tags.heading,textDecoration:"underline",fontWeight:"bold"},{tag:tags.emphasis,fontStyle:"italic"},{tag:tags.strong,fontWeight:"bold"},{tag:tags.strikethrough,textDecoration:"line-through"},{tag:tags.keyword,color:"#708"},{tag:[tags.atom,tags.bool,tags.url,tags.contentSeparator,tags.labelName],color:"#219"},{tag:[tags.literal,tags.inserted],color:"#164"},{tag:[tags.string,tags.deleted],color:"#a11"},{tag:[tags.regexp,tags.escape,tags.special(tags.string)],color:"#e40"},{tag:tags.definition(tags.variableName),color:"#00f"},{tag:tags.local(tags.variableName),color:"#30a"},{tag:[tags.typeName,tags.namespace],color:"#085"},{tag:tags.className,color:"#167"},{tag:[tags.special(tags.variableName),tags.macroName],color:"#256"},{tag:tags.definition(tags.propertyName),color:"#00c"},{tag:tags.comment,color:"#940"},{tag:tags.invalid,color:"#f00"}]),baseTheme$1=EditorView.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),DefaultScanDist=1e4,DefaultBrackets="()[]{}",bracketMatchingConfig=Facet.define({combine(r){return combineConfig(r,{afterCursor:!0,brackets:DefaultBrackets,maxScanDistance:DefaultScanDist,renderMatch:defaultRenderMatch})}}),matchingMark=Decoration.mark({class:"cm-matchingBracket"}),nonmatchingMark=Decoration.mark({class:"cm-nonmatchingBracket"});function defaultRenderMatch(r){let e=[],n=r.matched?matchingMark:nonmatchingMark;return e.push(n.range(r.start.from,r.start.to)),r.end&&e.push(n.range(r.end.from,r.end.to)),e}const bracketMatchingState=StateField.define({create(){return Decoration.none},update(r,e){if(!e.docChanged&&!e.selection)return r;let n=[],o=e.state.facet(bracketMatchingConfig);for(let s of e.state.selection.ranges){if(!s.empty)continue;let a=matchBrackets(e.state,s.head,-1,o)||s.head>0&&matchBrackets(e.state,s.head-1,1,o)||o.afterCursor&&(matchBrackets(e.state,s.head,1,o)||s.head<e.state.doc.length&&matchBrackets(e.state,s.head+1,-1,o));a&&(n=n.concat(o.renderMatch(a,e.state)))}return Decoration.set(n,!0)},provide:r=>EditorView.decorations.from(r)}),bracketMatchingUnique=[bracketMatchingState,baseTheme$1];function bracketMatching(r={}){return[bracketMatchingConfig.of(r),bracketMatchingUnique]}bracketMatchingHandle=new NodeProp;function matchingNodes(r,e,n){let o=r.prop(e<0?NodeProp.openedBy:NodeProp.closedBy);if(o)return o;if(r.name.length==1){let s=n.indexOf(r.name);if(s>-1&&s%2==(e<0?1:0))return[n[s+e]]}return null}function findHandle(r){let e=r.type.prop(bracketMatchingHandle);return e?e(r.node):r}function matchBrackets(r,e,n,o={}){let s=o.maxScanDistance||DefaultScanDist,a=o.brackets||DefaultBrackets,l=syntaxTree(r),c=l.resolveInner(e,n);for(let d=c;d;d=d.parent){let u=matchingNodes(d.type,n,a);if(u&&d.from<d.to){let m=findHandle(d);if(m&&(n>0?e>=m.from&&e<m.to:e>m.from&&e<=m.to))return matchMarkedBrackets(r,e,n,d,m,u,a)}}return matchPlainBrackets(r,e,n,l,c.type,s,a)}function matchMarkedBrackets(r,e,n,o,s,a,l){let c=o.parent,d={from:s.from,to:s.to},u=0,m=c==null?void 0:c.cursor();if(m&&(n<0?m.childBefore(o.from):m.childAfter(o.to)))do if(n<0?m.to<=o.from:m.from>=o.to){if(u==0&&a.indexOf(m.type.name)>-1&&m.from<m.to){let f=findHandle(m);return{start:d,end:f?{from:f.from,to:f.to}:void 0,matched:!0}}else if(matchingNodes(m.type,n,l))u++;else if(matchingNodes(m.type,-n,l)){if(u==0){let f=findHandle(m);return{start:d,end:f&&f.from<f.to?{from:f.from,to:f.to}:void 0,matched:!1}}u--}}while(n<0?m.prevSibling():m.nextSibling());return{start:d,matched:!1}}function matchPlainBrackets(r,e,n,o,s,a,l){let c=n<0?r.sliceDoc(e-1,e):r.sliceDoc(e,e+1),d=l.indexOf(c);if(d<0||d%2==0!=n>0)return null;let u={from:n<0?e-1:e,to:n>0?e+1:e},m=r.doc.iterRange(e,n>0?r.doc.length:0),f=0;for(let p=0;!m.next().done&&p<=a;){let g=m.value;n<0&&(p+=g.length);let y=e+p*n;for(let b=n>0?0:g.length-1,k=n>0?g.length:-1;b!=k;b+=n){let w=l.indexOf(g[b]);if(!(w<0||o.resolveInner(y+b,1).type!=s))if(w%2==0==n>0)f++;else{if(f==1)return{start:u,end:{from:y+b,to:y+b+1},matched:w>>1==d>>1};f--}}n>0&&(p+=g.length)}return m.done?{start:u,matched:!1}:null}function countCol(r,e,n,o=0,s=0){e==null&&(e=r.search(/[^\s\u00a0]/),e==-1&&(e=r.length));let a=s;for(let l=o;l<e;l++)r.charCodeAt(l)==9?a+=n-a%n:a++;return a}class StringStream{constructor(e,n,o,s){this.string=e,this.tabSize=n,this.indentUnit=o,this.overrideIndent=s,this.pos=0,this.start=0,this.lastColumnPos=0,this.lastColumnValue=0}eol(){return this.pos>=this.string.length}sol(){return this.pos==0}peek(){return this.string.charAt(this.pos)||void 0}next(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)}eat(e){let n=this.string.charAt(this.pos),o;if(typeof e=="string"?o=n==e:o=n&&(e instanceof RegExp?e.test(n):e(n)),o)return++this.pos,n}eatWhile(e){let n=this.pos;for(;this.eat(e););return this.pos>n}eatSpace(){let e=this.pos;for(;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>e}skipToEnd(){this.pos=this.string.length}skipTo(e){let n=this.string.indexOf(e,this.pos);if(n>-1)return this.pos=n,!0}backUp(e){this.pos-=e}column(){return this.lastColumnPos<this.start&&(this.lastColumnValue=countCol(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue}indentation(){var e;return(e=this.overrideIndent)!==null&&e!==void 0?e:countCol(this.string,null,this.tabSize)}match(e,n,o){if(typeof e=="string"){let s=l=>o?l.toLowerCase():l,a=this.string.substr(this.pos,e.length);return s(a)==s(e)?(n!==!1&&(this.pos+=e.length),!0):null}else{let s=this.string.slice(this.pos).match(e);return s&&s.index>0?null:(s&&n!==!1&&(this.pos+=s[0].length),s)}}current(){return this.string.slice(this.start,this.pos)}}function fullParser(r){return{name:r.name||"",token:r.token,blankLine:r.blankLine||(()=>{}),startState:r.startState||(()=>!0),copyState:r.copyState||defaultCopyState,indent:r.indent||(()=>null),languageData:r.languageData||{},tokenTable:r.tokenTable||noTokens}}function defaultCopyState(r){if(typeof r!="object")return r;let e={};for(let n in r){let o=r[n];e[n]=o instanceof Array?o.slice():o}return e}const IndentedFrom=new WeakMap;class StreamLanguage extends Language{constructor(e){let n=defineLanguageFacet(e.languageData),o=fullParser(e),s,a=new class extends Parser$1{createParse(l,c,d){return new Parse(s,l,c,d)}};super(n,a,[],e.name),this.topNode=docID(n,this),s=this,this.streamParser=o,this.stateAfter=new NodeProp({perNode:!0}),this.tokenTable=e.tokenTable?new TokenTable(o.tokenTable):defaultTokenTable}static define(e){return new StreamLanguage(e)}getIndent(e){let n,{overrideIndentation:o}=e.options;o&&(n=IndentedFrom.get(e.state),n!=null&&n<e.pos-1e4&&(n=void 0));let s=findState(this,e.node.tree,e.node.from,e.node.from,n??e.pos),a,l;if(s?(l=s.state,a=s.pos+1):(l=this.streamParser.startState(e.unit),a=e.node.from),e.pos-a>1e4)return null;for(;a<e.pos;){let d=e.state.doc.lineAt(a),u=Math.min(e.pos,d.to);if(d.length){let m=o?o(d.from):-1,f=new StringStream(d.text,e.state.tabSize,e.unit,m<0?void 0:m);for(;f.pos<u-d.from;)readToken(this.streamParser.token,f,l)}else this.streamParser.blankLine(l,e.unit);if(u==e.pos)break;a=d.to+1}let c=e.lineAt(e.pos);return o&&n==null&&IndentedFrom.set(e.state,c.from),this.streamParser.indent(l,/^\s*(.*)/.exec(c.text)[1],e)}get allowsNesting(){return!1}}function findState(r,e,n,o,s){let a=n>=o&&n+e.length<=s&&e.prop(r.stateAfter);if(a)return{state:r.streamParser.copyState(a),pos:n+e.length};for(let l=e.children.length-1;l>=0;l--){let c=e.children[l],d=n+e.positions[l],u=c instanceof Tree&&d<s&&findState(r,c,d,o,s);if(u)return u}return null}function cutTree(r,e,n,o,s){if(s&&n<=0&&o>=e.length)return e;!s&&n==0&&e.type==r.topNode&&(s=!0);for(let a=e.children.length-1;a>=0;a--){let l=e.positions[a],c=e.children[a],d;if(l<o&&c instanceof Tree){if(!(d=cutTree(r,c,n-l,o-l,s)))break;return s?new Tree(e.type,e.children.slice(0,a).concat(d),e.positions.slice(0,a+1),l+d.length):d}}return null}function findStartInFragments(r,e,n,o,s){for(let a of e){let l=a.from+(a.openStart?25:0),c=a.to-(a.openEnd?25:0),d=l<=n&&c>n&&findState(r,a.tree,0-a.offset,n,c),u;if(d&&d.pos<=o&&(u=cutTree(r,a.tree,n+a.offset,d.pos+a.offset,!1)))return{state:d.state,tree:u}}return{state:r.streamParser.startState(s?getIndentUnit(s):4),tree:Tree.empty}}class Parse{constructor(e,n,o,s){this.lang=e,this.input=n,this.fragments=o,this.ranges=s,this.stoppedAt=null,this.chunks=[],this.chunkPos=[],this.chunk=[],this.chunkReused=void 0,this.rangeIndex=0,this.to=s[s.length-1].to;let a=ParseContext.get(),l=s[0].from,{state:c,tree:d}=findStartInFragments(e,o,l,this.to,a==null?void 0:a.state);this.state=c,this.parsedPos=this.chunkStart=l+d.length;for(let u=0;u<d.children.length;u++)this.chunks.push(d.children[u]),this.chunkPos.push(d.positions[u]);a&&this.parsedPos<a.viewport.from-1e5&&s.some(u=>u.from<=a.viewport.from&&u.to>=a.viewport.from)&&(this.state=this.lang.streamParser.startState(getIndentUnit(a.state)),a.skipUntilInView(this.parsedPos,a.viewport.from),this.parsedPos=a.viewport.from),this.moveRangeIndex()}advance(){let e=ParseContext.get(),n=this.stoppedAt==null?this.to:Math.min(this.to,this.stoppedAt),o=Math.min(n,this.chunkStart+2048);for(e&&(o=Math.min(o,e.viewport.to));this.parsedPos<o;)this.parseLine(e);return this.chunkStart<this.parsedPos&&this.finishChunk(),this.parsedPos>=n?this.finish():e&&this.parsedPos>=e.viewport.to?(e.skipUntilInView(this.parsedPos,n),this.finish()):null}stopAt(e){this.stoppedAt=e}lineAfter(e){let n=this.input.chunk(e);if(this.input.lineChunks)n==`
`&&(n="");else{let o=n.indexOf(`
`);o>-1&&(n=n.slice(0,o))}return e+n.length<=this.to?n:n.slice(0,this.to-e)}nextLine(){let e=this.parsedPos,n=this.lineAfter(e),o=e+n.length;for(let s=this.rangeIndex;;){let a=this.ranges[s].to;if(a>=o||(n=n.slice(0,a-(o-n.length)),s++,s==this.ranges.length))break;let l=this.ranges[s].from,c=this.lineAfter(l);n+=c,o=l+c.length}return{line:n,end:o}}skipGapsTo(e,n,o){for(;;){let s=this.ranges[this.rangeIndex].to,a=e+n;if(o>0?s>a:s>=a)break;let l=this.ranges[++this.rangeIndex].from;n+=l-s}return n}moveRangeIndex(){for(;this.ranges[this.rangeIndex].to<this.parsedPos;)this.rangeIndex++}emitToken(e,n,o,s){let a=4;if(this.ranges.length>1){s=this.skipGapsTo(n,s,1),n+=s;let c=this.chunk.length;s=this.skipGapsTo(o,s,-1),o+=s,a+=this.chunk.length-c}let l=this.chunk.length-4;return a==4&&l>=0&&this.chunk[l]==e&&this.chunk[l+2]==n?this.chunk[l+2]=o:this.chunk.push(e,n,o,a),s}parseLine(e){let{line:n,end:o}=this.nextLine(),s=0,{streamParser:a}=this.lang,l=new StringStream(n,e?e.state.tabSize:4,e?getIndentUnit(e.state):2);if(l.eol())a.blankLine(this.state,l.indentUnit);else for(;!l.eol();){let c=readToken(a.token,l,this.state);if(c&&(s=this.emitToken(this.lang.tokenTable.resolve(c),this.parsedPos+l.start,this.parsedPos+l.pos,s)),l.start>1e4)break}this.parsedPos=o,this.moveRangeIndex(),this.parsedPos<this.to&&this.parsedPos++}finishChunk(){let e=Tree.build({buffer:this.chunk,start:this.chunkStart,length:this.parsedPos-this.chunkStart,nodeSet,topID:0,maxBufferLength:2048,reused:this.chunkReused});e=new Tree(e.type,e.children,e.positions,e.length,[[this.lang.stateAfter,this.lang.streamParser.copyState(this.state)]]),this.chunks.push(e),this.chunkPos.push(this.chunkStart-this.ranges[0].from),this.chunk=[],this.chunkReused=void 0,this.chunkStart=this.parsedPos}finish(){return new Tree(this.lang.topNode,this.chunks,this.chunkPos,this.parsedPos-this.ranges[0].from).balance()}}function readToken(r,e,n){e.start=e.pos;for(let o=0;o<10;o++){let s=r(e,n);if(e.pos>e.start)return s}throw new Error("Stream parser failed to advance stream.")}const noTokens=Object.create(null),typeArray=[NodeType.none],nodeSet=new NodeSet(typeArray),warned=[],byTag=Object.create(null),defaultTable=Object.create(null);for(let[r,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])defaultTable[r]=createTokenType(noTokens,e);class TokenTable{constructor(e){this.extra=e,this.table=Object.assign(Object.create(null),defaultTable)}resolve(e){return e?this.table[e]||(this.table[e]=createTokenType(this.extra,e)):0}}const defaultTokenTable=new TokenTable(noTokens);function warnForPart(r,e){warned.indexOf(r)>-1||(warned.push(r),console.warn(e))}function createTokenType(r,e){let n=[];for(let c of e.split(" ")){let d=[];for(let u of c.split(".")){let m=r[u]||tags[u];m?typeof m=="function"?d.length?d=d.map(m):warnForPart(u,`Modifier ${u} used at start of tag`):d.length?warnForPart(u,`Tag ${u} used as modifier`):d=Array.isArray(m)?m:[m]:warnForPart(u,`Unknown highlighting tag ${u}`)}for(let u of d)n.push(u)}if(!n.length)return 0;let o=e.replace(/ /g,"_"),s=o+" "+n.map(c=>c.id),a=byTag[s];if(a)return a.id;let l=byTag[s]=NodeType.define({id:typeArray.length,name:o,props:[styleTags({[o]:n})]});return typeArray.push(l),l.id}function docID(r,e){let n=NodeType.define({id:typeArray.length,name:"Document",props:[languageDataProp.add(()=>r),indentNodeProp.add(()=>o=>e.getIndent(o))],top:!0});return typeArray.push(n),n}Direction.RTL,Direction.LTR;const toggleComment=r=>{let{state:e}=r,n=e.doc.lineAt(e.selection.main.from),o=getConfig(r.state,n.from);return o.line?toggleLineComment(r):o.block?toggleBlockCommentByLine(r):!1};function command(r,e){return({state:n,dispatch:o})=>{if(n.readOnly)return!1;let s=r(e,n);return s?(o(n.update(s)),!0):!1}}const toggleLineComment=command(changeLineComment,0),toggleBlockComment=command(changeBlockComment,0),toggleBlockCommentByLine=command((r,e)=>changeBlockComment(r,e,selectedLineRanges(e)),0);function getConfig(r,e){let n=r.languageDataAt("commentTokens",e);return n.length?n[0]:{}}const SearchMargin=50;function findBlockComment(r,{open:e,close:n},o,s){let a=r.sliceDoc(o-SearchMargin,o),l=r.sliceDoc(s,s+SearchMargin),c=/\s*$/.exec(a)[0].length,d=/^\s*/.exec(l)[0].length,u=a.length-c;if(a.slice(u-e.length,u)==e&&l.slice(d,d+n.length)==n)return{open:{pos:o-c,margin:c&&1},close:{pos:s+d,margin:d&&1}};let m,f;s-o<=2*SearchMargin?m=f=r.sliceDoc(o,s):(m=r.sliceDoc(o,o+SearchMargin),f=r.sliceDoc(s-SearchMargin,s));let p=/^\s*/.exec(m)[0].length,g=/\s*$/.exec(f)[0].length,y=f.length-g-n.length;return m.slice(p,p+e.length)==e&&f.slice(y,y+n.length)==n?{open:{pos:o+p+e.length,margin:/\s/.test(m.charAt(p+e.length))?1:0},close:{pos:s-g-n.length,margin:/\s/.test(f.charAt(y-1))?1:0}}:null}function selectedLineRanges(r){let e=[];for(let n of r.selection.ranges){let o=r.doc.lineAt(n.from),s=n.to<=o.to?o:r.doc.lineAt(n.to);s.from>o.from&&s.from==n.to&&(s=n.to==o.to+1?o:r.doc.lineAt(n.to-1));let a=e.length-1;a>=0&&e[a].to>o.from?e[a].to=s.to:e.push({from:o.from+/^\s*/.exec(o.text)[0].length,to:s.to})}return e}function changeBlockComment(r,e,n=e.selection.ranges){let o=n.map(a=>getConfig(e,a.from).block);if(!o.every(a=>a))return null;let s=n.map((a,l)=>findBlockComment(e,o[l],a.from,a.to));if(r!=2&&!s.every(a=>a))return{changes:e.changes(n.map((a,l)=>s[l]?[]:[{from:a.from,insert:o[l].open+" "},{from:a.to,insert:" "+o[l].close}]))};if(r!=1&&s.some(a=>a)){let a=[];for(let l=0,c;l<s.length;l++)if(c=s[l]){let d=o[l],{open:u,close:m}=c;a.push({from:u.pos-d.open.length,to:u.pos+u.margin},{from:m.pos-m.margin,to:m.pos+d.close.length})}return{changes:a}}return null}function changeLineComment(r,e,n=e.selection.ranges){let o=[],s=-1;for(let{from:a,to:l}of n){let c=o.length,d=1e9,u=getConfig(e,a).line;if(u){for(let m=a;m<=l;){let f=e.doc.lineAt(m);if(f.from>s&&(a==l||l>f.from)){s=f.from;let p=/^\s*/.exec(f.text)[0].length,g=p==f.length,y=f.text.slice(p,p+u.length)==u?p:-1;p<f.text.length&&p<d&&(d=p),o.push({line:f,comment:y,token:u,indent:p,empty:g,single:!1})}m=f.to+1}if(d<1e9)for(let m=c;m<o.length;m++)o[m].indent<o[m].line.text.length&&(o[m].indent=d);o.length==c+1&&(o[c].single=!0)}}if(r!=2&&o.some(a=>a.comment<0&&(!a.empty||a.single))){let a=[];for(let{line:c,token:d,indent:u,empty:m,single:f}of o)(f||!m)&&a.push({from:c.from+u,insert:d+" "});let l=e.changes(a);return{changes:l,selection:e.selection.map(l,1)}}else if(r!=1&&o.some(a=>a.comment>=0)){let a=[];for(let{line:l,comment:c,token:d}of o)if(c>=0){let u=l.from+c,m=u+d.length;l.text[m-l.from]==" "&&m++,a.push({from:u,to:m})}return{changes:a}}return null}const fromHistory=Annotation.define(),isolateHistory=Annotation.define(),invertedEffects=Facet.define(),historyConfig=Facet.define({combine(r){return combineConfig(r,{minDepth:100,newGroupDelay:500,joinToEvent:(e,n)=>n},{minDepth:Math.max,newGroupDelay:Math.min,joinToEvent:(e,n)=>(o,s)=>e(o,s)||n(o,s)})}}),historyField_=StateField.define({create(){return HistoryState.empty},update(r,e){let n=e.state.facet(historyConfig),o=e.annotation(fromHistory);if(o){let d=HistEvent.fromTransaction(e,o.selection),u=o.side,m=u==0?r.undone:r.done;return d?m=updateBranch(m,m.length,n.minDepth,d):m=addSelection(m,e.startState.selection),new HistoryState(u==0?o.rest:m,u==0?m:o.rest)}let s=e.annotation(isolateHistory);if((s=="full"||s=="before")&&(r=r.isolate()),e.annotation(Transaction.addToHistory)===!1)return e.changes.empty?r:r.addMapping(e.changes.desc);let a=HistEvent.fromTransaction(e),l=e.annotation(Transaction.time),c=e.annotation(Transaction.userEvent);return a?r=r.addChanges(a,l,c,n,e):e.selection&&(r=r.addSelection(e.startState.selection,l,c,n.newGroupDelay)),(s=="full"||s=="after")&&(r=r.isolate()),r},toJSON(r){return{done:r.done.map(e=>e.toJSON()),undone:r.undone.map(e=>e.toJSON())}},fromJSON(r){return new HistoryState(r.done.map(HistEvent.fromJSON),r.undone.map(HistEvent.fromJSON))}});function history(r={}){return[historyField_,historyConfig.of(r),EditorView.domEventHandlers({beforeinput(e,n){let o=e.inputType=="historyUndo"?undo:e.inputType=="historyRedo"?redo:null;return o?(e.preventDefault(),o(n)):!1}})]}function cmd(r,e){return function({state:n,dispatch:o}){if(!e&&n.readOnly)return!1;let s=n.field(historyField_,!1);if(!s)return!1;let a=s.pop(r,n,e);return a?(o(a),!0):!1}}const undo=cmd(0,!1),redo=cmd(1,!1),undoSelection=cmd(0,!0),redoSelection=cmd(1,!0);class HistEvent{constructor(e,n,o,s,a){this.changes=e,this.effects=n,this.mapped=o,this.startSelection=s,this.selectionsAfter=a}setSelAfter(e){return new HistEvent(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,n,o;return{changes:(e=this.changes)===null||e===void 0?void 0:e.toJSON(),mapped:(n=this.mapped)===null||n===void 0?void 0:n.toJSON(),startSelection:(o=this.startSelection)===null||o===void 0?void 0:o.toJSON(),selectionsAfter:this.selectionsAfter.map(s=>s.toJSON())}}static fromJSON(e){return new HistEvent(e.changes&&ChangeSet.fromJSON(e.changes),[],e.mapped&&ChangeDesc.fromJSON(e.mapped),e.startSelection&&EditorSelection.fromJSON(e.startSelection),e.selectionsAfter.map(EditorSelection.fromJSON))}static fromTransaction(e,n){let o=none;for(let s of e.startState.facet(invertedEffects)){let a=s(e);a.length&&(o=o.concat(a))}return!o.length&&e.changes.empty?null:new HistEvent(e.changes.invert(e.startState.doc),o,void 0,n||e.startState.selection,none)}static selection(e){return new HistEvent(void 0,none,void 0,void 0,e)}}function updateBranch(r,e,n,o){let s=e+1>n+20?e-n-1:0,a=r.slice(s,e);return a.push(o),a}function isAdjacent(r,e){let n=[],o=!1;return r.iterChangedRanges((s,a)=>n.push(s,a)),e.iterChangedRanges((s,a,l,c)=>{for(let d=0;d<n.length;){let u=n[d++],m=n[d++];c>=u&&l<=m&&(o=!0)}}),o}function eqSelectionShape(r,e){return r.ranges.length==e.ranges.length&&r.ranges.filter((n,o)=>n.empty!=e.ranges[o].empty).length===0}function conc(r,e){return r.length?e.length?r.concat(e):r:e}const none=[],MaxSelectionsPerEvent=200;function addSelection(r,e){if(r.length){let n=r[r.length-1],o=n.selectionsAfter.slice(Math.max(0,n.selectionsAfter.length-MaxSelectionsPerEvent));return o.length&&o[o.length-1].eq(e)?r:(o.push(e),updateBranch(r,r.length-1,1e9,n.setSelAfter(o)))}else return[HistEvent.selection([e])]}function popSelection(r){let e=r[r.length-1],n=r.slice();return n[r.length-1]=e.setSelAfter(e.selectionsAfter.slice(0,e.selectionsAfter.length-1)),n}function addMappingToBranch(r,e){if(!r.length)return r;let n=r.length,o=none;for(;n;){let s=mapEvent(r[n-1],e,o);if(s.changes&&!s.changes.empty||s.effects.length){let a=r.slice(0,n);return a[n-1]=s,a}else e=s.mapped,n--,o=s.selectionsAfter}return o.length?[HistEvent.selection(o)]:none}function mapEvent(r,e,n){let o=conc(r.selectionsAfter.length?r.selectionsAfter.map(c=>c.map(e)):none,n);if(!r.changes)return HistEvent.selection(o);let s=r.changes.map(e),a=e.mapDesc(r.changes,!0),l=r.mapped?r.mapped.composeDesc(a):a;return new HistEvent(s,StateEffect.mapEffects(r.effects,e),l,r.startSelection.map(a),o)}const joinableUserEvent=/^(input\.type|delete)($|\.)/;class HistoryState{constructor(e,n,o=0,s=void 0){this.done=e,this.undone=n,this.prevTime=o,this.prevUserEvent=s}isolate(){return this.prevTime?new HistoryState(this.done,this.undone):this}addChanges(e,n,o,s,a){let l=this.done,c=l[l.length-1];return c&&c.changes&&!c.changes.empty&&e.changes&&(!o||joinableUserEvent.test(o))&&(!c.selectionsAfter.length&&n-this.prevTime<s.newGroupDelay&&s.joinToEvent(a,isAdjacent(c.changes,e.changes))||o=="input.type.compose")?l=updateBranch(l,l.length-1,s.minDepth,new HistEvent(e.changes.compose(c.changes),conc(StateEffect.mapEffects(e.effects,c.changes),c.effects),c.mapped,c.startSelection,none)):l=updateBranch(l,l.length,s.minDepth,e),new HistoryState(l,none,n,o)}addSelection(e,n,o,s){let a=this.done.length?this.done[this.done.length-1].selectionsAfter:none;return a.length>0&&n-this.prevTime<s&&o==this.prevUserEvent&&o&&/^select($|\.)/.test(o)&&eqSelectionShape(a[a.length-1],e)?this:new HistoryState(addSelection(this.done,e),this.undone,n,o)}addMapping(e){return new HistoryState(addMappingToBranch(this.done,e),addMappingToBranch(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,n,o){let s=e==0?this.done:this.undone;if(s.length==0)return null;let a=s[s.length-1],l=a.selectionsAfter[0]||n.selection;if(o&&a.selectionsAfter.length)return n.update({selection:a.selectionsAfter[a.selectionsAfter.length-1],annotations:fromHistory.of({side:e,rest:popSelection(s),selection:l}),userEvent:e==0?"select.undo":"select.redo",scrollIntoView:!0});if(a.changes){let c=s.length==1?none:s.slice(0,s.length-1);return a.mapped&&(c=addMappingToBranch(c,a.mapped)),n.update({changes:a.changes,selection:a.startSelection,effects:a.effects,annotations:fromHistory.of({side:e,rest:c,selection:l}),filter:!1,userEvent:e==0?"undo":"redo",scrollIntoView:!0})}else return null}}HistoryState.empty=new HistoryState(none,none);const historyKeymap=[{key:"Mod-z",run:undo,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:redo,preventDefault:!0},{linux:"Ctrl-Shift-z",run:redo,preventDefault:!0},{key:"Mod-u",run:undoSelection,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:redoSelection,preventDefault:!0}];function updateSel(r,e){return EditorSelection.create(r.ranges.map(e),r.mainIndex)}function setSel(r,e){return r.update({selection:e,scrollIntoView:!0,userEvent:"select"})}function moveSel({state:r,dispatch:e},n){let o=updateSel(r.selection,n);return o.eq(r.selection,!0)?!1:(e(setSel(r,o)),!0)}function rangeEnd(r,e){return EditorSelection.cursor(e?r.to:r.from)}function cursorByChar(r,e){return moveSel(r,n=>n.empty?r.moveByChar(n,e):rangeEnd(n,e))}function ltrAtCursor(r){return r.textDirectionAt(r.state.selection.main.head)==Direction.LTR}const cursorCharLeft=r=>cursorByChar(r,!ltrAtCursor(r)),cursorCharRight=r=>cursorByChar(r,ltrAtCursor(r));function cursorByGroup(r,e){return moveSel(r,n=>n.empty?r.moveByGroup(n,e):rangeEnd(n,e))}const cursorGroupLeft=r=>cursorByGroup(r,!ltrAtCursor(r)),cursorGroupRight=r=>cursorByGroup(r,ltrAtCursor(r));function interestingNode(r,e,n){if(e.type.prop(n))return!0;let o=e.to-e.from;return o&&(o>2||/[^\s,.;:]/.test(r.sliceDoc(e.from,e.to)))||e.firstChild}function moveBySyntax(r,e,n){let o=syntaxTree(r).resolveInner(e.head),s=n?NodeProp.closedBy:NodeProp.openedBy;for(let d=e.head;;){let u=n?o.childAfter(d):o.childBefore(d);if(!u)break;interestingNode(r,u,s)?o=u:d=n?u.to:u.from}let a=o.type.prop(s),l,c;return a&&(l=n?matchBrackets(r,o.from,1):matchBrackets(r,o.to,-1))&&l.matched?c=n?l.end.to:l.end.from:c=n?o.to:o.from,EditorSelection.cursor(c,n?-1:1)}const cursorSyntaxLeft=r=>moveSel(r,e=>moveBySyntax(r.state,e,!ltrAtCursor(r))),cursorSyntaxRight=r=>moveSel(r,e=>moveBySyntax(r.state,e,ltrAtCursor(r)));function cursorByLine(r,e){return moveSel(r,n=>{if(!n.empty)return rangeEnd(n,e);let o=r.moveVertically(n,e);return o.head!=n.head?o:r.moveToLineBoundary(n,e)})}const cursorLineUp=r=>cursorByLine(r,!1),cursorLineDown=r=>cursorByLine(r,!0);function pageInfo(r){let e=r.scrollDOM.clientHeight<r.scrollDOM.scrollHeight-2,n=0,o=0,s;if(e){for(let a of r.state.facet(EditorView.scrollMargins)){let l=a(r);l!=null&&l.top&&(n=Math.max(l==null?void 0:l.top,n)),l!=null&&l.bottom&&(o=Math.max(l==null?void 0:l.bottom,o))}s=r.scrollDOM.clientHeight-n-o}else s=(r.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:n,marginBottom:o,selfScroll:e,height:Math.max(r.defaultLineHeight,s-5)}}function cursorByPage(r,e){let n=pageInfo(r),{state:o}=r,s=updateSel(o.selection,l=>l.empty?r.moveVertically(l,e,n.height):rangeEnd(l,e));if(s.eq(o.selection))return!1;let a;if(n.selfScroll){let l=r.coordsAtPos(o.selection.main.head),c=r.scrollDOM.getBoundingClientRect(),d=c.top+n.marginTop,u=c.bottom-n.marginBottom;l&&l.top>d&&l.bottom<u&&(a=EditorView.scrollIntoView(s.main.head,{y:"start",yMargin:l.top-d}))}return r.dispatch(setSel(o,s),{effects:a}),!0}const cursorPageUp=r=>cursorByPage(r,!1),cursorPageDown=r=>cursorByPage(r,!0);function moveByLineBoundary(r,e,n){let o=r.lineBlockAt(e.head),s=r.moveToLineBoundary(e,n);if(s.head==e.head&&s.head!=(n?o.to:o.from)&&(s=r.moveToLineBoundary(e,n,!1)),!n&&s.head==o.from&&o.length){let a=/^\s*/.exec(r.state.sliceDoc(o.from,Math.min(o.from+100,o.to)))[0].length;a&&e.head!=o.from+a&&(s=EditorSelection.cursor(o.from+a))}return s}const cursorLineBoundaryForward=r=>moveSel(r,e=>moveByLineBoundary(r,e,!0)),cursorLineBoundaryBackward=r=>moveSel(r,e=>moveByLineBoundary(r,e,!1)),cursorLineBoundaryLeft=r=>moveSel(r,e=>moveByLineBoundary(r,e,!ltrAtCursor(r))),cursorLineBoundaryRight=r=>moveSel(r,e=>moveByLineBoundary(r,e,ltrAtCursor(r))),cursorLineStart=r=>moveSel(r,e=>EditorSelection.cursor(r.lineBlockAt(e.head).from,1)),cursorLineEnd=r=>moveSel(r,e=>EditorSelection.cursor(r.lineBlockAt(e.head).to,-1));function toMatchingBracket(r,e,n){let o=!1,s=updateSel(r.selection,a=>{let l=matchBrackets(r,a.head,-1)||matchBrackets(r,a.head,1)||a.head>0&&matchBrackets(r,a.head-1,1)||a.head<r.doc.length&&matchBrackets(r,a.head+1,-1);if(!l||!l.end)return a;o=!0;let c=l.start.from==a.head?l.end.to:l.end.from;return EditorSelection.cursor(c)});return o?(e(setSel(r,s)),!0):!1}const cursorMatchingBracket=({state:r,dispatch:e})=>toMatchingBracket(r,e);function extendSel(r,e){let n=updateSel(r.state.selection,o=>{let s=e(o);return EditorSelection.range(o.anchor,s.head,s.goalColumn,s.bidiLevel||void 0)});return n.eq(r.state.selection)?!1:(r.dispatch(setSel(r.state,n)),!0)}function selectByChar(r,e){return extendSel(r,n=>r.moveByChar(n,e))}const selectCharLeft=r=>selectByChar(r,!ltrAtCursor(r)),selectCharRight=r=>selectByChar(r,ltrAtCursor(r));function selectByGroup(r,e){return extendSel(r,n=>r.moveByGroup(n,e))}const selectGroupLeft=r=>selectByGroup(r,!ltrAtCursor(r)),selectGroupRight=r=>selectByGroup(r,ltrAtCursor(r)),selectSyntaxLeft=r=>extendSel(r,e=>moveBySyntax(r.state,e,!ltrAtCursor(r))),selectSyntaxRight=r=>extendSel(r,e=>moveBySyntax(r.state,e,ltrAtCursor(r)));function selectByLine(r,e){return extendSel(r,n=>r.moveVertically(n,e))}const selectLineUp=r=>selectByLine(r,!1),selectLineDown=r=>selectByLine(r,!0);function selectByPage(r,e){return extendSel(r,n=>r.moveVertically(n,e,pageInfo(r).height))}const selectPageUp=r=>selectByPage(r,!1),selectPageDown=r=>selectByPage(r,!0),selectLineBoundaryForward=r=>extendSel(r,e=>moveByLineBoundary(r,e,!0)),selectLineBoundaryBackward=r=>extendSel(r,e=>moveByLineBoundary(r,e,!1)),selectLineBoundaryLeft=r=>extendSel(r,e=>moveByLineBoundary(r,e,!ltrAtCursor(r))),selectLineBoundaryRight=r=>extendSel(r,e=>moveByLineBoundary(r,e,ltrAtCursor(r))),selectLineStart=r=>extendSel(r,e=>EditorSelection.cursor(r.lineBlockAt(e.head).from)),selectLineEnd=r=>extendSel(r,e=>EditorSelection.cursor(r.lineBlockAt(e.head).to)),cursorDocStart=({state:r,dispatch:e})=>(e(setSel(r,{anchor:0})),!0),cursorDocEnd=({state:r,dispatch:e})=>(e(setSel(r,{anchor:r.doc.length})),!0),selectDocStart=({state:r,dispatch:e})=>(e(setSel(r,{anchor:r.selection.main.anchor,head:0})),!0),selectDocEnd=({state:r,dispatch:e})=>(e(setSel(r,{anchor:r.selection.main.anchor,head:r.doc.length})),!0),selectAll=({state:r,dispatch:e})=>(e(r.update({selection:{anchor:0,head:r.doc.length},userEvent:"select"})),!0),selectLine=({state:r,dispatch:e})=>{let n=selectedLineBlocks(r).map(({from:o,to:s})=>EditorSelection.range(o,Math.min(s+1,r.doc.length)));return e(r.update({selection:EditorSelection.create(n),userEvent:"select"})),!0},selectParentSyntax=({state:r,dispatch:e})=>{let n=updateSel(r.selection,o=>{let s=syntaxTree(r),a=s.resolveStack(o.from,1);if(o.empty){let l=s.resolveStack(o.from,-1);l.node.from>=a.node.from&&l.node.to<=a.node.to&&(a=l)}for(let l=a;l;l=l.next){let{node:c}=l;if((c.from<o.from&&c.to>=o.to||c.to>o.to&&c.from<=o.from)&&l.next)return EditorSelection.range(c.to,c.from)}return o});return n.eq(r.selection)?!1:(e(setSel(r,n)),!0)},simplifySelection=({state:r,dispatch:e})=>{let n=r.selection,o=null;return n.ranges.length>1?o=EditorSelection.create([n.main]):n.main.empty||(o=EditorSelection.create([EditorSelection.cursor(n.main.head)])),o?(e(setSel(r,o)),!0):!1};function deleteBy(r,e){if(r.state.readOnly)return!1;let n="delete.selection",{state:o}=r,s=o.changeByRange(a=>{let{from:l,to:c}=a;if(l==c){let d=e(a);d<l?(n="delete.backward",d=skipAtomic(r,d,!1)):d>l&&(n="delete.forward",d=skipAtomic(r,d,!0)),l=Math.min(l,d),c=Math.max(c,d)}else l=skipAtomic(r,l,!1),c=skipAtomic(r,c,!0);return l==c?{range:a}:{changes:{from:l,to:c},range:EditorSelection.cursor(l,l<a.head?-1:1)}});return s.changes.empty?!1:(r.dispatch(o.update(s,{scrollIntoView:!0,userEvent:n,effects:n=="delete.selection"?EditorView.announce.of(o.phrase("Selection deleted")):void 0})),!0)}function skipAtomic(r,e,n){if(r instanceof EditorView)for(let o of r.state.facet(EditorView.atomicRanges).map(s=>s(r)))o.between(e,e,(s,a)=>{s<e&&a>e&&(e=n?a:s)});return e}const deleteByChar=(r,e,n)=>deleteBy(r,o=>{let s=o.from,{state:a}=r,l=a.doc.lineAt(s),c,d;if(n&&!e&&s>l.from&&s<l.from+200&&!/[^ \t]/.test(c=l.text.slice(0,s-l.from))){if(c[c.length-1]=="	")return s-1;let u=countColumn(c,a.tabSize),m=u%getIndentUnit(a)||getIndentUnit(a);for(let f=0;f<m&&c[c.length-1-f]==" ";f++)s--;d=s}else d=findClusterBreak(l.text,s-l.from,e,e)+l.from,d==s&&l.number!=(e?a.doc.lines:1)?d+=e?1:-1:!e&&/[\ufe00-\ufe0f]/.test(l.text.slice(d-l.from,s-l.from))&&(d=findClusterBreak(l.text,d-l.from,!1,!1)+l.from);return d}),deleteCharBackward=r=>deleteByChar(r,!1,!0),deleteCharForward=r=>deleteByChar(r,!0,!1),deleteByGroup=(r,e)=>deleteBy(r,n=>{let o=n.head,{state:s}=r,a=s.doc.lineAt(o),l=s.charCategorizer(o);for(let c=null;;){if(o==(e?a.to:a.from)){o==n.head&&a.number!=(e?s.doc.lines:1)&&(o+=e?1:-1);break}let d=findClusterBreak(a.text,o-a.from,e)+a.from,u=a.text.slice(Math.min(o,d)-a.from,Math.max(o,d)-a.from),m=l(u);if(c!=null&&m!=c)break;(u!=" "||o!=n.head)&&(c=m),o=d}return o}),deleteGroupBackward=r=>deleteByGroup(r,!1),deleteGroupForward=r=>deleteByGroup(r,!0),deleteToLineEnd=r=>deleteBy(r,e=>{let n=r.lineBlockAt(e.head).to;return e.head<n?n:Math.min(r.state.doc.length,e.head+1)}),deleteLineBoundaryBackward=r=>deleteBy(r,e=>{let n=r.moveToLineBoundary(e,!1).head;return e.head>n?n:Math.max(0,e.head-1)}),deleteLineBoundaryForward=r=>deleteBy(r,e=>{let n=r.moveToLineBoundary(e,!0).head;return e.head<n?n:Math.min(r.state.doc.length,e.head+1)}),splitLine=({state:r,dispatch:e})=>{if(r.readOnly)return!1;let n=r.changeByRange(o=>({changes:{from:o.from,to:o.to,insert:Text.of(["",""])},range:EditorSelection.cursor(o.from)}));return e(r.update(n,{scrollIntoView:!0,userEvent:"input"})),!0},transposeChars=({state:r,dispatch:e})=>{if(r.readOnly)return!1;let n=r.changeByRange(o=>{if(!o.empty||o.from==0||o.from==r.doc.length)return{range:o};let s=o.from,a=r.doc.lineAt(s),l=s==a.from?s-1:findClusterBreak(a.text,s-a.from,!1)+a.from,c=s==a.to?s+1:findClusterBreak(a.text,s-a.from,!0)+a.from;return{changes:{from:l,to:c,insert:r.doc.slice(s,c).append(r.doc.slice(l,s))},range:EditorSelection.cursor(c)}});return n.changes.empty?!1:(e(r.update(n,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function selectedLineBlocks(r){let e=[],n=-1;for(let o of r.selection.ranges){let s=r.doc.lineAt(o.from),a=r.doc.lineAt(o.to);if(!o.empty&&o.to==a.from&&(a=r.doc.lineAt(o.to-1)),n>=s.number){let l=e[e.length-1];l.to=a.to,l.ranges.push(o)}else e.push({from:s.from,to:a.to,ranges:[o]});n=a.number+1}return e}function moveLine(r,e,n){if(r.readOnly)return!1;let o=[],s=[];for(let a of selectedLineBlocks(r)){if(n?a.to==r.doc.length:a.from==0)continue;let l=r.doc.lineAt(n?a.to+1:a.from-1),c=l.length+1;if(n){o.push({from:a.to,to:l.to},{from:a.from,insert:l.text+r.lineBreak});for(let d of a.ranges)s.push(EditorSelection.range(Math.min(r.doc.length,d.anchor+c),Math.min(r.doc.length,d.head+c)))}else{o.push({from:l.from,to:a.from},{from:a.to,insert:r.lineBreak+l.text});for(let d of a.ranges)s.push(EditorSelection.range(d.anchor-c,d.head-c))}}return o.length?(e(r.update({changes:o,scrollIntoView:!0,selection:EditorSelection.create(s,r.selection.mainIndex),userEvent:"move.line"})),!0):!1}const moveLineUp=({state:r,dispatch:e})=>moveLine(r,e,!1),moveLineDown=({state:r,dispatch:e})=>moveLine(r,e,!0);function copyLine(r,e,n){if(r.readOnly)return!1;let o=[];for(let s of selectedLineBlocks(r))n?o.push({from:s.from,insert:r.doc.slice(s.from,s.to)+r.lineBreak}):o.push({from:s.to,insert:r.lineBreak+r.doc.slice(s.from,s.to)});return e(r.update({changes:o,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const copyLineUp=({state:r,dispatch:e})=>copyLine(r,e,!1),copyLineDown=({state:r,dispatch:e})=>copyLine(r,e,!0),deleteLine=r=>{if(r.state.readOnly)return!1;let{state:e}=r,n=e.changes(selectedLineBlocks(e).map(({from:s,to:a})=>(s>0?s--:a<e.doc.length&&a++,{from:s,to:a}))),o=updateSel(e.selection,s=>{let a;if(r.lineWrapping){let l=r.lineBlockAt(s.head),c=r.coordsAtPos(s.head,s.assoc||1);c&&(a=l.bottom+r.documentTop-c.bottom+r.defaultLineHeight/2)}return r.moveVertically(s,!0,a)}).map(n);return r.dispatch({changes:n,selection:o,scrollIntoView:!0,userEvent:"delete.line"}),!0};function isBetweenBrackets(r,e){if(/\(\)|\[\]|\{\}/.test(r.sliceDoc(e-1,e+1)))return{from:e,to:e};let n=syntaxTree(r).resolveInner(e),o=n.childBefore(e),s=n.childAfter(e),a;return o&&s&&o.to<=e&&s.from>=e&&(a=o.type.prop(NodeProp.closedBy))&&a.indexOf(s.name)>-1&&r.doc.lineAt(o.to).from==r.doc.lineAt(s.from).from&&!/\S/.test(r.sliceDoc(o.to,s.from))?{from:o.to,to:s.from}:null}const insertNewlineAndIndent=newlineAndIndent(!1),insertBlankLine=newlineAndIndent(!0);function newlineAndIndent(r){return({state:e,dispatch:n})=>{if(e.readOnly)return!1;let o=e.changeByRange(s=>{let{from:a,to:l}=s,c=e.doc.lineAt(a),d=!r&&a==l&&isBetweenBrackets(e,a);r&&(a=l=(l<=c.to?c:e.doc.lineAt(l)).to);let u=new IndentContext(e,{simulateBreak:a,simulateDoubleBreak:!!d}),m=getIndentation(u,a);for(m==null&&(m=countColumn(/^\s*/.exec(e.doc.lineAt(a).text)[0],e.tabSize));l<c.to&&/\s/.test(c.text[l-c.from]);)l++;d?{from:a,to:l}=d:a>c.from&&a<c.from+100&&!/\S/.test(c.text.slice(0,a))&&(a=c.from);let f=["",indentString(e,m)];return d&&f.push(indentString(e,u.lineIndent(c.from,-1))),{changes:{from:a,to:l,insert:Text.of(f)},range:EditorSelection.cursor(a+1+f[1].length)}});return n(e.update(o,{scrollIntoView:!0,userEvent:"input"})),!0}}function changeBySelectedLine(r,e){let n=-1;return r.changeByRange(o=>{let s=[];for(let l=o.from;l<=o.to;){let c=r.doc.lineAt(l);c.number>n&&(o.empty||o.to>c.from)&&(e(c,s,o),n=c.number),l=c.to+1}let a=r.changes(s);return{changes:s,range:EditorSelection.range(a.mapPos(o.anchor,1),a.mapPos(o.head,1))}})}const indentSelection=({state:r,dispatch:e})=>{if(r.readOnly)return!1;let n=Object.create(null),o=new IndentContext(r,{overrideIndentation:a=>n[a]??-1}),s=changeBySelectedLine(r,(a,l,c)=>{let d=getIndentation(o,a.from);if(d==null)return;/\S/.test(a.text)||(d=0);let u=/^\s*/.exec(a.text)[0],m=indentString(r,d);(u!=m||c.from<a.from+u.length)&&(n[a.from]=d,l.push({from:a.from,to:a.from+u.length,insert:m}))});return s.changes.empty||e(r.update(s,{userEvent:"indent"})),!0},indentMore=({state:r,dispatch:e})=>r.readOnly?!1:(e(r.update(changeBySelectedLine(r,(n,o)=>{o.push({from:n.from,insert:r.facet(indentUnit)})}),{userEvent:"input.indent"})),!0),indentLess=({state:r,dispatch:e})=>r.readOnly?!1:(e(r.update(changeBySelectedLine(r,(n,o)=>{let s=/^\s*/.exec(n.text)[0];if(!s)return;let a=countColumn(s,r.tabSize),l=0,c=indentString(r,Math.max(0,a-getIndentUnit(r)));for(;l<s.length&&l<c.length&&s.charCodeAt(l)==c.charCodeAt(l);)l++;o.push({from:n.from+l,to:n.from+s.length,insert:c.slice(l)})}),{userEvent:"delete.dedent"})),!0),toggleTabFocusMode=r=>(r.setTabFocusMode(),!0),emacsStyleKeymap=[{key:"Ctrl-b",run:cursorCharLeft,shift:selectCharLeft,preventDefault:!0},{key:"Ctrl-f",run:cursorCharRight,shift:selectCharRight},{key:"Ctrl-p",run:cursorLineUp,shift:selectLineUp},{key:"Ctrl-n",run:cursorLineDown,shift:selectLineDown},{key:"Ctrl-a",run:cursorLineStart,shift:selectLineStart},{key:"Ctrl-e",run:cursorLineEnd,shift:selectLineEnd},{key:"Ctrl-d",run:deleteCharForward},{key:"Ctrl-h",run:deleteCharBackward},{key:"Ctrl-k",run:deleteToLineEnd},{key:"Ctrl-Alt-h",run:deleteGroupBackward},{key:"Ctrl-o",run:splitLine},{key:"Ctrl-t",run:transposeChars},{key:"Ctrl-v",run:cursorPageDown}],standardKeymap=[{key:"ArrowLeft",run:cursorCharLeft,shift:selectCharLeft,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:cursorGroupLeft,shift:selectGroupLeft,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:cursorLineBoundaryLeft,shift:selectLineBoundaryLeft,preventDefault:!0},{key:"ArrowRight",run:cursorCharRight,shift:selectCharRight,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:cursorGroupRight,shift:selectGroupRight,preventDefault:!0},{mac:"Cmd-ArrowRight",run:cursorLineBoundaryRight,shift:selectLineBoundaryRight,preventDefault:!0},{key:"ArrowUp",run:cursorLineUp,shift:selectLineUp,preventDefault:!0},{mac:"Cmd-ArrowUp",run:cursorDocStart,shift:selectDocStart},{mac:"Ctrl-ArrowUp",run:cursorPageUp,shift:selectPageUp},{key:"ArrowDown",run:cursorLineDown,shift:selectLineDown,preventDefault:!0},{mac:"Cmd-ArrowDown",run:cursorDocEnd,shift:selectDocEnd},{mac:"Ctrl-ArrowDown",run:cursorPageDown,shift:selectPageDown},{key:"PageUp",run:cursorPageUp,shift:selectPageUp},{key:"PageDown",run:cursorPageDown,shift:selectPageDown},{key:"Home",run:cursorLineBoundaryBackward,shift:selectLineBoundaryBackward,preventDefault:!0},{key:"Mod-Home",run:cursorDocStart,shift:selectDocStart},{key:"End",run:cursorLineBoundaryForward,shift:selectLineBoundaryForward,preventDefault:!0},{key:"Mod-End",run:cursorDocEnd,shift:selectDocEnd},{key:"Enter",run:insertNewlineAndIndent,shift:insertNewlineAndIndent},{key:"Mod-a",run:selectAll},{key:"Backspace",run:deleteCharBackward,shift:deleteCharBackward},{key:"Delete",run:deleteCharForward},{key:"Mod-Backspace",mac:"Alt-Backspace",run:deleteGroupBackward},{key:"Mod-Delete",mac:"Alt-Delete",run:deleteGroupForward},{mac:"Mod-Backspace",run:deleteLineBoundaryBackward},{mac:"Mod-Delete",run:deleteLineBoundaryForward}].concat(emacsStyleKeymap.map(r=>({mac:r.key,run:r.run,shift:r.shift}))),defaultKeymap=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:cursorSyntaxLeft,shift:selectSyntaxLeft},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:cursorSyntaxRight,shift:selectSyntaxRight},{key:"Alt-ArrowUp",run:moveLineUp},{key:"Shift-Alt-ArrowUp",run:copyLineUp},{key:"Alt-ArrowDown",run:moveLineDown},{key:"Shift-Alt-ArrowDown",run:copyLineDown},{key:"Escape",run:simplifySelection},{key:"Mod-Enter",run:insertBlankLine},{key:"Alt-l",mac:"Ctrl-l",run:selectLine},{key:"Mod-i",run:selectParentSyntax,preventDefault:!0},{key:"Mod-[",run:indentLess},{key:"Mod-]",run:indentMore},{key:"Mod-Alt-\\",run:indentSelection},{key:"Shift-Mod-k",run:deleteLine},{key:"Shift-Mod-\\",run:cursorMatchingBracket},{key:"Mod-/",run:toggleComment},{key:"Alt-A",run:toggleBlockComment},{key:"Ctrl-m",mac:"Shift-Alt-m",run:toggleTabFocusMode}].concat(standardKeymap),SettingsContext=createContext(()=>{const r=shallowRef({}),e=shallowRef({}),n=c=>{if(r.value[c.key]){console.warn(`Setting group with key ${c.key} already exists, ignored.`);return}r.value[c.key]=c},o=c=>{if(!r.value[c]){console.warn(`Setting group with key ${c} not found, ignored.`);return}delete r.value[c]},s=c=>{if(e.value[c.id]){console.warn(`Setting item with id ${c.id} already exists, ignored.`);return}if(!r.value[c.groupKey]){console.warn(`Setting group with key ${c.groupKey} not found, ignored.`);return}e.value[c.id]=c},a=c=>{if(!e.value[c]){console.warn(`Setting item with id ${c} not found, ignored.`);return}delete e.value[c]},l=c=>Object.values(e.value).filter(d=>d.groupKey===c);return{settingItems:readonly(e),settingGroups:readonly(r),registerSettingGroup:n,unregisterSettingGroup:o,registerSettingItem:s,unregisterSettingItem:a,getAllSettingItemsInGroup:l}}),mac=typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!1;function normalizeKeyName(r){let e=r.split(/-(?!$)/),n=e[e.length-1];n=="Space"&&(n=" ");let o,s,a,l;for(let c=0;c<e.length-1;c++){const d=e[c];if(/^(cmd|meta|m)$/i.test(d))l=!0;else if(/^a(lt)?$/i.test(d))o=!0;else if(/^(c|ctrl|control)$/i.test(d))s=!0;else if(/^s(hift)?$/i.test(d))a=!0;else if(/^mod$/i.test(d))mac?l=!0:s=!0;else throw new Error("Unrecognized modifier name: "+d)}return o&&(n="Alt-"+n),s&&(n="Ctrl-"+n),l&&(n="Meta-"+n),a&&(n="Shift-"+n),n}function normalize(r){const e=Object.create(null);for(const n in r)e[normalizeKeyName(n)]=r[n];return e}function modifiers(r,e,n=!0){return e.altKey&&(r="Alt-"+r),e.ctrlKey&&(r="Ctrl-"+r),e.metaKey&&(r="Meta-"+r),n&&e.shiftKey&&(r="Shift-"+r),r}function generateKeydownHandler(r,e,n){const o=normalize(r);return function(...s){const a=e(...s),l=n(...s);let c;const d=keyName(l),u=o[modifiers(d,l)];if(u&&u.run(...a))return u.stopPropagation&&l.stopPropagation(),u.preventDefault&&l.preventDefault(),!0;if(d.length==1&&d!=" "){if(l.shiftKey){const f=o[modifiers(d,l,!1)];if(f&&f.run(...a))return f.stopPropagation&&l.stopPropagation(),f.preventDefault&&l.preventDefault(),!0}if((l.shiftKey||l.altKey||l.metaKey||d.charCodeAt(0)>127)&&(c=base[l.keyCode])&&c!=d){const f=o[modifiers(c,l)];if(f&&f.run(...a))return f.stopPropagation&&l.stopPropagation(),f.preventDefault&&l.preventDefault(),!0}}const m=r["*"];return m&&m.run(...a)?(m.stopPropagation&&l.stopPropagation(),m.preventDefault&&l.preventDefault(),!0):!1}}function generateKeydownHandlerSimple(r){return generateKeydownHandler(r,e=>[e],e=>e)}const KeymapContext=createContext(()=>{const r=useTaskQueue(),{lastFocusedBlockTree:e,lastFocusedDiId:n}=LastFocusContext.useContext(),{blockEditor:o,blocksManager:s}=BlocksContext.useContext();SettingsContext.useContext();const a=getPmSchema({getBlockRef:s.getBlockRef}),l=ref({"Mod-z":{run:()=>(s.undo(),!0),stopPropagation:!0,preventDefault:!0},"Mod-Shift-z":{run:()=>(s.redo(),!0),stopPropagation:!0,preventDefault:!0},Enter:{run:()=>(r.addTask(async()=>{const u=e.value,m=n.value;if(!u||!m)return;const f=u.getEditorView(m),p=u.getDi(m);if(!(f instanceof EditorView$1)||!p||!DI_FILTERS.isBlockDi(p))return;const g=f.state.selection,y=AllSelection.atEnd(f.state.doc),b=p.block.id===u.getRootBlockId();if(g.eq(y)){const k=b?o.normalizePos({parentId:p.block.id,childIndex:"last-space"}):o.normalizePos({baseBlockId:p.block.id,offset:1});if(!k)return;if(document.activeElement.blur(),o.insertNormalBlock({pos:k,content:plainTextToTextContent("",a)}),u){await u.nextUpdate();const w=u.getDiBelow(m,DI_FILTERS.isBlockDi);w&&u.focusDi(w[0].itemId)}}else if(g.head==0){if(b)return;const k=o.normalizePos({baseBlockId:p.block.id,offset:0});if(!k)return;if(document.activeElement.blur(),o.insertNormalBlock({pos:k,content:plainTextToTextContent("",a)}),u){await u.nextUpdate();const w=u.getDiAbove(m,DI_FILTERS.isBlockDi);w&&u.focusDi(w[0].itemId)}}else{if(b)return;const k=f.state.selection,w=f.state.doc.cut(0,k.anchor),B=f.state.doc.cut(k.anchor),M=s.createBlockTransaction({type:"ui"});o.changeBlockContent({blockId:p.block.id,content:[BLOCK_CONTENT_TYPES.TEXT,B.toJSON()],tr:M,commit:!1});const x=o.normalizePos({baseBlockId:p.block.id,offset:0});if(!x)return;o.insertNormalBlock({pos:x,content:[BLOCK_CONTENT_TYPES.TEXT,w.toJSON()],tr:M,commit:!1}),document.activeElement.blur(),M.commit(),u&&(await u.nextUpdate(),u.focusDi(p.itemId),u.moveCursorToBegin(p.itemId))}}),!0),stopPropagation:!0},"Shift-Enter":{run:(u,m)=>{const f=a.nodes.hardBreak.create(),p=u.tr.replaceSelectionWith(f);return m(p),!0},stopPropagation:!0},Backspace:{run:(u,m)=>(deleteUfeffBeforeCursor(u,m),r.addTask(async()=>{const f=e.value,p=n.value;if(!f||!p)return;const g=f.getEditorView(p),y=f.getDi(p);if(!(g instanceof EditorView$1)||!y||!DI_FILTERS.isBlockDi(y))return;const b=f.getDiAbove(p,DI_FILTERS.isBlockDi),k=f.getDiBelow(p,DI_FILTERS.isBlockDi),w=(b==null?void 0:b[0].itemId)||(k==null?void 0:k[0].itemId),B=g.state.selection;if(B.empty){if(g.state.doc.content.size==0){document.activeElement.blur(),o.deleteBlock({blockId:y.block.id}),w&&f&&(await f.nextUpdate(),await f.focusDi(w),f.moveCursorToTheEnd(w));return}else if(B.from==0&&b){if(DI_FILTERS.isBlockDi(b[0])){const M=b[0].block;if(M.content[0]!=BLOCK_CONTENT_TYPES.TEXT||M.childrenIds.length>0||y.block.parentId!=M.parentId||M.content[0]!=BLOCK_CONTENT_TYPES.TEXT)return;document.activeElement.blur();const x=Node$1.fromJSON(a,M.content[1]),v=g.state.doc,_=x.content.append(v.content),E=a.nodes.doc.create(null,_),N=s.createBlockTransaction({type:"ui"});if(o.changeBlockContent({blockId:y.block.id,content:[BLOCK_CONTENT_TYPES.TEXT,E.toJSON()],tr:N,commit:!1}),o.deleteBlock({blockId:M.id,tr:N,commit:!1}),N.commit(),f){await f.nextUpdate();const I=f.getEditorView(y.itemId);if(I instanceof EditorView$1){const L=TextSelection.create(I.state.doc,x.content.size),A=I.state.tr.setSelection(L);I.dispatch(A),I.focus()}}}return}}}),!1),preventDefault:!0,stopPropagation:!0},Delete:{run:(u,m)=>{deleteUfeffAfterCursor(u,m);const f=e.value,p=n.value;if(!f||!p)return!1;const g=f.getEditorView(p),y=f.getDi(p);if(!(g instanceof EditorView$1)||!y||!DI_FILTERS.isBlockDi(y))return!1;const b=f.getDiAbove(p,DI_FILTERS.isBlockDi),k=f.getDiBelow(p,DI_FILTERS.isBlockDi),w=(k==null?void 0:k[0].itemId)||(b==null?void 0:b[0].itemId),B=g.state.selection,M=AllSelection.atEnd(g.state.doc);if(!B.empty)return!1;if(g.state.doc.content.size==0)return r.addTask(async()=>{o.deleteBlock({blockId:y.block.id}),w&&f&&(await f.nextUpdate(),await f.focusDi(w))}),!0;if(B.eq(M)&&k&&DI_FILTERS.isBlockDi(k[0])){const x=k[0].block;return x.content[0]===BLOCK_CONTENT_TYPES.TEXT&&Node$1.fromJSON(a,x.content[1]).content.size===0?(r.addTask(async()=>{o.deleteBlock({blockId:x.id})}),!0):x.content[0]!==BLOCK_CONTENT_TYPES.TEXT||y.block.childrenIds.length>0||y.block.parentId!==x.parentId?!1:(r.addTask(async()=>{if(x.content[0]!==BLOCK_CONTENT_TYPES.TEXT)return;const v=Node$1.fromJSON(a,x.content[1]),_=g.state.doc,E=_.content.append(v.content),N=a.nodes.doc.create(null,E),I=s.createBlockTransaction({type:"ui"});if(o.changeBlockContent({blockId:x.id,content:[BLOCK_CONTENT_TYPES.TEXT,N.toJSON()],tr:I,commit:!1}),o.deleteBlock({blockId:y.block.id,tr:I,commit:!1}),I.commit(),f){await f.nextUpdate(),await f.focusDi(k[0].itemId);const L=f.getEditorView(k[0].itemId);if(L instanceof EditorView$1){const A=TextSelection.create(L.state.doc,_.content.size),F=L.state.tr.setSelection(A);L.dispatch(F)}}}),!0)}return!1},preventDefault:!0,stopPropagation:!0},"Mod-ArrowUp":{run:()=>(r.addTask(async()=>{const u=n.value,m=e.value;if(!u||!m)return;const f=m.getDi(u);(f==null?void 0:f.type)==="basic-block"&&await o.toggleFold(f.block.id,!0)}),!0),preventDefault:!0,stopPropagation:!0},"Mod-ArrowDown":{run:()=>(r.addTask(async()=>{const u=n.value,m=e.value;if(!u||!m)return;const f=m.getDi(u);(f==null?void 0:f.type)==="basic-block"&&await o.toggleFold(f.block.id,!1)}),!0),preventDefault:!0,stopPropagation:!0},"Alt-ArrowUp":{run:()=>(r.addTask(async()=>{const u=n.value,m=e.value;if(!u||!m)return;const f=m.getDi(u);if(!f||!DI_FILTERS.isBlockDi(f))return;const p=o.normalizePos({baseBlockId:f.block.id,offset:-1});p&&(o.moveBlock({blockId:f.block.id,pos:p}),await m.nextUpdate(),m.focusDi(u))}),!0),preventDefault:!0,stopPropagation:!0},"Alt-ArrowDown":{run:()=>(r.addTask(async()=>{const u=n.value,m=e.value;if(!u||!m)return;const f=m.getDi(u);if(!f||!DI_FILTERS.isBlockDi(f))return;const p=o.normalizePos({baseBlockId:f.block.id,offset:2});p&&(o.moveBlock({blockId:f.block.id,pos:p}),await m.nextUpdate(),m.focusDi(u))}),!0),preventDefault:!0,stopPropagation:!0},Tab:{run:()=>(r.addTask(async()=>{const u=n.value,m=e.value;if(!u||!m)return;const f=m.getDi(u);!f||!DI_FILTERS.isBlockDi(f)||(o.promoteBlock({blockId:f.block.id}),await m.nextUpdate(),m.focusDi(u))}),!0),preventDefault:!0,stopPropagation:!0},"Shift-Tab":{run:()=>(r.addTask(async()=>{const u=n.value,m=e.value;if(!u||!m)return;const f=m.getDi(u);!f||!DI_FILTERS.isBlockDi(f)||(o.demoteBlock({blockId:f.block.id}),await m.nextUpdate(),m.focusDi(u))}),!0),preventDefault:!0,stopPropagation:!0},ArrowUp:{run:()=>{var g;const u=e.value,m=n.value;if(!u||!m)return!1;const f=u.getEditorView(m),p=u.getDi(m);if(!(f instanceof EditorView$1)||!p||!DI_FILTERS.isBlockDi(p))return!1;if(u&&f.endOfTextblock("up")){const y=f.state.selection.anchor,b=f.coordsAtPos(y),k=u.getDiAbove(m,DI_FILTERS.isBlockDi);if(!k)return!1;u.focusDi(k[0].itemId);const w=u.getEditorView(k[0].itemId);if(!(w instanceof EditorView$1))return!1;const B=((g=w.posAtCoords({left:b.left,top:b.top-10}))==null?void 0:g.pos)??y,M=w.state.doc.content.size,x=TextSelection.create(w.state.doc,Math.min(B,M)),v=w.state.tr.setSelection(x);return w.dispatch(v),!0}return!1},preventDefault:!0,stopPropagation:!0},ArrowDown:{run:()=>{var g;const u=e.value,m=n.value;if(!u||!m)return!1;const f=u.getEditorView(m),p=u.getDi(m);if(!(f instanceof EditorView$1)||!p||!DI_FILTERS.isBlockDi(p))return!1;if(u&&f.endOfTextblock("down")){const y=f.state.selection.anchor,b=f.coordsAtPos(y),k=u.getDiBelow(m,DI_FILTERS.isBlockDi);if(!k)return!1;u.focusDi(k[0].itemId);const w=u.getEditorView(k[0].itemId);if(!(w instanceof EditorView$1))return!1;const B=((g=w.posAtCoords({left:b.left,top:b.top+30}))==null?void 0:g.pos)??y,M=w.state.doc.content.size,x=TextSelection.create(w.state.doc,Math.min(B,M)),v=w.state.tr.setSelection(x);return w.dispatch(v),!0}return!1},preventDefault:!0,stopPropagation:!0},"Mod-m":{run:(u,m,f)=>{if(m==null)return!1;const p=a.nodes.mathInline.create({src:""}),g=u.tr.replaceSelectionWith(p),y=g.doc.resolve(g.selection.anchor-g.selection.$anchor.nodeBefore.nodeSize);return g.setSelection(new NodeSelection(y)),m(g),!0},preventDefault:!0,stopPropagation:!0},"Mod-Shift-m":{run:(u,m,f)=>{const p=n.value,g=e.value;if(!p||!g)return!1;const y=g.getDi(p);return!y||!DI_FILTERS.isBlockDi(y)?!1:(u.doc.content.size==0?r.addTask(async()=>{o.changeBlockContent({blockId:y.block.id,content:[BLOCK_CONTENT_TYPES.MATH,""]}),await g.nextUpdate(),g.focusDi(p,{scrollIntoView:!0})}):r.addTask(async()=>{const b=o.normalizePos({baseBlockId:y.block.id,offset:1});if(b==null)return;o.insertNormalBlock({pos:b,content:[BLOCK_CONTENT_TYPES.MATH,""]});const k=g.getDiBelow(p,DI_FILTERS.isBlockDi);k&&(await g.nextUpdate(),g.focusDi(k[0].itemId,{scrollIntoView:!0}))}),!0)},preventDefault:!0,stopPropagation:!0},ArrowLeft:{run:(u,m,f)=>{skipOneUfeffBeforeCursor(u,m);const p=n.value,g=e.value;if(!p||!g)return!1;const y=g.getDi(p);if(!y||!DI_FILTERS.isBlockDi(y))return!1;const b=u.selection.empty&&u.selection.anchor==0;if(g&&b){const k=g.getPredecessorDi(p);return k?(g.focusDi(k[0].itemId),g.moveCursorToTheEnd(k[0].itemId),!0):!1}return!1},preventDefault:!0,stopPropagation:!0},ArrowRight:{run:(u,m,f)=>{skipOneUfeffAfterCursor(u,m);const p=n.value,g=e.value;if(!p||!g)return!1;const y=g.getDi(p);if(!y||!DI_FILTERS.isBlockDi(y))return!1;const b=u.selection.empty&&u.selection.anchor==u.doc.content.size;if(g&&b){const k=g.getSuccessorDi(p);return k?(g.focusDi(k[0].itemId),g.moveCursorToTheEnd(k[0].itemId),!0):!1}return!1},preventDefault:!0,stopPropagation:!0},"Mod-b":{run:toggleMark(a.marks.bold),preventDefault:!0,stopPropagation:!0},"Mod-i":{run:toggleMark(a.marks.italic),preventDefault:!0,stopPropagation:!0},"Mod-`":{run:toggleMark(a.marks.code),preventDefault:!0,stopPropagation:!0},"Mod-=":{run:toggleMark(a.marks.highlight,{bg:"bg4"}),preventDefault:!0,stopPropagation:!0}}),c=ref({ArrowLeft:{key:"ArrowLeft",run:()=>{const u=n.value,m=e.value;if(!u||!m)return!1;const f=m.getDi(u),p=m.getEditorView(u);if(!(p instanceof EditorView)||!f||!DI_FILTERS.isBlockDi(f))return!1;const g=p.state.selection;if(g.ranges.length==1){const y=g.ranges[0];if(y.from==y.to&&y.from==0){const b=m.getPredecessorDi(u);return b?(m.focusDi(b[0].itemId),m.moveCursorToTheEnd(b[0].itemId),!0):!1}}return cursorCharLeft(p)},stopPropagation:!0},ArrowRight:{key:"ArrowRight",run:()=>{const u=n.value,m=e.value;if(!u||!m)return!1;const f=m.getDi(u),p=m.getEditorView(u);if(!(p instanceof EditorView)||!f||!DI_FILTERS.isBlockDi(f))return!1;const g=p.state.selection,y=p.state.doc.length;if(g.ranges.length==1){const b=g.ranges[0];if(b.from==b.to&&b.from==y){const k=m.getSuccessorDi(u);return k?(m.focusDi(k[0].itemId),m.moveCursorToTheEnd(k[0].itemId),!0):!1}}return cursorCharRight(p)},stopPropagation:!0},ArrowUp:{key:"ArrowUp",run:()=>{const u=n.value,m=e.value;if(!u||!m)return!1;const f=m.getDi(u),p=m.getEditorView(u);if(!(p instanceof EditorView)||!f||!DI_FILTERS.isBlockDi(f))return!1;const g=p.state.selection;if(g.ranges.length==1){const y=g.ranges[0];if(y.from==y.to&&p.state.doc.lineAt(y.from).number==1){const b=m.getDiAbove(u);return b?(m.focusDi(b[0].itemId),m.moveCursorToTheEnd(b[0].itemId),!0):!1}}return cursorLineUp(p)},stopPropagation:!0},ArrowDown:{key:"ArrowDown",run:()=>{const u=n.value,m=e.value;if(!u||!m)return!1;const f=m.getDi(u),p=m.getEditorView(u);if(!(p instanceof EditorView)||!f||!DI_FILTERS.isBlockDi(f))return!1;const g=p.state.doc.lines,y=p.state.selection;if(y.ranges.length==1){const b=y.ranges[0];if(b.from==b.to&&p.state.doc.lineAt(b.from).number==g){const k=m.getDiBelow(u);return k?(m.focusDi(k[0].itemId),m.moveCursorToBegin(k[0].itemId),!0):!1}}return cursorLineDown(p)},stopPropagation:!0},Backspace:{key:"Backspace",run:()=>{const u=n.value,m=e.value;if(!u||!m)return!1;const f=m.getDi(u),p=m.getEditorView(u);if(!(p instanceof EditorView)||!f||!DI_FILTERS.isBlockDi(f))return!1;if(p.state.doc.length==0){const g=m.getDiAbove(u);return r.addTask(async()=>{o.deleteBlock({blockId:f.block.id}),g&&(await m.nextUpdate(),m.focusDi(g[0].itemId),m.moveCursorToTheEnd(g[0].itemId))}),!0}return deleteCharBackward(p)},stopPropagation:!0},Delete:{key:"Delete",run:()=>{const u=n.value,m=e.value;if(!u||!m)return!1;const f=m.getDi(u),p=m.getEditorView(u);if(!(p instanceof EditorView)||!f||!DI_FILTERS.isBlockDi(f))return!1;if(p.state.doc.length==0){const g=m.getDiBelow(u);return r.addTask(async()=>{o.deleteBlock({blockId:f.block.id}),g&&(await m.nextUpdate(),m.focusDi(g[0].itemId),m.moveCursorToBegin(g[0].itemId))}),!0}return deleteCharForward(p)},stopPropagation:!0},Tab:{key:"Tab",run:u=>indentMore(u),stopPropagation:!0},"Shift-Tab":{key:"Shift-Tab",run:u=>indentLess(u),stopPropagation:!0},Enter:{key:"Enter",run:u=>insertNewlineAndIndent(u),stopPropagation:!0}}),d=ref({});return{prosemirrorKeymap:l,codemirrorKeymap:c,globalKeymap:d,getProsemirrorKeybinding:u=>l.value[u],getCodemirrorKeybinding:u=>c.value[u],getGlobalKeybinding:u=>d.value[u],addProsemirrorKeybinding:(u,m)=>{if(l.value[u])throw new Error(`keybinding ${u} already exists`);l.value[u]=m},addCodemirrorKeybinding:(u,m)=>{if(c.value[u])throw new Error(`keybinding ${u} already exists`);c.value[u]=m},addGlobalKeybinding:(u,m)=>{if(d.value[u])throw new Error(`keybinding ${u} already exists`);d.value[u]=m},removeProsemirrorKeybinding:u=>{delete l.value[u]},removeCodemirrorKeybinding:u=>{delete c.value[u]},removeGlobalKeybinding:u=>{delete d.value[u]},moveProsemirrorKeybinding:(u,m,f)=>{const p=m?l.value[m]:void 0;if(l.value[u])throw new Error(`keybinding ${u} already exists`);const g=p??f;g&&(l.value[u]=g,m&&p&&delete l.value[m])},moveCodemirrorKeybinding:(u,m,f)=>{const p=m?c.value[m]:void 0;if(c.value[u])throw new Error(`keybinding ${u} already exists`);const g=p??f;g&&(c.value[u]=g,m&&p&&delete c.value[m])},moveGlobalKeybinding:(u,m,f)=>{const p=m?d.value[m]:void 0;if(d.value[u])throw new Error(`keybinding ${u} already exists`);const g=p??f;g&&(d.value[u]=g,m&&p&&delete d.value[m])}}}),skipOneUfeffAfterCursor=(r,e)=>{if(e==null)return!1;const n=r.selection;try{if(r.doc.textBetween(n.from,n.from+1)=="\uFEFF"){const o=r.tr.setSelection(TextSelection.create(r.doc,n.from+1));return e(o),!0}}catch{}return!1},skipOneUfeffBeforeCursor=(r,e)=>{if(e==null)return!1;const n=r.selection;if(r.doc.textBetween(n.from-1,n.from)=="\uFEFF"){const o=r.tr.setSelection(TextSelection.create(r.doc,n.from-1));return e(o),!0}return!1},deleteUfeffAfterCursor=(r,e)=>{const n=r.selection;try{if(r.doc.textBetween(n.from,n.from+1)=="\uFEFF"){const o=r.tr.delete(n.from,n.from+1);e(o)}}catch{}},deleteUfeffBeforeCursor=(r,e)=>{if(e==null)return!1;const n=r.selection;if(r.doc.textBetween(n.from-1,n.from)=="\uFEFF"){const o=r.tr.delete(n.from-1,n.from);e(o)}},SidebarContext=createContext(()=>{const{blocksManager:r}=BlocksContext.useContext(),e=useLocalStorage("sidePaneOpen",!1),n=useLocalStorage("sidePaneDir","right"),o=useLocalStorage("sidePaneWidth",500),s=useLocalStorage("sidePaneHeight",300),a=ref(!0),l=useLocalStorage("sidePaneBlockIds",[]),c=useLocalStorage("sidePaneCurrentBlockId",""),d=ref("left"),u=computed(()=>l.value.map(y=>r.getBlock(y)).filter(y=>!!y)),m=computed(()=>{if(c.value==null)return!1;const y=l.value.indexOf(c.value);return y!==-1&&y>0}),f=computed(()=>{if(c.value==null)return!1;const y=l.value.indexOf(c.value);return y!==-1&&y<l.value.length-1}),p=()=>{const y=l.value.indexOf(c.value);if(y===-1)return;const b=y===0?l.value.length-1:y-1;c.value=l.value[b],d.value="left"},g=()=>{const y=l.value.indexOf(c.value);if(y===-1)return;const b=y===l.value.length-1?0:y+1;c.value=l.value[b],d.value="right"};return watch([l,c],()=>{c.value==null?l.value.length>0&&(c.value=l.value[0]):l.value.includes(c.value)||(l.value.length>0?c.value=l.value[0]:c.value=null)},{immediate:!0}),{sidePaneOpen:e,sidePaneDir:n,sidePaneWidth:o,sidePaneHeight:s,enableSidePaneAnimation:a,sidePaneBlockIds:l,sidePaneBlocks:u,sidePaneCurrentBlockId:c,hasPrev:m,hasNext:f,goPrev:p,goNext:g,dir:d}}),useWritableComputedRef=r=>computed({get:()=>r.value,set:e=>{r.value=e}}),TimeMachineContext=createContext(()=>{const{registerSettingItem:r,registerSettingGroup:e}=SettingsContext.useContext();e({key:"timeMachine",label:{zh:"\u65F6\u5149\u673A"}});const n=ref(!1),o={hourly:1,daily:1,weekly:1},s="timeMachine.autoBackup",a=useLocalStorage(s,o),l={hourly:10,daily:10,weekly:10},c="timeMachine.autoBackupKeepNumber",d=useLocalStorage(c,l);r({id:s+"weekly",groupKey:"timeMachine",label:{zh:"\u6BCF\u51E0\u5468\u81EA\u52A8\u751F\u6210\u5B58\u6863"},defaultValue:o.weekly,value:computed({get:()=>a.value.weekly,set:p=>a.value.weekly=p}),componentType:{type:"integerInput"}}),r({id:c+"weekly",groupKey:"timeMachine",label:{zh:"\u6700\u591A\u4FDD\u7559\u51E0\u4EFD\u6BCF\u5468\u81EA\u52A8\u5907\u4EFD"},desc:{zh:"\u5982\u679C\u6BCF\u5468\u5907\u4EFD\u6570\u91CF\u8FBE\u5230\u6B64\u503C\uFF0C\u5219\u5220\u9664\u6700\u65E9\u7684\u5907\u4EFD\u3002"},defaultValue:l.weekly,value:computed({get:()=>d.value.hourly,set:p=>d.value.hourly=p}),componentType:{type:"integerInput"}}),r({id:s+"daily",groupKey:"timeMachine",label:{zh:"\u6BCF\u51E0\u65E5\u81EA\u52A8\u751F\u6210\u5B58\u6863"},defaultValue:o.daily,value:computed({get:()=>a.value.daily,set:p=>a.value.daily=p}),componentType:{type:"integerInput"}}),r({id:c+"daily",groupKey:"timeMachine",label:{zh:"\u6700\u591A\u4FDD\u7559\u51E0\u4EFD\u6BCF\u65E5\u81EA\u52A8\u5907\u4EFD"},desc:{zh:"\u5982\u679C\u6BCF\u65E5\u5907\u4EFD\u6570\u91CF\u8FBE\u5230\u6B64\u503C\uFF0C\u5219\u5220\u9664\u6700\u65E9\u7684\u5907\u4EFD\u3002"},defaultValue:l.daily,value:computed({get:()=>d.value.daily,set:p=>d.value.daily=p}),componentType:{type:"integerInput"}}),r({id:s+"hourly",groupKey:"timeMachine",label:{zh:"\u6BCF\u51E0\u5C0F\u65F6\u81EA\u52A8\u751F\u6210\u5B58\u6863"},defaultValue:o.hourly,value:computed({get:()=>a.value.hourly,set:p=>a.value.hourly=p}),componentType:{type:"integerInput"}}),r({id:c+"hourly",groupKey:"timeMachine",label:{zh:"\u6700\u591A\u4FDD\u7559\u51E0\u4EFD\u6BCF\u5C0F\u65F6\u81EA\u52A8\u5907\u4EFD"},desc:{zh:"\u5982\u679C\u6BCF\u5C0F\u65F6\u5907\u4EFD\u6570\u91CF\u8FBE\u5230\u6B64\u503C\uFF0C\u5219\u5220\u9664\u6700\u65E9\u7684\u5907\u4EFD\u3002"},defaultValue:l.hourly,value:computed({get:()=>d.value.hourly,set:p=>d.value.hourly=p}),componentType:{type:"integerInput"}});const u=30,m="timeMachine.inactiveThreshold",f=useLocalStorage(m,u);return r({id:m,groupKey:"timeMachine",label:{zh:"\u4E0D\u6D3B\u8DC3\u68C0\u6D4B\u9608\u503C"},desc:{zh:"\u5982\u679C\u4E00\u6BB5\u65F6\u95F4\u65E0\u64CD\u4F5C\uFF0C\u5219\u4F1A\u81EA\u52A8\u751F\u6210\u4E0D\u6D3B\u8DC3\u5F52\u6863\u3002\u6B64\u503C\u63A7\u5236\u591A\u4E45\u65E0\u64CD\u4F5C\u7B97\u4E0D\u6D3B\u8DC3\uFF0C\u5355\u4F4D\uFF1A\u79D2\u3002"},defaultValue:u,value:useWritableComputedRef(f),componentType:{type:"integerInput"}}),{timeMachineOpen:n}}),FloatingMathInputContext=createContext(()=>{const r=ref(null);return{registerFloatingMathInput:e=>{r.value=e},openFloatingMathInput:(...e)=>{var n;(n=r.value)==null||n.call(r,...e)}}});CompletionContext=class{constructor(r,e,n,o){this.state=r,this.pos=e,this.explicit=n,this.view=o,this.abortListeners=[],this.abortOnDocChange=!1}tokenBefore(r){let e=syntaxTree(this.state).resolveInner(this.pos,-1);for(;e&&r.indexOf(e.name)<0;)e=e.parent;return e?{from:e.from,to:this.pos,text:this.state.sliceDoc(e.from,this.pos),type:e.type}:null}matchBefore(r){let e=this.state.doc.lineAt(this.pos),n=Math.max(e.from,this.pos-250),o=e.text.slice(n-e.from,this.pos-e.from),s=o.search(ensureAnchor(r));return s<0?null:{from:n+s,to:this.pos,text:o.slice(s)}}get aborted(){return this.abortListeners==null}addEventListener(r,e,n){r=="abort"&&this.abortListeners&&(this.abortListeners.push(e),n&&n.onDocChange&&(this.abortOnDocChange=!0))}};function toSet(r){let e=Object.keys(r).join(""),n=/\w/.test(e);return n&&(e=e.replace(/\w/g,"")),`[${n?"\\w":""}${e.replace(/[^\w\s]/g,"\\$&")}]`}function prefixMatch(r){let e=Object.create(null),n=Object.create(null);for(let{label:s}of r){e[s[0]]=!0;for(let a=1;a<s.length;a++)n[s[a]]=!0}let o=toSet(e)+toSet(n)+"*$";return[new RegExp("^"+o),new RegExp(o)]}completeFromList=function(r){let e=r.map(s=>typeof s=="string"?{label:s}:s),[n,o]=e.every(s=>/^\w+$/.test(s.label))?[/\w*$/,/\w+$/]:prefixMatch(e);return s=>{let a=s.matchBefore(o);return a||s.explicit?{from:a?a.from:s.pos,options:e,validFor:n}:null}},ifNotIn=function(r,e){return n=>{for(let o=syntaxTree(n.state).resolveInner(n.pos,-1);o;o=o.parent){if(r.indexOf(o.name)>-1)return null;if(o.type.isTop)break}return e(n)}};function ensureAnchor(r,e){var n;let{source:o}=r,s=o[o.length-1]!="$";return s?new RegExp(`(?:${o})${s?"$":""}`,(n=r.flags)!==null&&n!==void 0?n:r.ignoreCase?"i":""):r}const pickedCompletion=Annotation.define(),baseTheme=EditorView.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li, & > completion-section":{padding:"1px 3px",lineHeight:1.2},"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer"},"& > completion-section":{display:"list-item",borderBottom:"1px solid silver",paddingLeft:"0.5em",opacity:.7}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"\xB7\xB7\xB7"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box",whiteSpace:"pre-line"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'\u0192'"}},".cm-completionIcon-class":{"&:after":{content:"'\u25CB'"}},".cm-completionIcon-interface":{"&:after":{content:"'\u25CC'"}},".cm-completionIcon-variable":{"&:after":{content:"'\u{1D465}'"}},".cm-completionIcon-constant":{"&:after":{content:"'\u{1D436}'"}},".cm-completionIcon-type":{"&:after":{content:"'\u{1D461}'"}},".cm-completionIcon-enum":{"&:after":{content:"'\u222A'"}},".cm-completionIcon-property":{"&:after":{content:"'\u25A1'"}},".cm-completionIcon-keyword":{"&:after":{content:"'\u{1F511}\uFE0E'"}},".cm-completionIcon-namespace":{"&:after":{content:"'\u25A2'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});class FieldPos{constructor(e,n,o,s){this.field=e,this.line=n,this.from=o,this.to=s}}class FieldRange{constructor(e,n,o){this.field=e,this.from=n,this.to=o}map(e){let n=e.mapPos(this.from,-1,MapMode.TrackDel),o=e.mapPos(this.to,1,MapMode.TrackDel);return n==null||o==null?null:new FieldRange(this.field,n,o)}}class Snippet{constructor(e,n){this.lines=e,this.fieldPositions=n}instantiate(e,n){let o=[],s=[n],a=e.doc.lineAt(n),l=/^\s*/.exec(a.text)[0];for(let d of this.lines){if(o.length){let u=l,m=/^\t*/.exec(d)[0].length;for(let f=0;f<m;f++)u+=e.facet(indentUnit);s.push(n+u.length-m),d=u+d.slice(m)}o.push(d),n+=d.length+1}let c=this.fieldPositions.map(d=>new FieldRange(d.field,s[d.line]+d.from,s[d.line]+d.to));return{text:o,ranges:c}}static parse(e){let n=[],o=[],s=[],a;for(let l of e.split(/\r\n?|\n/)){for(;a=/[#$]\{(?:(\d+)(?::([^}]*))?|((?:\\[{}]|[^}])*))\}/.exec(l);){let c=a[1]?+a[1]:null,d=a[2]||a[3]||"",u=-1,m=d.replace(/\\[{}]/g,f=>f[1]);for(let f=0;f<n.length;f++)(c!=null?n[f].seq==c:m&&n[f].name==m)&&(u=f);if(u<0){let f=0;for(;f<n.length&&(c==null||n[f].seq!=null&&n[f].seq<c);)f++;n.splice(f,0,{seq:c,name:m}),u=f;for(let p of s)p.field>=u&&p.field++}s.push(new FieldPos(u,o.length,a.index,a.index+m.length)),l=l.slice(0,a.index)+d+l.slice(a.index+a[0].length)}l=l.replace(/\\([{}])/g,(c,d,u)=>{for(let m of s)m.line==o.length&&m.from>u&&(m.from--,m.to--);return d}),o.push(l)}return new Snippet(o,s)}}let fieldMarker=Decoration.widget({widget:new class extends WidgetType{toDOM(){let r=document.createElement("span");return r.className="cm-snippetFieldPosition",r}ignoreEvent(){return!1}}}),fieldRange=Decoration.mark({class:"cm-snippetField"});class ActiveSnippet{constructor(e,n){this.ranges=e,this.active=n,this.deco=Decoration.set(e.map(o=>(o.from==o.to?fieldMarker:fieldRange).range(o.from,o.to)))}map(e){let n=[];for(let o of this.ranges){let s=o.map(e);if(!s)return null;n.push(s)}return new ActiveSnippet(n,this.active)}selectionInsideField(e){return e.ranges.every(n=>this.ranges.some(o=>o.field==this.active&&o.from<=n.from&&o.to>=n.to))}}const setActive=StateEffect.define({map(r,e){return r&&r.map(e)}}),moveToField=StateEffect.define(),snippetState=StateField.define({create(){return null},update(r,e){for(let n of e.effects){if(n.is(setActive))return n.value;if(n.is(moveToField)&&r)return new ActiveSnippet(r.ranges,n.value)}return r&&e.docChanged&&(r=r.map(e.changes)),r&&e.selection&&!r.selectionInsideField(e.selection)&&(r=null),r},provide:r=>EditorView.decorations.from(r,e=>e?e.deco:Decoration.none)});function fieldSelection(r,e){return EditorSelection.create(r.filter(n=>n.field==e).map(n=>EditorSelection.range(n.from,n.to)))}function snippet(r){let e=Snippet.parse(r);return(n,o,s,a)=>{let{text:l,ranges:c}=e.instantiate(n.state,s),{main:d}=n.state.selection,u={changes:{from:s,to:a==d.from?d.to:a,insert:Text.of(l)},scrollIntoView:!0,annotations:o?[pickedCompletion.of(o),Transaction.userEvent.of("input.complete")]:void 0};if(c.length&&(u.selection=fieldSelection(c,0)),c.some(m=>m.field>0)){let m=new ActiveSnippet(c,0),f=u.effects=[setActive.of(m)];n.state.field(snippetState,!1)===void 0&&f.push(StateEffect.appendConfig.of([snippetState,addSnippetKeymap,snippetPointerHandler,baseTheme]))}n.dispatch(n.state.update(u))}}function moveField(r){return({state:e,dispatch:n})=>{let o=e.field(snippetState,!1);if(!o||r<0&&o.active==0)return!1;let s=o.active+r,a=r>0&&!o.ranges.some(l=>l.field==s+r);return n(e.update({selection:fieldSelection(o.ranges,s),effects:setActive.of(a?null:new ActiveSnippet(o.ranges,s)),scrollIntoView:!0})),!0}}const clearSnippet=({state:r,dispatch:e})=>r.field(snippetState,!1)?(e(r.update({effects:setActive.of(null)})),!0):!1,nextSnippetField=moveField(1),prevSnippetField=moveField(-1),defaultSnippetKeymap=[{key:"Tab",run:nextSnippetField,shift:prevSnippetField},{key:"Escape",run:clearSnippet}],snippetKeymap=Facet.define({combine(r){return r.length?r[0]:defaultSnippetKeymap}}),addSnippetKeymap=Prec.highest(keymap.compute([snippetKeymap],r=>r.facet(snippetKeymap)));snippetCompletion=function(r,e){return Object.assign(Object.assign({},e),{apply:snippet(r)})};const snippetPointerHandler=EditorView.domEventHandlers({mousedown(r,e){let n=e.state.field(snippetState,!1),o;if(!n||(o=e.posAtCoords({x:r.clientX,y:r.clientY}))==null)return!1;let s=n.ranges.find(a=>a.from<=o&&a.to>=o);return!s||s.field==n.active?!1:(e.dispatch({selection:fieldSelection(n.ranges,s.field),effects:setActive.of(n.ranges.some(a=>a.field>s.field)?new ActiveSnippet(n.ranges,s.field):null),scrollIntoView:!0}),!0)}}),defaults={brackets:["(","[","{","'",'"'],before:")]}:;>",stringPrefixes:[]},closeBracketEffect=StateEffect.define({map(r,e){return e.mapPos(r,-1,MapMode.TrackAfter)??void 0}}),closedBracket=new class extends RangeValue{};closedBracket.startSide=1,closedBracket.endSide=-1;const bracketState=StateField.define({create(){return RangeSet.empty},update(r,e){if(r=r.map(e.changes),e.selection){let n=e.state.doc.lineAt(e.selection.main.head);r=r.update({filter:o=>o>=n.from&&o<=n.to})}for(let n of e.effects)n.is(closeBracketEffect)&&(r=r.update({add:[closedBracket.range(n.value,n.value+1)]}));return r}});function closeBrackets(){return[inputHandler,bracketState]}const definedClosing="()[]{}<>";function closing(r){for(let e=0;e<definedClosing.length;e+=2)if(definedClosing.charCodeAt(e)==r)return definedClosing.charAt(e+1);return fromCodePoint(r<128?r:r+1)}function config$1(r,e){return r.languageDataAt("closeBrackets",e)[0]||defaults}const android=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent),inputHandler=EditorView.inputHandler.of((r,e,n,o)=>{if((android?r.composing:r.compositionStarted)||r.state.readOnly)return!1;let s=r.state.selection.main;if(o.length>2||o.length==2&&codePointSize(codePointAt(o,0))==1||e!=s.from||n!=s.to)return!1;let a=insertBracket(r.state,o);return a?(r.dispatch(a),!0):!1});function insertBracket(r,e){let n=config$1(r,r.selection.main.head),o=n.brackets||defaults.brackets;for(let s of o){let a=closing(codePointAt(s,0));if(e==s)return a==s?handleSame(r,s,o.indexOf(s+s+s)>-1,n):handleOpen(r,s,a,n.before||defaults.before);if(e==a&&closedBracketAt(r,r.selection.main.from))return handleClose(r,s,a)}return null}function closedBracketAt(r,e){let n=!1;return r.field(bracketState).between(0,r.doc.length,o=>{o==e&&(n=!0)}),n}function nextChar(r,e){let n=r.sliceString(e,e+2);return n.slice(0,codePointSize(codePointAt(n,0)))}function handleOpen(r,e,n,o){let s=null,a=r.changeByRange(l=>{if(!l.empty)return{changes:[{insert:e,from:l.from},{insert:n,from:l.to}],effects:closeBracketEffect.of(l.to+e.length),range:EditorSelection.range(l.anchor+e.length,l.head+e.length)};let c=nextChar(r.doc,l.head);return!c||/\s/.test(c)||o.indexOf(c)>-1?{changes:{insert:e+n,from:l.head},effects:closeBracketEffect.of(l.head+e.length),range:EditorSelection.cursor(l.head+e.length)}:{range:s=l}});return s?null:r.update(a,{scrollIntoView:!0,userEvent:"input.type"})}function handleClose(r,e,n){let o=null,s=r.changeByRange(a=>a.empty&&nextChar(r.doc,a.head)==n?{changes:{from:a.head,to:a.head+n.length,insert:n},range:EditorSelection.cursor(a.head+n.length)}:o={range:a});return o?null:r.update(s,{scrollIntoView:!0,userEvent:"input.type"})}function handleSame(r,e,n,o){let s=o.stringPrefixes||defaults.stringPrefixes,a=null,l=r.changeByRange(c=>{if(!c.empty)return{changes:[{insert:e,from:c.from},{insert:e,from:c.to}],effects:closeBracketEffect.of(c.to+e.length),range:EditorSelection.range(c.anchor+e.length,c.head+e.length)};let d=c.head,u=nextChar(r.doc,d),m;if(u==e){if(nodeStart(r,d))return{changes:{insert:e+e,from:d},effects:closeBracketEffect.of(d+e.length),range:EditorSelection.cursor(d+e.length)};if(closedBracketAt(r,d)){let f=n&&r.sliceDoc(d,d+e.length*3)==e+e+e?e+e+e:e;return{changes:{from:d,to:d+f.length,insert:f},range:EditorSelection.cursor(d+f.length)}}}else{if(n&&r.sliceDoc(d-2*e.length,d)==e+e&&(m=canStartStringAt(r,d-2*e.length,s))>-1&&nodeStart(r,m))return{changes:{insert:e+e+e+e,from:d},effects:closeBracketEffect.of(d+e.length),range:EditorSelection.cursor(d+e.length)};if(r.charCategorizer(d)(u)!=CharCategory.Word&&canStartStringAt(r,d,s)>-1&&!probablyInString(r,d,e,s))return{changes:{insert:e+e,from:d},effects:closeBracketEffect.of(d+e.length),range:EditorSelection.cursor(d+e.length)}}return{range:a=c}});return a?null:r.update(l,{scrollIntoView:!0,userEvent:"input.type"})}function nodeStart(r,e){let n=syntaxTree(r).resolveInner(e+1);return n.parent&&n.from==e}function probablyInString(r,e,n,o){let s=syntaxTree(r).resolveInner(e,-1),a=o.reduce((l,c)=>Math.max(l,c.length),0);for(let l=0;l<5;l++){let c=r.sliceDoc(s.from,Math.min(s.to,s.from+n.length+a)),d=c.indexOf(n);if(!d||d>-1&&o.indexOf(c.slice(0,d))>-1){let m=s.firstChild;for(;m&&m.from==s.from&&m.to-m.from>n.length+d;){if(r.sliceDoc(m.to-n.length,m.to)==n)return!1;m=m.firstChild}return!0}let u=s.to==e&&s.parent;if(!u)break;s=u}return!1}function canStartStringAt(r,e,n){let o=r.charCategorizer(e);if(o(r.sliceDoc(e-1,e))!=CharCategory.Word)return e;for(let s of n){let a=e-s.length;if(r.sliceDoc(a,e)==s&&o(r.sliceDoc(a-1,a))!=CharCategory.Word)return a}return-1}const minimalSetup=[highlightSpecialChars(),history(),drawSelection(),syntaxHighlighting(defaultHighlightStyle,{fallback:!0}),keymap.of([...defaultKeymap,...historyKeymap])],HistoryContext=createContext(()=>{const r=ref([]),e=ref(0),n=computed(()=>e.value>0),o=computed(()=>e.value<r.value.length),{mainRootBlockId:s}=MainTreeContext.useContext(),{getBlockTree:a}=BlockTreeContext.useContext(),{lastFocusedDiId:l,lastFocusedBlockTree:c}=LastFocusContext.useContext(),d=()=>{const f=c.value,p=l.value;if(!f||!p)return null;const g=f.getEditorView(p),y=g instanceof EditorView$1||g instanceof EditorView?g.state.selection.toJSON():null;return{focusedDiId:p,rootBlockId:s.value,selection:y}},u=f=>{f??(f=d()??void 0),f&&(r.value.splice(e.value),r.value.push(f),e.value=r.value.length)},m=f=>{s.value=f.rootBlockId;const p=a("main");p&&p.focusDi(f.focusedDiId,{highlight:!0,expandIfFold:!0})};return{historyItems:r,currentIndex:e,pushHistoryItem:u,goPrev:()=>{if(e.value<=0)return;const f=e.value===r.value.length?d():void 0;e.value--,m(r.value[e.value]),f&&r.value.push(f)},goNext:()=>{e.value>=r.value.length||(e.value++,m(r.value[e.value]))},canGoPrev:n,canGoNext:o}}),RefSuggestionsContext=createContext(()=>{const{blocksManager:r}=BlocksContext.useContext(),{search:e}=IndexContext.useContext(),n=ref(null),o=computed({get:()=>n.value!==null,set:m=>!m&&(n.value=null)}),s=ref(""),a=ref(null),l=ref(0),c=ref([]),d=ref(!1),u=useDebounceFn(()=>{if(!s.value||s.value.trim().length==0){c.value=[];return}const m=e(s.value);c.value=m.slice(0,100).map(f=>r.getBlockRef(f)).filter(f=>{const p=f.value;return p!=null&&p.content[0]===BLOCK_CONTENT_TYPES.TEXT}),l.value=0},100);return{showPos:n,open:o,query:s,cb:a,focusItemIndex:l,suggestions:c,suppressMouseOver:d,updateSuggestions:u,withScrollSuppressed:(m,f=500)=>(d.value=!0,setTimeout(()=>d.value=!1,f),m()),openRefSuggestions:(m,f,p)=>{a.value=f,s.value=p??"",l.value=0,n.value=m}}}),mkEventBusPlugin=()=>{const r=_mitt();return new Plugin({view:e=>(Object.assign(e,{on:r.on}),Object.assign(e,{off:r.off}),Object.assign(e,{emit:r.emit}),{})})},mkHighlightMatchesPlugin=(r,e="highlight-keep")=>new Plugin({props:{decorations:n=>{const o=r.getHighlightTerms();if(!o||o.length==0)return null;let s;const a=[];return n.doc.content.descendants((l,c)=>{if(!l.isText)return!1;const d=l.textContent.toLowerCase();for(const u of o)for(s=-1;(s=d.indexOf(u,s+1))!=-1;){const m=Decoration$1.inline(c+s,c+s+u.length,{class:e});a.push(m)}}),DecorationSet.create(n.doc,a)}}}),mkHighlightRefsPlugin=r=>new Plugin({props:{decorations:e=>{const n=r.getHighlightRefs();if(!n||n.length==0)return null;const o=[];return e.doc.content.descendants((s,a)=>{if(s.type.name=="blockRef_v2"&&n.includes(s.attrs.toBlockId)){const l=Decoration$1.inline(a,a+1,{class:"highlight-keep"});o.push(l)}}),DecorationSet.create(e.doc,o)}}}),mkListenDocChangedPlugin=()=>{let r=null;return new Plugin({view:e=>(r=e,{}),state:{init:()=>{},apply:(e,n,o,s)=>{if(r!=null&&r.emit&&e.docChanged){const a=o.selection.toJSON(),l=s.selection.toJSON(),c=s.doc.toJSON(),d=o.doc.toJSON();r.emit("docChanged",{newDoc:c,oldDoc:d,view:r,oldSelection:a,newSelection:l})}}}})},PathsContext=createContext(()=>{ServerInfoContext.useContext();const r=useRoute(),e=computed(()=>r.params.location),n=ref("attachments"),o=computed(()=>joinPathSegments([e.value,n.value]));return{dbBasePath:e,attachmentsFolderName:n,attachmentsBasePath:o}}),DirentsSchema=z.record(z.string(),z.discriminatedUnion("isDirectory",[z.object({isDirectory:z.literal(!0),name:z.string(),subDirents:z.lazy(()=>DirentsSchema)}),z.object({isDirectory:z.literal(!1),name:z.string()})])),FsLsSchema={request:z.object({basePath:z.string(),includeHidden:z.boolean().optional(),recursive:z.boolean().optional(),maxDepth:z.number().optional()}),result:DirentsSchema};z.object({path:z.string()}),z.object({ctime:z.coerce.date(),mtime:z.coerce.date(),size:z.number()});const FsUploadSchema={request:z.object({overwrite:z.boolean().optional(),mkdir:z.boolean().optional()}),result:z.undefined()},FsEnsureAttachmentsDirSchema={request:z.object({}),result:z.any()},FsGetAttachmentSignedUrlSchema={request:z.object({path:z.string(),attachment:z.boolean().optional(),inferMimeType:z.boolean().optional()}),result:z.object({signedUrl:z.string()})},ClearScannedImageSchema={request:z.object({path:z.string()}),result:z.object({path:z.string()})},fsLs=usePostApi("/fs/ls",FsLsSchema.request,FsLsSchema.result),fsUpload=async(r,e)=>{const n="/fs/upload";try{let o;try{o=globalThis.getAxios()}catch(c){return console.error(`[NO_AXIOS] ${c}`),{success:!1,code:RESP_CODES.NO_AXIOS}}const s=new FormData;r.forEach(c=>{s.append("targetPath",c[0]),s.append("file",c[1])});const a=await o.post(n,s,{headers:{"Content-Type":"multipart/form-data"},params:e});if(!a)return console.error(`[EMPTY_RESPONSE] endpoint=${n}`),{success:!1,code:RESP_CODES.UNKNOWN_ERROR};const l=RespSchema(FsUploadSchema.result).safeParse(a.data);return l.success?{success:!0,code:RESP_CODES.SUCCESS}:(console.error(`[INVALID_RESPONSE] endpoint=${n}}, response=${JSON.stringify(a.data)}, validationErrors=${JSON.stringify(l.error.errors)}`),{success:!1,code:RESP_CODES.INVALID_RESPONSE})}catch(o){return console.error(`[UNKNOWN_ERROR] endpoint=${n}}, error=${o}`),{success:!1,code:RESP_CODES.UNKNOWN_ERROR}}},fsEnsureAttachmentsDir=usePostApi("/fs/ensure-attachments-dir",FsEnsureAttachmentsDirSchema.request,FsEnsureAttachmentsDirSchema.result),fsGetAttachmentSignedUrl=usePostApi("/fs/get-attachment-signed-url",FsGetAttachmentSignedUrlSchema.request,FsGetAttachmentSignedUrlSchema.result),fsClearScannedImage=usePostApi("/fs/clear-scanned-image",ClearScannedImageSchema.request,ClearScannedImageSchema.result),autoRetryGet=(r,e,n,o=!0)=>{let s=!1,a=0,l=0,c=null,d=null;const u=new Promise((f,p)=>{d=p;const g=()=>{if(s){p(new Error("Operation cancelled"));return}if(r(y=>{s||(f(y),m())}),a++,a>=n&&o){p(new Error("Max retry attempts reached"));return}a<n?(e.mode==="fixed"?l=e.value:l=Math.min(e.base*2**(a-1),e.max),c=setTimeout(g,l)):o||(e.mode==="fixed"?l=e.value:l=Math.min(e.base*2**(a-1),e.max),c=setTimeout(g,l))};g()}),m=()=>{s=!0,c&&clearTimeout(c),d&&d(new Error("Operation cancelled"))};return[u,m]},ImagesContext=createContext(()=>{const{serverUrl:r}=ServerInfoContext.useContext(),e=reactive({});ServerInfoContext.useContext(),PathsContext.useContext();const n=(s,a=!1)=>{var d;const l=(d=e[s])==null?void 0:d.status,c=e[s]&&"url"in e[s]?e[s].url:void 0;l!=="fetching"&&(l!==void 0&&!a||(async()=>{e[s]={status:"fetching",url:c};const[u,m]=autoRetryGet(f=>{fsGetAttachmentSignedUrl({path:s,inferMimeType:!0,attachment:!1}).then(p=>p.success&&f(p.data.signedUrl))},{mode:"backoff",base:500,max:5e3},5,!0);u.then(f=>{console.debug("\u56FE\u7247\u83B7\u53D6\u6210\u529F",s),e[s]={status:"synced",url:`http://${r.value}${f}`}}).catch(f=>{console.debug("\u56FE\u7247\u83B7\u53D6\u5931\u8D25",s,f.message),e[s]={status:"fetchError",url:c}})})())};function o(s,a){return typeof s=="string"?computed(()=>(n(s,a),e[s])):computed(()=>{const l=s();return l?(n(l,a),e[l]):null})}return{images:e,useImage:o,uploadImage:(s,a)=>{const l=a??s.name,c=URL.createObjectURL(s);return e[l]={status:"uploading",url:c},queueMicrotask(async()=>{(await fsUpload([[l,s]])).success?(console.log("\u56FE\u7247\u4E0A\u4F20\u6210\u529F",l),n(l,!0)):e[l]={status:"uploadError",url:c}}),computed(()=>e[l])}}}),_sfc_main$1z=defineComponent({__name:"ProseMirror",props:mergeModels({disableSpellcheckWhenBlur:{type:Boolean,default:!0},nodeViews:{},schema:{},pluginsBuilder:{},onDocChanged:{},highlightTerms:{},highlightRefs:{},blockTree:{},itemId:{},readonly:{type:Boolean,default:!1}},{doc:{},docModifiers:{}}),emits:["update:doc"],setup(r,{expose:e}){const n=r,o=useModel(r,"doc"),s=ref(null),a=ref(!1);let l=null;const c=HistoryContext.useContext(),d=BlockTreeContext.useContext(),u=BlocksContext.useContext(),m=RefSuggestionsContext.useContext(),f=LastFocusContext.useContext(),p=PathsContext.useContext(),g=ImagesContext.useContext(),y=KeymapContext.useContext(),b={getSchema:()=>n.schema,getItemId:()=>n.itemId??null,getBlockTree:()=>n.blockTree??null,getReadonly:()=>n.readonly,getEditorView:()=>l,getHighlightTerms:()=>n.highlightTerms??[],getHighlightRefs:()=>n.highlightRefs??[],lastFocusContext:f,historyContext:c,blockTreeContext:d,blocksContext:u,refSuggestionsContext:m,imagesContext:g,pathsContext:p,keymapContext:y};e({getEditorView:()=>l,isCorrupted:()=>a.value,getWrapperDom:()=>s.value});const k=()=>{var B;const w=((B=n.pluginsBuilder)==null?void 0:B.call(n,b))??[];return n.readonly?[mkHighlightMatchesPlugin(b),mkHighlightRefsPlugin(b),...w]:[mkEventBusPlugin(),mkListenDocChangedPlugin(),mkHighlightMatchesPlugin(b),mkHighlightRefsPlugin(b),...w]};return watch(o,()=>{if(!l||l!=null&&l.isDestroyed)return;const w=JSON.stringify(o.value),B=JSON.stringify(l.state.doc);if(w==B)return;let M;try{M=Node$1.fromJSON(n.schema,o.value)}catch{a.value=!0;return}const x=l.state.selection.toJSON();let v;try{v=Selection.fromJSON(M,x)}catch{}const _=EditorState$1.create({doc:M,plugins:l.state.plugins,selection:v});l.updateState(_)}),watch([()=>n.highlightTerms,()=>n.highlightRefs],()=>{if(l){const w=l.state.tr.setMeta("empty",{});l.dispatch(w)}}),onMounted(()=>{if(!s.value)return;let w;try{w=Node$1.fromJSON(n.schema,o.value)}catch{a.value=!0;return}const B=EditorState$1.create({doc:w,plugins:k()});if(l&&l.destroy(),l=new EditorView$1(s.value,{state:B,editable:()=>!n.readonly,nodeViews:n.nodeViews??{}}),l.on){const M=({newDoc:x})=>o.value=x;l.on("docChanged",n.onDocChanged??M)}n.disableSpellcheckWhenBlur&&(s.value.addEventListener("focusin",()=>{s.value&&(s.value.spellcheck=!0)}),s.value.addEventListener("focusout",()=>{s.value&&(s.value.spellcheck=!1)}))}),onUnmounted(()=>{setTimeout(()=>{l&&!l.isDestroyed&&l.destroy(),l=null},1e3)}),(w,B)=>(openBlock(),createElementBlock("div",{class:"prosemirror-wrapper",ref_key:"$wrapper",ref:s},null,512))}});class InputRule{constructor(e,n,o={}){this.match=e,this.match=e,this.handler=typeof n=="string"?stringHandler(n):n,this.undoable=o.undoable!==!1,this.inCode=o.inCode||!1}}function stringHandler(r){return function(e,n,o,s){let a=r;if(n[1]){let l=n[0].lastIndexOf(n[1]);a+=n[0].slice(l+n[1].length),o+=l;let c=o-s;c>0&&(a=n[0].slice(l-c,l)+a,o=s)}return e.tr.insertText(a,o,s)}}const MAX_MATCH=500;function inputRules({rules:r}){let e=new Plugin({state:{init(){return null},apply(n,o){return n.getMeta(this)||(n.selectionSet||n.docChanged?null:o)}},props:{handleTextInput(n,o,s,a){return run(n,o,s,a,r,e)},handleDOMEvents:{compositionend:n=>{setTimeout(()=>{let{$cursor:o}=n.state.selection;o&&run(n,o.pos,o.pos,"",r,e)})}}},isInputRules:!0});return e}function run(r,e,n,o,s,a){if(r.composing)return!1;let l=r.state,c=l.doc.resolve(e),d=c.parent.textBetween(Math.max(0,c.parentOffset-MAX_MATCH),c.parentOffset,null,"\uFFFC")+o;for(let u=0;u<s.length;u++){let m=s[u];if(c.parent.type.spec.code){if(!m.inCode)continue}else if(m.inCode==="only")continue;let f=m.match.exec(d),p=f&&m.handler(l,f,e-(f[0].length-o.length),n);if(p)return m.undoable&&p.setMeta(a,{transform:p,from:e,to:n,text:o}),r.dispatch(p),!0}return!1}new InputRule(/--$/,"\u2014"),new InputRule(/\.\.\.$/,"\u2026"),new InputRule(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(")$/,"\u201C"),new InputRule(/"$/,"\u201D"),new InputRule(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(')$/,"\u2018"),new InputRule(/'$/,"\u2019");const openRefSuggestions=r=>new InputRule(/([#@])$/,(e,n)=>{const o=r.getEditorView();if(!o)return null;const s=o.state.selection.from,a=o.coordsAtPos(s);if(!a)return null;const l={x:a.left,y:a.top},c=u=>{if(u){const m=n[1]=="#",f=r.getSchema().nodes.blockRef_v2.create({toBlockId:u,tag:m}),p=o.state.selection.anchor,g=o.state.tr.replaceRangeWith(p-n[1].length,p,f);o.dispatch(g)}setTimeout(()=>o.focus(),50)},{openRefSuggestions:d}=r.refSuggestionsContext??{};return d==null||d(l,c),null}),turnToCodeBlock=r=>new InputRule(/^```([a-z]+) $/,(e,n)=>{const o=e.tr.setMeta("",""),s=r.getItemId(),a=r.getBlockTree();if(!s||!a)return o;const l=a.getDi(s);if(!l||!DI_FILTERS.isBlockDi(l))return o;const{blockEditor:c}=r.blocksContext??{};if(!c)return o;const d=useTaskQueue();return setTimeout(()=>{d.addTask(async()=>{c.changeBlockContent({blockId:l.block.id,content:[BLOCK_CONTENT_TYPES.CODE,"",n[1]]}),await a.nextUpdate(),a.focusDi(s)})}),o});class SourceLocation{constructor(e,n,o){this.lexer=void 0,this.start=void 0,this.end=void 0,this.lexer=e,this.start=n,this.end=o}static range(e,n){return n?!e||!e.loc||!n.loc||e.loc.lexer!==n.loc.lexer?null:new SourceLocation(e.loc.lexer,e.loc.start,n.loc.end):e&&e.loc}}class Token{constructor(e,n){this.text=void 0,this.loc=void 0,this.noexpand=void 0,this.treatAsRelax=void 0,this.text=e,this.loc=n}range(e,n){return new Token(n,SourceLocation.range(this,e))}}class ParseError{constructor(e,n){this.name=void 0,this.position=void 0,this.length=void 0,this.rawMessage=void 0;var o="KaTeX parse error: "+e,s,a,l=n&&n.loc;if(l&&l.start<=l.end){var c=l.lexer.input;s=l.start,a=l.end,s===c.length?o+=" at end of input: ":o+=" at position "+(s+1)+": ";var d=c.slice(s,a).replace(/[^]/g,"$&\u0332"),u;s>15?u="\u2026"+c.slice(s-15,s):u=c.slice(0,s);var m;a+15<c.length?m=c.slice(a,a+15)+"\u2026":m=c.slice(a),o+=u+d+m}var f=new Error(o);return f.name="ParseError",f.__proto__=ParseError.prototype,f.position=s,s!=null&&a!=null&&(f.length=a-s),f.rawMessage=e,f}}ParseError.prototype.__proto__=Error.prototype;var contains=function r(e,n){return e.indexOf(n)!==-1},deflt=function r(e,n){return e===void 0?n:e},uppercase=/([A-Z])/g,hyphenate=function r(e){return e.replace(uppercase,"-$1").toLowerCase()},ESCAPE_LOOKUP={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#x27;"},ESCAPE_REGEX=/[&><"']/g;function escape(r){return String(r).replace(ESCAPE_REGEX,e=>ESCAPE_LOOKUP[e])}var getBaseElem=function r(e){return e.type==="ordgroup"||e.type==="color"?e.body.length===1?r(e.body[0]):e:e.type==="font"?r(e.body):e},isCharacterBox=function r(e){var n=getBaseElem(e);return n.type==="mathord"||n.type==="textord"||n.type==="atom"},assert=function r(e){if(!e)throw new Error("Expected non-null, but got "+String(e));return e},protocolFromUrl=function r(e){var n=/^[\x00-\x20]*([^\\/#?]*?)(:|&#0*58|&#x0*3a|&colon)/i.exec(e);return n?n[2]!==":"||!/^[a-zA-Z][a-zA-Z0-9+\-.]*$/.test(n[1])?null:n[1].toLowerCase():"_relative"},utils={contains,deflt,escape,hyphenate,getBaseElem,isCharacterBox,protocolFromUrl},SETTINGS_SCHEMA={displayMode:{type:"boolean",description:"Render math in display mode, which puts the math in display style (so \\int and \\sum are large, for example), and centers the math on the page on its own line.",cli:"-d, --display-mode"},output:{type:{enum:["htmlAndMathml","html","mathml"]},description:"Determines the markup language of the output.",cli:"-F, --format <type>"},leqno:{type:"boolean",description:"Render display math in leqno style (left-justified tags)."},fleqn:{type:"boolean",description:"Render display math flush left."},throwOnError:{type:"boolean",default:!0,cli:"-t, --no-throw-on-error",cliDescription:"Render errors (in the color given by --error-color) instead of throwing a ParseError exception when encountering an error."},errorColor:{type:"string",default:"#cc0000",cli:"-c, --error-color <color>",cliDescription:"A color string given in the format 'rgb' or 'rrggbb' (no #). This option determines the color of errors rendered by the -t option.",cliProcessor:r=>"#"+r},macros:{type:"object",cli:"-m, --macro <def>",cliDescription:"Define custom macro of the form '\\foo:expansion' (use multiple -m arguments for multiple macros).",cliDefault:[],cliProcessor:(r,e)=>(e.push(r),e)},minRuleThickness:{type:"number",description:"Specifies a minimum thickness, in ems, for fraction lines, `\\sqrt` top lines, `{array}` vertical lines, `\\hline`, `\\hdashline`, `\\underline`, `\\overline`, and the borders of `\\fbox`, `\\boxed`, and `\\fcolorbox`.",processor:r=>Math.max(0,r),cli:"--min-rule-thickness <size>",cliProcessor:parseFloat},colorIsTextColor:{type:"boolean",description:"Makes \\color behave like LaTeX's 2-argument \\textcolor, instead of LaTeX's one-argument \\color mode change.",cli:"-b, --color-is-text-color"},strict:{type:[{enum:["warn","ignore","error"]},"boolean","function"],description:"Turn on strict / LaTeX faithfulness mode, which throws an error if the input uses features that are not supported by LaTeX.",cli:"-S, --strict",cliDefault:!1},trust:{type:["boolean","function"],description:"Trust the input, enabling all HTML features such as \\url.",cli:"-T, --trust"},maxSize:{type:"number",default:1/0,description:"If non-zero, all user-specified sizes, e.g. in \\rule{500em}{500em}, will be capped to maxSize ems. Otherwise, elements and spaces can be arbitrarily large",processor:r=>Math.max(0,r),cli:"-s, --max-size <n>",cliProcessor:parseInt},maxExpand:{type:"number",default:1e3,description:"Limit the number of macro expansions to the specified number, to prevent e.g. infinite macro loops. If set to Infinity, the macro expander will try to fully expand as in LaTeX.",processor:r=>Math.max(0,r),cli:"-e, --max-expand <n>",cliProcessor:r=>r==="Infinity"?1/0:parseInt(r)},globalGroup:{type:"boolean",cli:!1}};function getDefaultValue(r){if(r.default)return r.default;var e=r.type,n=Array.isArray(e)?e[0]:e;if(typeof n!="string")return n.enum[0];switch(n){case"boolean":return!1;case"string":return"";case"number":return 0;case"object":return{}}}class Settings{constructor(e){this.displayMode=void 0,this.output=void 0,this.leqno=void 0,this.fleqn=void 0,this.throwOnError=void 0,this.errorColor=void 0,this.macros=void 0,this.minRuleThickness=void 0,this.colorIsTextColor=void 0,this.strict=void 0,this.trust=void 0,this.maxSize=void 0,this.maxExpand=void 0,this.globalGroup=void 0,e=e||{};for(var n in SETTINGS_SCHEMA)if(SETTINGS_SCHEMA.hasOwnProperty(n)){var o=SETTINGS_SCHEMA[n];this[n]=e[n]!==void 0?o.processor?o.processor(e[n]):e[n]:getDefaultValue(o)}}reportNonstrict(e,n,o){var s=this.strict;if(typeof s=="function"&&(s=s(e,n,o)),!(!s||s==="ignore")){if(s===!0||s==="error")throw new ParseError("LaTeX-incompatible input and strict mode is set to 'error': "+(n+" ["+e+"]"),o);s==="warn"?typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to 'warn': "+(n+" ["+e+"]")):typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to "+("unrecognized '"+s+"': "+n+" ["+e+"]"))}}useStrictBehavior(e,n,o){var s=this.strict;if(typeof s=="function")try{s=s(e,n,o)}catch{s="error"}return!s||s==="ignore"?!1:s===!0||s==="error"?!0:s==="warn"?(typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to 'warn': "+(n+" ["+e+"]")),!1):(typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to "+("unrecognized '"+s+"': "+n+" ["+e+"]")),!1)}isTrusted(e){if(e.url&&!e.protocol){var n=utils.protocolFromUrl(e.url);if(n==null)return!1;e.protocol=n}var o=typeof this.trust=="function"?this.trust(e):this.trust;return!!o}}class Style{constructor(e,n,o){this.id=void 0,this.size=void 0,this.cramped=void 0,this.id=e,this.size=n,this.cramped=o}sup(){return styles[sup[this.id]]}sub(){return styles[sub[this.id]]}fracNum(){return styles[fracNum[this.id]]}fracDen(){return styles[fracDen[this.id]]}cramp(){return styles[cramp[this.id]]}text(){return styles[text$1[this.id]]}isTight(){return this.size>=2}}var D=0,Dc=1,T=2,Tc=3,S=4,Sc=5,SS=6,SSc=7,styles=[new Style(D,0,!1),new Style(Dc,0,!0),new Style(T,1,!1),new Style(Tc,1,!0),new Style(S,2,!1),new Style(Sc,2,!0),new Style(SS,3,!1),new Style(SSc,3,!0)],sup=[S,Sc,S,Sc,SS,SSc,SS,SSc],sub=[Sc,Sc,Sc,Sc,SSc,SSc,SSc,SSc],fracNum=[T,Tc,S,Sc,SS,SSc,SS,SSc],fracDen=[Tc,Tc,Sc,Sc,SSc,SSc,SSc,SSc],cramp=[Dc,Dc,Tc,Tc,Sc,Sc,SSc,SSc],text$1=[D,Dc,T,Tc,T,Tc,T,Tc],Style$1={DISPLAY:styles[D],TEXT:styles[T],SCRIPT:styles[S],SCRIPTSCRIPT:styles[SS]},scriptData=[{name:"latin",blocks:[[256,591],[768,879]]},{name:"cyrillic",blocks:[[1024,1279]]},{name:"armenian",blocks:[[1328,1423]]},{name:"brahmic",blocks:[[2304,4255]]},{name:"georgian",blocks:[[4256,4351]]},{name:"cjk",blocks:[[12288,12543],[19968,40879],[65280,65376]]},{name:"hangul",blocks:[[44032,55215]]}];function scriptFromCodepoint(r){for(var e=0;e<scriptData.length;e++)for(var n=scriptData[e],o=0;o<n.blocks.length;o++){var s=n.blocks[o];if(r>=s[0]&&r<=s[1])return n.name}return null}var allBlocks=[];scriptData.forEach(r=>r.blocks.forEach(e=>allBlocks.push(...e)));function supportedCodepoint(r){for(var e=0;e<allBlocks.length;e+=2)if(r>=allBlocks[e]&&r<=allBlocks[e+1])return!0;return!1}var hLinePad=80,sqrtMain=function r(e,n){return"M95,"+(622+e+n)+`
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l`+e/2.075+" -"+e+`
c5.3,-9.3,12,-14,20,-14
H400000v`+(40+e)+`H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M`+(834+e)+" "+n+"h400000v"+(40+e)+"h-400000z"},sqrtSize1=function r(e,n){return"M263,"+(601+e+n)+`c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l`+e/2.084+" -"+e+`
c4.7,-7.3,11,-11,19,-11
H40000v`+(40+e)+`H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M`+(1001+e)+" "+n+"h400000v"+(40+e)+"h-400000z"},sqrtSize2=function r(e,n){return"M983 "+(10+e+n)+`
l`+e/3.13+" -"+e+`
c4,-6.7,10,-10,18,-10 H400000v`+(40+e)+`
H1013.1s-83.4,268,-264.1,840c-180.7,572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7
s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744
c-10,12,-21,25,-33,39s-32,39,-32,39c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30
c26.7,-32.7,52,-63,76,-91s52,-60,52,-60s208,722,208,722
c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,-658.5
c53.7,-170.3,84.5,-266.8,92.5,-289.5z
M`+(1001+e)+" "+n+"h400000v"+(40+e)+"h-400000z"},sqrtSize3=function r(e,n){return"M424,"+(2398+e+n)+`
c-1.3,-0.7,-38.5,-172,-111.5,-514c-73,-342,-109.8,-513.3,-110.5,-514
c0,-2,-10.7,14.3,-32,49c-4.7,7.3,-9.8,15.7,-15.5,25c-5.7,9.3,-9.8,16,-12.5,20
s-5,7,-5,7c-4,-3.3,-8.3,-7.7,-13,-13s-13,-13,-13,-13s76,-122,76,-122s77,-121,77,-121
s209,968,209,968c0,-2,84.7,-361.7,254,-1079c169.3,-717.3,254.7,-1077.7,256,-1081
l`+e/4.223+" -"+e+`c4,-6.7,10,-10,18,-10 H400000
v`+(40+e)+`H1014.6
s-87.3,378.7,-272.6,1166c-185.3,787.3,-279.3,1182.3,-282,1185
c-2,6,-10,9,-24,9
c-8,0,-12,-0.7,-12,-2z M`+(1001+e)+" "+n+`
h400000v`+(40+e)+"h-400000z"},sqrtSize4=function r(e,n){return"M473,"+(2713+e+n)+`
c339.3,-1799.3,509.3,-2700,510,-2702 l`+e/5.298+" -"+e+`
c3.3,-7.3,9.3,-11,18,-11 H400000v`+(40+e)+`H1017.7
s-90.5,478,-276.2,1466c-185.7,988,-279.5,1483,-281.5,1485c-2,6,-10,9,-24,9
c-8,0,-12,-0.7,-12,-2c0,-1.3,-5.3,-32,-16,-92c-50.7,-293.3,-119.7,-693.3,-207,-1200
c0,-1.3,-5.3,8.7,-16,30c-10.7,21.3,-21.3,42.7,-32,64s-16,33,-16,33s-26,-26,-26,-26
s76,-153,76,-153s77,-151,77,-151c0.7,0.7,35.7,202,105,604c67.3,400.7,102,602.7,104,
606zM`+(1001+e)+" "+n+"h400000v"+(40+e)+"H1017.7z"},phasePath=function r(e){var n=e/2;return"M400000 "+e+" H0 L"+n+" 0 l65 45 L145 "+(e-80)+" H400000z"},sqrtTall=function r(e,n,o){var s=o-54-n-e;return"M702 "+(e+n)+"H400000"+(40+e)+`
H742v`+s+`l-4 4-4 4c-.667.7 -2 1.5-4 2.5s-4.167 1.833-6.5 2.5-5.5 1-9.5 1
h-12l-28-84c-16.667-52-96.667 -294.333-240-727l-212 -643 -85 170
c-4-3.333-8.333-7.667-13 -13l-13-13l77-155 77-156c66 199.333 139 419.667
219 661 l218 661zM702 `+n+"H400000v"+(40+e)+"H742z"},sqrtPath=function r(e,n,o){n=1e3*n;var s="";switch(e){case"sqrtMain":s=sqrtMain(n,hLinePad);break;case"sqrtSize1":s=sqrtSize1(n,hLinePad);break;case"sqrtSize2":s=sqrtSize2(n,hLinePad);break;case"sqrtSize3":s=sqrtSize3(n,hLinePad);break;case"sqrtSize4":s=sqrtSize4(n,hLinePad);break;case"sqrtTall":s=sqrtTall(n,hLinePad,o)}return s},innerPath=function r(e,n){switch(e){case"\u239C":return"M291 0 H417 V"+n+" H291z M291 0 H417 V"+n+" H291z";case"\u2223":return"M145 0 H188 V"+n+" H145z M145 0 H188 V"+n+" H145z";case"\u2225":return"M145 0 H188 V"+n+" H145z M145 0 H188 V"+n+" H145z"+("M367 0 H410 V"+n+" H367z M367 0 H410 V"+n+" H367z");case"\u239F":return"M457 0 H583 V"+n+" H457z M457 0 H583 V"+n+" H457z";case"\u23A2":return"M319 0 H403 V"+n+" H319z M319 0 H403 V"+n+" H319z";case"\u23A5":return"M263 0 H347 V"+n+" H263z M263 0 H347 V"+n+" H263z";case"\u23AA":return"M384 0 H504 V"+n+" H384z M384 0 H504 V"+n+" H384z";case"\u23D0":return"M312 0 H355 V"+n+" H312z M312 0 H355 V"+n+" H312z";case"\u2016":return"M257 0 H300 V"+n+" H257z M257 0 H300 V"+n+" H257z"+("M478 0 H521 V"+n+" H478z M478 0 H521 V"+n+" H478z");default:return""}},path={doubleleftarrow:`M262 157
l10-10c34-36 62.7-77 86-123 3.3-8 5-13.3 5-16 0-5.3-6.7-8-20-8-7.3
 0-12.2.5-14.5 1.5-2.3 1-4.8 4.5-7.5 10.5-49.3 97.3-121.7 169.3-217 216-28
 14-57.3 25-88 33-6.7 2-11 3.8-13 5.5-2 1.7-3 4.2-3 7.5s1 5.8 3 7.5
c2 1.7 6.3 3.5 13 5.5 68 17.3 128.2 47.8 180.5 91.5 52.3 43.7 93.8 96.2 124.5
 157.5 9.3 8 15.3 12.3 18 13h6c12-.7 18-4 18-10 0-2-1.7-7-5-15-23.3-46-52-87
-86-123l-10-10h399738v-40H218c328 0 0 0 0 0l-10-8c-26.7-20-65.7-43-117-69 2.7
-2 6-3.7 10-5 36.7-16 72.3-37.3 107-64l10-8h399782v-40z
m8 0v40h399730v-40zm0 194v40h399730v-40z`,doublerightarrow:`M399738 392l
-10 10c-34 36-62.7 77-86 123-3.3 8-5 13.3-5 16 0 5.3 6.7 8 20 8 7.3 0 12.2-.5
 14.5-1.5 2.3-1 4.8-4.5 7.5-10.5 49.3-97.3 121.7-169.3 217-216 28-14 57.3-25 88
-33 6.7-2 11-3.8 13-5.5 2-1.7 3-4.2 3-7.5s-1-5.8-3-7.5c-2-1.7-6.3-3.5-13-5.5-68
-17.3-128.2-47.8-180.5-91.5-52.3-43.7-93.8-96.2-124.5-157.5-9.3-8-15.3-12.3-18
-13h-6c-12 .7-18 4-18 10 0 2 1.7 7 5 15 23.3 46 52 87 86 123l10 10H0v40h399782
c-328 0 0 0 0 0l10 8c26.7 20 65.7 43 117 69-2.7 2-6 3.7-10 5-36.7 16-72.3 37.3
-107 64l-10 8H0v40zM0 157v40h399730v-40zm0 194v40h399730v-40z`,leftarrow:`M400000 241H110l3-3c68.7-52.7 113.7-120
 135-202 4-14.7 6-23 6-25 0-7.3-7-11-21-11-8 0-13.2.8-15.5 2.5-2.3 1.7-4.2 5.8
-5.5 12.5-1.3 4.7-2.7 10.3-4 17-12 48.7-34.8 92-68.5 130S65.3 228.3 18 247
c-10 4-16 7.7-18 11 0 8.7 6 14.3 18 17 47.3 18.7 87.8 47 121.5 85S196 441.3 208
 490c.7 2 1.3 5 2 9s1.2 6.7 1.5 8c.3 1.3 1 3.3 2 6s2.2 4.5 3.5 5.5c1.3 1 3.3
 1.8 6 2.5s6 1 10 1c14 0 21-3.7 21-11 0-2-2-10.3-6-25-20-79.3-65-146.7-135-202
 l-3-3h399890zM100 241v40h399900v-40z`,leftbrace:`M6 548l-6-6v-35l6-11c56-104 135.3-181.3 238-232 57.3-28.7 117
-45 179-50h399577v120H403c-43.3 7-81 15-113 26-100.7 33-179.7 91-237 174-2.7
 5-6 9-10 13-.7 1-7.3 1-20 1H6z`,leftbraceunder:`M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13
 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688
 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7
-331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z`,leftgroup:`M400000 80
H435C64 80 168.3 229.4 21 260c-5.9 1.2-18 0-18 0-2 0-3-1-3-3v-38C76 61 257 0
 435 0h399565z`,leftgroupunder:`M400000 262
H435C64 262 168.3 112.6 21 82c-5.9-1.2-18 0-18 0-2 0-3 1-3 3v38c76 158 257 219
 435 219h399565z`,leftharpoon:`M0 267c.7 5.3 3 10 7 14h399993v-40H93c3.3
-3.3 10.2-9.5 20.5-18.5s17.8-15.8 22.5-20.5c50.7-52 88-110.3 112-175 4-11.3 5
-18.3 3-21-1.3-4-7.3-6-18-6-8 0-13 .7-15 2s-4.7 6.7-8 16c-42 98.7-107.3 174.7
-196 228-6.7 4.7-10.7 8-12 10-1.3 2-2 5.7-2 11zm100-26v40h399900v-40z`,leftharpoonplus:`M0 267c.7 5.3 3 10 7 14h399993v-40H93c3.3-3.3 10.2-9.5
 20.5-18.5s17.8-15.8 22.5-20.5c50.7-52 88-110.3 112-175 4-11.3 5-18.3 3-21-1.3
-4-7.3-6-18-6-8 0-13 .7-15 2s-4.7 6.7-8 16c-42 98.7-107.3 174.7-196 228-6.7 4.7
-10.7 8-12 10-1.3 2-2 5.7-2 11zm100-26v40h399900v-40zM0 435v40h400000v-40z
m0 0v40h400000v-40z`,leftharpoondown:`M7 241c-4 4-6.333 8.667-7 14 0 5.333.667 9 2 11s5.333
 5.333 12 10c90.667 54 156 130 196 228 3.333 10.667 6.333 16.333 9 17 2 .667 5
 1 9 1h5c10.667 0 16.667-2 18-6 2-2.667 1-9.667-3-21-32-87.333-82.667-157.667
-152-211l-3-3h399907v-40zM93 281 H400000 v-40L7 241z`,leftharpoondownplus:`M7 435c-4 4-6.3 8.7-7 14 0 5.3.7 9 2 11s5.3 5.3 12
 10c90.7 54 156 130 196 228 3.3 10.7 6.3 16.3 9 17 2 .7 5 1 9 1h5c10.7 0 16.7
-2 18-6 2-2.7 1-9.7-3-21-32-87.3-82.7-157.7-152-211l-3-3h399907v-40H7zm93 0
v40h399900v-40zM0 241v40h399900v-40zm0 0v40h399900v-40z`,lefthook:`M400000 281 H103s-33-11.2-61-33.5S0 197.3 0 164s14.2-61.2 42.5
-83.5C70.8 58.2 104 47 142 47 c16.7 0 25 6.7 25 20 0 12-8.7 18.7-26 20-40 3.3
-68.7 15.7-86 37-10 12-15 25.3-15 40 0 22.7 9.8 40.7 29.5 54 19.7 13.3 43.5 21
 71.5 23h399859zM103 281v-40h399897v40z`,leftlinesegment:`M40 281 V428 H0 V94 H40 V241 H400000 v40z
M40 281 V428 H0 V94 H40 V241 H400000 v40z`,leftmapsto:`M40 281 V448H0V74H40V241H400000v40z
M40 281 V448H0V74H40V241H400000v40z`,leftToFrom:`M0 147h400000v40H0zm0 214c68 40 115.7 95.7 143 167h22c15.3 0 23
-.3 23-1 0-1.3-5.3-13.7-16-37-18-35.3-41.3-69-70-101l-7-8h399905v-40H95l7-8
c28.7-32 52-65.7 70-101 10.7-23.3 16-35.7 16-37 0-.7-7.7-1-23-1h-22C115.7 265.3
 68 321 0 361zm0-174v-40h399900v40zm100 154v40h399900v-40z`,longequal:`M0 50 h400000 v40H0z m0 194h40000v40H0z
M0 50 h400000 v40H0z m0 194h40000v40H0z`,midbrace:`M200428 334
c-100.7-8.3-195.3-44-280-108-55.3-42-101.7-93-139-153l-9-14c-2.7 4-5.7 8.7-9 14
-53.3 86.7-123.7 153-211 199-66.7 36-137.3 56.3-212 62H0V214h199568c178.3-11.7
 311.7-78.3 403-201 6-8 9.7-12 11-12 .7-.7 6.7-1 18-1s17.3.3 18 1c1.3 0 5 4 11
 12 44.7 59.3 101.3 106.3 170 141s145.3 54.3 229 60h199572v120z`,midbraceunder:`M199572 214
c100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14
 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3
 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0
-5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z`,oiintSize1:`M512.6 71.6c272.6 0 320.3 106.8 320.3 178.2 0 70.8-47.7 177.6
-320.3 177.6S193.1 320.6 193.1 249.8c0-71.4 46.9-178.2 319.5-178.2z
m368.1 178.2c0-86.4-60.9-215.4-368.1-215.4-306.4 0-367.3 129-367.3 215.4 0 85.8
60.9 214.8 367.3 214.8 307.2 0 368.1-129 368.1-214.8z`,oiintSize2:`M757.8 100.1c384.7 0 451.1 137.6 451.1 230 0 91.3-66.4 228.8
-451.1 228.8-386.3 0-452.7-137.5-452.7-228.8 0-92.4 66.4-230 452.7-230z
m502.4 230c0-111.2-82.4-277.2-502.4-277.2s-504 166-504 277.2
c0 110 84 276 504 276s502.4-166 502.4-276z`,oiiintSize1:`M681.4 71.6c408.9 0 480.5 106.8 480.5 178.2 0 70.8-71.6 177.6
-480.5 177.6S202.1 320.6 202.1 249.8c0-71.4 70.5-178.2 479.3-178.2z
m525.8 178.2c0-86.4-86.8-215.4-525.7-215.4-437.9 0-524.7 129-524.7 215.4 0
85.8 86.8 214.8 524.7 214.8 438.9 0 525.7-129 525.7-214.8z`,oiiintSize2:`M1021.2 53c603.6 0 707.8 165.8 707.8 277.2 0 110-104.2 275.8
-707.8 275.8-606 0-710.2-165.8-710.2-275.8C311 218.8 415.2 53 1021.2 53z
m770.4 277.1c0-131.2-126.4-327.6-770.5-327.6S248.4 198.9 248.4 330.1
c0 130 128.8 326.4 772.7 326.4s770.5-196.4 770.5-326.4z`,rightarrow:`M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z`,rightbrace:`M400000 542l
-6 6h-17c-12.7 0-19.3-.3-20-1-4-4-7.3-8.3-10-13-35.3-51.3-80.8-93.8-136.5-127.5
s-117.2-55.8-184.5-66.5c-.7 0-2-.3-4-1-18.7-2.7-76-4.3-172-5H0V214h399571l6 1
c124.7 8 235 61.7 331 161 31.3 33.3 59.7 72.7 85 118l7 13v35z`,rightbraceunder:`M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3
 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237
-174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z`,rightgroup:`M0 80h399565c371 0 266.7 149.4 414 180 5.9 1.2 18 0 18 0 2 0
 3-1 3-3v-38c-76-158-257-219-435-219H0z`,rightgroupunder:`M0 262h399565c371 0 266.7-149.4 414-180 5.9-1.2 18 0 18
 0 2 0 3 1 3 3v38c-76 158-257 219-435 219H0z`,rightharpoon:`M0 241v40h399993c4.7-4.7 7-9.3 7-14 0-9.3
-3.7-15.3-11-18-92.7-56.7-159-133.7-199-231-3.3-9.3-6-14.7-8-16-2-1.3-7-2-15-2
-10.7 0-16.7 2-18 6-2 2.7-1 9.7 3 21 15.3 42 36.7 81.8 64 119.5 27.3 37.7 58
 69.2 92 94.5zm0 0v40h399900v-40z`,rightharpoonplus:`M0 241v40h399993c4.7-4.7 7-9.3 7-14 0-9.3-3.7-15.3-11
-18-92.7-56.7-159-133.7-199-231-3.3-9.3-6-14.7-8-16-2-1.3-7-2-15-2-10.7 0-16.7
 2-18 6-2 2.7-1 9.7 3 21 15.3 42 36.7 81.8 64 119.5 27.3 37.7 58 69.2 92 94.5z
m0 0v40h399900v-40z m100 194v40h399900v-40zm0 0v40h399900v-40z`,rightharpoondown:`M399747 511c0 7.3 6.7 11 20 11 8 0 13-.8 15-2.5s4.7-6.8
 8-15.5c40-94 99.3-166.3 178-217 13.3-8 20.3-12.3 21-13 5.3-3.3 8.5-5.8 9.5
-7.5 1-1.7 1.5-5.2 1.5-10.5s-2.3-10.3-7-15H0v40h399908c-34 25.3-64.7 57-92 95
-27.3 38-48.7 77.7-64 119-3.3 8.7-5 14-5 16zM0 241v40h399900v-40z`,rightharpoondownplus:`M399747 705c0 7.3 6.7 11 20 11 8 0 13-.8
 15-2.5s4.7-6.8 8-15.5c40-94 99.3-166.3 178-217 13.3-8 20.3-12.3 21-13 5.3-3.3
 8.5-5.8 9.5-7.5 1-1.7 1.5-5.2 1.5-10.5s-2.3-10.3-7-15H0v40h399908c-34 25.3
-64.7 57-92 95-27.3 38-48.7 77.7-64 119-3.3 8.7-5 14-5 16zM0 435v40h399900v-40z
m0-194v40h400000v-40zm0 0v40h400000v-40z`,righthook:`M399859 241c-764 0 0 0 0 0 40-3.3 68.7-15.7 86-37 10-12 15-25.3
 15-40 0-22.7-9.8-40.7-29.5-54-19.7-13.3-43.5-21-71.5-23-17.3-1.3-26-8-26-20 0
-13.3 8.7-20 26-20 38 0 71 11.2 99 33.5 0 0 7 5.6 21 16.7 14 11.2 21 33.5 21
 66.8s-14 61.2-42 83.5c-28 22.3-61 33.5-99 33.5L0 241z M0 281v-40h399859v40z`,rightlinesegment:`M399960 241 V94 h40 V428 h-40 V281 H0 v-40z
M399960 241 V94 h40 V428 h-40 V281 H0 v-40z`,rightToFrom:`M400000 167c-70.7-42-118-97.7-142-167h-23c-15.3 0-23 .3-23
 1 0 1.3 5.3 13.7 16 37 18 35.3 41.3 69 70 101l7 8H0v40h399905l-7 8c-28.7 32
-52 65.7-70 101-10.7 23.3-16 35.7-16 37 0 .7 7.7 1 23 1h23c24-69.3 71.3-125 142
-167z M100 147v40h399900v-40zM0 341v40h399900v-40z`,twoheadleftarrow:`M0 167c68 40
 115.7 95.7 143 167h22c15.3 0 23-.3 23-1 0-1.3-5.3-13.7-16-37-18-35.3-41.3-69
-70-101l-7-8h125l9 7c50.7 39.3 85 86 103 140h46c0-4.7-6.3-18.7-19-42-18-35.3
-40-67.3-66-96l-9-9h399716v-40H284l9-9c26-28.7 48-60.7 66-96 12.7-23.333 19
-37.333 19-42h-46c-18 54-52.3 100.7-103 140l-9 7H95l7-8c28.7-32 52-65.7 70-101
 10.7-23.333 16-35.7 16-37 0-.7-7.7-1-23-1h-22C115.7 71.3 68 127 0 167z`,twoheadrightarrow:`M400000 167
c-68-40-115.7-95.7-143-167h-22c-15.3 0-23 .3-23 1 0 1.3 5.3 13.7 16 37 18 35.3
 41.3 69 70 101l7 8h-125l-9-7c-50.7-39.3-85-86-103-140h-46c0 4.7 6.3 18.7 19 42
 18 35.3 40 67.3 66 96l9 9H0v40h399716l-9 9c-26 28.7-48 60.7-66 96-12.7 23.333
-19 37.333-19 42h46c18-54 52.3-100.7 103-140l9-7h125l-7 8c-28.7 32-52 65.7-70
 101-10.7 23.333-16 35.7-16 37 0 .7 7.7 1 23 1h22c27.3-71.3 75-127 143-167z`,tilde1:`M200 55.538c-77 0-168 73.953-177 73.953-3 0-7
-2.175-9-5.437L2 97c-1-2-2-4-2-6 0-4 2-7 5-9l20-12C116 12 171 0 207 0c86 0
 114 68 191 68 78 0 168-68 177-68 4 0 7 2 9 5l12 19c1 2.175 2 4.35 2 6.525 0
 4.35-2 7.613-5 9.788l-19 13.05c-92 63.077-116.937 75.308-183 76.128
-68.267.847-113-73.952-191-73.952z`,tilde2:`M344 55.266c-142 0-300.638 81.316-311.5 86.418
-8.01 3.762-22.5 10.91-23.5 5.562L1 120c-1-2-1-3-1-4 0-5 3-9 8-10l18.4-9C160.9
 31.9 283 0 358 0c148 0 188 122 331 122s314-97 326-97c4 0 8 2 10 7l7 21.114
c1 2.14 1 3.21 1 4.28 0 5.347-3 9.626-7 10.696l-22.3 12.622C852.6 158.372 751
 181.476 676 181.476c-149 0-189-126.21-332-126.21z`,tilde3:`M786 59C457 59 32 175.242 13 175.242c-6 0-10-3.457
-11-10.37L.15 138c-1-7 3-12 10-13l19.2-6.4C378.4 40.7 634.3 0 804.3 0c337 0
 411.8 157 746.8 157 328 0 754-112 773-112 5 0 10 3 11 9l1 14.075c1 8.066-.697
 16.595-6.697 17.492l-21.052 7.31c-367.9 98.146-609.15 122.696-778.15 122.696
 -338 0-409-156.573-744-156.573z`,tilde4:`M786 58C457 58 32 177.487 13 177.487c-6 0-10-3.345
-11-10.035L.15 143c-1-7 3-12 10-13l22-6.7C381.2 35 637.15 0 807.15 0c337 0 409
 177 744 177 328 0 754-127 773-127 5 0 10 3 11 9l1 14.794c1 7.805-3 13.38-9
 14.495l-20.7 5.574c-366.85 99.79-607.3 139.372-776.3 139.372-338 0-409
 -175.236-744-175.236z`,vec:`M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z`,widehat1:`M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z`,widehat2:`M1181 0h2l1171 176c6 0 10 5 10 11l-2 23c-1 6-5 10
-11 10h-1L1182 67 15 220h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z`,widehat3:`M1181 0h2l1171 236c6 0 10 5 10 11l-2 23c-1 6-5 10
-11 10h-1L1182 67 15 280h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z`,widehat4:`M1181 0h2l1171 296c6 0 10 5 10 11l-2 23c-1 6-5 10
-11 10h-1L1182 67 15 340h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z`,widecheck1:`M529,159h5l519,-115c5,-1,9,-5,9,-10c0,-1,-1,-2,-1,-3l-4,-22c-1,
-5,-5,-9,-11,-9h-2l-512,92l-513,-92h-2c-5,0,-9,4,-11,9l-5,22c-1,6,2,12,8,13z`,widecheck2:`M1181,220h2l1171,-176c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,
-11,-10h-1l-1168,153l-1167,-153h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z`,widecheck3:`M1181,280h2l1171,-236c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,
-11,-10h-1l-1168,213l-1167,-213h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z`,widecheck4:`M1181,340h2l1171,-296c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,
-11,-10h-1l-1168,273l-1167,-273h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z`,baraboveleftarrow:`M400000 620h-399890l3 -3c68.7 -52.7 113.7 -120 135 -202
c4 -14.7 6 -23 6 -25c0 -7.3 -7 -11 -21 -11c-8 0 -13.2 0.8 -15.5 2.5
c-2.3 1.7 -4.2 5.8 -5.5 12.5c-1.3 4.7 -2.7 10.3 -4 17c-12 48.7 -34.8 92 -68.5 130
s-74.2 66.3 -121.5 85c-10 4 -16 7.7 -18 11c0 8.7 6 14.3 18 17c47.3 18.7 87.8 47
121.5 85s56.5 81.3 68.5 130c0.7 2 1.3 5 2 9s1.2 6.7 1.5 8c0.3 1.3 1 3.3 2 6
s2.2 4.5 3.5 5.5c1.3 1 3.3 1.8 6 2.5s6 1 10 1c14 0 21 -3.7 21 -11
c0 -2 -2 -10.3 -6 -25c-20 -79.3 -65 -146.7 -135 -202l-3 -3h399890z
M100 620v40h399900v-40z M0 241v40h399900v-40zM0 241v40h399900v-40z`,rightarrowabovebar:`M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32
-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0
13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39
-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5
-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
151.7 139 205zm96 379h399894v40H0zm0 0h399904v40H0z`,baraboveshortleftharpoon:`M507,435c-4,4,-6.3,8.7,-7,14c0,5.3,0.7,9,2,11
c1.3,2,5.3,5.3,12,10c90.7,54,156,130,196,228c3.3,10.7,6.3,16.3,9,17
c2,0.7,5,1,9,1c0,0,5,0,5,0c10.7,0,16.7,-2,18,-6c2,-2.7,1,-9.7,-3,-21
c-32,-87.3,-82.7,-157.7,-152,-211c0,0,-3,-3,-3,-3l399351,0l0,-40
c-398570,0,-399437,0,-399437,0z M593 435 v40 H399500 v-40z
M0 281 v-40 H399908 v40z M0 281 v-40 H399908 v40z`,rightharpoonaboveshortbar:`M0,241 l0,40c399126,0,399993,0,399993,0
c4.7,-4.7,7,-9.3,7,-14c0,-9.3,-3.7,-15.3,-11,-18c-92.7,-56.7,-159,-133.7,-199,
-231c-3.3,-9.3,-6,-14.7,-8,-16c-2,-1.3,-7,-2,-15,-2c-10.7,0,-16.7,2,-18,6
c-2,2.7,-1,9.7,3,21c15.3,42,36.7,81.8,64,119.5c27.3,37.7,58,69.2,92,94.5z
M0 241 v40 H399908 v-40z M0 475 v-40 H399500 v40z M0 475 v-40 H399500 v40z`,shortbaraboveleftharpoon:`M7,435c-4,4,-6.3,8.7,-7,14c0,5.3,0.7,9,2,11
c1.3,2,5.3,5.3,12,10c90.7,54,156,130,196,228c3.3,10.7,6.3,16.3,9,17c2,0.7,5,1,9,
1c0,0,5,0,5,0c10.7,0,16.7,-2,18,-6c2,-2.7,1,-9.7,-3,-21c-32,-87.3,-82.7,-157.7,
-152,-211c0,0,-3,-3,-3,-3l399907,0l0,-40c-399126,0,-399993,0,-399993,0z
M93 435 v40 H400000 v-40z M500 241 v40 H400000 v-40z M500 241 v40 H400000 v-40z`,shortrightharpoonabovebar:`M53,241l0,40c398570,0,399437,0,399437,0
c4.7,-4.7,7,-9.3,7,-14c0,-9.3,-3.7,-15.3,-11,-18c-92.7,-56.7,-159,-133.7,-199,
-231c-3.3,-9.3,-6,-14.7,-8,-16c-2,-1.3,-7,-2,-15,-2c-10.7,0,-16.7,2,-18,6
c-2,2.7,-1,9.7,3,21c15.3,42,36.7,81.8,64,119.5c27.3,37.7,58,69.2,92,94.5z
M500 241 v40 H399408 v-40z M500 435 v40 H400000 v-40z`},tallDelim=function r(e,n){switch(e){case"lbrack":return"M403 1759 V84 H666 V0 H319 V1759 v"+n+` v1759 h347 v-84
H403z M403 1759 V0 H319 V1759 v`+n+" v1759 h84z";case"rbrack":return"M347 1759 V0 H0 V84 H263 V1759 v"+n+` v1759 H0 v84 H347z
M347 1759 V0 H263 V1759 v`+n+" v1759 h84z";case"vert":return"M145 15 v585 v"+n+` v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v`+-n+` v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v`+n+" v585 h43z";case"doublevert":return"M145 15 v585 v"+n+` v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v`+-n+` v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v`+n+` v585 h43z
M367 15 v585 v`+n+` v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v`+-n+` v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M410 15 H367 v585 v`+n+" v585 h43z";case"lfloor":return"M319 602 V0 H403 V602 v"+n+` v1715 h263 v84 H319z
MM319 602 V0 H403 V602 v`+n+" v1715 H319z";case"rfloor":return"M319 602 V0 H403 V602 v"+n+` v1799 H0 v-84 H319z
MM319 602 V0 H403 V602 v`+n+" v1715 H319z";case"lceil":return"M403 1759 V84 H666 V0 H319 V1759 v"+n+` v602 h84z
M403 1759 V0 H319 V1759 v`+n+" v602 h84z";case"rceil":return"M347 1759 V0 H0 V84 H263 V1759 v"+n+` v602 h84z
M347 1759 V0 h-84 V1759 v`+n+" v602 h84z";case"lparen":return`M863,9c0,-2,-2,-5,-6,-9c0,0,-17,0,-17,0c-12.7,0,-19.3,0.3,-20,1
c-5.3,5.3,-10.3,11,-15,17c-242.7,294.7,-395.3,682,-458,1162c-21.3,163.3,-33.3,349,
-36,557 l0,`+(n+84)+`c0.2,6,0,26,0,60c2,159.3,10,310.7,24,454c53.3,528,210,
949.7,470,1265c4.7,6,9.7,11.7,15,17c0.7,0.7,7,1,19,1c0,0,18,0,18,0c4,-4,6,-7,6,-9
c0,-2.7,-3.3,-8.7,-10,-18c-135.3,-192.7,-235.5,-414.3,-300.5,-665c-65,-250.7,-102.5,
-544.7,-112.5,-882c-2,-104,-3,-167,-3,-189
l0,-`+(n+92)+`c0,-162.7,5.7,-314,17,-454c20.7,-272,63.7,-513,129,-723c65.3,
-210,155.3,-396.3,270,-559c6.7,-9.3,10,-15.3,10,-18z`;case"rparen":return`M76,0c-16.7,0,-25,3,-25,9c0,2,2,6.3,6,13c21.3,28.7,42.3,60.3,
63,95c96.7,156.7,172.8,332.5,228.5,527.5c55.7,195,92.8,416.5,111.5,664.5
c11.3,139.3,17,290.7,17,454c0,28,1.7,43,3.3,45l0,`+(n+9)+`
c-3,4,-3.3,16.7,-3.3,38c0,162,-5.7,313.7,-17,455c-18.7,248,-55.8,469.3,-111.5,664
c-55.7,194.7,-131.8,370.3,-228.5,527c-20.7,34.7,-41.7,66.3,-63,95c-2,3.3,-4,7,-6,11
c0,7.3,5.7,11,17,11c0,0,11,0,11,0c9.3,0,14.3,-0.3,15,-1c5.3,-5.3,10.3,-11,15,-17
c242.7,-294.7,395.3,-681.7,458,-1161c21.3,-164.7,33.3,-350.7,36,-558
l0,-`+(n+144)+`c-2,-159.3,-10,-310.7,-24,-454c-53.3,-528,-210,-949.7,
-470,-1265c-4.7,-6,-9.7,-11.7,-15,-17c-0.7,-0.7,-6.7,-1,-18,-1z`;default:throw new Error("Unknown stretchy delimiter.")}};class DocumentFragment{constructor(e){this.children=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,this.children=e,this.classes=[],this.height=0,this.depth=0,this.maxFontSize=0,this.style={}}hasClass(e){return utils.contains(this.classes,e)}toNode(){for(var e=document.createDocumentFragment(),n=0;n<this.children.length;n++)e.appendChild(this.children[n].toNode());return e}toMarkup(){for(var e="",n=0;n<this.children.length;n++)e+=this.children[n].toMarkup();return e}toText(){var e=n=>n.toText();return this.children.map(e).join("")}}var fontMetricsData={"AMS-Regular":{32:[0,0,0,0,.25],65:[0,.68889,0,0,.72222],66:[0,.68889,0,0,.66667],67:[0,.68889,0,0,.72222],68:[0,.68889,0,0,.72222],69:[0,.68889,0,0,.66667],70:[0,.68889,0,0,.61111],71:[0,.68889,0,0,.77778],72:[0,.68889,0,0,.77778],73:[0,.68889,0,0,.38889],74:[.16667,.68889,0,0,.5],75:[0,.68889,0,0,.77778],76:[0,.68889,0,0,.66667],77:[0,.68889,0,0,.94445],78:[0,.68889,0,0,.72222],79:[.16667,.68889,0,0,.77778],80:[0,.68889,0,0,.61111],81:[.16667,.68889,0,0,.77778],82:[0,.68889,0,0,.72222],83:[0,.68889,0,0,.55556],84:[0,.68889,0,0,.66667],85:[0,.68889,0,0,.72222],86:[0,.68889,0,0,.72222],87:[0,.68889,0,0,1],88:[0,.68889,0,0,.72222],89:[0,.68889,0,0,.72222],90:[0,.68889,0,0,.66667],107:[0,.68889,0,0,.55556],160:[0,0,0,0,.25],165:[0,.675,.025,0,.75],174:[.15559,.69224,0,0,.94666],240:[0,.68889,0,0,.55556],295:[0,.68889,0,0,.54028],710:[0,.825,0,0,2.33334],732:[0,.9,0,0,2.33334],770:[0,.825,0,0,2.33334],771:[0,.9,0,0,2.33334],989:[.08167,.58167,0,0,.77778],1008:[0,.43056,.04028,0,.66667],8245:[0,.54986,0,0,.275],8463:[0,.68889,0,0,.54028],8487:[0,.68889,0,0,.72222],8498:[0,.68889,0,0,.55556],8502:[0,.68889,0,0,.66667],8503:[0,.68889,0,0,.44445],8504:[0,.68889,0,0,.66667],8513:[0,.68889,0,0,.63889],8592:[-.03598,.46402,0,0,.5],8594:[-.03598,.46402,0,0,.5],8602:[-.13313,.36687,0,0,1],8603:[-.13313,.36687,0,0,1],8606:[.01354,.52239,0,0,1],8608:[.01354,.52239,0,0,1],8610:[.01354,.52239,0,0,1.11111],8611:[.01354,.52239,0,0,1.11111],8619:[0,.54986,0,0,1],8620:[0,.54986,0,0,1],8621:[-.13313,.37788,0,0,1.38889],8622:[-.13313,.36687,0,0,1],8624:[0,.69224,0,0,.5],8625:[0,.69224,0,0,.5],8630:[0,.43056,0,0,1],8631:[0,.43056,0,0,1],8634:[.08198,.58198,0,0,.77778],8635:[.08198,.58198,0,0,.77778],8638:[.19444,.69224,0,0,.41667],8639:[.19444,.69224,0,0,.41667],8642:[.19444,.69224,0,0,.41667],8643:[.19444,.69224,0,0,.41667],8644:[.1808,.675,0,0,1],8646:[.1808,.675,0,0,1],8647:[.1808,.675,0,0,1],8648:[.19444,.69224,0,0,.83334],8649:[.1808,.675,0,0,1],8650:[.19444,.69224,0,0,.83334],8651:[.01354,.52239,0,0,1],8652:[.01354,.52239,0,0,1],8653:[-.13313,.36687,0,0,1],8654:[-.13313,.36687,0,0,1],8655:[-.13313,.36687,0,0,1],8666:[.13667,.63667,0,0,1],8667:[.13667,.63667,0,0,1],8669:[-.13313,.37788,0,0,1],8672:[-.064,.437,0,0,1.334],8674:[-.064,.437,0,0,1.334],8705:[0,.825,0,0,.5],8708:[0,.68889,0,0,.55556],8709:[.08167,.58167,0,0,.77778],8717:[0,.43056,0,0,.42917],8722:[-.03598,.46402,0,0,.5],8724:[.08198,.69224,0,0,.77778],8726:[.08167,.58167,0,0,.77778],8733:[0,.69224,0,0,.77778],8736:[0,.69224,0,0,.72222],8737:[0,.69224,0,0,.72222],8738:[.03517,.52239,0,0,.72222],8739:[.08167,.58167,0,0,.22222],8740:[.25142,.74111,0,0,.27778],8741:[.08167,.58167,0,0,.38889],8742:[.25142,.74111,0,0,.5],8756:[0,.69224,0,0,.66667],8757:[0,.69224,0,0,.66667],8764:[-.13313,.36687,0,0,.77778],8765:[-.13313,.37788,0,0,.77778],8769:[-.13313,.36687,0,0,.77778],8770:[-.03625,.46375,0,0,.77778],8774:[.30274,.79383,0,0,.77778],8776:[-.01688,.48312,0,0,.77778],8778:[.08167,.58167,0,0,.77778],8782:[.06062,.54986,0,0,.77778],8783:[.06062,.54986,0,0,.77778],8785:[.08198,.58198,0,0,.77778],8786:[.08198,.58198,0,0,.77778],8787:[.08198,.58198,0,0,.77778],8790:[0,.69224,0,0,.77778],8791:[.22958,.72958,0,0,.77778],8796:[.08198,.91667,0,0,.77778],8806:[.25583,.75583,0,0,.77778],8807:[.25583,.75583,0,0,.77778],8808:[.25142,.75726,0,0,.77778],8809:[.25142,.75726,0,0,.77778],8812:[.25583,.75583,0,0,.5],8814:[.20576,.70576,0,0,.77778],8815:[.20576,.70576,0,0,.77778],8816:[.30274,.79383,0,0,.77778],8817:[.30274,.79383,0,0,.77778],8818:[.22958,.72958,0,0,.77778],8819:[.22958,.72958,0,0,.77778],8822:[.1808,.675,0,0,.77778],8823:[.1808,.675,0,0,.77778],8828:[.13667,.63667,0,0,.77778],8829:[.13667,.63667,0,0,.77778],8830:[.22958,.72958,0,0,.77778],8831:[.22958,.72958,0,0,.77778],8832:[.20576,.70576,0,0,.77778],8833:[.20576,.70576,0,0,.77778],8840:[.30274,.79383,0,0,.77778],8841:[.30274,.79383,0,0,.77778],8842:[.13597,.63597,0,0,.77778],8843:[.13597,.63597,0,0,.77778],8847:[.03517,.54986,0,0,.77778],8848:[.03517,.54986,0,0,.77778],8858:[.08198,.58198,0,0,.77778],8859:[.08198,.58198,0,0,.77778],8861:[.08198,.58198,0,0,.77778],8862:[0,.675,0,0,.77778],8863:[0,.675,0,0,.77778],8864:[0,.675,0,0,.77778],8865:[0,.675,0,0,.77778],8872:[0,.69224,0,0,.61111],8873:[0,.69224,0,0,.72222],8874:[0,.69224,0,0,.88889],8876:[0,.68889,0,0,.61111],8877:[0,.68889,0,0,.61111],8878:[0,.68889,0,0,.72222],8879:[0,.68889,0,0,.72222],8882:[.03517,.54986,0,0,.77778],8883:[.03517,.54986,0,0,.77778],8884:[.13667,.63667,0,0,.77778],8885:[.13667,.63667,0,0,.77778],8888:[0,.54986,0,0,1.11111],8890:[.19444,.43056,0,0,.55556],8891:[.19444,.69224,0,0,.61111],8892:[.19444,.69224,0,0,.61111],8901:[0,.54986,0,0,.27778],8903:[.08167,.58167,0,0,.77778],8905:[.08167,.58167,0,0,.77778],8906:[.08167,.58167,0,0,.77778],8907:[0,.69224,0,0,.77778],8908:[0,.69224,0,0,.77778],8909:[-.03598,.46402,0,0,.77778],8910:[0,.54986,0,0,.76042],8911:[0,.54986,0,0,.76042],8912:[.03517,.54986,0,0,.77778],8913:[.03517,.54986,0,0,.77778],8914:[0,.54986,0,0,.66667],8915:[0,.54986,0,0,.66667],8916:[0,.69224,0,0,.66667],8918:[.0391,.5391,0,0,.77778],8919:[.0391,.5391,0,0,.77778],8920:[.03517,.54986,0,0,1.33334],8921:[.03517,.54986,0,0,1.33334],8922:[.38569,.88569,0,0,.77778],8923:[.38569,.88569,0,0,.77778],8926:[.13667,.63667,0,0,.77778],8927:[.13667,.63667,0,0,.77778],8928:[.30274,.79383,0,0,.77778],8929:[.30274,.79383,0,0,.77778],8934:[.23222,.74111,0,0,.77778],8935:[.23222,.74111,0,0,.77778],8936:[.23222,.74111,0,0,.77778],8937:[.23222,.74111,0,0,.77778],8938:[.20576,.70576,0,0,.77778],8939:[.20576,.70576,0,0,.77778],8940:[.30274,.79383,0,0,.77778],8941:[.30274,.79383,0,0,.77778],8994:[.19444,.69224,0,0,.77778],8995:[.19444,.69224,0,0,.77778],9416:[.15559,.69224,0,0,.90222],9484:[0,.69224,0,0,.5],9488:[0,.69224,0,0,.5],9492:[0,.37788,0,0,.5],9496:[0,.37788,0,0,.5],9585:[.19444,.68889,0,0,.88889],9586:[.19444,.74111,0,0,.88889],9632:[0,.675,0,0,.77778],9633:[0,.675,0,0,.77778],9650:[0,.54986,0,0,.72222],9651:[0,.54986,0,0,.72222],9654:[.03517,.54986,0,0,.77778],9660:[0,.54986,0,0,.72222],9661:[0,.54986,0,0,.72222],9664:[.03517,.54986,0,0,.77778],9674:[.11111,.69224,0,0,.66667],9733:[.19444,.69224,0,0,.94445],10003:[0,.69224,0,0,.83334],10016:[0,.69224,0,0,.83334],10731:[.11111,.69224,0,0,.66667],10846:[.19444,.75583,0,0,.61111],10877:[.13667,.63667,0,0,.77778],10878:[.13667,.63667,0,0,.77778],10885:[.25583,.75583,0,0,.77778],10886:[.25583,.75583,0,0,.77778],10887:[.13597,.63597,0,0,.77778],10888:[.13597,.63597,0,0,.77778],10889:[.26167,.75726,0,0,.77778],10890:[.26167,.75726,0,0,.77778],10891:[.48256,.98256,0,0,.77778],10892:[.48256,.98256,0,0,.77778],10901:[.13667,.63667,0,0,.77778],10902:[.13667,.63667,0,0,.77778],10933:[.25142,.75726,0,0,.77778],10934:[.25142,.75726,0,0,.77778],10935:[.26167,.75726,0,0,.77778],10936:[.26167,.75726,0,0,.77778],10937:[.26167,.75726,0,0,.77778],10938:[.26167,.75726,0,0,.77778],10949:[.25583,.75583,0,0,.77778],10950:[.25583,.75583,0,0,.77778],10955:[.28481,.79383,0,0,.77778],10956:[.28481,.79383,0,0,.77778],57350:[.08167,.58167,0,0,.22222],57351:[.08167,.58167,0,0,.38889],57352:[.08167,.58167,0,0,.77778],57353:[0,.43056,.04028,0,.66667],57356:[.25142,.75726,0,0,.77778],57357:[.25142,.75726,0,0,.77778],57358:[.41951,.91951,0,0,.77778],57359:[.30274,.79383,0,0,.77778],57360:[.30274,.79383,0,0,.77778],57361:[.41951,.91951,0,0,.77778],57366:[.25142,.75726,0,0,.77778],57367:[.25142,.75726,0,0,.77778],57368:[.25142,.75726,0,0,.77778],57369:[.25142,.75726,0,0,.77778],57370:[.13597,.63597,0,0,.77778],57371:[.13597,.63597,0,0,.77778]},"Caligraphic-Regular":{32:[0,0,0,0,.25],65:[0,.68333,0,.19445,.79847],66:[0,.68333,.03041,.13889,.65681],67:[0,.68333,.05834,.13889,.52653],68:[0,.68333,.02778,.08334,.77139],69:[0,.68333,.08944,.11111,.52778],70:[0,.68333,.09931,.11111,.71875],71:[.09722,.68333,.0593,.11111,.59487],72:[0,.68333,.00965,.11111,.84452],73:[0,.68333,.07382,0,.54452],74:[.09722,.68333,.18472,.16667,.67778],75:[0,.68333,.01445,.05556,.76195],76:[0,.68333,0,.13889,.68972],77:[0,.68333,0,.13889,1.2009],78:[0,.68333,.14736,.08334,.82049],79:[0,.68333,.02778,.11111,.79611],80:[0,.68333,.08222,.08334,.69556],81:[.09722,.68333,0,.11111,.81667],82:[0,.68333,0,.08334,.8475],83:[0,.68333,.075,.13889,.60556],84:[0,.68333,.25417,0,.54464],85:[0,.68333,.09931,.08334,.62583],86:[0,.68333,.08222,0,.61278],87:[0,.68333,.08222,.08334,.98778],88:[0,.68333,.14643,.13889,.7133],89:[.09722,.68333,.08222,.08334,.66834],90:[0,.68333,.07944,.13889,.72473],160:[0,0,0,0,.25]},"Fraktur-Regular":{32:[0,0,0,0,.25],33:[0,.69141,0,0,.29574],34:[0,.69141,0,0,.21471],38:[0,.69141,0,0,.73786],39:[0,.69141,0,0,.21201],40:[.24982,.74947,0,0,.38865],41:[.24982,.74947,0,0,.38865],42:[0,.62119,0,0,.27764],43:[.08319,.58283,0,0,.75623],44:[0,.10803,0,0,.27764],45:[.08319,.58283,0,0,.75623],46:[0,.10803,0,0,.27764],47:[.24982,.74947,0,0,.50181],48:[0,.47534,0,0,.50181],49:[0,.47534,0,0,.50181],50:[0,.47534,0,0,.50181],51:[.18906,.47534,0,0,.50181],52:[.18906,.47534,0,0,.50181],53:[.18906,.47534,0,0,.50181],54:[0,.69141,0,0,.50181],55:[.18906,.47534,0,0,.50181],56:[0,.69141,0,0,.50181],57:[.18906,.47534,0,0,.50181],58:[0,.47534,0,0,.21606],59:[.12604,.47534,0,0,.21606],61:[-.13099,.36866,0,0,.75623],63:[0,.69141,0,0,.36245],65:[0,.69141,0,0,.7176],66:[0,.69141,0,0,.88397],67:[0,.69141,0,0,.61254],68:[0,.69141,0,0,.83158],69:[0,.69141,0,0,.66278],70:[.12604,.69141,0,0,.61119],71:[0,.69141,0,0,.78539],72:[.06302,.69141,0,0,.7203],73:[0,.69141,0,0,.55448],74:[.12604,.69141,0,0,.55231],75:[0,.69141,0,0,.66845],76:[0,.69141,0,0,.66602],77:[0,.69141,0,0,1.04953],78:[0,.69141,0,0,.83212],79:[0,.69141,0,0,.82699],80:[.18906,.69141,0,0,.82753],81:[.03781,.69141,0,0,.82699],82:[0,.69141,0,0,.82807],83:[0,.69141,0,0,.82861],84:[0,.69141,0,0,.66899],85:[0,.69141,0,0,.64576],86:[0,.69141,0,0,.83131],87:[0,.69141,0,0,1.04602],88:[0,.69141,0,0,.71922],89:[.18906,.69141,0,0,.83293],90:[.12604,.69141,0,0,.60201],91:[.24982,.74947,0,0,.27764],93:[.24982,.74947,0,0,.27764],94:[0,.69141,0,0,.49965],97:[0,.47534,0,0,.50046],98:[0,.69141,0,0,.51315],99:[0,.47534,0,0,.38946],100:[0,.62119,0,0,.49857],101:[0,.47534,0,0,.40053],102:[.18906,.69141,0,0,.32626],103:[.18906,.47534,0,0,.5037],104:[.18906,.69141,0,0,.52126],105:[0,.69141,0,0,.27899],106:[0,.69141,0,0,.28088],107:[0,.69141,0,0,.38946],108:[0,.69141,0,0,.27953],109:[0,.47534,0,0,.76676],110:[0,.47534,0,0,.52666],111:[0,.47534,0,0,.48885],112:[.18906,.52396,0,0,.50046],113:[.18906,.47534,0,0,.48912],114:[0,.47534,0,0,.38919],115:[0,.47534,0,0,.44266],116:[0,.62119,0,0,.33301],117:[0,.47534,0,0,.5172],118:[0,.52396,0,0,.5118],119:[0,.52396,0,0,.77351],120:[.18906,.47534,0,0,.38865],121:[.18906,.47534,0,0,.49884],122:[.18906,.47534,0,0,.39054],160:[0,0,0,0,.25],8216:[0,.69141,0,0,.21471],8217:[0,.69141,0,0,.21471],58112:[0,.62119,0,0,.49749],58113:[0,.62119,0,0,.4983],58114:[.18906,.69141,0,0,.33328],58115:[.18906,.69141,0,0,.32923],58116:[.18906,.47534,0,0,.50343],58117:[0,.69141,0,0,.33301],58118:[0,.62119,0,0,.33409],58119:[0,.47534,0,0,.50073]},"Main-Bold":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.35],34:[0,.69444,0,0,.60278],35:[.19444,.69444,0,0,.95833],36:[.05556,.75,0,0,.575],37:[.05556,.75,0,0,.95833],38:[0,.69444,0,0,.89444],39:[0,.69444,0,0,.31944],40:[.25,.75,0,0,.44722],41:[.25,.75,0,0,.44722],42:[0,.75,0,0,.575],43:[.13333,.63333,0,0,.89444],44:[.19444,.15556,0,0,.31944],45:[0,.44444,0,0,.38333],46:[0,.15556,0,0,.31944],47:[.25,.75,0,0,.575],48:[0,.64444,0,0,.575],49:[0,.64444,0,0,.575],50:[0,.64444,0,0,.575],51:[0,.64444,0,0,.575],52:[0,.64444,0,0,.575],53:[0,.64444,0,0,.575],54:[0,.64444,0,0,.575],55:[0,.64444,0,0,.575],56:[0,.64444,0,0,.575],57:[0,.64444,0,0,.575],58:[0,.44444,0,0,.31944],59:[.19444,.44444,0,0,.31944],60:[.08556,.58556,0,0,.89444],61:[-.10889,.39111,0,0,.89444],62:[.08556,.58556,0,0,.89444],63:[0,.69444,0,0,.54305],64:[0,.69444,0,0,.89444],65:[0,.68611,0,0,.86944],66:[0,.68611,0,0,.81805],67:[0,.68611,0,0,.83055],68:[0,.68611,0,0,.88194],69:[0,.68611,0,0,.75555],70:[0,.68611,0,0,.72361],71:[0,.68611,0,0,.90416],72:[0,.68611,0,0,.9],73:[0,.68611,0,0,.43611],74:[0,.68611,0,0,.59444],75:[0,.68611,0,0,.90138],76:[0,.68611,0,0,.69166],77:[0,.68611,0,0,1.09166],78:[0,.68611,0,0,.9],79:[0,.68611,0,0,.86388],80:[0,.68611,0,0,.78611],81:[.19444,.68611,0,0,.86388],82:[0,.68611,0,0,.8625],83:[0,.68611,0,0,.63889],84:[0,.68611,0,0,.8],85:[0,.68611,0,0,.88472],86:[0,.68611,.01597,0,.86944],87:[0,.68611,.01597,0,1.18888],88:[0,.68611,0,0,.86944],89:[0,.68611,.02875,0,.86944],90:[0,.68611,0,0,.70277],91:[.25,.75,0,0,.31944],92:[.25,.75,0,0,.575],93:[.25,.75,0,0,.31944],94:[0,.69444,0,0,.575],95:[.31,.13444,.03194,0,.575],97:[0,.44444,0,0,.55902],98:[0,.69444,0,0,.63889],99:[0,.44444,0,0,.51111],100:[0,.69444,0,0,.63889],101:[0,.44444,0,0,.52708],102:[0,.69444,.10903,0,.35139],103:[.19444,.44444,.01597,0,.575],104:[0,.69444,0,0,.63889],105:[0,.69444,0,0,.31944],106:[.19444,.69444,0,0,.35139],107:[0,.69444,0,0,.60694],108:[0,.69444,0,0,.31944],109:[0,.44444,0,0,.95833],110:[0,.44444,0,0,.63889],111:[0,.44444,0,0,.575],112:[.19444,.44444,0,0,.63889],113:[.19444,.44444,0,0,.60694],114:[0,.44444,0,0,.47361],115:[0,.44444,0,0,.45361],116:[0,.63492,0,0,.44722],117:[0,.44444,0,0,.63889],118:[0,.44444,.01597,0,.60694],119:[0,.44444,.01597,0,.83055],120:[0,.44444,0,0,.60694],121:[.19444,.44444,.01597,0,.60694],122:[0,.44444,0,0,.51111],123:[.25,.75,0,0,.575],124:[.25,.75,0,0,.31944],125:[.25,.75,0,0,.575],126:[.35,.34444,0,0,.575],160:[0,0,0,0,.25],163:[0,.69444,0,0,.86853],168:[0,.69444,0,0,.575],172:[0,.44444,0,0,.76666],176:[0,.69444,0,0,.86944],177:[.13333,.63333,0,0,.89444],184:[.17014,0,0,0,.51111],198:[0,.68611,0,0,1.04166],215:[.13333,.63333,0,0,.89444],216:[.04861,.73472,0,0,.89444],223:[0,.69444,0,0,.59722],230:[0,.44444,0,0,.83055],247:[.13333,.63333,0,0,.89444],248:[.09722,.54167,0,0,.575],305:[0,.44444,0,0,.31944],338:[0,.68611,0,0,1.16944],339:[0,.44444,0,0,.89444],567:[.19444,.44444,0,0,.35139],710:[0,.69444,0,0,.575],711:[0,.63194,0,0,.575],713:[0,.59611,0,0,.575],714:[0,.69444,0,0,.575],715:[0,.69444,0,0,.575],728:[0,.69444,0,0,.575],729:[0,.69444,0,0,.31944],730:[0,.69444,0,0,.86944],732:[0,.69444,0,0,.575],733:[0,.69444,0,0,.575],915:[0,.68611,0,0,.69166],916:[0,.68611,0,0,.95833],920:[0,.68611,0,0,.89444],923:[0,.68611,0,0,.80555],926:[0,.68611,0,0,.76666],928:[0,.68611,0,0,.9],931:[0,.68611,0,0,.83055],933:[0,.68611,0,0,.89444],934:[0,.68611,0,0,.83055],936:[0,.68611,0,0,.89444],937:[0,.68611,0,0,.83055],8211:[0,.44444,.03194,0,.575],8212:[0,.44444,.03194,0,1.14999],8216:[0,.69444,0,0,.31944],8217:[0,.69444,0,0,.31944],8220:[0,.69444,0,0,.60278],8221:[0,.69444,0,0,.60278],8224:[.19444,.69444,0,0,.51111],8225:[.19444,.69444,0,0,.51111],8242:[0,.55556,0,0,.34444],8407:[0,.72444,.15486,0,.575],8463:[0,.69444,0,0,.66759],8465:[0,.69444,0,0,.83055],8467:[0,.69444,0,0,.47361],8472:[.19444,.44444,0,0,.74027],8476:[0,.69444,0,0,.83055],8501:[0,.69444,0,0,.70277],8592:[-.10889,.39111,0,0,1.14999],8593:[.19444,.69444,0,0,.575],8594:[-.10889,.39111,0,0,1.14999],8595:[.19444,.69444,0,0,.575],8596:[-.10889,.39111,0,0,1.14999],8597:[.25,.75,0,0,.575],8598:[.19444,.69444,0,0,1.14999],8599:[.19444,.69444,0,0,1.14999],8600:[.19444,.69444,0,0,1.14999],8601:[.19444,.69444,0,0,1.14999],8636:[-.10889,.39111,0,0,1.14999],8637:[-.10889,.39111,0,0,1.14999],8640:[-.10889,.39111,0,0,1.14999],8641:[-.10889,.39111,0,0,1.14999],8656:[-.10889,.39111,0,0,1.14999],8657:[.19444,.69444,0,0,.70277],8658:[-.10889,.39111,0,0,1.14999],8659:[.19444,.69444,0,0,.70277],8660:[-.10889,.39111,0,0,1.14999],8661:[.25,.75,0,0,.70277],8704:[0,.69444,0,0,.63889],8706:[0,.69444,.06389,0,.62847],8707:[0,.69444,0,0,.63889],8709:[.05556,.75,0,0,.575],8711:[0,.68611,0,0,.95833],8712:[.08556,.58556,0,0,.76666],8715:[.08556,.58556,0,0,.76666],8722:[.13333,.63333,0,0,.89444],8723:[.13333,.63333,0,0,.89444],8725:[.25,.75,0,0,.575],8726:[.25,.75,0,0,.575],8727:[-.02778,.47222,0,0,.575],8728:[-.02639,.47361,0,0,.575],8729:[-.02639,.47361,0,0,.575],8730:[.18,.82,0,0,.95833],8733:[0,.44444,0,0,.89444],8734:[0,.44444,0,0,1.14999],8736:[0,.69224,0,0,.72222],8739:[.25,.75,0,0,.31944],8741:[.25,.75,0,0,.575],8743:[0,.55556,0,0,.76666],8744:[0,.55556,0,0,.76666],8745:[0,.55556,0,0,.76666],8746:[0,.55556,0,0,.76666],8747:[.19444,.69444,.12778,0,.56875],8764:[-.10889,.39111,0,0,.89444],8768:[.19444,.69444,0,0,.31944],8771:[.00222,.50222,0,0,.89444],8773:[.027,.638,0,0,.894],8776:[.02444,.52444,0,0,.89444],8781:[.00222,.50222,0,0,.89444],8801:[.00222,.50222,0,0,.89444],8804:[.19667,.69667,0,0,.89444],8805:[.19667,.69667,0,0,.89444],8810:[.08556,.58556,0,0,1.14999],8811:[.08556,.58556,0,0,1.14999],8826:[.08556,.58556,0,0,.89444],8827:[.08556,.58556,0,0,.89444],8834:[.08556,.58556,0,0,.89444],8835:[.08556,.58556,0,0,.89444],8838:[.19667,.69667,0,0,.89444],8839:[.19667,.69667,0,0,.89444],8846:[0,.55556,0,0,.76666],8849:[.19667,.69667,0,0,.89444],8850:[.19667,.69667,0,0,.89444],8851:[0,.55556,0,0,.76666],8852:[0,.55556,0,0,.76666],8853:[.13333,.63333,0,0,.89444],8854:[.13333,.63333,0,0,.89444],8855:[.13333,.63333,0,0,.89444],8856:[.13333,.63333,0,0,.89444],8857:[.13333,.63333,0,0,.89444],8866:[0,.69444,0,0,.70277],8867:[0,.69444,0,0,.70277],8868:[0,.69444,0,0,.89444],8869:[0,.69444,0,0,.89444],8900:[-.02639,.47361,0,0,.575],8901:[-.02639,.47361,0,0,.31944],8902:[-.02778,.47222,0,0,.575],8968:[.25,.75,0,0,.51111],8969:[.25,.75,0,0,.51111],8970:[.25,.75,0,0,.51111],8971:[.25,.75,0,0,.51111],8994:[-.13889,.36111,0,0,1.14999],8995:[-.13889,.36111,0,0,1.14999],9651:[.19444,.69444,0,0,1.02222],9657:[-.02778,.47222,0,0,.575],9661:[.19444,.69444,0,0,1.02222],9667:[-.02778,.47222,0,0,.575],9711:[.19444,.69444,0,0,1.14999],9824:[.12963,.69444,0,0,.89444],9825:[.12963,.69444,0,0,.89444],9826:[.12963,.69444,0,0,.89444],9827:[.12963,.69444,0,0,.89444],9837:[0,.75,0,0,.44722],9838:[.19444,.69444,0,0,.44722],9839:[.19444,.69444,0,0,.44722],10216:[.25,.75,0,0,.44722],10217:[.25,.75,0,0,.44722],10815:[0,.68611,0,0,.9],10927:[.19667,.69667,0,0,.89444],10928:[.19667,.69667,0,0,.89444],57376:[.19444,.69444,0,0,0]},"Main-BoldItalic":{32:[0,0,0,0,.25],33:[0,.69444,.11417,0,.38611],34:[0,.69444,.07939,0,.62055],35:[.19444,.69444,.06833,0,.94444],37:[.05556,.75,.12861,0,.94444],38:[0,.69444,.08528,0,.88555],39:[0,.69444,.12945,0,.35555],40:[.25,.75,.15806,0,.47333],41:[.25,.75,.03306,0,.47333],42:[0,.75,.14333,0,.59111],43:[.10333,.60333,.03306,0,.88555],44:[.19444,.14722,0,0,.35555],45:[0,.44444,.02611,0,.41444],46:[0,.14722,0,0,.35555],47:[.25,.75,.15806,0,.59111],48:[0,.64444,.13167,0,.59111],49:[0,.64444,.13167,0,.59111],50:[0,.64444,.13167,0,.59111],51:[0,.64444,.13167,0,.59111],52:[.19444,.64444,.13167,0,.59111],53:[0,.64444,.13167,0,.59111],54:[0,.64444,.13167,0,.59111],55:[.19444,.64444,.13167,0,.59111],56:[0,.64444,.13167,0,.59111],57:[0,.64444,.13167,0,.59111],58:[0,.44444,.06695,0,.35555],59:[.19444,.44444,.06695,0,.35555],61:[-.10889,.39111,.06833,0,.88555],63:[0,.69444,.11472,0,.59111],64:[0,.69444,.09208,0,.88555],65:[0,.68611,0,0,.86555],66:[0,.68611,.0992,0,.81666],67:[0,.68611,.14208,0,.82666],68:[0,.68611,.09062,0,.87555],69:[0,.68611,.11431,0,.75666],70:[0,.68611,.12903,0,.72722],71:[0,.68611,.07347,0,.89527],72:[0,.68611,.17208,0,.8961],73:[0,.68611,.15681,0,.47166],74:[0,.68611,.145,0,.61055],75:[0,.68611,.14208,0,.89499],76:[0,.68611,0,0,.69777],77:[0,.68611,.17208,0,1.07277],78:[0,.68611,.17208,0,.8961],79:[0,.68611,.09062,0,.85499],80:[0,.68611,.0992,0,.78721],81:[.19444,.68611,.09062,0,.85499],82:[0,.68611,.02559,0,.85944],83:[0,.68611,.11264,0,.64999],84:[0,.68611,.12903,0,.7961],85:[0,.68611,.17208,0,.88083],86:[0,.68611,.18625,0,.86555],87:[0,.68611,.18625,0,1.15999],88:[0,.68611,.15681,0,.86555],89:[0,.68611,.19803,0,.86555],90:[0,.68611,.14208,0,.70888],91:[.25,.75,.1875,0,.35611],93:[.25,.75,.09972,0,.35611],94:[0,.69444,.06709,0,.59111],95:[.31,.13444,.09811,0,.59111],97:[0,.44444,.09426,0,.59111],98:[0,.69444,.07861,0,.53222],99:[0,.44444,.05222,0,.53222],100:[0,.69444,.10861,0,.59111],101:[0,.44444,.085,0,.53222],102:[.19444,.69444,.21778,0,.4],103:[.19444,.44444,.105,0,.53222],104:[0,.69444,.09426,0,.59111],105:[0,.69326,.11387,0,.35555],106:[.19444,.69326,.1672,0,.35555],107:[0,.69444,.11111,0,.53222],108:[0,.69444,.10861,0,.29666],109:[0,.44444,.09426,0,.94444],110:[0,.44444,.09426,0,.64999],111:[0,.44444,.07861,0,.59111],112:[.19444,.44444,.07861,0,.59111],113:[.19444,.44444,.105,0,.53222],114:[0,.44444,.11111,0,.50167],115:[0,.44444,.08167,0,.48694],116:[0,.63492,.09639,0,.385],117:[0,.44444,.09426,0,.62055],118:[0,.44444,.11111,0,.53222],119:[0,.44444,.11111,0,.76777],120:[0,.44444,.12583,0,.56055],121:[.19444,.44444,.105,0,.56166],122:[0,.44444,.13889,0,.49055],126:[.35,.34444,.11472,0,.59111],160:[0,0,0,0,.25],168:[0,.69444,.11473,0,.59111],176:[0,.69444,0,0,.94888],184:[.17014,0,0,0,.53222],198:[0,.68611,.11431,0,1.02277],216:[.04861,.73472,.09062,0,.88555],223:[.19444,.69444,.09736,0,.665],230:[0,.44444,.085,0,.82666],248:[.09722,.54167,.09458,0,.59111],305:[0,.44444,.09426,0,.35555],338:[0,.68611,.11431,0,1.14054],339:[0,.44444,.085,0,.82666],567:[.19444,.44444,.04611,0,.385],710:[0,.69444,.06709,0,.59111],711:[0,.63194,.08271,0,.59111],713:[0,.59444,.10444,0,.59111],714:[0,.69444,.08528,0,.59111],715:[0,.69444,0,0,.59111],728:[0,.69444,.10333,0,.59111],729:[0,.69444,.12945,0,.35555],730:[0,.69444,0,0,.94888],732:[0,.69444,.11472,0,.59111],733:[0,.69444,.11472,0,.59111],915:[0,.68611,.12903,0,.69777],916:[0,.68611,0,0,.94444],920:[0,.68611,.09062,0,.88555],923:[0,.68611,0,0,.80666],926:[0,.68611,.15092,0,.76777],928:[0,.68611,.17208,0,.8961],931:[0,.68611,.11431,0,.82666],933:[0,.68611,.10778,0,.88555],934:[0,.68611,.05632,0,.82666],936:[0,.68611,.10778,0,.88555],937:[0,.68611,.0992,0,.82666],8211:[0,.44444,.09811,0,.59111],8212:[0,.44444,.09811,0,1.18221],8216:[0,.69444,.12945,0,.35555],8217:[0,.69444,.12945,0,.35555],8220:[0,.69444,.16772,0,.62055],8221:[0,.69444,.07939,0,.62055]},"Main-Italic":{32:[0,0,0,0,.25],33:[0,.69444,.12417,0,.30667],34:[0,.69444,.06961,0,.51444],35:[.19444,.69444,.06616,0,.81777],37:[.05556,.75,.13639,0,.81777],38:[0,.69444,.09694,0,.76666],39:[0,.69444,.12417,0,.30667],40:[.25,.75,.16194,0,.40889],41:[.25,.75,.03694,0,.40889],42:[0,.75,.14917,0,.51111],43:[.05667,.56167,.03694,0,.76666],44:[.19444,.10556,0,0,.30667],45:[0,.43056,.02826,0,.35778],46:[0,.10556,0,0,.30667],47:[.25,.75,.16194,0,.51111],48:[0,.64444,.13556,0,.51111],49:[0,.64444,.13556,0,.51111],50:[0,.64444,.13556,0,.51111],51:[0,.64444,.13556,0,.51111],52:[.19444,.64444,.13556,0,.51111],53:[0,.64444,.13556,0,.51111],54:[0,.64444,.13556,0,.51111],55:[.19444,.64444,.13556,0,.51111],56:[0,.64444,.13556,0,.51111],57:[0,.64444,.13556,0,.51111],58:[0,.43056,.0582,0,.30667],59:[.19444,.43056,.0582,0,.30667],61:[-.13313,.36687,.06616,0,.76666],63:[0,.69444,.1225,0,.51111],64:[0,.69444,.09597,0,.76666],65:[0,.68333,0,0,.74333],66:[0,.68333,.10257,0,.70389],67:[0,.68333,.14528,0,.71555],68:[0,.68333,.09403,0,.755],69:[0,.68333,.12028,0,.67833],70:[0,.68333,.13305,0,.65277],71:[0,.68333,.08722,0,.77361],72:[0,.68333,.16389,0,.74333],73:[0,.68333,.15806,0,.38555],74:[0,.68333,.14028,0,.525],75:[0,.68333,.14528,0,.76888],76:[0,.68333,0,0,.62722],77:[0,.68333,.16389,0,.89666],78:[0,.68333,.16389,0,.74333],79:[0,.68333,.09403,0,.76666],80:[0,.68333,.10257,0,.67833],81:[.19444,.68333,.09403,0,.76666],82:[0,.68333,.03868,0,.72944],83:[0,.68333,.11972,0,.56222],84:[0,.68333,.13305,0,.71555],85:[0,.68333,.16389,0,.74333],86:[0,.68333,.18361,0,.74333],87:[0,.68333,.18361,0,.99888],88:[0,.68333,.15806,0,.74333],89:[0,.68333,.19383,0,.74333],90:[0,.68333,.14528,0,.61333],91:[.25,.75,.1875,0,.30667],93:[.25,.75,.10528,0,.30667],94:[0,.69444,.06646,0,.51111],95:[.31,.12056,.09208,0,.51111],97:[0,.43056,.07671,0,.51111],98:[0,.69444,.06312,0,.46],99:[0,.43056,.05653,0,.46],100:[0,.69444,.10333,0,.51111],101:[0,.43056,.07514,0,.46],102:[.19444,.69444,.21194,0,.30667],103:[.19444,.43056,.08847,0,.46],104:[0,.69444,.07671,0,.51111],105:[0,.65536,.1019,0,.30667],106:[.19444,.65536,.14467,0,.30667],107:[0,.69444,.10764,0,.46],108:[0,.69444,.10333,0,.25555],109:[0,.43056,.07671,0,.81777],110:[0,.43056,.07671,0,.56222],111:[0,.43056,.06312,0,.51111],112:[.19444,.43056,.06312,0,.51111],113:[.19444,.43056,.08847,0,.46],114:[0,.43056,.10764,0,.42166],115:[0,.43056,.08208,0,.40889],116:[0,.61508,.09486,0,.33222],117:[0,.43056,.07671,0,.53666],118:[0,.43056,.10764,0,.46],119:[0,.43056,.10764,0,.66444],120:[0,.43056,.12042,0,.46389],121:[.19444,.43056,.08847,0,.48555],122:[0,.43056,.12292,0,.40889],126:[.35,.31786,.11585,0,.51111],160:[0,0,0,0,.25],168:[0,.66786,.10474,0,.51111],176:[0,.69444,0,0,.83129],184:[.17014,0,0,0,.46],198:[0,.68333,.12028,0,.88277],216:[.04861,.73194,.09403,0,.76666],223:[.19444,.69444,.10514,0,.53666],230:[0,.43056,.07514,0,.71555],248:[.09722,.52778,.09194,0,.51111],338:[0,.68333,.12028,0,.98499],339:[0,.43056,.07514,0,.71555],710:[0,.69444,.06646,0,.51111],711:[0,.62847,.08295,0,.51111],713:[0,.56167,.10333,0,.51111],714:[0,.69444,.09694,0,.51111],715:[0,.69444,0,0,.51111],728:[0,.69444,.10806,0,.51111],729:[0,.66786,.11752,0,.30667],730:[0,.69444,0,0,.83129],732:[0,.66786,.11585,0,.51111],733:[0,.69444,.1225,0,.51111],915:[0,.68333,.13305,0,.62722],916:[0,.68333,0,0,.81777],920:[0,.68333,.09403,0,.76666],923:[0,.68333,0,0,.69222],926:[0,.68333,.15294,0,.66444],928:[0,.68333,.16389,0,.74333],931:[0,.68333,.12028,0,.71555],933:[0,.68333,.11111,0,.76666],934:[0,.68333,.05986,0,.71555],936:[0,.68333,.11111,0,.76666],937:[0,.68333,.10257,0,.71555],8211:[0,.43056,.09208,0,.51111],8212:[0,.43056,.09208,0,1.02222],8216:[0,.69444,.12417,0,.30667],8217:[0,.69444,.12417,0,.30667],8220:[0,.69444,.1685,0,.51444],8221:[0,.69444,.06961,0,.51444],8463:[0,.68889,0,0,.54028]},"Main-Regular":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.27778],34:[0,.69444,0,0,.5],35:[.19444,.69444,0,0,.83334],36:[.05556,.75,0,0,.5],37:[.05556,.75,0,0,.83334],38:[0,.69444,0,0,.77778],39:[0,.69444,0,0,.27778],40:[.25,.75,0,0,.38889],41:[.25,.75,0,0,.38889],42:[0,.75,0,0,.5],43:[.08333,.58333,0,0,.77778],44:[.19444,.10556,0,0,.27778],45:[0,.43056,0,0,.33333],46:[0,.10556,0,0,.27778],47:[.25,.75,0,0,.5],48:[0,.64444,0,0,.5],49:[0,.64444,0,0,.5],50:[0,.64444,0,0,.5],51:[0,.64444,0,0,.5],52:[0,.64444,0,0,.5],53:[0,.64444,0,0,.5],54:[0,.64444,0,0,.5],55:[0,.64444,0,0,.5],56:[0,.64444,0,0,.5],57:[0,.64444,0,0,.5],58:[0,.43056,0,0,.27778],59:[.19444,.43056,0,0,.27778],60:[.0391,.5391,0,0,.77778],61:[-.13313,.36687,0,0,.77778],62:[.0391,.5391,0,0,.77778],63:[0,.69444,0,0,.47222],64:[0,.69444,0,0,.77778],65:[0,.68333,0,0,.75],66:[0,.68333,0,0,.70834],67:[0,.68333,0,0,.72222],68:[0,.68333,0,0,.76389],69:[0,.68333,0,0,.68056],70:[0,.68333,0,0,.65278],71:[0,.68333,0,0,.78472],72:[0,.68333,0,0,.75],73:[0,.68333,0,0,.36111],74:[0,.68333,0,0,.51389],75:[0,.68333,0,0,.77778],76:[0,.68333,0,0,.625],77:[0,.68333,0,0,.91667],78:[0,.68333,0,0,.75],79:[0,.68333,0,0,.77778],80:[0,.68333,0,0,.68056],81:[.19444,.68333,0,0,.77778],82:[0,.68333,0,0,.73611],83:[0,.68333,0,0,.55556],84:[0,.68333,0,0,.72222],85:[0,.68333,0,0,.75],86:[0,.68333,.01389,0,.75],87:[0,.68333,.01389,0,1.02778],88:[0,.68333,0,0,.75],89:[0,.68333,.025,0,.75],90:[0,.68333,0,0,.61111],91:[.25,.75,0,0,.27778],92:[.25,.75,0,0,.5],93:[.25,.75,0,0,.27778],94:[0,.69444,0,0,.5],95:[.31,.12056,.02778,0,.5],97:[0,.43056,0,0,.5],98:[0,.69444,0,0,.55556],99:[0,.43056,0,0,.44445],100:[0,.69444,0,0,.55556],101:[0,.43056,0,0,.44445],102:[0,.69444,.07778,0,.30556],103:[.19444,.43056,.01389,0,.5],104:[0,.69444,0,0,.55556],105:[0,.66786,0,0,.27778],106:[.19444,.66786,0,0,.30556],107:[0,.69444,0,0,.52778],108:[0,.69444,0,0,.27778],109:[0,.43056,0,0,.83334],110:[0,.43056,0,0,.55556],111:[0,.43056,0,0,.5],112:[.19444,.43056,0,0,.55556],113:[.19444,.43056,0,0,.52778],114:[0,.43056,0,0,.39167],115:[0,.43056,0,0,.39445],116:[0,.61508,0,0,.38889],117:[0,.43056,0,0,.55556],118:[0,.43056,.01389,0,.52778],119:[0,.43056,.01389,0,.72222],120:[0,.43056,0,0,.52778],121:[.19444,.43056,.01389,0,.52778],122:[0,.43056,0,0,.44445],123:[.25,.75,0,0,.5],124:[.25,.75,0,0,.27778],125:[.25,.75,0,0,.5],126:[.35,.31786,0,0,.5],160:[0,0,0,0,.25],163:[0,.69444,0,0,.76909],167:[.19444,.69444,0,0,.44445],168:[0,.66786,0,0,.5],172:[0,.43056,0,0,.66667],176:[0,.69444,0,0,.75],177:[.08333,.58333,0,0,.77778],182:[.19444,.69444,0,0,.61111],184:[.17014,0,0,0,.44445],198:[0,.68333,0,0,.90278],215:[.08333,.58333,0,0,.77778],216:[.04861,.73194,0,0,.77778],223:[0,.69444,0,0,.5],230:[0,.43056,0,0,.72222],247:[.08333,.58333,0,0,.77778],248:[.09722,.52778,0,0,.5],305:[0,.43056,0,0,.27778],338:[0,.68333,0,0,1.01389],339:[0,.43056,0,0,.77778],567:[.19444,.43056,0,0,.30556],710:[0,.69444,0,0,.5],711:[0,.62847,0,0,.5],713:[0,.56778,0,0,.5],714:[0,.69444,0,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,0,0,.5],729:[0,.66786,0,0,.27778],730:[0,.69444,0,0,.75],732:[0,.66786,0,0,.5],733:[0,.69444,0,0,.5],915:[0,.68333,0,0,.625],916:[0,.68333,0,0,.83334],920:[0,.68333,0,0,.77778],923:[0,.68333,0,0,.69445],926:[0,.68333,0,0,.66667],928:[0,.68333,0,0,.75],931:[0,.68333,0,0,.72222],933:[0,.68333,0,0,.77778],934:[0,.68333,0,0,.72222],936:[0,.68333,0,0,.77778],937:[0,.68333,0,0,.72222],8211:[0,.43056,.02778,0,.5],8212:[0,.43056,.02778,0,1],8216:[0,.69444,0,0,.27778],8217:[0,.69444,0,0,.27778],8220:[0,.69444,0,0,.5],8221:[0,.69444,0,0,.5],8224:[.19444,.69444,0,0,.44445],8225:[.19444,.69444,0,0,.44445],8230:[0,.123,0,0,1.172],8242:[0,.55556,0,0,.275],8407:[0,.71444,.15382,0,.5],8463:[0,.68889,0,0,.54028],8465:[0,.69444,0,0,.72222],8467:[0,.69444,0,.11111,.41667],8472:[.19444,.43056,0,.11111,.63646],8476:[0,.69444,0,0,.72222],8501:[0,.69444,0,0,.61111],8592:[-.13313,.36687,0,0,1],8593:[.19444,.69444,0,0,.5],8594:[-.13313,.36687,0,0,1],8595:[.19444,.69444,0,0,.5],8596:[-.13313,.36687,0,0,1],8597:[.25,.75,0,0,.5],8598:[.19444,.69444,0,0,1],8599:[.19444,.69444,0,0,1],8600:[.19444,.69444,0,0,1],8601:[.19444,.69444,0,0,1],8614:[.011,.511,0,0,1],8617:[.011,.511,0,0,1.126],8618:[.011,.511,0,0,1.126],8636:[-.13313,.36687,0,0,1],8637:[-.13313,.36687,0,0,1],8640:[-.13313,.36687,0,0,1],8641:[-.13313,.36687,0,0,1],8652:[.011,.671,0,0,1],8656:[-.13313,.36687,0,0,1],8657:[.19444,.69444,0,0,.61111],8658:[-.13313,.36687,0,0,1],8659:[.19444,.69444,0,0,.61111],8660:[-.13313,.36687,0,0,1],8661:[.25,.75,0,0,.61111],8704:[0,.69444,0,0,.55556],8706:[0,.69444,.05556,.08334,.5309],8707:[0,.69444,0,0,.55556],8709:[.05556,.75,0,0,.5],8711:[0,.68333,0,0,.83334],8712:[.0391,.5391,0,0,.66667],8715:[.0391,.5391,0,0,.66667],8722:[.08333,.58333,0,0,.77778],8723:[.08333,.58333,0,0,.77778],8725:[.25,.75,0,0,.5],8726:[.25,.75,0,0,.5],8727:[-.03472,.46528,0,0,.5],8728:[-.05555,.44445,0,0,.5],8729:[-.05555,.44445,0,0,.5],8730:[.2,.8,0,0,.83334],8733:[0,.43056,0,0,.77778],8734:[0,.43056,0,0,1],8736:[0,.69224,0,0,.72222],8739:[.25,.75,0,0,.27778],8741:[.25,.75,0,0,.5],8743:[0,.55556,0,0,.66667],8744:[0,.55556,0,0,.66667],8745:[0,.55556,0,0,.66667],8746:[0,.55556,0,0,.66667],8747:[.19444,.69444,.11111,0,.41667],8764:[-.13313,.36687,0,0,.77778],8768:[.19444,.69444,0,0,.27778],8771:[-.03625,.46375,0,0,.77778],8773:[-.022,.589,0,0,.778],8776:[-.01688,.48312,0,0,.77778],8781:[-.03625,.46375,0,0,.77778],8784:[-.133,.673,0,0,.778],8801:[-.03625,.46375,0,0,.77778],8804:[.13597,.63597,0,0,.77778],8805:[.13597,.63597,0,0,.77778],8810:[.0391,.5391,0,0,1],8811:[.0391,.5391,0,0,1],8826:[.0391,.5391,0,0,.77778],8827:[.0391,.5391,0,0,.77778],8834:[.0391,.5391,0,0,.77778],8835:[.0391,.5391,0,0,.77778],8838:[.13597,.63597,0,0,.77778],8839:[.13597,.63597,0,0,.77778],8846:[0,.55556,0,0,.66667],8849:[.13597,.63597,0,0,.77778],8850:[.13597,.63597,0,0,.77778],8851:[0,.55556,0,0,.66667],8852:[0,.55556,0,0,.66667],8853:[.08333,.58333,0,0,.77778],8854:[.08333,.58333,0,0,.77778],8855:[.08333,.58333,0,0,.77778],8856:[.08333,.58333,0,0,.77778],8857:[.08333,.58333,0,0,.77778],8866:[0,.69444,0,0,.61111],8867:[0,.69444,0,0,.61111],8868:[0,.69444,0,0,.77778],8869:[0,.69444,0,0,.77778],8872:[.249,.75,0,0,.867],8900:[-.05555,.44445,0,0,.5],8901:[-.05555,.44445,0,0,.27778],8902:[-.03472,.46528,0,0,.5],8904:[.005,.505,0,0,.9],8942:[.03,.903,0,0,.278],8943:[-.19,.313,0,0,1.172],8945:[-.1,.823,0,0,1.282],8968:[.25,.75,0,0,.44445],8969:[.25,.75,0,0,.44445],8970:[.25,.75,0,0,.44445],8971:[.25,.75,0,0,.44445],8994:[-.14236,.35764,0,0,1],8995:[-.14236,.35764,0,0,1],9136:[.244,.744,0,0,.412],9137:[.244,.745,0,0,.412],9651:[.19444,.69444,0,0,.88889],9657:[-.03472,.46528,0,0,.5],9661:[.19444,.69444,0,0,.88889],9667:[-.03472,.46528,0,0,.5],9711:[.19444,.69444,0,0,1],9824:[.12963,.69444,0,0,.77778],9825:[.12963,.69444,0,0,.77778],9826:[.12963,.69444,0,0,.77778],9827:[.12963,.69444,0,0,.77778],9837:[0,.75,0,0,.38889],9838:[.19444,.69444,0,0,.38889],9839:[.19444,.69444,0,0,.38889],10216:[.25,.75,0,0,.38889],10217:[.25,.75,0,0,.38889],10222:[.244,.744,0,0,.412],10223:[.244,.745,0,0,.412],10229:[.011,.511,0,0,1.609],10230:[.011,.511,0,0,1.638],10231:[.011,.511,0,0,1.859],10232:[.024,.525,0,0,1.609],10233:[.024,.525,0,0,1.638],10234:[.024,.525,0,0,1.858],10236:[.011,.511,0,0,1.638],10815:[0,.68333,0,0,.75],10927:[.13597,.63597,0,0,.77778],10928:[.13597,.63597,0,0,.77778],57376:[.19444,.69444,0,0,0]},"Math-BoldItalic":{32:[0,0,0,0,.25],48:[0,.44444,0,0,.575],49:[0,.44444,0,0,.575],50:[0,.44444,0,0,.575],51:[.19444,.44444,0,0,.575],52:[.19444,.44444,0,0,.575],53:[.19444,.44444,0,0,.575],54:[0,.64444,0,0,.575],55:[.19444,.44444,0,0,.575],56:[0,.64444,0,0,.575],57:[.19444,.44444,0,0,.575],65:[0,.68611,0,0,.86944],66:[0,.68611,.04835,0,.8664],67:[0,.68611,.06979,0,.81694],68:[0,.68611,.03194,0,.93812],69:[0,.68611,.05451,0,.81007],70:[0,.68611,.15972,0,.68889],71:[0,.68611,0,0,.88673],72:[0,.68611,.08229,0,.98229],73:[0,.68611,.07778,0,.51111],74:[0,.68611,.10069,0,.63125],75:[0,.68611,.06979,0,.97118],76:[0,.68611,0,0,.75555],77:[0,.68611,.11424,0,1.14201],78:[0,.68611,.11424,0,.95034],79:[0,.68611,.03194,0,.83666],80:[0,.68611,.15972,0,.72309],81:[.19444,.68611,0,0,.86861],82:[0,.68611,.00421,0,.87235],83:[0,.68611,.05382,0,.69271],84:[0,.68611,.15972,0,.63663],85:[0,.68611,.11424,0,.80027],86:[0,.68611,.25555,0,.67778],87:[0,.68611,.15972,0,1.09305],88:[0,.68611,.07778,0,.94722],89:[0,.68611,.25555,0,.67458],90:[0,.68611,.06979,0,.77257],97:[0,.44444,0,0,.63287],98:[0,.69444,0,0,.52083],99:[0,.44444,0,0,.51342],100:[0,.69444,0,0,.60972],101:[0,.44444,0,0,.55361],102:[.19444,.69444,.11042,0,.56806],103:[.19444,.44444,.03704,0,.5449],104:[0,.69444,0,0,.66759],105:[0,.69326,0,0,.4048],106:[.19444,.69326,.0622,0,.47083],107:[0,.69444,.01852,0,.6037],108:[0,.69444,.0088,0,.34815],109:[0,.44444,0,0,1.0324],110:[0,.44444,0,0,.71296],111:[0,.44444,0,0,.58472],112:[.19444,.44444,0,0,.60092],113:[.19444,.44444,.03704,0,.54213],114:[0,.44444,.03194,0,.5287],115:[0,.44444,0,0,.53125],116:[0,.63492,0,0,.41528],117:[0,.44444,0,0,.68102],118:[0,.44444,.03704,0,.56666],119:[0,.44444,.02778,0,.83148],120:[0,.44444,0,0,.65903],121:[.19444,.44444,.03704,0,.59028],122:[0,.44444,.04213,0,.55509],160:[0,0,0,0,.25],915:[0,.68611,.15972,0,.65694],916:[0,.68611,0,0,.95833],920:[0,.68611,.03194,0,.86722],923:[0,.68611,0,0,.80555],926:[0,.68611,.07458,0,.84125],928:[0,.68611,.08229,0,.98229],931:[0,.68611,.05451,0,.88507],933:[0,.68611,.15972,0,.67083],934:[0,.68611,0,0,.76666],936:[0,.68611,.11653,0,.71402],937:[0,.68611,.04835,0,.8789],945:[0,.44444,0,0,.76064],946:[.19444,.69444,.03403,0,.65972],947:[.19444,.44444,.06389,0,.59003],948:[0,.69444,.03819,0,.52222],949:[0,.44444,0,0,.52882],950:[.19444,.69444,.06215,0,.50833],951:[.19444,.44444,.03704,0,.6],952:[0,.69444,.03194,0,.5618],953:[0,.44444,0,0,.41204],954:[0,.44444,0,0,.66759],955:[0,.69444,0,0,.67083],956:[.19444,.44444,0,0,.70787],957:[0,.44444,.06898,0,.57685],958:[.19444,.69444,.03021,0,.50833],959:[0,.44444,0,0,.58472],960:[0,.44444,.03704,0,.68241],961:[.19444,.44444,0,0,.6118],962:[.09722,.44444,.07917,0,.42361],963:[0,.44444,.03704,0,.68588],964:[0,.44444,.13472,0,.52083],965:[0,.44444,.03704,0,.63055],966:[.19444,.44444,0,0,.74722],967:[.19444,.44444,0,0,.71805],968:[.19444,.69444,.03704,0,.75833],969:[0,.44444,.03704,0,.71782],977:[0,.69444,0,0,.69155],981:[.19444,.69444,0,0,.7125],982:[0,.44444,.03194,0,.975],1009:[.19444,.44444,0,0,.6118],1013:[0,.44444,0,0,.48333],57649:[0,.44444,0,0,.39352],57911:[.19444,.44444,0,0,.43889]},"Math-Italic":{32:[0,0,0,0,.25],48:[0,.43056,0,0,.5],49:[0,.43056,0,0,.5],50:[0,.43056,0,0,.5],51:[.19444,.43056,0,0,.5],52:[.19444,.43056,0,0,.5],53:[.19444,.43056,0,0,.5],54:[0,.64444,0,0,.5],55:[.19444,.43056,0,0,.5],56:[0,.64444,0,0,.5],57:[.19444,.43056,0,0,.5],65:[0,.68333,0,.13889,.75],66:[0,.68333,.05017,.08334,.75851],67:[0,.68333,.07153,.08334,.71472],68:[0,.68333,.02778,.05556,.82792],69:[0,.68333,.05764,.08334,.7382],70:[0,.68333,.13889,.08334,.64306],71:[0,.68333,0,.08334,.78625],72:[0,.68333,.08125,.05556,.83125],73:[0,.68333,.07847,.11111,.43958],74:[0,.68333,.09618,.16667,.55451],75:[0,.68333,.07153,.05556,.84931],76:[0,.68333,0,.02778,.68056],77:[0,.68333,.10903,.08334,.97014],78:[0,.68333,.10903,.08334,.80347],79:[0,.68333,.02778,.08334,.76278],80:[0,.68333,.13889,.08334,.64201],81:[.19444,.68333,0,.08334,.79056],82:[0,.68333,.00773,.08334,.75929],83:[0,.68333,.05764,.08334,.6132],84:[0,.68333,.13889,.08334,.58438],85:[0,.68333,.10903,.02778,.68278],86:[0,.68333,.22222,0,.58333],87:[0,.68333,.13889,0,.94445],88:[0,.68333,.07847,.08334,.82847],89:[0,.68333,.22222,0,.58056],90:[0,.68333,.07153,.08334,.68264],97:[0,.43056,0,0,.52859],98:[0,.69444,0,0,.42917],99:[0,.43056,0,.05556,.43276],100:[0,.69444,0,.16667,.52049],101:[0,.43056,0,.05556,.46563],102:[.19444,.69444,.10764,.16667,.48959],103:[.19444,.43056,.03588,.02778,.47697],104:[0,.69444,0,0,.57616],105:[0,.65952,0,0,.34451],106:[.19444,.65952,.05724,0,.41181],107:[0,.69444,.03148,0,.5206],108:[0,.69444,.01968,.08334,.29838],109:[0,.43056,0,0,.87801],110:[0,.43056,0,0,.60023],111:[0,.43056,0,.05556,.48472],112:[.19444,.43056,0,.08334,.50313],113:[.19444,.43056,.03588,.08334,.44641],114:[0,.43056,.02778,.05556,.45116],115:[0,.43056,0,.05556,.46875],116:[0,.61508,0,.08334,.36111],117:[0,.43056,0,.02778,.57246],118:[0,.43056,.03588,.02778,.48472],119:[0,.43056,.02691,.08334,.71592],120:[0,.43056,0,.02778,.57153],121:[.19444,.43056,.03588,.05556,.49028],122:[0,.43056,.04398,.05556,.46505],160:[0,0,0,0,.25],915:[0,.68333,.13889,.08334,.61528],916:[0,.68333,0,.16667,.83334],920:[0,.68333,.02778,.08334,.76278],923:[0,.68333,0,.16667,.69445],926:[0,.68333,.07569,.08334,.74236],928:[0,.68333,.08125,.05556,.83125],931:[0,.68333,.05764,.08334,.77986],933:[0,.68333,.13889,.05556,.58333],934:[0,.68333,0,.08334,.66667],936:[0,.68333,.11,.05556,.61222],937:[0,.68333,.05017,.08334,.7724],945:[0,.43056,.0037,.02778,.6397],946:[.19444,.69444,.05278,.08334,.56563],947:[.19444,.43056,.05556,0,.51773],948:[0,.69444,.03785,.05556,.44444],949:[0,.43056,0,.08334,.46632],950:[.19444,.69444,.07378,.08334,.4375],951:[.19444,.43056,.03588,.05556,.49653],952:[0,.69444,.02778,.08334,.46944],953:[0,.43056,0,.05556,.35394],954:[0,.43056,0,0,.57616],955:[0,.69444,0,0,.58334],956:[.19444,.43056,0,.02778,.60255],957:[0,.43056,.06366,.02778,.49398],958:[.19444,.69444,.04601,.11111,.4375],959:[0,.43056,0,.05556,.48472],960:[0,.43056,.03588,0,.57003],961:[.19444,.43056,0,.08334,.51702],962:[.09722,.43056,.07986,.08334,.36285],963:[0,.43056,.03588,0,.57141],964:[0,.43056,.1132,.02778,.43715],965:[0,.43056,.03588,.02778,.54028],966:[.19444,.43056,0,.08334,.65417],967:[.19444,.43056,0,.05556,.62569],968:[.19444,.69444,.03588,.11111,.65139],969:[0,.43056,.03588,0,.62245],977:[0,.69444,0,.08334,.59144],981:[.19444,.69444,0,.08334,.59583],982:[0,.43056,.02778,0,.82813],1009:[.19444,.43056,0,.08334,.51702],1013:[0,.43056,0,.05556,.4059],57649:[0,.43056,0,.02778,.32246],57911:[.19444,.43056,0,.08334,.38403]},"SansSerif-Bold":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.36667],34:[0,.69444,0,0,.55834],35:[.19444,.69444,0,0,.91667],36:[.05556,.75,0,0,.55],37:[.05556,.75,0,0,1.02912],38:[0,.69444,0,0,.83056],39:[0,.69444,0,0,.30556],40:[.25,.75,0,0,.42778],41:[.25,.75,0,0,.42778],42:[0,.75,0,0,.55],43:[.11667,.61667,0,0,.85556],44:[.10556,.13056,0,0,.30556],45:[0,.45833,0,0,.36667],46:[0,.13056,0,0,.30556],47:[.25,.75,0,0,.55],48:[0,.69444,0,0,.55],49:[0,.69444,0,0,.55],50:[0,.69444,0,0,.55],51:[0,.69444,0,0,.55],52:[0,.69444,0,0,.55],53:[0,.69444,0,0,.55],54:[0,.69444,0,0,.55],55:[0,.69444,0,0,.55],56:[0,.69444,0,0,.55],57:[0,.69444,0,0,.55],58:[0,.45833,0,0,.30556],59:[.10556,.45833,0,0,.30556],61:[-.09375,.40625,0,0,.85556],63:[0,.69444,0,0,.51945],64:[0,.69444,0,0,.73334],65:[0,.69444,0,0,.73334],66:[0,.69444,0,0,.73334],67:[0,.69444,0,0,.70278],68:[0,.69444,0,0,.79445],69:[0,.69444,0,0,.64167],70:[0,.69444,0,0,.61111],71:[0,.69444,0,0,.73334],72:[0,.69444,0,0,.79445],73:[0,.69444,0,0,.33056],74:[0,.69444,0,0,.51945],75:[0,.69444,0,0,.76389],76:[0,.69444,0,0,.58056],77:[0,.69444,0,0,.97778],78:[0,.69444,0,0,.79445],79:[0,.69444,0,0,.79445],80:[0,.69444,0,0,.70278],81:[.10556,.69444,0,0,.79445],82:[0,.69444,0,0,.70278],83:[0,.69444,0,0,.61111],84:[0,.69444,0,0,.73334],85:[0,.69444,0,0,.76389],86:[0,.69444,.01528,0,.73334],87:[0,.69444,.01528,0,1.03889],88:[0,.69444,0,0,.73334],89:[0,.69444,.0275,0,.73334],90:[0,.69444,0,0,.67223],91:[.25,.75,0,0,.34306],93:[.25,.75,0,0,.34306],94:[0,.69444,0,0,.55],95:[.35,.10833,.03056,0,.55],97:[0,.45833,0,0,.525],98:[0,.69444,0,0,.56111],99:[0,.45833,0,0,.48889],100:[0,.69444,0,0,.56111],101:[0,.45833,0,0,.51111],102:[0,.69444,.07639,0,.33611],103:[.19444,.45833,.01528,0,.55],104:[0,.69444,0,0,.56111],105:[0,.69444,0,0,.25556],106:[.19444,.69444,0,0,.28611],107:[0,.69444,0,0,.53056],108:[0,.69444,0,0,.25556],109:[0,.45833,0,0,.86667],110:[0,.45833,0,0,.56111],111:[0,.45833,0,0,.55],112:[.19444,.45833,0,0,.56111],113:[.19444,.45833,0,0,.56111],114:[0,.45833,.01528,0,.37222],115:[0,.45833,0,0,.42167],116:[0,.58929,0,0,.40417],117:[0,.45833,0,0,.56111],118:[0,.45833,.01528,0,.5],119:[0,.45833,.01528,0,.74445],120:[0,.45833,0,0,.5],121:[.19444,.45833,.01528,0,.5],122:[0,.45833,0,0,.47639],126:[.35,.34444,0,0,.55],160:[0,0,0,0,.25],168:[0,.69444,0,0,.55],176:[0,.69444,0,0,.73334],180:[0,.69444,0,0,.55],184:[.17014,0,0,0,.48889],305:[0,.45833,0,0,.25556],567:[.19444,.45833,0,0,.28611],710:[0,.69444,0,0,.55],711:[0,.63542,0,0,.55],713:[0,.63778,0,0,.55],728:[0,.69444,0,0,.55],729:[0,.69444,0,0,.30556],730:[0,.69444,0,0,.73334],732:[0,.69444,0,0,.55],733:[0,.69444,0,0,.55],915:[0,.69444,0,0,.58056],916:[0,.69444,0,0,.91667],920:[0,.69444,0,0,.85556],923:[0,.69444,0,0,.67223],926:[0,.69444,0,0,.73334],928:[0,.69444,0,0,.79445],931:[0,.69444,0,0,.79445],933:[0,.69444,0,0,.85556],934:[0,.69444,0,0,.79445],936:[0,.69444,0,0,.85556],937:[0,.69444,0,0,.79445],8211:[0,.45833,.03056,0,.55],8212:[0,.45833,.03056,0,1.10001],8216:[0,.69444,0,0,.30556],8217:[0,.69444,0,0,.30556],8220:[0,.69444,0,0,.55834],8221:[0,.69444,0,0,.55834]},"SansSerif-Italic":{32:[0,0,0,0,.25],33:[0,.69444,.05733,0,.31945],34:[0,.69444,.00316,0,.5],35:[.19444,.69444,.05087,0,.83334],36:[.05556,.75,.11156,0,.5],37:[.05556,.75,.03126,0,.83334],38:[0,.69444,.03058,0,.75834],39:[0,.69444,.07816,0,.27778],40:[.25,.75,.13164,0,.38889],41:[.25,.75,.02536,0,.38889],42:[0,.75,.11775,0,.5],43:[.08333,.58333,.02536,0,.77778],44:[.125,.08333,0,0,.27778],45:[0,.44444,.01946,0,.33333],46:[0,.08333,0,0,.27778],47:[.25,.75,.13164,0,.5],48:[0,.65556,.11156,0,.5],49:[0,.65556,.11156,0,.5],50:[0,.65556,.11156,0,.5],51:[0,.65556,.11156,0,.5],52:[0,.65556,.11156,0,.5],53:[0,.65556,.11156,0,.5],54:[0,.65556,.11156,0,.5],55:[0,.65556,.11156,0,.5],56:[0,.65556,.11156,0,.5],57:[0,.65556,.11156,0,.5],58:[0,.44444,.02502,0,.27778],59:[.125,.44444,.02502,0,.27778],61:[-.13,.37,.05087,0,.77778],63:[0,.69444,.11809,0,.47222],64:[0,.69444,.07555,0,.66667],65:[0,.69444,0,0,.66667],66:[0,.69444,.08293,0,.66667],67:[0,.69444,.11983,0,.63889],68:[0,.69444,.07555,0,.72223],69:[0,.69444,.11983,0,.59722],70:[0,.69444,.13372,0,.56945],71:[0,.69444,.11983,0,.66667],72:[0,.69444,.08094,0,.70834],73:[0,.69444,.13372,0,.27778],74:[0,.69444,.08094,0,.47222],75:[0,.69444,.11983,0,.69445],76:[0,.69444,0,0,.54167],77:[0,.69444,.08094,0,.875],78:[0,.69444,.08094,0,.70834],79:[0,.69444,.07555,0,.73611],80:[0,.69444,.08293,0,.63889],81:[.125,.69444,.07555,0,.73611],82:[0,.69444,.08293,0,.64584],83:[0,.69444,.09205,0,.55556],84:[0,.69444,.13372,0,.68056],85:[0,.69444,.08094,0,.6875],86:[0,.69444,.1615,0,.66667],87:[0,.69444,.1615,0,.94445],88:[0,.69444,.13372,0,.66667],89:[0,.69444,.17261,0,.66667],90:[0,.69444,.11983,0,.61111],91:[.25,.75,.15942,0,.28889],93:[.25,.75,.08719,0,.28889],94:[0,.69444,.0799,0,.5],95:[.35,.09444,.08616,0,.5],97:[0,.44444,.00981,0,.48056],98:[0,.69444,.03057,0,.51667],99:[0,.44444,.08336,0,.44445],100:[0,.69444,.09483,0,.51667],101:[0,.44444,.06778,0,.44445],102:[0,.69444,.21705,0,.30556],103:[.19444,.44444,.10836,0,.5],104:[0,.69444,.01778,0,.51667],105:[0,.67937,.09718,0,.23889],106:[.19444,.67937,.09162,0,.26667],107:[0,.69444,.08336,0,.48889],108:[0,.69444,.09483,0,.23889],109:[0,.44444,.01778,0,.79445],110:[0,.44444,.01778,0,.51667],111:[0,.44444,.06613,0,.5],112:[.19444,.44444,.0389,0,.51667],113:[.19444,.44444,.04169,0,.51667],114:[0,.44444,.10836,0,.34167],115:[0,.44444,.0778,0,.38333],116:[0,.57143,.07225,0,.36111],117:[0,.44444,.04169,0,.51667],118:[0,.44444,.10836,0,.46111],119:[0,.44444,.10836,0,.68334],120:[0,.44444,.09169,0,.46111],121:[.19444,.44444,.10836,0,.46111],122:[0,.44444,.08752,0,.43472],126:[.35,.32659,.08826,0,.5],160:[0,0,0,0,.25],168:[0,.67937,.06385,0,.5],176:[0,.69444,0,0,.73752],184:[.17014,0,0,0,.44445],305:[0,.44444,.04169,0,.23889],567:[.19444,.44444,.04169,0,.26667],710:[0,.69444,.0799,0,.5],711:[0,.63194,.08432,0,.5],713:[0,.60889,.08776,0,.5],714:[0,.69444,.09205,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,.09483,0,.5],729:[0,.67937,.07774,0,.27778],730:[0,.69444,0,0,.73752],732:[0,.67659,.08826,0,.5],733:[0,.69444,.09205,0,.5],915:[0,.69444,.13372,0,.54167],916:[0,.69444,0,0,.83334],920:[0,.69444,.07555,0,.77778],923:[0,.69444,0,0,.61111],926:[0,.69444,.12816,0,.66667],928:[0,.69444,.08094,0,.70834],931:[0,.69444,.11983,0,.72222],933:[0,.69444,.09031,0,.77778],934:[0,.69444,.04603,0,.72222],936:[0,.69444,.09031,0,.77778],937:[0,.69444,.08293,0,.72222],8211:[0,.44444,.08616,0,.5],8212:[0,.44444,.08616,0,1],8216:[0,.69444,.07816,0,.27778],8217:[0,.69444,.07816,0,.27778],8220:[0,.69444,.14205,0,.5],8221:[0,.69444,.00316,0,.5]},"SansSerif-Regular":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.31945],34:[0,.69444,0,0,.5],35:[.19444,.69444,0,0,.83334],36:[.05556,.75,0,0,.5],37:[.05556,.75,0,0,.83334],38:[0,.69444,0,0,.75834],39:[0,.69444,0,0,.27778],40:[.25,.75,0,0,.38889],41:[.25,.75,0,0,.38889],42:[0,.75,0,0,.5],43:[.08333,.58333,0,0,.77778],44:[.125,.08333,0,0,.27778],45:[0,.44444,0,0,.33333],46:[0,.08333,0,0,.27778],47:[.25,.75,0,0,.5],48:[0,.65556,0,0,.5],49:[0,.65556,0,0,.5],50:[0,.65556,0,0,.5],51:[0,.65556,0,0,.5],52:[0,.65556,0,0,.5],53:[0,.65556,0,0,.5],54:[0,.65556,0,0,.5],55:[0,.65556,0,0,.5],56:[0,.65556,0,0,.5],57:[0,.65556,0,0,.5],58:[0,.44444,0,0,.27778],59:[.125,.44444,0,0,.27778],61:[-.13,.37,0,0,.77778],63:[0,.69444,0,0,.47222],64:[0,.69444,0,0,.66667],65:[0,.69444,0,0,.66667],66:[0,.69444,0,0,.66667],67:[0,.69444,0,0,.63889],68:[0,.69444,0,0,.72223],69:[0,.69444,0,0,.59722],70:[0,.69444,0,0,.56945],71:[0,.69444,0,0,.66667],72:[0,.69444,0,0,.70834],73:[0,.69444,0,0,.27778],74:[0,.69444,0,0,.47222],75:[0,.69444,0,0,.69445],76:[0,.69444,0,0,.54167],77:[0,.69444,0,0,.875],78:[0,.69444,0,0,.70834],79:[0,.69444,0,0,.73611],80:[0,.69444,0,0,.63889],81:[.125,.69444,0,0,.73611],82:[0,.69444,0,0,.64584],83:[0,.69444,0,0,.55556],84:[0,.69444,0,0,.68056],85:[0,.69444,0,0,.6875],86:[0,.69444,.01389,0,.66667],87:[0,.69444,.01389,0,.94445],88:[0,.69444,0,0,.66667],89:[0,.69444,.025,0,.66667],90:[0,.69444,0,0,.61111],91:[.25,.75,0,0,.28889],93:[.25,.75,0,0,.28889],94:[0,.69444,0,0,.5],95:[.35,.09444,.02778,0,.5],97:[0,.44444,0,0,.48056],98:[0,.69444,0,0,.51667],99:[0,.44444,0,0,.44445],100:[0,.69444,0,0,.51667],101:[0,.44444,0,0,.44445],102:[0,.69444,.06944,0,.30556],103:[.19444,.44444,.01389,0,.5],104:[0,.69444,0,0,.51667],105:[0,.67937,0,0,.23889],106:[.19444,.67937,0,0,.26667],107:[0,.69444,0,0,.48889],108:[0,.69444,0,0,.23889],109:[0,.44444,0,0,.79445],110:[0,.44444,0,0,.51667],111:[0,.44444,0,0,.5],112:[.19444,.44444,0,0,.51667],113:[.19444,.44444,0,0,.51667],114:[0,.44444,.01389,0,.34167],115:[0,.44444,0,0,.38333],116:[0,.57143,0,0,.36111],117:[0,.44444,0,0,.51667],118:[0,.44444,.01389,0,.46111],119:[0,.44444,.01389,0,.68334],120:[0,.44444,0,0,.46111],121:[.19444,.44444,.01389,0,.46111],122:[0,.44444,0,0,.43472],126:[.35,.32659,0,0,.5],160:[0,0,0,0,.25],168:[0,.67937,0,0,.5],176:[0,.69444,0,0,.66667],184:[.17014,0,0,0,.44445],305:[0,.44444,0,0,.23889],567:[.19444,.44444,0,0,.26667],710:[0,.69444,0,0,.5],711:[0,.63194,0,0,.5],713:[0,.60889,0,0,.5],714:[0,.69444,0,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,0,0,.5],729:[0,.67937,0,0,.27778],730:[0,.69444,0,0,.66667],732:[0,.67659,0,0,.5],733:[0,.69444,0,0,.5],915:[0,.69444,0,0,.54167],916:[0,.69444,0,0,.83334],920:[0,.69444,0,0,.77778],923:[0,.69444,0,0,.61111],926:[0,.69444,0,0,.66667],928:[0,.69444,0,0,.70834],931:[0,.69444,0,0,.72222],933:[0,.69444,0,0,.77778],934:[0,.69444,0,0,.72222],936:[0,.69444,0,0,.77778],937:[0,.69444,0,0,.72222],8211:[0,.44444,.02778,0,.5],8212:[0,.44444,.02778,0,1],8216:[0,.69444,0,0,.27778],8217:[0,.69444,0,0,.27778],8220:[0,.69444,0,0,.5],8221:[0,.69444,0,0,.5]},"Script-Regular":{32:[0,0,0,0,.25],65:[0,.7,.22925,0,.80253],66:[0,.7,.04087,0,.90757],67:[0,.7,.1689,0,.66619],68:[0,.7,.09371,0,.77443],69:[0,.7,.18583,0,.56162],70:[0,.7,.13634,0,.89544],71:[0,.7,.17322,0,.60961],72:[0,.7,.29694,0,.96919],73:[0,.7,.19189,0,.80907],74:[.27778,.7,.19189,0,1.05159],75:[0,.7,.31259,0,.91364],76:[0,.7,.19189,0,.87373],77:[0,.7,.15981,0,1.08031],78:[0,.7,.3525,0,.9015],79:[0,.7,.08078,0,.73787],80:[0,.7,.08078,0,1.01262],81:[0,.7,.03305,0,.88282],82:[0,.7,.06259,0,.85],83:[0,.7,.19189,0,.86767],84:[0,.7,.29087,0,.74697],85:[0,.7,.25815,0,.79996],86:[0,.7,.27523,0,.62204],87:[0,.7,.27523,0,.80532],88:[0,.7,.26006,0,.94445],89:[0,.7,.2939,0,.70961],90:[0,.7,.24037,0,.8212],160:[0,0,0,0,.25]},"Size1-Regular":{32:[0,0,0,0,.25],40:[.35001,.85,0,0,.45834],41:[.35001,.85,0,0,.45834],47:[.35001,.85,0,0,.57778],91:[.35001,.85,0,0,.41667],92:[.35001,.85,0,0,.57778],93:[.35001,.85,0,0,.41667],123:[.35001,.85,0,0,.58334],125:[.35001,.85,0,0,.58334],160:[0,0,0,0,.25],710:[0,.72222,0,0,.55556],732:[0,.72222,0,0,.55556],770:[0,.72222,0,0,.55556],771:[0,.72222,0,0,.55556],8214:[-99e-5,.601,0,0,.77778],8593:[1e-5,.6,0,0,.66667],8595:[1e-5,.6,0,0,.66667],8657:[1e-5,.6,0,0,.77778],8659:[1e-5,.6,0,0,.77778],8719:[.25001,.75,0,0,.94445],8720:[.25001,.75,0,0,.94445],8721:[.25001,.75,0,0,1.05556],8730:[.35001,.85,0,0,1],8739:[-.00599,.606,0,0,.33333],8741:[-.00599,.606,0,0,.55556],8747:[.30612,.805,.19445,0,.47222],8748:[.306,.805,.19445,0,.47222],8749:[.306,.805,.19445,0,.47222],8750:[.30612,.805,.19445,0,.47222],8896:[.25001,.75,0,0,.83334],8897:[.25001,.75,0,0,.83334],8898:[.25001,.75,0,0,.83334],8899:[.25001,.75,0,0,.83334],8968:[.35001,.85,0,0,.47222],8969:[.35001,.85,0,0,.47222],8970:[.35001,.85,0,0,.47222],8971:[.35001,.85,0,0,.47222],9168:[-99e-5,.601,0,0,.66667],10216:[.35001,.85,0,0,.47222],10217:[.35001,.85,0,0,.47222],10752:[.25001,.75,0,0,1.11111],10753:[.25001,.75,0,0,1.11111],10754:[.25001,.75,0,0,1.11111],10756:[.25001,.75,0,0,.83334],10758:[.25001,.75,0,0,.83334]},"Size2-Regular":{32:[0,0,0,0,.25],40:[.65002,1.15,0,0,.59722],41:[.65002,1.15,0,0,.59722],47:[.65002,1.15,0,0,.81111],91:[.65002,1.15,0,0,.47222],92:[.65002,1.15,0,0,.81111],93:[.65002,1.15,0,0,.47222],123:[.65002,1.15,0,0,.66667],125:[.65002,1.15,0,0,.66667],160:[0,0,0,0,.25],710:[0,.75,0,0,1],732:[0,.75,0,0,1],770:[0,.75,0,0,1],771:[0,.75,0,0,1],8719:[.55001,1.05,0,0,1.27778],8720:[.55001,1.05,0,0,1.27778],8721:[.55001,1.05,0,0,1.44445],8730:[.65002,1.15,0,0,1],8747:[.86225,1.36,.44445,0,.55556],8748:[.862,1.36,.44445,0,.55556],8749:[.862,1.36,.44445,0,.55556],8750:[.86225,1.36,.44445,0,.55556],8896:[.55001,1.05,0,0,1.11111],8897:[.55001,1.05,0,0,1.11111],8898:[.55001,1.05,0,0,1.11111],8899:[.55001,1.05,0,0,1.11111],8968:[.65002,1.15,0,0,.52778],8969:[.65002,1.15,0,0,.52778],8970:[.65002,1.15,0,0,.52778],8971:[.65002,1.15,0,0,.52778],10216:[.65002,1.15,0,0,.61111],10217:[.65002,1.15,0,0,.61111],10752:[.55001,1.05,0,0,1.51112],10753:[.55001,1.05,0,0,1.51112],10754:[.55001,1.05,0,0,1.51112],10756:[.55001,1.05,0,0,1.11111],10758:[.55001,1.05,0,0,1.11111]},"Size3-Regular":{32:[0,0,0,0,.25],40:[.95003,1.45,0,0,.73611],41:[.95003,1.45,0,0,.73611],47:[.95003,1.45,0,0,1.04445],91:[.95003,1.45,0,0,.52778],92:[.95003,1.45,0,0,1.04445],93:[.95003,1.45,0,0,.52778],123:[.95003,1.45,0,0,.75],125:[.95003,1.45,0,0,.75],160:[0,0,0,0,.25],710:[0,.75,0,0,1.44445],732:[0,.75,0,0,1.44445],770:[0,.75,0,0,1.44445],771:[0,.75,0,0,1.44445],8730:[.95003,1.45,0,0,1],8968:[.95003,1.45,0,0,.58334],8969:[.95003,1.45,0,0,.58334],8970:[.95003,1.45,0,0,.58334],8971:[.95003,1.45,0,0,.58334],10216:[.95003,1.45,0,0,.75],10217:[.95003,1.45,0,0,.75]},"Size4-Regular":{32:[0,0,0,0,.25],40:[1.25003,1.75,0,0,.79167],41:[1.25003,1.75,0,0,.79167],47:[1.25003,1.75,0,0,1.27778],91:[1.25003,1.75,0,0,.58334],92:[1.25003,1.75,0,0,1.27778],93:[1.25003,1.75,0,0,.58334],123:[1.25003,1.75,0,0,.80556],125:[1.25003,1.75,0,0,.80556],160:[0,0,0,0,.25],710:[0,.825,0,0,1.8889],732:[0,.825,0,0,1.8889],770:[0,.825,0,0,1.8889],771:[0,.825,0,0,1.8889],8730:[1.25003,1.75,0,0,1],8968:[1.25003,1.75,0,0,.63889],8969:[1.25003,1.75,0,0,.63889],8970:[1.25003,1.75,0,0,.63889],8971:[1.25003,1.75,0,0,.63889],9115:[.64502,1.155,0,0,.875],9116:[1e-5,.6,0,0,.875],9117:[.64502,1.155,0,0,.875],9118:[.64502,1.155,0,0,.875],9119:[1e-5,.6,0,0,.875],9120:[.64502,1.155,0,0,.875],9121:[.64502,1.155,0,0,.66667],9122:[-99e-5,.601,0,0,.66667],9123:[.64502,1.155,0,0,.66667],9124:[.64502,1.155,0,0,.66667],9125:[-99e-5,.601,0,0,.66667],9126:[.64502,1.155,0,0,.66667],9127:[1e-5,.9,0,0,.88889],9128:[.65002,1.15,0,0,.88889],9129:[.90001,0,0,0,.88889],9130:[0,.3,0,0,.88889],9131:[1e-5,.9,0,0,.88889],9132:[.65002,1.15,0,0,.88889],9133:[.90001,0,0,0,.88889],9143:[.88502,.915,0,0,1.05556],10216:[1.25003,1.75,0,0,.80556],10217:[1.25003,1.75,0,0,.80556],57344:[-.00499,.605,0,0,1.05556],57345:[-.00499,.605,0,0,1.05556],57680:[0,.12,0,0,.45],57681:[0,.12,0,0,.45],57682:[0,.12,0,0,.45],57683:[0,.12,0,0,.45]},"Typewriter-Regular":{32:[0,0,0,0,.525],33:[0,.61111,0,0,.525],34:[0,.61111,0,0,.525],35:[0,.61111,0,0,.525],36:[.08333,.69444,0,0,.525],37:[.08333,.69444,0,0,.525],38:[0,.61111,0,0,.525],39:[0,.61111,0,0,.525],40:[.08333,.69444,0,0,.525],41:[.08333,.69444,0,0,.525],42:[0,.52083,0,0,.525],43:[-.08056,.53055,0,0,.525],44:[.13889,.125,0,0,.525],45:[-.08056,.53055,0,0,.525],46:[0,.125,0,0,.525],47:[.08333,.69444,0,0,.525],48:[0,.61111,0,0,.525],49:[0,.61111,0,0,.525],50:[0,.61111,0,0,.525],51:[0,.61111,0,0,.525],52:[0,.61111,0,0,.525],53:[0,.61111,0,0,.525],54:[0,.61111,0,0,.525],55:[0,.61111,0,0,.525],56:[0,.61111,0,0,.525],57:[0,.61111,0,0,.525],58:[0,.43056,0,0,.525],59:[.13889,.43056,0,0,.525],60:[-.05556,.55556,0,0,.525],61:[-.19549,.41562,0,0,.525],62:[-.05556,.55556,0,0,.525],63:[0,.61111,0,0,.525],64:[0,.61111,0,0,.525],65:[0,.61111,0,0,.525],66:[0,.61111,0,0,.525],67:[0,.61111,0,0,.525],68:[0,.61111,0,0,.525],69:[0,.61111,0,0,.525],70:[0,.61111,0,0,.525],71:[0,.61111,0,0,.525],72:[0,.61111,0,0,.525],73:[0,.61111,0,0,.525],74:[0,.61111,0,0,.525],75:[0,.61111,0,0,.525],76:[0,.61111,0,0,.525],77:[0,.61111,0,0,.525],78:[0,.61111,0,0,.525],79:[0,.61111,0,0,.525],80:[0,.61111,0,0,.525],81:[.13889,.61111,0,0,.525],82:[0,.61111,0,0,.525],83:[0,.61111,0,0,.525],84:[0,.61111,0,0,.525],85:[0,.61111,0,0,.525],86:[0,.61111,0,0,.525],87:[0,.61111,0,0,.525],88:[0,.61111,0,0,.525],89:[0,.61111,0,0,.525],90:[0,.61111,0,0,.525],91:[.08333,.69444,0,0,.525],92:[.08333,.69444,0,0,.525],93:[.08333,.69444,0,0,.525],94:[0,.61111,0,0,.525],95:[.09514,0,0,0,.525],96:[0,.61111,0,0,.525],97:[0,.43056,0,0,.525],98:[0,.61111,0,0,.525],99:[0,.43056,0,0,.525],100:[0,.61111,0,0,.525],101:[0,.43056,0,0,.525],102:[0,.61111,0,0,.525],103:[.22222,.43056,0,0,.525],104:[0,.61111,0,0,.525],105:[0,.61111,0,0,.525],106:[.22222,.61111,0,0,.525],107:[0,.61111,0,0,.525],108:[0,.61111,0,0,.525],109:[0,.43056,0,0,.525],110:[0,.43056,0,0,.525],111:[0,.43056,0,0,.525],112:[.22222,.43056,0,0,.525],113:[.22222,.43056,0,0,.525],114:[0,.43056,0,0,.525],115:[0,.43056,0,0,.525],116:[0,.55358,0,0,.525],117:[0,.43056,0,0,.525],118:[0,.43056,0,0,.525],119:[0,.43056,0,0,.525],120:[0,.43056,0,0,.525],121:[.22222,.43056,0,0,.525],122:[0,.43056,0,0,.525],123:[.08333,.69444,0,0,.525],124:[.08333,.69444,0,0,.525],125:[.08333,.69444,0,0,.525],126:[0,.61111,0,0,.525],127:[0,.61111,0,0,.525],160:[0,0,0,0,.525],176:[0,.61111,0,0,.525],184:[.19445,0,0,0,.525],305:[0,.43056,0,0,.525],567:[.22222,.43056,0,0,.525],711:[0,.56597,0,0,.525],713:[0,.56555,0,0,.525],714:[0,.61111,0,0,.525],715:[0,.61111,0,0,.525],728:[0,.61111,0,0,.525],730:[0,.61111,0,0,.525],770:[0,.61111,0,0,.525],771:[0,.61111,0,0,.525],776:[0,.61111,0,0,.525],915:[0,.61111,0,0,.525],916:[0,.61111,0,0,.525],920:[0,.61111,0,0,.525],923:[0,.61111,0,0,.525],926:[0,.61111,0,0,.525],928:[0,.61111,0,0,.525],931:[0,.61111,0,0,.525],933:[0,.61111,0,0,.525],934:[0,.61111,0,0,.525],936:[0,.61111,0,0,.525],937:[0,.61111,0,0,.525],8216:[0,.61111,0,0,.525],8217:[0,.61111,0,0,.525],8242:[0,.61111,0,0,.525],9251:[.11111,.21944,0,0,.525]}},sigmasAndXis={slant:[.25,.25,.25],space:[0,0,0],stretch:[0,0,0],shrink:[0,0,0],xHeight:[.431,.431,.431],quad:[1,1.171,1.472],extraSpace:[0,0,0],num1:[.677,.732,.925],num2:[.394,.384,.387],num3:[.444,.471,.504],denom1:[.686,.752,1.025],denom2:[.345,.344,.532],sup1:[.413,.503,.504],sup2:[.363,.431,.404],sup3:[.289,.286,.294],sub1:[.15,.143,.2],sub2:[.247,.286,.4],supDrop:[.386,.353,.494],subDrop:[.05,.071,.1],delim1:[2.39,1.7,1.98],delim2:[1.01,1.157,1.42],axisHeight:[.25,.25,.25],defaultRuleThickness:[.04,.049,.049],bigOpSpacing1:[.111,.111,.111],bigOpSpacing2:[.166,.166,.166],bigOpSpacing3:[.2,.2,.2],bigOpSpacing4:[.6,.611,.611],bigOpSpacing5:[.1,.143,.143],sqrtRuleThickness:[.04,.04,.04],ptPerEm:[10,10,10],doubleRuleSep:[.2,.2,.2],arrayRuleWidth:[.04,.04,.04],fboxsep:[.3,.3,.3],fboxrule:[.04,.04,.04]},extraCharacterMap={\u00C5:"A",\u00D0:"D",\u00DE:"o",\u00E5:"a",\u00F0:"d",\u00FE:"o",\u0410:"A",\u0411:"B",\u0412:"B",\u0413:"F",\u0414:"A",\u0415:"E",\u0416:"K",\u0417:"3",\u0418:"N",\u0419:"N",\u041A:"K",\u041B:"N",\u041C:"M",\u041D:"H",\u041E:"O",\u041F:"N",\u0420:"P",\u0421:"C",\u0422:"T",\u0423:"y",\u0424:"O",\u0425:"X",\u0426:"U",\u0427:"h",\u0428:"W",\u0429:"W",\u042A:"B",\u042B:"X",\u042C:"B",\u042D:"3",\u042E:"X",\u042F:"R",\u0430:"a",\u0431:"b",\u0432:"a",\u0433:"r",\u0434:"y",\u0435:"e",\u0436:"m",\u0437:"e",\u0438:"n",\u0439:"n",\u043A:"n",\u043B:"n",\u043C:"m",\u043D:"n",\u043E:"o",\u043F:"n",\u0440:"p",\u0441:"c",\u0442:"o",\u0443:"y",\u0444:"b",\u0445:"x",\u0446:"n",\u0447:"n",\u0448:"w",\u0449:"w",\u044A:"a",\u044B:"m",\u044C:"a",\u044D:"e",\u044E:"m",\u044F:"r"};function setFontMetrics(r,e){fontMetricsData[r]=e}function getCharacterMetrics(r,e,n){if(!fontMetricsData[e])throw new Error("Font metrics not found for font: "+e+".");var o=r.charCodeAt(0),s=fontMetricsData[e][o];if(!s&&r[0]in extraCharacterMap&&(o=extraCharacterMap[r[0]].charCodeAt(0),s=fontMetricsData[e][o]),!s&&n==="text"&&supportedCodepoint(o)&&(s=fontMetricsData[e][77]),s)return{depth:s[0],height:s[1],italic:s[2],skew:s[3],width:s[4]}}var fontMetricsBySizeIndex={};function getGlobalMetrics(r){var e;if(r>=5?e=0:r>=3?e=1:e=2,!fontMetricsBySizeIndex[e]){var n=fontMetricsBySizeIndex[e]={cssEmPerMu:sigmasAndXis.quad[e]/18};for(var o in sigmasAndXis)sigmasAndXis.hasOwnProperty(o)&&(n[o]=sigmasAndXis[o][e])}return fontMetricsBySizeIndex[e]}var sizeStyleMap=[[1,1,1],[2,1,1],[3,1,1],[4,2,1],[5,2,1],[6,3,1],[7,4,2],[8,6,3],[9,7,6],[10,8,7],[11,10,9]],sizeMultipliers=[.5,.6,.7,.8,.9,1,1.2,1.44,1.728,2.074,2.488],sizeAtStyle=function r(e,n){return n.size<2?e:sizeStyleMap[e-1][n.size-1]};class Options{constructor(e){this.style=void 0,this.color=void 0,this.size=void 0,this.textSize=void 0,this.phantom=void 0,this.font=void 0,this.fontFamily=void 0,this.fontWeight=void 0,this.fontShape=void 0,this.sizeMultiplier=void 0,this.maxSize=void 0,this.minRuleThickness=void 0,this._fontMetrics=void 0,this.style=e.style,this.color=e.color,this.size=e.size||Options.BASESIZE,this.textSize=e.textSize||this.size,this.phantom=!!e.phantom,this.font=e.font||"",this.fontFamily=e.fontFamily||"",this.fontWeight=e.fontWeight||"",this.fontShape=e.fontShape||"",this.sizeMultiplier=sizeMultipliers[this.size-1],this.maxSize=e.maxSize,this.minRuleThickness=e.minRuleThickness,this._fontMetrics=void 0}extend(e){var n={style:this.style,size:this.size,textSize:this.textSize,color:this.color,phantom:this.phantom,font:this.font,fontFamily:this.fontFamily,fontWeight:this.fontWeight,fontShape:this.fontShape,maxSize:this.maxSize,minRuleThickness:this.minRuleThickness};for(var o in e)e.hasOwnProperty(o)&&(n[o]=e[o]);return new Options(n)}havingStyle(e){return this.style===e?this:this.extend({style:e,size:sizeAtStyle(this.textSize,e)})}havingCrampedStyle(){return this.havingStyle(this.style.cramp())}havingSize(e){return this.size===e&&this.textSize===e?this:this.extend({style:this.style.text(),size:e,textSize:e,sizeMultiplier:sizeMultipliers[e-1]})}havingBaseStyle(e){e=e||this.style.text();var n=sizeAtStyle(Options.BASESIZE,e);return this.size===n&&this.textSize===Options.BASESIZE&&this.style===e?this:this.extend({style:e,size:n})}havingBaseSizing(){var e;switch(this.style.id){case 4:case 5:e=3;break;case 6:case 7:e=1;break;default:e=6}return this.extend({style:this.style.text(),size:e})}withColor(e){return this.extend({color:e})}withPhantom(){return this.extend({phantom:!0})}withFont(e){return this.extend({font:e})}withTextFontFamily(e){return this.extend({fontFamily:e,font:""})}withTextFontWeight(e){return this.extend({fontWeight:e,font:""})}withTextFontShape(e){return this.extend({fontShape:e,font:""})}sizingClasses(e){return e.size!==this.size?["sizing","reset-size"+e.size,"size"+this.size]:[]}baseSizingClasses(){return this.size!==Options.BASESIZE?["sizing","reset-size"+this.size,"size"+Options.BASESIZE]:[]}fontMetrics(){return this._fontMetrics||(this._fontMetrics=getGlobalMetrics(this.size)),this._fontMetrics}getColor(){return this.phantom?"transparent":this.color}}Options.BASESIZE=6;var ptPerUnit={pt:1,mm:7227/2540,cm:7227/254,in:72.27,bp:803/800,pc:12,dd:1238/1157,cc:14856/1157,nd:685/642,nc:1370/107,sp:1/65536,px:803/800},relativeUnit={ex:!0,em:!0,mu:!0},validUnit=function r(e){return typeof e!="string"&&(e=e.unit),e in ptPerUnit||e in relativeUnit||e==="ex"},calculateSize=function r(e,n){var o;if(e.unit in ptPerUnit)o=ptPerUnit[e.unit]/n.fontMetrics().ptPerEm/n.sizeMultiplier;else if(e.unit==="mu")o=n.fontMetrics().cssEmPerMu;else{var s;if(n.style.isTight()?s=n.havingStyle(n.style.text()):s=n,e.unit==="ex")o=s.fontMetrics().xHeight;else if(e.unit==="em")o=s.fontMetrics().quad;else throw new ParseError("Invalid unit: '"+e.unit+"'");s!==n&&(o*=s.sizeMultiplier/n.sizeMultiplier)}return Math.min(e.number*o,n.maxSize)},makeEm=function r(e){return+e.toFixed(4)+"em"},createClass=function r(e){return e.filter(n=>n).join(" ")},initNode=function r(e,n,o){if(this.classes=e||[],this.attributes={},this.height=0,this.depth=0,this.maxFontSize=0,this.style=o||{},n){n.style.isTight()&&this.classes.push("mtight");var s=n.getColor();s&&(this.style.color=s)}},toNode=function r(e){var n=document.createElement(e);n.className=createClass(this.classes);for(var o in this.style)this.style.hasOwnProperty(o)&&(n.style[o]=this.style[o]);for(var s in this.attributes)this.attributes.hasOwnProperty(s)&&n.setAttribute(s,this.attributes[s]);for(var a=0;a<this.children.length;a++)n.appendChild(this.children[a].toNode());return n},toMarkup=function r(e){var n="<"+e;this.classes.length&&(n+=' class="'+utils.escape(createClass(this.classes))+'"');var o="";for(var s in this.style)this.style.hasOwnProperty(s)&&(o+=utils.hyphenate(s)+":"+this.style[s]+";");o&&(n+=' style="'+utils.escape(o)+'"');for(var a in this.attributes)this.attributes.hasOwnProperty(a)&&(n+=" "+a+'="'+utils.escape(this.attributes[a])+'"');n+=">";for(var l=0;l<this.children.length;l++)n+=this.children[l].toMarkup();return n+="</"+e+">",n};class Span{constructor(e,n,o,s){this.children=void 0,this.attributes=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.width=void 0,this.maxFontSize=void 0,this.style=void 0,initNode.call(this,e,o,s),this.children=n||[]}setAttribute(e,n){this.attributes[e]=n}hasClass(e){return utils.contains(this.classes,e)}toNode(){return toNode.call(this,"span")}toMarkup(){return toMarkup.call(this,"span")}}class Anchor{constructor(e,n,o,s){this.children=void 0,this.attributes=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,initNode.call(this,n,s),this.children=o||[],this.setAttribute("href",e)}setAttribute(e,n){this.attributes[e]=n}hasClass(e){return utils.contains(this.classes,e)}toNode(){return toNode.call(this,"a")}toMarkup(){return toMarkup.call(this,"a")}}class Img{constructor(e,n,o){this.src=void 0,this.alt=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,this.alt=n,this.src=e,this.classes=["mord"],this.style=o}hasClass(e){return utils.contains(this.classes,e)}toNode(){var e=document.createElement("img");e.src=this.src,e.alt=this.alt,e.className="mord";for(var n in this.style)this.style.hasOwnProperty(n)&&(e.style[n]=this.style[n]);return e}toMarkup(){var e='<img src="'+utils.escape(this.src)+'"'+(' alt="'+utils.escape(this.alt)+'"'),n="";for(var o in this.style)this.style.hasOwnProperty(o)&&(n+=utils.hyphenate(o)+":"+this.style[o]+";");return n&&(e+=' style="'+utils.escape(n)+'"'),e+="'/>",e}}var iCombinations={\u00EE:"\u0131\u0302",\u00EF:"\u0131\u0308",\u00ED:"\u0131\u0301",\u00EC:"\u0131\u0300"};class SymbolNode{constructor(e,n,o,s,a,l,c,d){this.text=void 0,this.height=void 0,this.depth=void 0,this.italic=void 0,this.skew=void 0,this.width=void 0,this.maxFontSize=void 0,this.classes=void 0,this.style=void 0,this.text=e,this.height=n||0,this.depth=o||0,this.italic=s||0,this.skew=a||0,this.width=l||0,this.classes=c||[],this.style=d||{},this.maxFontSize=0;var u=scriptFromCodepoint(this.text.charCodeAt(0));u&&this.classes.push(u+"_fallback"),/[]/.test(this.text)&&(this.text=iCombinations[this.text])}hasClass(e){return utils.contains(this.classes,e)}toNode(){var e=document.createTextNode(this.text),n=null;this.italic>0&&(n=document.createElement("span"),n.style.marginRight=makeEm(this.italic)),this.classes.length>0&&(n=n||document.createElement("span"),n.className=createClass(this.classes));for(var o in this.style)this.style.hasOwnProperty(o)&&(n=n||document.createElement("span"),n.style[o]=this.style[o]);return n?(n.appendChild(e),n):e}toMarkup(){var e=!1,n="<span";this.classes.length&&(e=!0,n+=' class="',n+=utils.escape(createClass(this.classes)),n+='"');var o="";this.italic>0&&(o+="margin-right:"+this.italic+"em;");for(var s in this.style)this.style.hasOwnProperty(s)&&(o+=utils.hyphenate(s)+":"+this.style[s]+";");o&&(e=!0,n+=' style="'+utils.escape(o)+'"');var a=utils.escape(this.text);return e?(n+=">",n+=a,n+="</span>",n):a}}class SvgNode{constructor(e,n){this.children=void 0,this.attributes=void 0,this.children=e||[],this.attributes=n||{}}toNode(){var e="http://www.w3.org/2000/svg",n=document.createElementNS(e,"svg");for(var o in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,o)&&n.setAttribute(o,this.attributes[o]);for(var s=0;s<this.children.length;s++)n.appendChild(this.children[s].toNode());return n}toMarkup(){var e='<svg xmlns="http://www.w3.org/2000/svg"';for(var n in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,n)&&(e+=" "+n+'="'+utils.escape(this.attributes[n])+'"');e+=">";for(var o=0;o<this.children.length;o++)e+=this.children[o].toMarkup();return e+="</svg>",e}}class PathNode{constructor(e,n){this.pathName=void 0,this.alternate=void 0,this.pathName=e,this.alternate=n}toNode(){var e="http://www.w3.org/2000/svg",n=document.createElementNS(e,"path");return this.alternate?n.setAttribute("d",this.alternate):n.setAttribute("d",path[this.pathName]),n}toMarkup(){return this.alternate?'<path d="'+utils.escape(this.alternate)+'"/>':'<path d="'+utils.escape(path[this.pathName])+'"/>'}}class LineNode{constructor(e){this.attributes=void 0,this.attributes=e||{}}toNode(){var e="http://www.w3.org/2000/svg",n=document.createElementNS(e,"line");for(var o in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,o)&&n.setAttribute(o,this.attributes[o]);return n}toMarkup(){var e="<line";for(var n in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,n)&&(e+=" "+n+'="'+utils.escape(this.attributes[n])+'"');return e+="/>",e}}function assertSymbolDomNode(r){if(r instanceof SymbolNode)return r;throw new Error("Expected symbolNode but got "+String(r)+".")}function assertSpan(r){if(r instanceof Span)return r;throw new Error("Expected span<HtmlDomNode> but got "+String(r)+".")}var ATOMS={bin:1,close:1,inner:1,open:1,punct:1,rel:1},NON_ATOMS={"accent-token":1,mathord:1,"op-token":1,spacing:1,textord:1},symbols={math:{},text:{}};function defineSymbol(r,e,n,o,s,a){symbols[r][s]={font:e,group:n,replace:o},a&&o&&(symbols[r][o]=symbols[r][s])}var math="math",text="text",main="main",ams="ams",accent="accent-token",bin="bin",close="close",inner="inner",mathord="mathord",op="op-token",open="open",punct="punct",rel="rel",spacing="spacing",textord="textord";defineSymbol(math,main,rel,"\u2261","\\equiv",!0),defineSymbol(math,main,rel,"\u227A","\\prec",!0),defineSymbol(math,main,rel,"\u227B","\\succ",!0),defineSymbol(math,main,rel,"\u223C","\\sim",!0),defineSymbol(math,main,rel,"\u22A5","\\perp"),defineSymbol(math,main,rel,"\u2AAF","\\preceq",!0),defineSymbol(math,main,rel,"\u2AB0","\\succeq",!0),defineSymbol(math,main,rel,"\u2243","\\simeq",!0),defineSymbol(math,main,rel,"\u2223","\\mid",!0),defineSymbol(math,main,rel,"\u226A","\\ll",!0),defineSymbol(math,main,rel,"\u226B","\\gg",!0),defineSymbol(math,main,rel,"\u224D","\\asymp",!0),defineSymbol(math,main,rel,"\u2225","\\parallel"),defineSymbol(math,main,rel,"\u22C8","\\bowtie",!0),defineSymbol(math,main,rel,"\u2323","\\smile",!0),defineSymbol(math,main,rel,"\u2291","\\sqsubseteq",!0),defineSymbol(math,main,rel,"\u2292","\\sqsupseteq",!0),defineSymbol(math,main,rel,"\u2250","\\doteq",!0),defineSymbol(math,main,rel,"\u2322","\\frown",!0),defineSymbol(math,main,rel,"\u220B","\\ni",!0),defineSymbol(math,main,rel,"\u221D","\\propto",!0),defineSymbol(math,main,rel,"\u22A2","\\vdash",!0),defineSymbol(math,main,rel,"\u22A3","\\dashv",!0),defineSymbol(math,main,rel,"\u220B","\\owns"),defineSymbol(math,main,punct,".","\\ldotp"),defineSymbol(math,main,punct,"\u22C5","\\cdotp"),defineSymbol(math,main,textord,"#","\\#"),defineSymbol(text,main,textord,"#","\\#"),defineSymbol(math,main,textord,"&","\\&"),defineSymbol(text,main,textord,"&","\\&"),defineSymbol(math,main,textord,"\u2135","\\aleph",!0),defineSymbol(math,main,textord,"\u2200","\\forall",!0),defineSymbol(math,main,textord,"\u210F","\\hbar",!0),defineSymbol(math,main,textord,"\u2203","\\exists",!0),defineSymbol(math,main,textord,"\u2207","\\nabla",!0),defineSymbol(math,main,textord,"\u266D","\\flat",!0),defineSymbol(math,main,textord,"\u2113","\\ell",!0),defineSymbol(math,main,textord,"\u266E","\\natural",!0),defineSymbol(math,main,textord,"\u2663","\\clubsuit",!0),defineSymbol(math,main,textord,"\u2118","\\wp",!0),defineSymbol(math,main,textord,"\u266F","\\sharp",!0),defineSymbol(math,main,textord,"\u2662","\\diamondsuit",!0),defineSymbol(math,main,textord,"\u211C","\\Re",!0),defineSymbol(math,main,textord,"\u2661","\\heartsuit",!0),defineSymbol(math,main,textord,"\u2111","\\Im",!0),defineSymbol(math,main,textord,"\u2660","\\spadesuit",!0),defineSymbol(math,main,textord,"\xA7","\\S",!0),defineSymbol(text,main,textord,"\xA7","\\S"),defineSymbol(math,main,textord,"\xB6","\\P",!0),defineSymbol(text,main,textord,"\xB6","\\P"),defineSymbol(math,main,textord,"\u2020","\\dag"),defineSymbol(text,main,textord,"\u2020","\\dag"),defineSymbol(text,main,textord,"\u2020","\\textdagger"),defineSymbol(math,main,textord,"\u2021","\\ddag"),defineSymbol(text,main,textord,"\u2021","\\ddag"),defineSymbol(text,main,textord,"\u2021","\\textdaggerdbl"),defineSymbol(math,main,close,"\u23B1","\\rmoustache",!0),defineSymbol(math,main,open,"\u23B0","\\lmoustache",!0),defineSymbol(math,main,close,"\u27EF","\\rgroup",!0),defineSymbol(math,main,open,"\u27EE","\\lgroup",!0),defineSymbol(math,main,bin,"\u2213","\\mp",!0),defineSymbol(math,main,bin,"\u2296","\\ominus",!0),defineSymbol(math,main,bin,"\u228E","\\uplus",!0),defineSymbol(math,main,bin,"\u2293","\\sqcap",!0),defineSymbol(math,main,bin,"\u2217","\\ast"),defineSymbol(math,main,bin,"\u2294","\\sqcup",!0),defineSymbol(math,main,bin,"\u25EF","\\bigcirc",!0),defineSymbol(math,main,bin,"\u2219","\\bullet",!0),defineSymbol(math,main,bin,"\u2021","\\ddagger"),defineSymbol(math,main,bin,"\u2240","\\wr",!0),defineSymbol(math,main,bin,"\u2A3F","\\amalg"),defineSymbol(math,main,bin,"&","\\And"),defineSymbol(math,main,rel,"\u27F5","\\longleftarrow",!0),defineSymbol(math,main,rel,"\u21D0","\\Leftarrow",!0),defineSymbol(math,main,rel,"\u27F8","\\Longleftarrow",!0),defineSymbol(math,main,rel,"\u27F6","\\longrightarrow",!0),defineSymbol(math,main,rel,"\u21D2","\\Rightarrow",!0),defineSymbol(math,main,rel,"\u27F9","\\Longrightarrow",!0),defineSymbol(math,main,rel,"\u2194","\\leftrightarrow",!0),defineSymbol(math,main,rel,"\u27F7","\\longleftrightarrow",!0),defineSymbol(math,main,rel,"\u21D4","\\Leftrightarrow",!0),defineSymbol(math,main,rel,"\u27FA","\\Longleftrightarrow",!0),defineSymbol(math,main,rel,"\u21A6","\\mapsto",!0),defineSymbol(math,main,rel,"\u27FC","\\longmapsto",!0),defineSymbol(math,main,rel,"\u2197","\\nearrow",!0),defineSymbol(math,main,rel,"\u21A9","\\hookleftarrow",!0),defineSymbol(math,main,rel,"\u21AA","\\hookrightarrow",!0),defineSymbol(math,main,rel,"\u2198","\\searrow",!0),defineSymbol(math,main,rel,"\u21BC","\\leftharpoonup",!0),defineSymbol(math,main,rel,"\u21C0","\\rightharpoonup",!0),defineSymbol(math,main,rel,"\u2199","\\swarrow",!0),defineSymbol(math,main,rel,"\u21BD","\\leftharpoondown",!0),defineSymbol(math,main,rel,"\u21C1","\\rightharpoondown",!0),defineSymbol(math,main,rel,"\u2196","\\nwarrow",!0),defineSymbol(math,main,rel,"\u21CC","\\rightleftharpoons",!0),defineSymbol(math,ams,rel,"\u226E","\\nless",!0),defineSymbol(math,ams,rel,"\uE010","\\@nleqslant"),defineSymbol(math,ams,rel,"\uE011","\\@nleqq"),defineSymbol(math,ams,rel,"\u2A87","\\lneq",!0),defineSymbol(math,ams,rel,"\u2268","\\lneqq",!0),defineSymbol(math,ams,rel,"\uE00C","\\@lvertneqq"),defineSymbol(math,ams,rel,"\u22E6","\\lnsim",!0),defineSymbol(math,ams,rel,"\u2A89","\\lnapprox",!0),defineSymbol(math,ams,rel,"\u2280","\\nprec",!0),defineSymbol(math,ams,rel,"\u22E0","\\npreceq",!0),defineSymbol(math,ams,rel,"\u22E8","\\precnsim",!0),defineSymbol(math,ams,rel,"\u2AB9","\\precnapprox",!0),defineSymbol(math,ams,rel,"\u2241","\\nsim",!0),defineSymbol(math,ams,rel,"\uE006","\\@nshortmid"),defineSymbol(math,ams,rel,"\u2224","\\nmid",!0),defineSymbol(math,ams,rel,"\u22AC","\\nvdash",!0),defineSymbol(math,ams,rel,"\u22AD","\\nvDash",!0),defineSymbol(math,ams,rel,"\u22EA","\\ntriangleleft"),defineSymbol(math,ams,rel,"\u22EC","\\ntrianglelefteq",!0),defineSymbol(math,ams,rel,"\u228A","\\subsetneq",!0),defineSymbol(math,ams,rel,"\uE01A","\\@varsubsetneq"),defineSymbol(math,ams,rel,"\u2ACB","\\subsetneqq",!0),defineSymbol(math,ams,rel,"\uE017","\\@varsubsetneqq"),defineSymbol(math,ams,rel,"\u226F","\\ngtr",!0),defineSymbol(math,ams,rel,"\uE00F","\\@ngeqslant"),defineSymbol(math,ams,rel,"\uE00E","\\@ngeqq"),defineSymbol(math,ams,rel,"\u2A88","\\gneq",!0),defineSymbol(math,ams,rel,"\u2269","\\gneqq",!0),defineSymbol(math,ams,rel,"\uE00D","\\@gvertneqq"),defineSymbol(math,ams,rel,"\u22E7","\\gnsim",!0),defineSymbol(math,ams,rel,"\u2A8A","\\gnapprox",!0),defineSymbol(math,ams,rel,"\u2281","\\nsucc",!0),defineSymbol(math,ams,rel,"\u22E1","\\nsucceq",!0),defineSymbol(math,ams,rel,"\u22E9","\\succnsim",!0),defineSymbol(math,ams,rel,"\u2ABA","\\succnapprox",!0),defineSymbol(math,ams,rel,"\u2246","\\ncong",!0),defineSymbol(math,ams,rel,"\uE007","\\@nshortparallel"),defineSymbol(math,ams,rel,"\u2226","\\nparallel",!0),defineSymbol(math,ams,rel,"\u22AF","\\nVDash",!0),defineSymbol(math,ams,rel,"\u22EB","\\ntriangleright"),defineSymbol(math,ams,rel,"\u22ED","\\ntrianglerighteq",!0),defineSymbol(math,ams,rel,"\uE018","\\@nsupseteqq"),defineSymbol(math,ams,rel,"\u228B","\\supsetneq",!0),defineSymbol(math,ams,rel,"\uE01B","\\@varsupsetneq"),defineSymbol(math,ams,rel,"\u2ACC","\\supsetneqq",!0),defineSymbol(math,ams,rel,"\uE019","\\@varsupsetneqq"),defineSymbol(math,ams,rel,"\u22AE","\\nVdash",!0),defineSymbol(math,ams,rel,"\u2AB5","\\precneqq",!0),defineSymbol(math,ams,rel,"\u2AB6","\\succneqq",!0),defineSymbol(math,ams,rel,"\uE016","\\@nsubseteqq"),defineSymbol(math,ams,bin,"\u22B4","\\unlhd"),defineSymbol(math,ams,bin,"\u22B5","\\unrhd"),defineSymbol(math,ams,rel,"\u219A","\\nleftarrow",!0),defineSymbol(math,ams,rel,"\u219B","\\nrightarrow",!0),defineSymbol(math,ams,rel,"\u21CD","\\nLeftarrow",!0),defineSymbol(math,ams,rel,"\u21CF","\\nRightarrow",!0),defineSymbol(math,ams,rel,"\u21AE","\\nleftrightarrow",!0),defineSymbol(math,ams,rel,"\u21CE","\\nLeftrightarrow",!0),defineSymbol(math,ams,rel,"\u25B3","\\vartriangle"),defineSymbol(math,ams,textord,"\u210F","\\hslash"),defineSymbol(math,ams,textord,"\u25BD","\\triangledown"),defineSymbol(math,ams,textord,"\u25CA","\\lozenge"),defineSymbol(math,ams,textord,"\u24C8","\\circledS"),defineSymbol(math,ams,textord,"\xAE","\\circledR"),defineSymbol(text,ams,textord,"\xAE","\\circledR"),defineSymbol(math,ams,textord,"\u2221","\\measuredangle",!0),defineSymbol(math,ams,textord,"\u2204","\\nexists"),defineSymbol(math,ams,textord,"\u2127","\\mho"),defineSymbol(math,ams,textord,"\u2132","\\Finv",!0),defineSymbol(math,ams,textord,"\u2141","\\Game",!0),defineSymbol(math,ams,textord,"\u2035","\\backprime"),defineSymbol(math,ams,textord,"\u25B2","\\blacktriangle"),defineSymbol(math,ams,textord,"\u25BC","\\blacktriangledown"),defineSymbol(math,ams,textord,"\u25A0","\\blacksquare"),defineSymbol(math,ams,textord,"\u29EB","\\blacklozenge"),defineSymbol(math,ams,textord,"\u2605","\\bigstar"),defineSymbol(math,ams,textord,"\u2222","\\sphericalangle",!0),defineSymbol(math,ams,textord,"\u2201","\\complement",!0),defineSymbol(math,ams,textord,"\xF0","\\eth",!0),defineSymbol(text,main,textord,"\xF0","\xF0"),defineSymbol(math,ams,textord,"\u2571","\\diagup"),defineSymbol(math,ams,textord,"\u2572","\\diagdown"),defineSymbol(math,ams,textord,"\u25A1","\\square"),defineSymbol(math,ams,textord,"\u25A1","\\Box"),defineSymbol(math,ams,textord,"\u25CA","\\Diamond"),defineSymbol(math,ams,textord,"\xA5","\\yen",!0),defineSymbol(text,ams,textord,"\xA5","\\yen",!0),defineSymbol(math,ams,textord,"\u2713","\\checkmark",!0),defineSymbol(text,ams,textord,"\u2713","\\checkmark"),defineSymbol(math,ams,textord,"\u2136","\\beth",!0),defineSymbol(math,ams,textord,"\u2138","\\daleth",!0),defineSymbol(math,ams,textord,"\u2137","\\gimel",!0),defineSymbol(math,ams,textord,"\u03DD","\\digamma",!0),defineSymbol(math,ams,textord,"\u03F0","\\varkappa"),defineSymbol(math,ams,open,"\u250C","\\@ulcorner",!0),defineSymbol(math,ams,close,"\u2510","\\@urcorner",!0),defineSymbol(math,ams,open,"\u2514","\\@llcorner",!0),defineSymbol(math,ams,close,"\u2518","\\@lrcorner",!0),defineSymbol(math,ams,rel,"\u2266","\\leqq",!0),defineSymbol(math,ams,rel,"\u2A7D","\\leqslant",!0),defineSymbol(math,ams,rel,"\u2A95","\\eqslantless",!0),defineSymbol(math,ams,rel,"\u2272","\\lesssim",!0),defineSymbol(math,ams,rel,"\u2A85","\\lessapprox",!0),defineSymbol(math,ams,rel,"\u224A","\\approxeq",!0),defineSymbol(math,ams,bin,"\u22D6","\\lessdot"),defineSymbol(math,ams,rel,"\u22D8","\\lll",!0),defineSymbol(math,ams,rel,"\u2276","\\lessgtr",!0),defineSymbol(math,ams,rel,"\u22DA","\\lesseqgtr",!0),defineSymbol(math,ams,rel,"\u2A8B","\\lesseqqgtr",!0),defineSymbol(math,ams,rel,"\u2251","\\doteqdot"),defineSymbol(math,ams,rel,"\u2253","\\risingdotseq",!0),defineSymbol(math,ams,rel,"\u2252","\\fallingdotseq",!0),defineSymbol(math,ams,rel,"\u223D","\\backsim",!0),defineSymbol(math,ams,rel,"\u22CD","\\backsimeq",!0),defineSymbol(math,ams,rel,"\u2AC5","\\subseteqq",!0),defineSymbol(math,ams,rel,"\u22D0","\\Subset",!0),defineSymbol(math,ams,rel,"\u228F","\\sqsubset",!0),defineSymbol(math,ams,rel,"\u227C","\\preccurlyeq",!0),defineSymbol(math,ams,rel,"\u22DE","\\curlyeqprec",!0),defineSymbol(math,ams,rel,"\u227E","\\precsim",!0),defineSymbol(math,ams,rel,"\u2AB7","\\precapprox",!0),defineSymbol(math,ams,rel,"\u22B2","\\vartriangleleft"),defineSymbol(math,ams,rel,"\u22B4","\\trianglelefteq"),defineSymbol(math,ams,rel,"\u22A8","\\vDash",!0),defineSymbol(math,ams,rel,"\u22AA","\\Vvdash",!0),defineSymbol(math,ams,rel,"\u2323","\\smallsmile"),defineSymbol(math,ams,rel,"\u2322","\\smallfrown"),defineSymbol(math,ams,rel,"\u224F","\\bumpeq",!0),defineSymbol(math,ams,rel,"\u224E","\\Bumpeq",!0),defineSymbol(math,ams,rel,"\u2267","\\geqq",!0),defineSymbol(math,ams,rel,"\u2A7E","\\geqslant",!0),defineSymbol(math,ams,rel,"\u2A96","\\eqslantgtr",!0),defineSymbol(math,ams,rel,"\u2273","\\gtrsim",!0),defineSymbol(math,ams,rel,"\u2A86","\\gtrapprox",!0),defineSymbol(math,ams,bin,"\u22D7","\\gtrdot"),defineSymbol(math,ams,rel,"\u22D9","\\ggg",!0),defineSymbol(math,ams,rel,"\u2277","\\gtrless",!0),defineSymbol(math,ams,rel,"\u22DB","\\gtreqless",!0),defineSymbol(math,ams,rel,"\u2A8C","\\gtreqqless",!0),defineSymbol(math,ams,rel,"\u2256","\\eqcirc",!0),defineSymbol(math,ams,rel,"\u2257","\\circeq",!0),defineSymbol(math,ams,rel,"\u225C","\\triangleq",!0),defineSymbol(math,ams,rel,"\u223C","\\thicksim"),defineSymbol(math,ams,rel,"\u2248","\\thickapprox"),defineSymbol(math,ams,rel,"\u2AC6","\\supseteqq",!0),defineSymbol(math,ams,rel,"\u22D1","\\Supset",!0),defineSymbol(math,ams,rel,"\u2290","\\sqsupset",!0),defineSymbol(math,ams,rel,"\u227D","\\succcurlyeq",!0),defineSymbol(math,ams,rel,"\u22DF","\\curlyeqsucc",!0),defineSymbol(math,ams,rel,"\u227F","\\succsim",!0),defineSymbol(math,ams,rel,"\u2AB8","\\succapprox",!0),defineSymbol(math,ams,rel,"\u22B3","\\vartriangleright"),defineSymbol(math,ams,rel,"\u22B5","\\trianglerighteq"),defineSymbol(math,ams,rel,"\u22A9","\\Vdash",!0),defineSymbol(math,ams,rel,"\u2223","\\shortmid"),defineSymbol(math,ams,rel,"\u2225","\\shortparallel"),defineSymbol(math,ams,rel,"\u226C","\\between",!0),defineSymbol(math,ams,rel,"\u22D4","\\pitchfork",!0),defineSymbol(math,ams,rel,"\u221D","\\varpropto"),defineSymbol(math,ams,rel,"\u25C0","\\blacktriangleleft"),defineSymbol(math,ams,rel,"\u2234","\\therefore",!0),defineSymbol(math,ams,rel,"\u220D","\\backepsilon"),defineSymbol(math,ams,rel,"\u25B6","\\blacktriangleright"),defineSymbol(math,ams,rel,"\u2235","\\because",!0),defineSymbol(math,ams,rel,"\u22D8","\\llless"),defineSymbol(math,ams,rel,"\u22D9","\\gggtr"),defineSymbol(math,ams,bin,"\u22B2","\\lhd"),defineSymbol(math,ams,bin,"\u22B3","\\rhd"),defineSymbol(math,ams,rel,"\u2242","\\eqsim",!0),defineSymbol(math,main,rel,"\u22C8","\\Join"),defineSymbol(math,ams,rel,"\u2251","\\Doteq",!0),defineSymbol(math,ams,bin,"\u2214","\\dotplus",!0),defineSymbol(math,ams,bin,"\u2216","\\smallsetminus"),defineSymbol(math,ams,bin,"\u22D2","\\Cap",!0),defineSymbol(math,ams,bin,"\u22D3","\\Cup",!0),defineSymbol(math,ams,bin,"\u2A5E","\\doublebarwedge",!0),defineSymbol(math,ams,bin,"\u229F","\\boxminus",!0),defineSymbol(math,ams,bin,"\u229E","\\boxplus",!0),defineSymbol(math,ams,bin,"\u22C7","\\divideontimes",!0),defineSymbol(math,ams,bin,"\u22C9","\\ltimes",!0),defineSymbol(math,ams,bin,"\u22CA","\\rtimes",!0),defineSymbol(math,ams,bin,"\u22CB","\\leftthreetimes",!0),defineSymbol(math,ams,bin,"\u22CC","\\rightthreetimes",!0),defineSymbol(math,ams,bin,"\u22CF","\\curlywedge",!0),defineSymbol(math,ams,bin,"\u22CE","\\curlyvee",!0),defineSymbol(math,ams,bin,"\u229D","\\circleddash",!0),defineSymbol(math,ams,bin,"\u229B","\\circledast",!0),defineSymbol(math,ams,bin,"\u22C5","\\centerdot"),defineSymbol(math,ams,bin,"\u22BA","\\intercal",!0),defineSymbol(math,ams,bin,"\u22D2","\\doublecap"),defineSymbol(math,ams,bin,"\u22D3","\\doublecup"),defineSymbol(math,ams,bin,"\u22A0","\\boxtimes",!0),defineSymbol(math,ams,rel,"\u21E2","\\dashrightarrow",!0),defineSymbol(math,ams,rel,"\u21E0","\\dashleftarrow",!0),defineSymbol(math,ams,rel,"\u21C7","\\leftleftarrows",!0),defineSymbol(math,ams,rel,"\u21C6","\\leftrightarrows",!0),defineSymbol(math,ams,rel,"\u21DA","\\Lleftarrow",!0),defineSymbol(math,ams,rel,"\u219E","\\twoheadleftarrow",!0),defineSymbol(math,ams,rel,"\u21A2","\\leftarrowtail",!0),defineSymbol(math,ams,rel,"\u21AB","\\looparrowleft",!0),defineSymbol(math,ams,rel,"\u21CB","\\leftrightharpoons",!0),defineSymbol(math,ams,rel,"\u21B6","\\curvearrowleft",!0),defineSymbol(math,ams,rel,"\u21BA","\\circlearrowleft",!0),defineSymbol(math,ams,rel,"\u21B0","\\Lsh",!0),defineSymbol(math,ams,rel,"\u21C8","\\upuparrows",!0),defineSymbol(math,ams,rel,"\u21BF","\\upharpoonleft",!0),defineSymbol(math,ams,rel,"\u21C3","\\downharpoonleft",!0),defineSymbol(math,main,rel,"\u22B6","\\origof",!0),defineSymbol(math,main,rel,"\u22B7","\\imageof",!0),defineSymbol(math,ams,rel,"\u22B8","\\multimap",!0),defineSymbol(math,ams,rel,"\u21AD","\\leftrightsquigarrow",!0),defineSymbol(math,ams,rel,"\u21C9","\\rightrightarrows",!0),defineSymbol(math,ams,rel,"\u21C4","\\rightleftarrows",!0),defineSymbol(math,ams,rel,"\u21A0","\\twoheadrightarrow",!0),defineSymbol(math,ams,rel,"\u21A3","\\rightarrowtail",!0),defineSymbol(math,ams,rel,"\u21AC","\\looparrowright",!0),defineSymbol(math,ams,rel,"\u21B7","\\curvearrowright",!0),defineSymbol(math,ams,rel,"\u21BB","\\circlearrowright",!0),defineSymbol(math,ams,rel,"\u21B1","\\Rsh",!0),defineSymbol(math,ams,rel,"\u21CA","\\downdownarrows",!0),defineSymbol(math,ams,rel,"\u21BE","\\upharpoonright",!0),defineSymbol(math,ams,rel,"\u21C2","\\downharpoonright",!0),defineSymbol(math,ams,rel,"\u21DD","\\rightsquigarrow",!0),defineSymbol(math,ams,rel,"\u21DD","\\leadsto"),defineSymbol(math,ams,rel,"\u21DB","\\Rrightarrow",!0),defineSymbol(math,ams,rel,"\u21BE","\\restriction"),defineSymbol(math,main,textord,"\u2018","`"),defineSymbol(math,main,textord,"$","\\$"),defineSymbol(text,main,textord,"$","\\$"),defineSymbol(text,main,textord,"$","\\textdollar"),defineSymbol(math,main,textord,"%","\\%"),defineSymbol(text,main,textord,"%","\\%"),defineSymbol(math,main,textord,"_","\\_"),defineSymbol(text,main,textord,"_","\\_"),defineSymbol(text,main,textord,"_","\\textunderscore"),defineSymbol(math,main,textord,"\u2220","\\angle",!0),defineSymbol(math,main,textord,"\u221E","\\infty",!0),defineSymbol(math,main,textord,"\u2032","\\prime"),defineSymbol(math,main,textord,"\u25B3","\\triangle"),defineSymbol(math,main,textord,"\u0393","\\Gamma",!0),defineSymbol(math,main,textord,"\u0394","\\Delta",!0),defineSymbol(math,main,textord,"\u0398","\\Theta",!0),defineSymbol(math,main,textord,"\u039B","\\Lambda",!0),defineSymbol(math,main,textord,"\u039E","\\Xi",!0),defineSymbol(math,main,textord,"\u03A0","\\Pi",!0),defineSymbol(math,main,textord,"\u03A3","\\Sigma",!0),defineSymbol(math,main,textord,"\u03A5","\\Upsilon",!0),defineSymbol(math,main,textord,"\u03A6","\\Phi",!0),defineSymbol(math,main,textord,"\u03A8","\\Psi",!0),defineSymbol(math,main,textord,"\u03A9","\\Omega",!0),defineSymbol(math,main,textord,"A","\u0391"),defineSymbol(math,main,textord,"B","\u0392"),defineSymbol(math,main,textord,"E","\u0395"),defineSymbol(math,main,textord,"Z","\u0396"),defineSymbol(math,main,textord,"H","\u0397"),defineSymbol(math,main,textord,"I","\u0399"),defineSymbol(math,main,textord,"K","\u039A"),defineSymbol(math,main,textord,"M","\u039C"),defineSymbol(math,main,textord,"N","\u039D"),defineSymbol(math,main,textord,"O","\u039F"),defineSymbol(math,main,textord,"P","\u03A1"),defineSymbol(math,main,textord,"T","\u03A4"),defineSymbol(math,main,textord,"X","\u03A7"),defineSymbol(math,main,textord,"\xAC","\\neg",!0),defineSymbol(math,main,textord,"\xAC","\\lnot"),defineSymbol(math,main,textord,"\u22A4","\\top"),defineSymbol(math,main,textord,"\u22A5","\\bot"),defineSymbol(math,main,textord,"\u2205","\\emptyset"),defineSymbol(math,ams,textord,"\u2205","\\varnothing"),defineSymbol(math,main,mathord,"\u03B1","\\alpha",!0),defineSymbol(math,main,mathord,"\u03B2","\\beta",!0),defineSymbol(math,main,mathord,"\u03B3","\\gamma",!0),defineSymbol(math,main,mathord,"\u03B4","\\delta",!0),defineSymbol(math,main,mathord,"\u03F5","\\epsilon",!0),defineSymbol(math,main,mathord,"\u03B6","\\zeta",!0),defineSymbol(math,main,mathord,"\u03B7","\\eta",!0),defineSymbol(math,main,mathord,"\u03B8","\\theta",!0),defineSymbol(math,main,mathord,"\u03B9","\\iota",!0),defineSymbol(math,main,mathord,"\u03BA","\\kappa",!0),defineSymbol(math,main,mathord,"\u03BB","\\lambda",!0),defineSymbol(math,main,mathord,"\u03BC","\\mu",!0),defineSymbol(math,main,mathord,"\u03BD","\\nu",!0),defineSymbol(math,main,mathord,"\u03BE","\\xi",!0),defineSymbol(math,main,mathord,"\u03BF","\\omicron",!0),defineSymbol(math,main,mathord,"\u03C0","\\pi",!0),defineSymbol(math,main,mathord,"\u03C1","\\rho",!0),defineSymbol(math,main,mathord,"\u03C3","\\sigma",!0),defineSymbol(math,main,mathord,"\u03C4","\\tau",!0),defineSymbol(math,main,mathord,"\u03C5","\\upsilon",!0),defineSymbol(math,main,mathord,"\u03D5","\\phi",!0),defineSymbol(math,main,mathord,"\u03C7","\\chi",!0),defineSymbol(math,main,mathord,"\u03C8","\\psi",!0),defineSymbol(math,main,mathord,"\u03C9","\\omega",!0),defineSymbol(math,main,mathord,"\u03B5","\\varepsilon",!0),defineSymbol(math,main,mathord,"\u03D1","\\vartheta",!0),defineSymbol(math,main,mathord,"\u03D6","\\varpi",!0),defineSymbol(math,main,mathord,"\u03F1","\\varrho",!0),defineSymbol(math,main,mathord,"\u03C2","\\varsigma",!0),defineSymbol(math,main,mathord,"\u03C6","\\varphi",!0),defineSymbol(math,main,bin,"\u2217","*",!0),defineSymbol(math,main,bin,"+","+"),defineSymbol(math,main,bin,"\u2212","-",!0),defineSymbol(math,main,bin,"\u22C5","\\cdot",!0),defineSymbol(math,main,bin,"\u2218","\\circ",!0),defineSymbol(math,main,bin,"\xF7","\\div",!0),defineSymbol(math,main,bin,"\xB1","\\pm",!0),defineSymbol(math,main,bin,"\xD7","\\times",!0),defineSymbol(math,main,bin,"\u2229","\\cap",!0),defineSymbol(math,main,bin,"\u222A","\\cup",!0),defineSymbol(math,main,bin,"\u2216","\\setminus",!0),defineSymbol(math,main,bin,"\u2227","\\land"),defineSymbol(math,main,bin,"\u2228","\\lor"),defineSymbol(math,main,bin,"\u2227","\\wedge",!0),defineSymbol(math,main,bin,"\u2228","\\vee",!0),defineSymbol(math,main,textord,"\u221A","\\surd"),defineSymbol(math,main,open,"\u27E8","\\langle",!0),defineSymbol(math,main,open,"\u2223","\\lvert"),defineSymbol(math,main,open,"\u2225","\\lVert"),defineSymbol(math,main,close,"?","?"),defineSymbol(math,main,close,"!","!"),defineSymbol(math,main,close,"\u27E9","\\rangle",!0),defineSymbol(math,main,close,"\u2223","\\rvert"),defineSymbol(math,main,close,"\u2225","\\rVert"),defineSymbol(math,main,rel,"=","="),defineSymbol(math,main,rel,":",":"),defineSymbol(math,main,rel,"\u2248","\\approx",!0),defineSymbol(math,main,rel,"\u2245","\\cong",!0),defineSymbol(math,main,rel,"\u2265","\\ge"),defineSymbol(math,main,rel,"\u2265","\\geq",!0),defineSymbol(math,main,rel,"\u2190","\\gets"),defineSymbol(math,main,rel,">","\\gt",!0),defineSymbol(math,main,rel,"\u2208","\\in",!0),defineSymbol(math,main,rel,"\uE020","\\@not"),defineSymbol(math,main,rel,"\u2282","\\subset",!0),defineSymbol(math,main,rel,"\u2283","\\supset",!0),defineSymbol(math,main,rel,"\u2286","\\subseteq",!0),defineSymbol(math,main,rel,"\u2287","\\supseteq",!0),defineSymbol(math,ams,rel,"\u2288","\\nsubseteq",!0),defineSymbol(math,ams,rel,"\u2289","\\nsupseteq",!0),defineSymbol(math,main,rel,"\u22A8","\\models"),defineSymbol(math,main,rel,"\u2190","\\leftarrow",!0),defineSymbol(math,main,rel,"\u2264","\\le"),defineSymbol(math,main,rel,"\u2264","\\leq",!0),defineSymbol(math,main,rel,"<","\\lt",!0),defineSymbol(math,main,rel,"\u2192","\\rightarrow",!0),defineSymbol(math,main,rel,"\u2192","\\to"),defineSymbol(math,ams,rel,"\u2271","\\ngeq",!0),defineSymbol(math,ams,rel,"\u2270","\\nleq",!0),defineSymbol(math,main,spacing,"\xA0","\\ "),defineSymbol(math,main,spacing,"\xA0","\\space"),defineSymbol(math,main,spacing,"\xA0","\\nobreakspace"),defineSymbol(text,main,spacing,"\xA0","\\ "),defineSymbol(text,main,spacing,"\xA0"," "),defineSymbol(text,main,spacing,"\xA0","\\space"),defineSymbol(text,main,spacing,"\xA0","\\nobreakspace"),defineSymbol(math,main,spacing,null,"\\nobreak"),defineSymbol(math,main,spacing,null,"\\allowbreak"),defineSymbol(math,main,punct,",",","),defineSymbol(math,main,punct,";",";"),defineSymbol(math,ams,bin,"\u22BC","\\barwedge",!0),defineSymbol(math,ams,bin,"\u22BB","\\veebar",!0),defineSymbol(math,main,bin,"\u2299","\\odot",!0),defineSymbol(math,main,bin,"\u2295","\\oplus",!0),defineSymbol(math,main,bin,"\u2297","\\otimes",!0),defineSymbol(math,main,textord,"\u2202","\\partial",!0),defineSymbol(math,main,bin,"\u2298","\\oslash",!0),defineSymbol(math,ams,bin,"\u229A","\\circledcirc",!0),defineSymbol(math,ams,bin,"\u22A1","\\boxdot",!0),defineSymbol(math,main,bin,"\u25B3","\\bigtriangleup"),defineSymbol(math,main,bin,"\u25BD","\\bigtriangledown"),defineSymbol(math,main,bin,"\u2020","\\dagger"),defineSymbol(math,main,bin,"\u22C4","\\diamond"),defineSymbol(math,main,bin,"\u22C6","\\star"),defineSymbol(math,main,bin,"\u25C3","\\triangleleft"),defineSymbol(math,main,bin,"\u25B9","\\triangleright"),defineSymbol(math,main,open,"{","\\{"),defineSymbol(text,main,textord,"{","\\{"),defineSymbol(text,main,textord,"{","\\textbraceleft"),defineSymbol(math,main,close,"}","\\}"),defineSymbol(text,main,textord,"}","\\}"),defineSymbol(text,main,textord,"}","\\textbraceright"),defineSymbol(math,main,open,"{","\\lbrace"),defineSymbol(math,main,close,"}","\\rbrace"),defineSymbol(math,main,open,"[","\\lbrack",!0),defineSymbol(text,main,textord,"[","\\lbrack",!0),defineSymbol(math,main,close,"]","\\rbrack",!0),defineSymbol(text,main,textord,"]","\\rbrack",!0),defineSymbol(math,main,open,"(","\\lparen",!0),defineSymbol(math,main,close,")","\\rparen",!0),defineSymbol(text,main,textord,"<","\\textless",!0),defineSymbol(text,main,textord,">","\\textgreater",!0),defineSymbol(math,main,open,"\u230A","\\lfloor",!0),defineSymbol(math,main,close,"\u230B","\\rfloor",!0),defineSymbol(math,main,open,"\u2308","\\lceil",!0),defineSymbol(math,main,close,"\u2309","\\rceil",!0),defineSymbol(math,main,textord,"\\","\\backslash"),defineSymbol(math,main,textord,"\u2223","|"),defineSymbol(math,main,textord,"\u2223","\\vert"),defineSymbol(text,main,textord,"|","\\textbar",!0),defineSymbol(math,main,textord,"\u2225","\\|"),defineSymbol(math,main,textord,"\u2225","\\Vert"),defineSymbol(text,main,textord,"\u2225","\\textbardbl"),defineSymbol(text,main,textord,"~","\\textasciitilde"),defineSymbol(text,main,textord,"\\","\\textbackslash"),defineSymbol(text,main,textord,"^","\\textasciicircum"),defineSymbol(math,main,rel,"\u2191","\\uparrow",!0),defineSymbol(math,main,rel,"\u21D1","\\Uparrow",!0),defineSymbol(math,main,rel,"\u2193","\\downarrow",!0),defineSymbol(math,main,rel,"\u21D3","\\Downarrow",!0),defineSymbol(math,main,rel,"\u2195","\\updownarrow",!0),defineSymbol(math,main,rel,"\u21D5","\\Updownarrow",!0),defineSymbol(math,main,op,"\u2210","\\coprod"),defineSymbol(math,main,op,"\u22C1","\\bigvee"),defineSymbol(math,main,op,"\u22C0","\\bigwedge"),defineSymbol(math,main,op,"\u2A04","\\biguplus"),defineSymbol(math,main,op,"\u22C2","\\bigcap"),defineSymbol(math,main,op,"\u22C3","\\bigcup"),defineSymbol(math,main,op,"\u222B","\\int"),defineSymbol(math,main,op,"\u222B","\\intop"),defineSymbol(math,main,op,"\u222C","\\iint"),defineSymbol(math,main,op,"\u222D","\\iiint"),defineSymbol(math,main,op,"\u220F","\\prod"),defineSymbol(math,main,op,"\u2211","\\sum"),defineSymbol(math,main,op,"\u2A02","\\bigotimes"),defineSymbol(math,main,op,"\u2A01","\\bigoplus"),defineSymbol(math,main,op,"\u2A00","\\bigodot"),defineSymbol(math,main,op,"\u222E","\\oint"),defineSymbol(math,main,op,"\u222F","\\oiint"),defineSymbol(math,main,op,"\u2230","\\oiiint"),defineSymbol(math,main,op,"\u2A06","\\bigsqcup"),defineSymbol(math,main,op,"\u222B","\\smallint"),defineSymbol(text,main,inner,"\u2026","\\textellipsis"),defineSymbol(math,main,inner,"\u2026","\\mathellipsis"),defineSymbol(text,main,inner,"\u2026","\\ldots",!0),defineSymbol(math,main,inner,"\u2026","\\ldots",!0),defineSymbol(math,main,inner,"\u22EF","\\@cdots",!0),defineSymbol(math,main,inner,"\u22F1","\\ddots",!0),defineSymbol(math,main,textord,"\u22EE","\\varvdots"),defineSymbol(text,main,textord,"\u22EE","\\varvdots"),defineSymbol(math,main,accent,"\u02CA","\\acute"),defineSymbol(math,main,accent,"\u02CB","\\grave"),defineSymbol(math,main,accent,"\xA8","\\ddot"),defineSymbol(math,main,accent,"~","\\tilde"),defineSymbol(math,main,accent,"\u02C9","\\bar"),defineSymbol(math,main,accent,"\u02D8","\\breve"),defineSymbol(math,main,accent,"\u02C7","\\check"),defineSymbol(math,main,accent,"^","\\hat"),defineSymbol(math,main,accent,"\u20D7","\\vec"),defineSymbol(math,main,accent,"\u02D9","\\dot"),defineSymbol(math,main,accent,"\u02DA","\\mathring"),defineSymbol(math,main,mathord,"\uE131","\\@imath"),defineSymbol(math,main,mathord,"\uE237","\\@jmath"),defineSymbol(math,main,textord,"\u0131","\u0131"),defineSymbol(math,main,textord,"\u0237","\u0237"),defineSymbol(text,main,textord,"\u0131","\\i",!0),defineSymbol(text,main,textord,"\u0237","\\j",!0),defineSymbol(text,main,textord,"\xDF","\\ss",!0),defineSymbol(text,main,textord,"\xE6","\\ae",!0),defineSymbol(text,main,textord,"\u0153","\\oe",!0),defineSymbol(text,main,textord,"\xF8","\\o",!0),defineSymbol(text,main,textord,"\xC6","\\AE",!0),defineSymbol(text,main,textord,"\u0152","\\OE",!0),defineSymbol(text,main,textord,"\xD8","\\O",!0),defineSymbol(text,main,accent,"\u02CA","\\'"),defineSymbol(text,main,accent,"\u02CB","\\`"),defineSymbol(text,main,accent,"\u02C6","\\^"),defineSymbol(text,main,accent,"\u02DC","\\~"),defineSymbol(text,main,accent,"\u02C9","\\="),defineSymbol(text,main,accent,"\u02D8","\\u"),defineSymbol(text,main,accent,"\u02D9","\\."),defineSymbol(text,main,accent,"\xB8","\\c"),defineSymbol(text,main,accent,"\u02DA","\\r"),defineSymbol(text,main,accent,"\u02C7","\\v"),defineSymbol(text,main,accent,"\xA8",'\\"'),defineSymbol(text,main,accent,"\u02DD","\\H"),defineSymbol(text,main,accent,"\u25EF","\\textcircled");var ligatures={"--":!0,"---":!0,"``":!0,"''":!0};defineSymbol(text,main,textord,"\u2013","--",!0),defineSymbol(text,main,textord,"\u2013","\\textendash"),defineSymbol(text,main,textord,"\u2014","---",!0),defineSymbol(text,main,textord,"\u2014","\\textemdash"),defineSymbol(text,main,textord,"\u2018","`",!0),defineSymbol(text,main,textord,"\u2018","\\textquoteleft"),defineSymbol(text,main,textord,"\u2019","'",!0),defineSymbol(text,main,textord,"\u2019","\\textquoteright"),defineSymbol(text,main,textord,"\u201C","``",!0),defineSymbol(text,main,textord,"\u201C","\\textquotedblleft"),defineSymbol(text,main,textord,"\u201D","''",!0),defineSymbol(text,main,textord,"\u201D","\\textquotedblright"),defineSymbol(math,main,textord,"\xB0","\\degree",!0),defineSymbol(text,main,textord,"\xB0","\\degree"),defineSymbol(text,main,textord,"\xB0","\\textdegree",!0),defineSymbol(math,main,textord,"\xA3","\\pounds"),defineSymbol(math,main,textord,"\xA3","\\mathsterling",!0),defineSymbol(text,main,textord,"\xA3","\\pounds"),defineSymbol(text,main,textord,"\xA3","\\textsterling",!0),defineSymbol(math,ams,textord,"\u2720","\\maltese"),defineSymbol(text,ams,textord,"\u2720","\\maltese");for(var mathTextSymbols='0123456789/@."',i=0;i<mathTextSymbols.length;i++){var ch=mathTextSymbols.charAt(i);defineSymbol(math,main,textord,ch,ch)}for(var textSymbols='0123456789!@*()-=+";:?/.,',_i=0;_i<textSymbols.length;_i++){var _ch=textSymbols.charAt(_i);defineSymbol(text,main,textord,_ch,_ch)}for(var letters="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",_i2=0;_i2<letters.length;_i2++){var _ch2=letters.charAt(_i2);defineSymbol(math,main,mathord,_ch2,_ch2),defineSymbol(text,main,textord,_ch2,_ch2)}defineSymbol(math,ams,textord,"C","\u2102"),defineSymbol(text,ams,textord,"C","\u2102"),defineSymbol(math,ams,textord,"H","\u210D"),defineSymbol(text,ams,textord,"H","\u210D"),defineSymbol(math,ams,textord,"N","\u2115"),defineSymbol(text,ams,textord,"N","\u2115"),defineSymbol(math,ams,textord,"P","\u2119"),defineSymbol(text,ams,textord,"P","\u2119"),defineSymbol(math,ams,textord,"Q","\u211A"),defineSymbol(text,ams,textord,"Q","\u211A"),defineSymbol(math,ams,textord,"R","\u211D"),defineSymbol(text,ams,textord,"R","\u211D"),defineSymbol(math,ams,textord,"Z","\u2124"),defineSymbol(text,ams,textord,"Z","\u2124"),defineSymbol(math,main,mathord,"h","\u210E"),defineSymbol(text,main,mathord,"h","\u210E");for(var wideChar="",_i3=0;_i3<letters.length;_i3++){var _ch3=letters.charAt(_i3);wideChar=String.fromCharCode(55349,56320+_i3),defineSymbol(math,main,mathord,_ch3,wideChar),defineSymbol(text,main,textord,_ch3,wideChar),wideChar=String.fromCharCode(55349,56372+_i3),defineSymbol(math,main,mathord,_ch3,wideChar),defineSymbol(text,main,textord,_ch3,wideChar),wideChar=String.fromCharCode(55349,56424+_i3),defineSymbol(math,main,mathord,_ch3,wideChar),defineSymbol(text,main,textord,_ch3,wideChar),wideChar=String.fromCharCode(55349,56580+_i3),defineSymbol(math,main,mathord,_ch3,wideChar),defineSymbol(text,main,textord,_ch3,wideChar),wideChar=String.fromCharCode(55349,56684+_i3),defineSymbol(math,main,mathord,_ch3,wideChar),defineSymbol(text,main,textord,_ch3,wideChar),wideChar=String.fromCharCode(55349,56736+_i3),defineSymbol(math,main,mathord,_ch3,wideChar),defineSymbol(text,main,textord,_ch3,wideChar),wideChar=String.fromCharCode(55349,56788+_i3),defineSymbol(math,main,mathord,_ch3,wideChar),defineSymbol(text,main,textord,_ch3,wideChar),wideChar=String.fromCharCode(55349,56840+_i3),defineSymbol(math,main,mathord,_ch3,wideChar),defineSymbol(text,main,textord,_ch3,wideChar),wideChar=String.fromCharCode(55349,56944+_i3),defineSymbol(math,main,mathord,_ch3,wideChar),defineSymbol(text,main,textord,_ch3,wideChar),_i3<26&&(wideChar=String.fromCharCode(55349,56632+_i3),defineSymbol(math,main,mathord,_ch3,wideChar),defineSymbol(text,main,textord,_ch3,wideChar),wideChar=String.fromCharCode(55349,56476+_i3),defineSymbol(math,main,mathord,_ch3,wideChar),defineSymbol(text,main,textord,_ch3,wideChar))}wideChar="\u{1D55C}",defineSymbol(math,main,mathord,"k",wideChar),defineSymbol(text,main,textord,"k",wideChar);for(var _i4=0;_i4<10;_i4++){var _ch4=_i4.toString();wideChar=String.fromCharCode(55349,57294+_i4),defineSymbol(math,main,mathord,_ch4,wideChar),defineSymbol(text,main,textord,_ch4,wideChar),wideChar=String.fromCharCode(55349,57314+_i4),defineSymbol(math,main,mathord,_ch4,wideChar),defineSymbol(text,main,textord,_ch4,wideChar),wideChar=String.fromCharCode(55349,57324+_i4),defineSymbol(math,main,mathord,_ch4,wideChar),defineSymbol(text,main,textord,_ch4,wideChar),wideChar=String.fromCharCode(55349,57334+_i4),defineSymbol(math,main,mathord,_ch4,wideChar),defineSymbol(text,main,textord,_ch4,wideChar)}for(var extraLatin="\xD0\xDE\xFE",_i5=0;_i5<extraLatin.length;_i5++){var _ch5=extraLatin.charAt(_i5);defineSymbol(math,main,mathord,_ch5,_ch5),defineSymbol(text,main,textord,_ch5,_ch5)}var wideLatinLetterData=[["mathbf","textbf","Main-Bold"],["mathbf","textbf","Main-Bold"],["mathnormal","textit","Math-Italic"],["mathnormal","textit","Math-Italic"],["boldsymbol","boldsymbol","Main-BoldItalic"],["boldsymbol","boldsymbol","Main-BoldItalic"],["mathscr","textscr","Script-Regular"],["","",""],["","",""],["","",""],["mathfrak","textfrak","Fraktur-Regular"],["mathfrak","textfrak","Fraktur-Regular"],["mathbb","textbb","AMS-Regular"],["mathbb","textbb","AMS-Regular"],["mathboldfrak","textboldfrak","Fraktur-Regular"],["mathboldfrak","textboldfrak","Fraktur-Regular"],["mathsf","textsf","SansSerif-Regular"],["mathsf","textsf","SansSerif-Regular"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathitsf","textitsf","SansSerif-Italic"],["mathitsf","textitsf","SansSerif-Italic"],["","",""],["","",""],["mathtt","texttt","Typewriter-Regular"],["mathtt","texttt","Typewriter-Regular"]],wideNumeralData=[["mathbf","textbf","Main-Bold"],["","",""],["mathsf","textsf","SansSerif-Regular"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathtt","texttt","Typewriter-Regular"]],wideCharacterFont=function r(e,n){var o=e.charCodeAt(0),s=e.charCodeAt(1),a=(o-55296)*1024+(s-56320)+65536,l=n==="math"?0:1;if(119808<=a&&a<120484){var c=Math.floor((a-119808)/26);return[wideLatinLetterData[c][2],wideLatinLetterData[c][l]]}else if(120782<=a&&a<=120831){var d=Math.floor((a-120782)/10);return[wideNumeralData[d][2],wideNumeralData[d][l]]}else{if(a===120485||a===120486)return[wideLatinLetterData[0][2],wideLatinLetterData[0][l]];if(120486<a&&a<120782)return["",""];throw new ParseError("Unsupported character: "+e)}},lookupSymbol=function r(e,n,o){return symbols[o][e]&&symbols[o][e].replace&&(e=symbols[o][e].replace),{value:e,metrics:getCharacterMetrics(e,n,o)}},makeSymbol=function r(e,n,o,s,a){var l=lookupSymbol(e,n,o),c=l.metrics;e=l.value;var d;if(c){var u=c.italic;(o==="text"||s&&s.font==="mathit")&&(u=0),d=new SymbolNode(e,c.height,c.depth,u,c.skew,c.width,a)}else typeof console<"u"&&console.warn("No character metrics "+("for '"+e+"' in style '"+n+"' and mode '"+o+"'")),d=new SymbolNode(e,0,0,0,0,0,a);if(s){d.maxFontSize=s.sizeMultiplier,s.style.isTight()&&d.classes.push("mtight");var m=s.getColor();m&&(d.style.color=m)}return d},mathsym=function r(e,n,o,s){return s===void 0&&(s=[]),o.font==="boldsymbol"&&lookupSymbol(e,"Main-Bold",n).metrics?makeSymbol(e,"Main-Bold",n,o,s.concat(["mathbf"])):e==="\\"||symbols[n][e].font==="main"?makeSymbol(e,"Main-Regular",n,o,s):makeSymbol(e,"AMS-Regular",n,o,s.concat(["amsrm"]))},boldsymbol=function r(e,n,o,s,a){return a!=="textord"&&lookupSymbol(e,"Math-BoldItalic",n).metrics?{fontName:"Math-BoldItalic",fontClass:"boldsymbol"}:{fontName:"Main-Bold",fontClass:"mathbf"}},makeOrd=function r(e,n,o){var s=e.mode,a=e.text,l=["mord"],c=s==="math"||s==="text"&&n.font,d=c?n.font:n.fontFamily,u="",m="";if(a.charCodeAt(0)===55349&&([u,m]=wideCharacterFont(a,s)),u.length>0)return makeSymbol(a,u,s,n,l.concat(m));if(d){var f,p;if(d==="boldsymbol"){var g=boldsymbol(a,s,n,l,o);f=g.fontName,p=[g.fontClass]}else c?(f=fontMap[d].fontName,p=[d]):(f=retrieveTextFontName(d,n.fontWeight,n.fontShape),p=[d,n.fontWeight,n.fontShape]);if(lookupSymbol(a,f,s).metrics)return makeSymbol(a,f,s,n,l.concat(p));if(ligatures.hasOwnProperty(a)&&f.slice(0,10)==="Typewriter"){for(var y=[],b=0;b<a.length;b++)y.push(makeSymbol(a[b],f,s,n,l.concat(p)));return makeFragment(y)}}if(o==="mathord")return makeSymbol(a,"Math-Italic",s,n,l.concat(["mathnormal"]));if(o==="textord"){var k=symbols[s][a]&&symbols[s][a].font;if(k==="ams"){var w=retrieveTextFontName("amsrm",n.fontWeight,n.fontShape);return makeSymbol(a,w,s,n,l.concat("amsrm",n.fontWeight,n.fontShape))}else if(k==="main"||!k){var B=retrieveTextFontName("textrm",n.fontWeight,n.fontShape);return makeSymbol(a,B,s,n,l.concat(n.fontWeight,n.fontShape))}else{var M=retrieveTextFontName(k,n.fontWeight,n.fontShape);return makeSymbol(a,M,s,n,l.concat(M,n.fontWeight,n.fontShape))}}else throw new Error("unexpected type: "+o+" in makeOrd")},canCombine=(r,e)=>{if(createClass(r.classes)!==createClass(e.classes)||r.skew!==e.skew||r.maxFontSize!==e.maxFontSize)return!1;if(r.classes.length===1){var n=r.classes[0];if(n==="mbin"||n==="mord")return!1}for(var o in r.style)if(r.style.hasOwnProperty(o)&&r.style[o]!==e.style[o])return!1;for(var s in e.style)if(e.style.hasOwnProperty(s)&&r.style[s]!==e.style[s])return!1;return!0},tryCombineChars=r=>{for(var e=0;e<r.length-1;e++){var n=r[e],o=r[e+1];n instanceof SymbolNode&&o instanceof SymbolNode&&canCombine(n,o)&&(n.text+=o.text,n.height=Math.max(n.height,o.height),n.depth=Math.max(n.depth,o.depth),n.italic=o.italic,r.splice(e+1,1),e--)}return r},sizeElementFromChildren=function r(e){for(var n=0,o=0,s=0,a=0;a<e.children.length;a++){var l=e.children[a];l.height>n&&(n=l.height),l.depth>o&&(o=l.depth),l.maxFontSize>s&&(s=l.maxFontSize)}e.height=n,e.depth=o,e.maxFontSize=s},makeSpan$2=function r(e,n,o,s){var a=new Span(e,n,o,s);return sizeElementFromChildren(a),a},makeSvgSpan=(r,e,n,o)=>new Span(r,e,n,o),makeLineSpan=function r(e,n,o){var s=makeSpan$2([e],[],n);return s.height=Math.max(o||n.fontMetrics().defaultRuleThickness,n.minRuleThickness),s.style.borderBottomWidth=makeEm(s.height),s.maxFontSize=1,s},makeAnchor=function r(e,n,o,s){var a=new Anchor(e,n,o,s);return sizeElementFromChildren(a),a},makeFragment=function r(e){var n=new DocumentFragment(e);return sizeElementFromChildren(n),n},wrapFragment=function r(e,n){return e instanceof DocumentFragment?makeSpan$2([],[e],n):e},getVListChildrenAndDepth=function r(e){if(e.positionType==="individualShift"){for(var n=e.children,o=[n[0]],s=-n[0].shift-n[0].elem.depth,a=s,l=1;l<n.length;l++){var c=-n[l].shift-a-n[l].elem.depth,d=c-(n[l-1].elem.height+n[l-1].elem.depth);a=a+c,o.push({type:"kern",size:d}),o.push(n[l])}return{children:o,depth:s}}var u;if(e.positionType==="top"){for(var m=e.positionData,f=0;f<e.children.length;f++){var p=e.children[f];m-=p.type==="kern"?p.size:p.elem.height+p.elem.depth}u=m}else if(e.positionType==="bottom")u=-e.positionData;else{var g=e.children[0];if(g.type!=="elem")throw new Error('First child must have type "elem".');if(e.positionType==="shift")u=-g.elem.depth-e.positionData;else if(e.positionType==="firstBaseline")u=-g.elem.depth;else throw new Error("Invalid positionType "+e.positionType+".")}return{children:e.children,depth:u}},makeVList=function r(e,n){for(var{children:o,depth:s}=getVListChildrenAndDepth(e),a=0,l=0;l<o.length;l++){var c=o[l];if(c.type==="elem"){var d=c.elem;a=Math.max(a,d.maxFontSize,d.height)}}a+=2;var u=makeSpan$2(["pstrut"],[]);u.style.height=makeEm(a);for(var m=[],f=s,p=s,g=s,y=0;y<o.length;y++){var b=o[y];if(b.type==="kern")g+=b.size;else{var k=b.elem,w=b.wrapperClasses||[],B=b.wrapperStyle||{},M=makeSpan$2(w,[u,k],void 0,B);M.style.top=makeEm(-a-g-k.depth),b.marginLeft&&(M.style.marginLeft=b.marginLeft),b.marginRight&&(M.style.marginRight=b.marginRight),m.push(M),g+=k.height+k.depth}f=Math.min(f,g),p=Math.max(p,g)}var x=makeSpan$2(["vlist"],m);x.style.height=makeEm(p);var v;if(f<0){var _=makeSpan$2([],[]),E=makeSpan$2(["vlist"],[_]);E.style.height=makeEm(-f);var N=makeSpan$2(["vlist-s"],[new SymbolNode("\u200B")]);v=[makeSpan$2(["vlist-r"],[x,N]),makeSpan$2(["vlist-r"],[E])]}else v=[makeSpan$2(["vlist-r"],[x])];var I=makeSpan$2(["vlist-t"],v);return v.length===2&&I.classes.push("vlist-t2"),I.height=p,I.depth=-f,I},makeGlue=(r,e)=>{var n=makeSpan$2(["mspace"],[],e),o=calculateSize(r,e);return n.style.marginRight=makeEm(o),n},retrieveTextFontName=function r(e,n,o){var s="";switch(e){case"amsrm":s="AMS";break;case"textrm":s="Main";break;case"textsf":s="SansSerif";break;case"texttt":s="Typewriter";break;default:s=e}var a;return n==="textbf"&&o==="textit"?a="BoldItalic":n==="textbf"?a="Bold":n==="textit"?a="Italic":a="Regular",s+"-"+a},fontMap={mathbf:{variant:"bold",fontName:"Main-Bold"},mathrm:{variant:"normal",fontName:"Main-Regular"},textit:{variant:"italic",fontName:"Main-Italic"},mathit:{variant:"italic",fontName:"Main-Italic"},mathnormal:{variant:"italic",fontName:"Math-Italic"},mathsfit:{variant:"sans-serif-italic",fontName:"SansSerif-Italic"},mathbb:{variant:"double-struck",fontName:"AMS-Regular"},mathcal:{variant:"script",fontName:"Caligraphic-Regular"},mathfrak:{variant:"fraktur",fontName:"Fraktur-Regular"},mathscr:{variant:"script",fontName:"Script-Regular"},mathsf:{variant:"sans-serif",fontName:"SansSerif-Regular"},mathtt:{variant:"monospace",fontName:"Typewriter-Regular"}},svgData={vec:["vec",.471,.714],oiintSize1:["oiintSize1",.957,.499],oiintSize2:["oiintSize2",1.472,.659],oiiintSize1:["oiiintSize1",1.304,.499],oiiintSize2:["oiiintSize2",1.98,.659]},staticSvg=function r(e,n){var[o,s,a]=svgData[e],l=new PathNode(o),c=new SvgNode([l],{width:makeEm(s),height:makeEm(a),style:"width:"+makeEm(s),viewBox:"0 0 "+1e3*s+" "+1e3*a,preserveAspectRatio:"xMinYMin"}),d=makeSvgSpan(["overlay"],[c],n);return d.height=a,d.style.height=makeEm(a),d.style.width=makeEm(s),d},buildCommon={fontMap,makeSymbol,mathsym,makeSpan:makeSpan$2,makeSvgSpan,makeLineSpan,makeAnchor,makeFragment,wrapFragment,makeVList,makeOrd,makeGlue,staticSvg,svgData,tryCombineChars},thinspace={number:3,unit:"mu"},mediumspace={number:4,unit:"mu"},thickspace={number:5,unit:"mu"},spacings={mord:{mop:thinspace,mbin:mediumspace,mrel:thickspace,minner:thinspace},mop:{mord:thinspace,mop:thinspace,mrel:thickspace,minner:thinspace},mbin:{mord:mediumspace,mop:mediumspace,mopen:mediumspace,minner:mediumspace},mrel:{mord:thickspace,mop:thickspace,mopen:thickspace,minner:thickspace},mopen:{},mclose:{mop:thinspace,mbin:mediumspace,mrel:thickspace,minner:thinspace},mpunct:{mord:thinspace,mop:thinspace,mrel:thickspace,mopen:thinspace,mclose:thinspace,mpunct:thinspace,minner:thinspace},minner:{mord:thinspace,mop:thinspace,mbin:mediumspace,mrel:thickspace,mopen:thinspace,mpunct:thinspace,minner:thinspace}},tightSpacings={mord:{mop:thinspace},mop:{mord:thinspace,mop:thinspace},mbin:{},mrel:{},mopen:{},mclose:{mop:thinspace},mpunct:{},minner:{mop:thinspace}},_functions={},_htmlGroupBuilders={},_mathmlGroupBuilders={};function defineFunction(r){for(var{type:e,names:n,props:o,handler:s,htmlBuilder:a,mathmlBuilder:l}=r,c={type:e,numArgs:o.numArgs,argTypes:o.argTypes,allowedInArgument:!!o.allowedInArgument,allowedInText:!!o.allowedInText,allowedInMath:o.allowedInMath===void 0?!0:o.allowedInMath,numOptionalArgs:o.numOptionalArgs||0,infix:!!o.infix,primitive:!!o.primitive,handler:s},d=0;d<n.length;++d)_functions[n[d]]=c;e&&(a&&(_htmlGroupBuilders[e]=a),l&&(_mathmlGroupBuilders[e]=l))}function defineFunctionBuilders(r){var{type:e,htmlBuilder:n,mathmlBuilder:o}=r;defineFunction({type:e,names:[],props:{numArgs:0},handler(){throw new Error("Should never be called.")},htmlBuilder:n,mathmlBuilder:o})}var normalizeArgument=function r(e){return e.type==="ordgroup"&&e.body.length===1?e.body[0]:e},ordargument=function r(e){return e.type==="ordgroup"?e.body:[e]},makeSpan$1=buildCommon.makeSpan,binLeftCanceller=["leftmost","mbin","mopen","mrel","mop","mpunct"],binRightCanceller=["rightmost","mrel","mclose","mpunct"],styleMap$1={display:Style$1.DISPLAY,text:Style$1.TEXT,script:Style$1.SCRIPT,scriptscript:Style$1.SCRIPTSCRIPT},DomEnum={mord:"mord",mop:"mop",mbin:"mbin",mrel:"mrel",mopen:"mopen",mclose:"mclose",mpunct:"mpunct",minner:"minner"},buildExpression$1=function r(e,n,o,s){s===void 0&&(s=[null,null]);for(var a=[],l=0;l<e.length;l++){var c=buildGroup$1(e[l],n);if(c instanceof DocumentFragment){var d=c.children;a.push(...d)}else a.push(c)}if(buildCommon.tryCombineChars(a),!o)return a;var u=n;if(e.length===1){var m=e[0];m.type==="sizing"?u=n.havingSize(m.size):m.type==="styling"&&(u=n.havingStyle(styleMap$1[m.style]))}var f=makeSpan$1([s[0]||"leftmost"],[],n),p=makeSpan$1([s[1]||"rightmost"],[],n),g=o==="root";return traverseNonSpaceNodes(a,(y,b)=>{var k=b.classes[0],w=y.classes[0];k==="mbin"&&utils.contains(binRightCanceller,w)?b.classes[0]="mord":w==="mbin"&&utils.contains(binLeftCanceller,k)&&(y.classes[0]="mord")},{node:f},p,g),traverseNonSpaceNodes(a,(y,b)=>{var k=getTypeOfDomTree(b),w=getTypeOfDomTree(y),B=k&&w?y.hasClass("mtight")?tightSpacings[k][w]:spacings[k][w]:null;if(B)return buildCommon.makeGlue(B,u)},{node:f},p,g),a},traverseNonSpaceNodes=function r(e,n,o,s,a){s&&e.push(s);for(var l=0;l<e.length;l++){var c=e[l],d=checkPartialGroup(c);if(d){r(d.children,n,o,null,a);continue}var u=!c.hasClass("mspace");if(u){var m=n(c,o.node);m&&(o.insertAfter?o.insertAfter(m):(e.unshift(m),l++))}u?o.node=c:a&&c.hasClass("newline")&&(o.node=makeSpan$1(["leftmost"])),o.insertAfter=(f=>p=>{e.splice(f+1,0,p),l++})(l)}s&&e.pop()},checkPartialGroup=function r(e){return e instanceof DocumentFragment||e instanceof Anchor||e instanceof Span&&e.hasClass("enclosing")?e:null},getOutermostNode=function r(e,n){var o=checkPartialGroup(e);if(o){var s=o.children;if(s.length){if(n==="right")return r(s[s.length-1],"right");if(n==="left")return r(s[0],"left")}}return e},getTypeOfDomTree=function r(e,n){return e?(n&&(e=getOutermostNode(e,n)),DomEnum[e.classes[0]]||null):null},makeNullDelimiter=function r(e,n){var o=["nulldelimiter"].concat(e.baseSizingClasses());return makeSpan$1(n.concat(o))},buildGroup$1=function r(e,n,o){if(!e)return makeSpan$1();if(_htmlGroupBuilders[e.type]){var s=_htmlGroupBuilders[e.type](e,n);if(o&&n.size!==o.size){s=makeSpan$1(n.sizingClasses(o),[s],n);var a=n.sizeMultiplier/o.sizeMultiplier;s.height*=a,s.depth*=a}return s}else throw new ParseError("Got group of unknown type: '"+e.type+"'")};function buildHTMLUnbreakable(r,e){var n=makeSpan$1(["base"],r,e),o=makeSpan$1(["strut"]);return o.style.height=makeEm(n.height+n.depth),n.depth&&(o.style.verticalAlign=makeEm(-n.depth)),n.children.unshift(o),n}function buildHTML(r,e){var n=null;r.length===1&&r[0].type==="tag"&&(n=r[0].tag,r=r[0].body);var o=buildExpression$1(r,e,"root"),s;o.length===2&&o[1].hasClass("tag")&&(s=o.pop());for(var a=[],l=[],c=0;c<o.length;c++)if(l.push(o[c]),o[c].hasClass("mbin")||o[c].hasClass("mrel")||o[c].hasClass("allowbreak")){for(var d=!1;c<o.length-1&&o[c+1].hasClass("mspace")&&!o[c+1].hasClass("newline");)c++,l.push(o[c]),o[c].hasClass("nobreak")&&(d=!0);d||(a.push(buildHTMLUnbreakable(l,e)),l=[])}else o[c].hasClass("newline")&&(l.pop(),l.length>0&&(a.push(buildHTMLUnbreakable(l,e)),l=[]),a.push(o[c]));l.length>0&&a.push(buildHTMLUnbreakable(l,e));var u;n?(u=buildHTMLUnbreakable(buildExpression$1(n,e,!0)),u.classes=["tag"],a.push(u)):s&&a.push(s);var m=makeSpan$1(["katex-html"],a);if(m.setAttribute("aria-hidden","true"),u){var f=u.children[0];f.style.height=makeEm(m.height+m.depth),m.depth&&(f.style.verticalAlign=makeEm(-m.depth))}return m}function newDocumentFragment(r){return new DocumentFragment(r)}class MathNode{constructor(e,n,o){this.type=void 0,this.attributes=void 0,this.children=void 0,this.classes=void 0,this.type=e,this.attributes={},this.children=n||[],this.classes=o||[]}setAttribute(e,n){this.attributes[e]=n}getAttribute(e){return this.attributes[e]}toNode(){var e=document.createElementNS("http://www.w3.org/1998/Math/MathML",this.type);for(var n in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,n)&&e.setAttribute(n,this.attributes[n]);this.classes.length>0&&(e.className=createClass(this.classes));for(var o=0;o<this.children.length;o++)if(this.children[o]instanceof TextNode&&this.children[o+1]instanceof TextNode){for(var s=this.children[o].toText()+this.children[++o].toText();this.children[o+1]instanceof TextNode;)s+=this.children[++o].toText();e.appendChild(new TextNode(s).toNode())}else e.appendChild(this.children[o].toNode());return e}toMarkup(){var e="<"+this.type;for(var n in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,n)&&(e+=" "+n+'="',e+=utils.escape(this.attributes[n]),e+='"');this.classes.length>0&&(e+=' class ="'+utils.escape(createClass(this.classes))+'"'),e+=">";for(var o=0;o<this.children.length;o++)e+=this.children[o].toMarkup();return e+="</"+this.type+">",e}toText(){return this.children.map(e=>e.toText()).join("")}}class TextNode{constructor(e){this.text=void 0,this.text=e}toNode(){return document.createTextNode(this.text)}toMarkup(){return utils.escape(this.toText())}toText(){return this.text}}class SpaceNode{constructor(e){this.width=void 0,this.character=void 0,this.width=e,e>=.05555&&e<=.05556?this.character="\u200A":e>=.1666&&e<=.1667?this.character="\u2009":e>=.2222&&e<=.2223?this.character="\u2005":e>=.2777&&e<=.2778?this.character="\u2005\u200A":e>=-.05556&&e<=-.05555?this.character="\u200A\u2063":e>=-.1667&&e<=-.1666?this.character="\u2009\u2063":e>=-.2223&&e<=-.2222?this.character="\u205F\u2063":e>=-.2778&&e<=-.2777?this.character="\u2005\u2063":this.character=null}toNode(){if(this.character)return document.createTextNode(this.character);var e=document.createElementNS("http://www.w3.org/1998/Math/MathML","mspace");return e.setAttribute("width",makeEm(this.width)),e}toMarkup(){return this.character?"<mtext>"+this.character+"</mtext>":'<mspace width="'+makeEm(this.width)+'"/>'}toText(){return this.character?this.character:" "}}var mathMLTree={MathNode,TextNode,SpaceNode,newDocumentFragment},makeText=function r(e,n,o){return symbols[n][e]&&symbols[n][e].replace&&e.charCodeAt(0)!==55349&&!(ligatures.hasOwnProperty(e)&&o&&(o.fontFamily&&o.fontFamily.slice(4,6)==="tt"||o.font&&o.font.slice(4,6)==="tt"))&&(e=symbols[n][e].replace),new mathMLTree.TextNode(e)},makeRow=function r(e){return e.length===1?e[0]:new mathMLTree.MathNode("mrow",e)},getVariant=function r(e,n){if(n.fontFamily==="texttt")return"monospace";if(n.fontFamily==="textsf")return n.fontShape==="textit"&&n.fontWeight==="textbf"?"sans-serif-bold-italic":n.fontShape==="textit"?"sans-serif-italic":n.fontWeight==="textbf"?"bold-sans-serif":"sans-serif";if(n.fontShape==="textit"&&n.fontWeight==="textbf")return"bold-italic";if(n.fontShape==="textit")return"italic";if(n.fontWeight==="textbf")return"bold";var o=n.font;if(!o||o==="mathnormal")return null;var s=e.mode;if(o==="mathit")return"italic";if(o==="boldsymbol")return e.type==="textord"?"bold":"bold-italic";if(o==="mathbf")return"bold";if(o==="mathbb")return"double-struck";if(o==="mathsfit")return"sans-serif-italic";if(o==="mathfrak")return"fraktur";if(o==="mathscr"||o==="mathcal")return"script";if(o==="mathsf")return"sans-serif";if(o==="mathtt")return"monospace";var a=e.text;if(utils.contains(["\\imath","\\jmath"],a))return null;symbols[s][a]&&symbols[s][a].replace&&(a=symbols[s][a].replace);var l=buildCommon.fontMap[o].fontName;return getCharacterMetrics(a,l,s)?buildCommon.fontMap[o].variant:null};function isNumberPunctuation(r){if(!r)return!1;if(r.type==="mi"&&r.children.length===1){var e=r.children[0];return e instanceof TextNode&&e.text==="."}else if(r.type==="mo"&&r.children.length===1&&r.getAttribute("separator")==="true"&&r.getAttribute("lspace")==="0em"&&r.getAttribute("rspace")==="0em"){var n=r.children[0];return n instanceof TextNode&&n.text===","}else return!1}var buildExpression=function r(e,n,o){if(e.length===1){var s=buildGroup(e[0],n);return o&&s instanceof MathNode&&s.type==="mo"&&(s.setAttribute("lspace","0em"),s.setAttribute("rspace","0em")),[s]}for(var a=[],l,c=0;c<e.length;c++){var d=buildGroup(e[c],n);if(d instanceof MathNode&&l instanceof MathNode){if(d.type==="mtext"&&l.type==="mtext"&&d.getAttribute("mathvariant")===l.getAttribute("mathvariant")){l.children.push(...d.children);continue}else if(d.type==="mn"&&l.type==="mn"){l.children.push(...d.children);continue}else if(isNumberPunctuation(d)&&l.type==="mn"){l.children.push(...d.children);continue}else if(d.type==="mn"&&isNumberPunctuation(l))d.children=[...l.children,...d.children],a.pop();else if((d.type==="msup"||d.type==="msub")&&d.children.length>=1&&(l.type==="mn"||isNumberPunctuation(l))){var u=d.children[0];u instanceof MathNode&&u.type==="mn"&&(u.children=[...l.children,...u.children],a.pop())}else if(l.type==="mi"&&l.children.length===1){var m=l.children[0];if(m instanceof TextNode&&m.text==="\u0338"&&(d.type==="mo"||d.type==="mi"||d.type==="mn")){var f=d.children[0];f instanceof TextNode&&f.text.length>0&&(f.text=f.text.slice(0,1)+"\u0338"+f.text.slice(1),a.pop())}}}a.push(d),l=d}return a},buildExpressionRow=function r(e,n,o){return makeRow(buildExpression(e,n,o))},buildGroup=function r(e,n){if(!e)return new mathMLTree.MathNode("mrow");if(_mathmlGroupBuilders[e.type]){var o=_mathmlGroupBuilders[e.type](e,n);return o}else throw new ParseError("Got group of unknown type: '"+e.type+"'")};function buildMathML(r,e,n,o,s){var a=buildExpression(r,n),l;a.length===1&&a[0]instanceof MathNode&&utils.contains(["mrow","mtable"],a[0].type)?l=a[0]:l=new mathMLTree.MathNode("mrow",a);var c=new mathMLTree.MathNode("annotation",[new mathMLTree.TextNode(e)]);c.setAttribute("encoding","application/x-tex");var d=new mathMLTree.MathNode("semantics",[l,c]),u=new mathMLTree.MathNode("math",[d]);u.setAttribute("xmlns","http://www.w3.org/1998/Math/MathML"),o&&u.setAttribute("display","block");var m=s?"katex":"katex-mathml";return buildCommon.makeSpan([m],[u])}var optionsFromSettings=function r(e){return new Options({style:e.displayMode?Style$1.DISPLAY:Style$1.TEXT,maxSize:e.maxSize,minRuleThickness:e.minRuleThickness})},displayWrap=function r(e,n){if(n.displayMode){var o=["katex-display"];n.leqno&&o.push("leqno"),n.fleqn&&o.push("fleqn"),e=buildCommon.makeSpan(o,[e])}return e},buildTree=function r(e,n,o){var s=optionsFromSettings(o),a;if(o.output==="mathml")return buildMathML(e,n,s,o.displayMode,!0);if(o.output==="html"){var l=buildHTML(e,s);a=buildCommon.makeSpan(["katex"],[l])}else{var c=buildMathML(e,n,s,o.displayMode,!1),d=buildHTML(e,s);a=buildCommon.makeSpan(["katex"],[c,d])}return displayWrap(a,o)},buildHTMLTree=function r(e,n,o){var s=optionsFromSettings(o),a=buildHTML(e,s),l=buildCommon.makeSpan(["katex"],[a]);return displayWrap(l,o)},stretchyCodePoint={widehat:"^",widecheck:"\u02C7",widetilde:"~",utilde:"~",overleftarrow:"\u2190",underleftarrow:"\u2190",xleftarrow:"\u2190",overrightarrow:"\u2192",underrightarrow:"\u2192",xrightarrow:"\u2192",underbrace:"\u23DF",overbrace:"\u23DE",overgroup:"\u23E0",undergroup:"\u23E1",overleftrightarrow:"\u2194",underleftrightarrow:"\u2194",xleftrightarrow:"\u2194",Overrightarrow:"\u21D2",xRightarrow:"\u21D2",overleftharpoon:"\u21BC",xleftharpoonup:"\u21BC",overrightharpoon:"\u21C0",xrightharpoonup:"\u21C0",xLeftarrow:"\u21D0",xLeftrightarrow:"\u21D4",xhookleftarrow:"\u21A9",xhookrightarrow:"\u21AA",xmapsto:"\u21A6",xrightharpoondown:"\u21C1",xleftharpoondown:"\u21BD",xrightleftharpoons:"\u21CC",xleftrightharpoons:"\u21CB",xtwoheadleftarrow:"\u219E",xtwoheadrightarrow:"\u21A0",xlongequal:"=",xtofrom:"\u21C4",xrightleftarrows:"\u21C4",xrightequilibrium:"\u21CC",xleftequilibrium:"\u21CB","\\cdrightarrow":"\u2192","\\cdleftarrow":"\u2190","\\cdlongequal":"="},mathMLnode=function r(e){var n=new mathMLTree.MathNode("mo",[new mathMLTree.TextNode(stretchyCodePoint[e.replace(/^\\/,"")])]);return n.setAttribute("stretchy","true"),n},katexImagesData={overrightarrow:[["rightarrow"],.888,522,"xMaxYMin"],overleftarrow:[["leftarrow"],.888,522,"xMinYMin"],underrightarrow:[["rightarrow"],.888,522,"xMaxYMin"],underleftarrow:[["leftarrow"],.888,522,"xMinYMin"],xrightarrow:[["rightarrow"],1.469,522,"xMaxYMin"],"\\cdrightarrow":[["rightarrow"],3,522,"xMaxYMin"],xleftarrow:[["leftarrow"],1.469,522,"xMinYMin"],"\\cdleftarrow":[["leftarrow"],3,522,"xMinYMin"],Overrightarrow:[["doublerightarrow"],.888,560,"xMaxYMin"],xRightarrow:[["doublerightarrow"],1.526,560,"xMaxYMin"],xLeftarrow:[["doubleleftarrow"],1.526,560,"xMinYMin"],overleftharpoon:[["leftharpoon"],.888,522,"xMinYMin"],xleftharpoonup:[["leftharpoon"],.888,522,"xMinYMin"],xleftharpoondown:[["leftharpoondown"],.888,522,"xMinYMin"],overrightharpoon:[["rightharpoon"],.888,522,"xMaxYMin"],xrightharpoonup:[["rightharpoon"],.888,522,"xMaxYMin"],xrightharpoondown:[["rightharpoondown"],.888,522,"xMaxYMin"],xlongequal:[["longequal"],.888,334,"xMinYMin"],"\\cdlongequal":[["longequal"],3,334,"xMinYMin"],xtwoheadleftarrow:[["twoheadleftarrow"],.888,334,"xMinYMin"],xtwoheadrightarrow:[["twoheadrightarrow"],.888,334,"xMaxYMin"],overleftrightarrow:[["leftarrow","rightarrow"],.888,522],overbrace:[["leftbrace","midbrace","rightbrace"],1.6,548],underbrace:[["leftbraceunder","midbraceunder","rightbraceunder"],1.6,548],underleftrightarrow:[["leftarrow","rightarrow"],.888,522],xleftrightarrow:[["leftarrow","rightarrow"],1.75,522],xLeftrightarrow:[["doubleleftarrow","doublerightarrow"],1.75,560],xrightleftharpoons:[["leftharpoondownplus","rightharpoonplus"],1.75,716],xleftrightharpoons:[["leftharpoonplus","rightharpoondownplus"],1.75,716],xhookleftarrow:[["leftarrow","righthook"],1.08,522],xhookrightarrow:[["lefthook","rightarrow"],1.08,522],overlinesegment:[["leftlinesegment","rightlinesegment"],.888,522],underlinesegment:[["leftlinesegment","rightlinesegment"],.888,522],overgroup:[["leftgroup","rightgroup"],.888,342],undergroup:[["leftgroupunder","rightgroupunder"],.888,342],xmapsto:[["leftmapsto","rightarrow"],1.5,522],xtofrom:[["leftToFrom","rightToFrom"],1.75,528],xrightleftarrows:[["baraboveleftarrow","rightarrowabovebar"],1.75,901],xrightequilibrium:[["baraboveshortleftharpoon","rightharpoonaboveshortbar"],1.75,716],xleftequilibrium:[["shortbaraboveleftharpoon","shortrightharpoonabovebar"],1.75,716]},groupLength=function r(e){return e.type==="ordgroup"?e.body.length:1},svgSpan=function r(e,n){function o(){var c=4e5,d=e.label.slice(1);if(utils.contains(["widehat","widecheck","widetilde","utilde"],d)){var u=e,m=groupLength(u.base),f,p,g;if(m>5)d==="widehat"||d==="widecheck"?(f=420,c=2364,g=.42,p=d+"4"):(f=312,c=2340,g=.34,p="tilde4");else{var y=[1,1,2,2,3,3][m];d==="widehat"||d==="widecheck"?(c=[0,1062,2364,2364,2364][y],f=[0,239,300,360,420][y],g=[0,.24,.3,.3,.36,.42][y],p=d+y):(c=[0,600,1033,2339,2340][y],f=[0,260,286,306,312][y],g=[0,.26,.286,.3,.306,.34][y],p="tilde"+y)}var b=new PathNode(p),k=new SvgNode([b],{width:"100%",height:makeEm(g),viewBox:"0 0 "+c+" "+f,preserveAspectRatio:"none"});return{span:buildCommon.makeSvgSpan([],[k],n),minWidth:0,height:g}}else{var w=[],B=katexImagesData[d],[M,x,v]=B,_=v/1e3,E=M.length,N,I;if(E===1){var L=B[3];N=["hide-tail"],I=[L]}else if(E===2)N=["halfarrow-left","halfarrow-right"],I=["xMinYMin","xMaxYMin"];else if(E===3)N=["brace-left","brace-center","brace-right"],I=["xMinYMin","xMidYMin","xMaxYMin"];else throw new Error(`Correct katexImagesData or update code here to support
                    `+E+" children.");for(var A=0;A<E;A++){var F=new PathNode(M[A]),se=new SvgNode([F],{width:"400em",height:makeEm(_),viewBox:"0 0 "+c+" "+v,preserveAspectRatio:I[A]+" slice"}),H=buildCommon.makeSvgSpan([N[A]],[se],n);if(E===1)return{span:H,minWidth:x,height:_};H.style.height=makeEm(_),w.push(H)}return{span:buildCommon.makeSpan(["stretchy"],w,n),minWidth:x,height:_}}}var{span:s,minWidth:a,height:l}=o();return s.height=l,s.style.height=makeEm(l),a>0&&(s.style.minWidth=makeEm(a)),s},encloseSpan=function r(e,n,o,s,a){var l,c=e.height+e.depth+o+s;if(/fbox|color|angl/.test(n)){if(l=buildCommon.makeSpan(["stretchy",n],[],a),n==="fbox"){var d=a.color&&a.getColor();d&&(l.style.borderColor=d)}}else{var u=[];/^[bx]cancel$/.test(n)&&u.push(new LineNode({x1:"0",y1:"0",x2:"100%",y2:"100%","stroke-width":"0.046em"})),/^x?cancel$/.test(n)&&u.push(new LineNode({x1:"0",y1:"100%",x2:"100%",y2:"0","stroke-width":"0.046em"}));var m=new SvgNode(u,{width:"100%",height:makeEm(c)});l=buildCommon.makeSvgSpan([],[m],a)}return l.height=c,l.style.height=makeEm(c),l},stretchy={encloseSpan,mathMLnode,svgSpan};function assertNodeType(r,e){if(!r||r.type!==e)throw new Error("Expected node of type "+e+", but got "+(r?"node of type "+r.type:String(r)));return r}function assertSymbolNodeType(r){var e=checkSymbolNodeType(r);if(!e)throw new Error("Expected node of symbol group type, but got "+(r?"node of type "+r.type:String(r)));return e}function checkSymbolNodeType(r){return r&&(r.type==="atom"||NON_ATOMS.hasOwnProperty(r.type))?r:null}var htmlBuilder$a=(r,e)=>{var n,o,s;r&&r.type==="supsub"?(o=assertNodeType(r.base,"accent"),n=o.base,r.base=n,s=assertSpan(buildGroup$1(r,e)),r.base=o):(o=assertNodeType(r,"accent"),n=o.base);var a=buildGroup$1(n,e.havingCrampedStyle()),l=o.isShifty&&utils.isCharacterBox(n),c=0;if(l){var d=utils.getBaseElem(n),u=buildGroup$1(d,e.havingCrampedStyle());c=assertSymbolDomNode(u).skew}var m=o.label==="\\c",f=m?a.height+a.depth:Math.min(a.height,e.fontMetrics().xHeight),p;if(o.isStretchy)p=stretchy.svgSpan(o,e),p=buildCommon.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:a},{type:"elem",elem:p,wrapperClasses:["svg-align"],wrapperStyle:c>0?{width:"calc(100% - "+makeEm(2*c)+")",marginLeft:makeEm(2*c)}:void 0}]},e);else{var g,y;o.label==="\\vec"?(g=buildCommon.staticSvg("vec",e),y=buildCommon.svgData.vec[1]):(g=buildCommon.makeOrd({mode:o.mode,text:o.label},e,"textord"),g=assertSymbolDomNode(g),g.italic=0,y=g.width,m&&(f+=g.depth)),p=buildCommon.makeSpan(["accent-body"],[g]);var b=o.label==="\\textcircled";b&&(p.classes.push("accent-full"),f=a.height);var k=c;b||(k-=y/2),p.style.left=makeEm(k),o.label==="\\textcircled"&&(p.style.top=".2em"),p=buildCommon.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:a},{type:"kern",size:-f},{type:"elem",elem:p}]},e)}var w=buildCommon.makeSpan(["mord","accent"],[p],e);return s?(s.children[0]=w,s.height=Math.max(w.height,s.height),s.classes[0]="mord",s):w},mathmlBuilder$9=(r,e)=>{var n=r.isStretchy?stretchy.mathMLnode(r.label):new mathMLTree.MathNode("mo",[makeText(r.label,r.mode)]),o=new mathMLTree.MathNode("mover",[buildGroup(r.base,e),n]);return o.setAttribute("accent","true"),o},NON_STRETCHY_ACCENT_REGEX=new RegExp(["\\acute","\\grave","\\ddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot","\\mathring"].map(r=>"\\"+r).join("|"));defineFunction({type:"accent",names:["\\acute","\\grave","\\ddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot","\\mathring","\\widecheck","\\widehat","\\widetilde","\\overrightarrow","\\overleftarrow","\\Overrightarrow","\\overleftrightarrow","\\overgroup","\\overlinesegment","\\overleftharpoon","\\overrightharpoon"],props:{numArgs:1},handler:(r,e)=>{var n=normalizeArgument(e[0]),o=!NON_STRETCHY_ACCENT_REGEX.test(r.funcName),s=!o||r.funcName==="\\widehat"||r.funcName==="\\widetilde"||r.funcName==="\\widecheck";return{type:"accent",mode:r.parser.mode,label:r.funcName,isStretchy:o,isShifty:s,base:n}},htmlBuilder:htmlBuilder$a,mathmlBuilder:mathmlBuilder$9}),defineFunction({type:"accent",names:["\\'","\\`","\\^","\\~","\\=","\\u","\\.",'\\"',"\\c","\\r","\\H","\\v","\\textcircled"],props:{numArgs:1,allowedInText:!0,allowedInMath:!0,argTypes:["primitive"]},handler:(r,e)=>{var n=e[0],o=r.parser.mode;return o==="math"&&(r.parser.settings.reportNonstrict("mathVsTextAccents","LaTeX's accent "+r.funcName+" works only in text mode"),o="text"),{type:"accent",mode:o,label:r.funcName,isStretchy:!1,isShifty:!0,base:n}},htmlBuilder:htmlBuilder$a,mathmlBuilder:mathmlBuilder$9}),defineFunction({type:"accentUnder",names:["\\underleftarrow","\\underrightarrow","\\underleftrightarrow","\\undergroup","\\underlinesegment","\\utilde"],props:{numArgs:1},handler:(r,e)=>{var{parser:n,funcName:o}=r,s=e[0];return{type:"accentUnder",mode:n.mode,label:o,base:s}},htmlBuilder:(r,e)=>{var n=buildGroup$1(r.base,e),o=stretchy.svgSpan(r,e),s=r.label==="\\utilde"?.12:0,a=buildCommon.makeVList({positionType:"top",positionData:n.height,children:[{type:"elem",elem:o,wrapperClasses:["svg-align"]},{type:"kern",size:s},{type:"elem",elem:n}]},e);return buildCommon.makeSpan(["mord","accentunder"],[a],e)},mathmlBuilder:(r,e)=>{var n=stretchy.mathMLnode(r.label),o=new mathMLTree.MathNode("munder",[buildGroup(r.base,e),n]);return o.setAttribute("accentunder","true"),o}});var paddedNode=r=>{var e=new mathMLTree.MathNode("mpadded",r?[r]:[]);return e.setAttribute("width","+0.6em"),e.setAttribute("lspace","0.3em"),e};defineFunction({type:"xArrow",names:["\\xleftarrow","\\xrightarrow","\\xLeftarrow","\\xRightarrow","\\xleftrightarrow","\\xLeftrightarrow","\\xhookleftarrow","\\xhookrightarrow","\\xmapsto","\\xrightharpoondown","\\xrightharpoonup","\\xleftharpoondown","\\xleftharpoonup","\\xrightleftharpoons","\\xleftrightharpoons","\\xlongequal","\\xtwoheadrightarrow","\\xtwoheadleftarrow","\\xtofrom","\\xrightleftarrows","\\xrightequilibrium","\\xleftequilibrium","\\\\cdrightarrow","\\\\cdleftarrow","\\\\cdlongequal"],props:{numArgs:1,numOptionalArgs:1},handler(r,e,n){var{parser:o,funcName:s}=r;return{type:"xArrow",mode:o.mode,label:s,body:e[0],below:n[0]}},htmlBuilder(r,e){var n=e.style,o=e.havingStyle(n.sup()),s=buildCommon.wrapFragment(buildGroup$1(r.body,o,e),e),a=r.label.slice(0,2)==="\\x"?"x":"cd";s.classes.push(a+"-arrow-pad");var l;r.below&&(o=e.havingStyle(n.sub()),l=buildCommon.wrapFragment(buildGroup$1(r.below,o,e),e),l.classes.push(a+"-arrow-pad"));var c=stretchy.svgSpan(r,e),d=-e.fontMetrics().axisHeight+.5*c.height,u=-e.fontMetrics().axisHeight-.5*c.height-.111;(s.depth>.25||r.label==="\\xleftequilibrium")&&(u-=s.depth);var m;if(l){var f=-e.fontMetrics().axisHeight+l.height+.5*c.height+.111;m=buildCommon.makeVList({positionType:"individualShift",children:[{type:"elem",elem:s,shift:u},{type:"elem",elem:c,shift:d},{type:"elem",elem:l,shift:f}]},e)}else m=buildCommon.makeVList({positionType:"individualShift",children:[{type:"elem",elem:s,shift:u},{type:"elem",elem:c,shift:d}]},e);return m.children[0].children[0].children[1].classes.push("svg-align"),buildCommon.makeSpan(["mrel","x-arrow"],[m],e)},mathmlBuilder(r,e){var n=stretchy.mathMLnode(r.label);n.setAttribute("minsize",r.label.charAt(0)==="x"?"1.75em":"3.0em");var o;if(r.body){var s=paddedNode(buildGroup(r.body,e));if(r.below){var a=paddedNode(buildGroup(r.below,e));o=new mathMLTree.MathNode("munderover",[n,a,s])}else o=new mathMLTree.MathNode("mover",[n,s])}else if(r.below){var l=paddedNode(buildGroup(r.below,e));o=new mathMLTree.MathNode("munder",[n,l])}else o=paddedNode(),o=new mathMLTree.MathNode("mover",[n,o]);return o}});var makeSpan=buildCommon.makeSpan;function htmlBuilder$9(r,e){var n=buildExpression$1(r.body,e,!0);return makeSpan([r.mclass],n,e)}function mathmlBuilder$8(r,e){var n,o=buildExpression(r.body,e);return r.mclass==="minner"?n=new mathMLTree.MathNode("mpadded",o):r.mclass==="mord"?r.isCharacterBox?(n=o[0],n.type="mi"):n=new mathMLTree.MathNode("mi",o):(r.isCharacterBox?(n=o[0],n.type="mo"):n=new mathMLTree.MathNode("mo",o),r.mclass==="mbin"?(n.attributes.lspace="0.22em",n.attributes.rspace="0.22em"):r.mclass==="mpunct"?(n.attributes.lspace="0em",n.attributes.rspace="0.17em"):r.mclass==="mopen"||r.mclass==="mclose"?(n.attributes.lspace="0em",n.attributes.rspace="0em"):r.mclass==="minner"&&(n.attributes.lspace="0.0556em",n.attributes.width="+0.1111em")),n}defineFunction({type:"mclass",names:["\\mathord","\\mathbin","\\mathrel","\\mathopen","\\mathclose","\\mathpunct","\\mathinner"],props:{numArgs:1,primitive:!0},handler(r,e){var{parser:n,funcName:o}=r,s=e[0];return{type:"mclass",mode:n.mode,mclass:"m"+o.slice(5),body:ordargument(s),isCharacterBox:utils.isCharacterBox(s)}},htmlBuilder:htmlBuilder$9,mathmlBuilder:mathmlBuilder$8});var binrelClass=r=>{var e=r.type==="ordgroup"&&r.body.length?r.body[0]:r;return e.type==="atom"&&(e.family==="bin"||e.family==="rel")?"m"+e.family:"mord"};defineFunction({type:"mclass",names:["\\@binrel"],props:{numArgs:2},handler(r,e){var{parser:n}=r;return{type:"mclass",mode:n.mode,mclass:binrelClass(e[0]),body:ordargument(e[1]),isCharacterBox:utils.isCharacterBox(e[1])}}}),defineFunction({type:"mclass",names:["\\stackrel","\\overset","\\underset"],props:{numArgs:2},handler(r,e){var{parser:n,funcName:o}=r,s=e[1],a=e[0],l;o!=="\\stackrel"?l=binrelClass(s):l="mrel";var c={type:"op",mode:s.mode,limits:!0,alwaysHandleSupSub:!0,parentIsSupSub:!1,symbol:!1,suppressBaseShift:o!=="\\stackrel",body:ordargument(s)},d={type:"supsub",mode:a.mode,base:c,sup:o==="\\underset"?null:a,sub:o==="\\underset"?a:null};return{type:"mclass",mode:n.mode,mclass:l,body:[d],isCharacterBox:utils.isCharacterBox(d)}},htmlBuilder:htmlBuilder$9,mathmlBuilder:mathmlBuilder$8}),defineFunction({type:"pmb",names:["\\pmb"],props:{numArgs:1,allowedInText:!0},handler(r,e){var{parser:n}=r;return{type:"pmb",mode:n.mode,mclass:binrelClass(e[0]),body:ordargument(e[0])}},htmlBuilder(r,e){var n=buildExpression$1(r.body,e,!0),o=buildCommon.makeSpan([r.mclass],n,e);return o.style.textShadow="0.02em 0.01em 0.04px",o},mathmlBuilder(r,e){var n=buildExpression(r.body,e),o=new mathMLTree.MathNode("mstyle",n);return o.setAttribute("style","text-shadow: 0.02em 0.01em 0.04px"),o}});var cdArrowFunctionName={">":"\\\\cdrightarrow","<":"\\\\cdleftarrow","=":"\\\\cdlongequal",A:"\\uparrow",V:"\\downarrow","|":"\\Vert",".":"no arrow"},newCell=()=>({type:"styling",body:[],mode:"math",style:"display"}),isStartOfArrow=r=>r.type==="textord"&&r.text==="@",isLabelEnd=(r,e)=>(r.type==="mathord"||r.type==="atom")&&r.text===e;function cdArrow(r,e,n){var o=cdArrowFunctionName[r];switch(o){case"\\\\cdrightarrow":case"\\\\cdleftarrow":return n.callFunction(o,[e[0]],[e[1]]);case"\\uparrow":case"\\downarrow":{var s=n.callFunction("\\\\cdleft",[e[0]],[]),a={type:"atom",text:o,mode:"math",family:"rel"},l=n.callFunction("\\Big",[a],[]),c=n.callFunction("\\\\cdright",[e[1]],[]),d={type:"ordgroup",mode:"math",body:[s,l,c]};return n.callFunction("\\\\cdparent",[d],[])}case"\\\\cdlongequal":return n.callFunction("\\\\cdlongequal",[],[]);case"\\Vert":{var u={type:"textord",text:"\\Vert",mode:"math"};return n.callFunction("\\Big",[u],[])}default:return{type:"textord",text:" ",mode:"math"}}}function parseCD(r){var e=[];for(r.gullet.beginGroup(),r.gullet.macros.set("\\cr","\\\\\\relax"),r.gullet.beginGroup();;){e.push(r.parseExpression(!1,"\\\\")),r.gullet.endGroup(),r.gullet.beginGroup();var n=r.fetch().text;if(n==="&"||n==="\\\\")r.consume();else if(n==="\\end"){e[e.length-1].length===0&&e.pop();break}else throw new ParseError("Expected \\\\ or \\cr or \\end",r.nextToken)}for(var o=[],s=[o],a=0;a<e.length;a++){for(var l=e[a],c=newCell(),d=0;d<l.length;d++)if(!isStartOfArrow(l[d]))c.body.push(l[d]);else{o.push(c),d+=1;var u=assertSymbolNodeType(l[d]).text,m=new Array(2);if(m[0]={type:"ordgroup",mode:"math",body:[]},m[1]={type:"ordgroup",mode:"math",body:[]},!("=|.".indexOf(u)>-1))if("<>AV".indexOf(u)>-1)for(var f=0;f<2;f++){for(var p=!0,g=d+1;g<l.length;g++){if(isLabelEnd(l[g],u)){p=!1,d=g;break}if(isStartOfArrow(l[g]))throw new ParseError("Missing a "+u+" character to complete a CD arrow.",l[g]);m[f].body.push(l[g])}if(p)throw new ParseError("Missing a "+u+" character to complete a CD arrow.",l[d])}else throw new ParseError('Expected one of "<>AV=|." after @',l[d]);var y=cdArrow(u,m,r),b={type:"styling",body:[y],mode:"math",style:"display"};o.push(b),c=newCell()}a%2===0?o.push(c):o.shift(),o=[],s.push(o)}r.gullet.endGroup(),r.gullet.endGroup();var k=new Array(s[0].length).fill({type:"align",align:"c",pregap:.25,postgap:.25});return{type:"array",mode:"math",body:s,arraystretch:1,addJot:!0,rowGaps:[null],cols:k,colSeparationType:"CD",hLinesBeforeRow:new Array(s.length+1).fill([])}}defineFunction({type:"cdlabel",names:["\\\\cdleft","\\\\cdright"],props:{numArgs:1},handler(r,e){var{parser:n,funcName:o}=r;return{type:"cdlabel",mode:n.mode,side:o.slice(4),label:e[0]}},htmlBuilder(r,e){var n=e.havingStyle(e.style.sup()),o=buildCommon.wrapFragment(buildGroup$1(r.label,n,e),e);return o.classes.push("cd-label-"+r.side),o.style.bottom=makeEm(.8-o.depth),o.height=0,o.depth=0,o},mathmlBuilder(r,e){var n=new mathMLTree.MathNode("mrow",[buildGroup(r.label,e)]);return n=new mathMLTree.MathNode("mpadded",[n]),n.setAttribute("width","0"),r.side==="left"&&n.setAttribute("lspace","-1width"),n.setAttribute("voffset","0.7em"),n=new mathMLTree.MathNode("mstyle",[n]),n.setAttribute("displaystyle","false"),n.setAttribute("scriptlevel","1"),n}}),defineFunction({type:"cdlabelparent",names:["\\\\cdparent"],props:{numArgs:1},handler(r,e){var{parser:n}=r;return{type:"cdlabelparent",mode:n.mode,fragment:e[0]}},htmlBuilder(r,e){var n=buildCommon.wrapFragment(buildGroup$1(r.fragment,e),e);return n.classes.push("cd-vert-arrow"),n},mathmlBuilder(r,e){return new mathMLTree.MathNode("mrow",[buildGroup(r.fragment,e)])}}),defineFunction({type:"textord",names:["\\@char"],props:{numArgs:1,allowedInText:!0},handler(r,e){for(var{parser:n}=r,o=assertNodeType(e[0],"ordgroup"),s=o.body,a="",l=0;l<s.length;l++){var c=assertNodeType(s[l],"textord");a+=c.text}var d=parseInt(a),u;if(isNaN(d))throw new ParseError("\\@char has non-numeric argument "+a);if(d<0||d>=1114111)throw new ParseError("\\@char with invalid code point "+a);return d<=65535?u=String.fromCharCode(d):(d-=65536,u=String.fromCharCode((d>>10)+55296,(d&1023)+56320)),{type:"textord",mode:n.mode,text:u}}});var htmlBuilder$8=(r,e)=>{var n=buildExpression$1(r.body,e.withColor(r.color),!1);return buildCommon.makeFragment(n)},mathmlBuilder$7=(r,e)=>{var n=buildExpression(r.body,e.withColor(r.color)),o=new mathMLTree.MathNode("mstyle",n);return o.setAttribute("mathcolor",r.color),o};defineFunction({type:"color",names:["\\textcolor"],props:{numArgs:2,allowedInText:!0,argTypes:["color","original"]},handler(r,e){var{parser:n}=r,o=assertNodeType(e[0],"color-token").color,s=e[1];return{type:"color",mode:n.mode,color:o,body:ordargument(s)}},htmlBuilder:htmlBuilder$8,mathmlBuilder:mathmlBuilder$7}),defineFunction({type:"color",names:["\\color"],props:{numArgs:1,allowedInText:!0,argTypes:["color"]},handler(r,e){var{parser:n,breakOnTokenText:o}=r,s=assertNodeType(e[0],"color-token").color;n.gullet.macros.set("\\current@color",s);var a=n.parseExpression(!0,o);return{type:"color",mode:n.mode,color:s,body:a}},htmlBuilder:htmlBuilder$8,mathmlBuilder:mathmlBuilder$7}),defineFunction({type:"cr",names:["\\\\"],props:{numArgs:0,numOptionalArgs:0,allowedInText:!0},handler(r,e,n){var{parser:o}=r,s=o.gullet.future().text==="["?o.parseSizeGroup(!0):null,a=!o.settings.displayMode||!o.settings.useStrictBehavior("newLineInDisplayMode","In LaTeX, \\\\ or \\newline does nothing in display mode");return{type:"cr",mode:o.mode,newLine:a,size:s&&assertNodeType(s,"size").value}},htmlBuilder(r,e){var n=buildCommon.makeSpan(["mspace"],[],e);return r.newLine&&(n.classes.push("newline"),r.size&&(n.style.marginTop=makeEm(calculateSize(r.size,e)))),n},mathmlBuilder(r,e){var n=new mathMLTree.MathNode("mspace");return r.newLine&&(n.setAttribute("linebreak","newline"),r.size&&n.setAttribute("height",makeEm(calculateSize(r.size,e)))),n}});var globalMap={"\\global":"\\global","\\long":"\\\\globallong","\\\\globallong":"\\\\globallong","\\def":"\\gdef","\\gdef":"\\gdef","\\edef":"\\xdef","\\xdef":"\\xdef","\\let":"\\\\globallet","\\futurelet":"\\\\globalfuture"},checkControlSequence=r=>{var e=r.text;if(/^(?:[\\{}$&#^_]|EOF)$/.test(e))throw new ParseError("Expected a control sequence",r);return e},getRHS=r=>{var e=r.gullet.popToken();return e.text==="="&&(e=r.gullet.popToken(),e.text===" "&&(e=r.gullet.popToken())),e},letCommand=(r,e,n,o)=>{var s=r.gullet.macros.get(n.text);s==null&&(n.noexpand=!0,s={tokens:[n],numArgs:0,unexpandable:!r.gullet.isExpandable(n.text)}),r.gullet.macros.set(e,s,o)};defineFunction({type:"internal",names:["\\global","\\long","\\\\globallong"],props:{numArgs:0,allowedInText:!0},handler(r){var{parser:e,funcName:n}=r;e.consumeSpaces();var o=e.fetch();if(globalMap[o.text])return(n==="\\global"||n==="\\\\globallong")&&(o.text=globalMap[o.text]),assertNodeType(e.parseFunction(),"internal");throw new ParseError("Invalid token after macro prefix",o)}}),defineFunction({type:"internal",names:["\\def","\\gdef","\\edef","\\xdef"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(r){var{parser:e,funcName:n}=r,o=e.gullet.popToken(),s=o.text;if(/^(?:[\\{}$&#^_]|EOF)$/.test(s))throw new ParseError("Expected a control sequence",o);for(var a=0,l,c=[[]];e.gullet.future().text!=="{";)if(o=e.gullet.popToken(),o.text==="#"){if(e.gullet.future().text==="{"){l=e.gullet.future(),c[a].push("{");break}if(o=e.gullet.popToken(),!/^[1-9]$/.test(o.text))throw new ParseError('Invalid argument number "'+o.text+'"');if(parseInt(o.text)!==a+1)throw new ParseError('Argument number "'+o.text+'" out of order');a++,c.push([])}else{if(o.text==="EOF")throw new ParseError("Expected a macro definition");c[a].push(o.text)}var{tokens:d}=e.gullet.consumeArg();return l&&d.unshift(l),(n==="\\edef"||n==="\\xdef")&&(d=e.gullet.expandTokens(d),d.reverse()),e.gullet.macros.set(s,{tokens:d,numArgs:a,delimiters:c},n===globalMap[n]),{type:"internal",mode:e.mode}}}),defineFunction({type:"internal",names:["\\let","\\\\globallet"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(r){var{parser:e,funcName:n}=r,o=checkControlSequence(e.gullet.popToken());e.gullet.consumeSpaces();var s=getRHS(e);return letCommand(e,o,s,n==="\\\\globallet"),{type:"internal",mode:e.mode}}}),defineFunction({type:"internal",names:["\\futurelet","\\\\globalfuture"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(r){var{parser:e,funcName:n}=r,o=checkControlSequence(e.gullet.popToken()),s=e.gullet.popToken(),a=e.gullet.popToken();return letCommand(e,o,a,n==="\\\\globalfuture"),e.gullet.pushToken(a),e.gullet.pushToken(s),{type:"internal",mode:e.mode}}});var getMetrics=function r(e,n,o){var s=symbols.math[e]&&symbols.math[e].replace,a=getCharacterMetrics(s||e,n,o);if(!a)throw new Error("Unsupported symbol "+e+" and font size "+n+".");return a},styleWrap=function r(e,n,o,s){var a=o.havingBaseStyle(n),l=buildCommon.makeSpan(s.concat(a.sizingClasses(o)),[e],o),c=a.sizeMultiplier/o.sizeMultiplier;return l.height*=c,l.depth*=c,l.maxFontSize=a.sizeMultiplier,l},centerSpan=function r(e,n,o){var s=n.havingBaseStyle(o),a=(1-n.sizeMultiplier/s.sizeMultiplier)*n.fontMetrics().axisHeight;e.classes.push("delimcenter"),e.style.top=makeEm(a),e.height-=a,e.depth+=a},makeSmallDelim=function r(e,n,o,s,a,l){var c=buildCommon.makeSymbol(e,"Main-Regular",a,s),d=styleWrap(c,n,s,l);return o&&centerSpan(d,s,n),d},mathrmSize=function r(e,n,o,s){return buildCommon.makeSymbol(e,"Size"+n+"-Regular",o,s)},makeLargeDelim=function r(e,n,o,s,a,l){var c=mathrmSize(e,n,a,s),d=styleWrap(buildCommon.makeSpan(["delimsizing","size"+n],[c],s),Style$1.TEXT,s,l);return o&&centerSpan(d,s,Style$1.TEXT),d},makeGlyphSpan=function r(e,n,o){var s;n==="Size1-Regular"?s="delim-size1":s="delim-size4";var a=buildCommon.makeSpan(["delimsizinginner",s],[buildCommon.makeSpan([],[buildCommon.makeSymbol(e,n,o)])]);return{type:"elem",elem:a}},makeInner=function r(e,n,o){var s=fontMetricsData["Size4-Regular"][e.charCodeAt(0)]?fontMetricsData["Size4-Regular"][e.charCodeAt(0)][4]:fontMetricsData["Size1-Regular"][e.charCodeAt(0)][4],a=new PathNode("inner",innerPath(e,Math.round(1e3*n))),l=new SvgNode([a],{width:makeEm(s),height:makeEm(n),style:"width:"+makeEm(s),viewBox:"0 0 "+1e3*s+" "+Math.round(1e3*n),preserveAspectRatio:"xMinYMin"}),c=buildCommon.makeSvgSpan([],[l],o);return c.height=n,c.style.height=makeEm(n),c.style.width=makeEm(s),{type:"elem",elem:c}},lapInEms=.008,lap={type:"kern",size:-1*lapInEms},verts=["|","\\lvert","\\rvert","\\vert"],doubleVerts=["\\|","\\lVert","\\rVert","\\Vert"],makeStackedDelim=function r(e,n,o,s,a,l){var c,d,u,m,f="",p=0;c=u=m=e,d=null;var g="Size1-Regular";e==="\\uparrow"?u=m="\u23D0":e==="\\Uparrow"?u=m="\u2016":e==="\\downarrow"?c=u="\u23D0":e==="\\Downarrow"?c=u="\u2016":e==="\\updownarrow"?(c="\\uparrow",u="\u23D0",m="\\downarrow"):e==="\\Updownarrow"?(c="\\Uparrow",u="\u2016",m="\\Downarrow"):utils.contains(verts,e)?(u="\u2223",f="vert",p=333):utils.contains(doubleVerts,e)?(u="\u2225",f="doublevert",p=556):e==="["||e==="\\lbrack"?(c="\u23A1",u="\u23A2",m="\u23A3",g="Size4-Regular",f="lbrack",p=667):e==="]"||e==="\\rbrack"?(c="\u23A4",u="\u23A5",m="\u23A6",g="Size4-Regular",f="rbrack",p=667):e==="\\lfloor"||e==="\u230A"?(u=c="\u23A2",m="\u23A3",g="Size4-Regular",f="lfloor",p=667):e==="\\lceil"||e==="\u2308"?(c="\u23A1",u=m="\u23A2",g="Size4-Regular",f="lceil",p=667):e==="\\rfloor"||e==="\u230B"?(u=c="\u23A5",m="\u23A6",g="Size4-Regular",f="rfloor",p=667):e==="\\rceil"||e==="\u2309"?(c="\u23A4",u=m="\u23A5",g="Size4-Regular",f="rceil",p=667):e==="("||e==="\\lparen"?(c="\u239B",u="\u239C",m="\u239D",g="Size4-Regular",f="lparen",p=875):e===")"||e==="\\rparen"?(c="\u239E",u="\u239F",m="\u23A0",g="Size4-Regular",f="rparen",p=875):e==="\\{"||e==="\\lbrace"?(c="\u23A7",d="\u23A8",m="\u23A9",u="\u23AA",g="Size4-Regular"):e==="\\}"||e==="\\rbrace"?(c="\u23AB",d="\u23AC",m="\u23AD",u="\u23AA",g="Size4-Regular"):e==="\\lgroup"||e==="\u27EE"?(c="\u23A7",m="\u23A9",u="\u23AA",g="Size4-Regular"):e==="\\rgroup"||e==="\u27EF"?(c="\u23AB",m="\u23AD",u="\u23AA",g="Size4-Regular"):e==="\\lmoustache"||e==="\u23B0"?(c="\u23A7",m="\u23AD",u="\u23AA",g="Size4-Regular"):(e==="\\rmoustache"||e==="\u23B1")&&(c="\u23AB",m="\u23A9",u="\u23AA",g="Size4-Regular");var y=getMetrics(c,g,a),b=y.height+y.depth,k=getMetrics(u,g,a),w=k.height+k.depth,B=getMetrics(m,g,a),M=B.height+B.depth,x=0,v=1;if(d!==null){var _=getMetrics(d,g,a);x=_.height+_.depth,v=2}var E=b+M+x,N=Math.max(0,Math.ceil((n-E)/(v*w))),I=E+N*v*w,L=s.fontMetrics().axisHeight;o&&(L*=s.sizeMultiplier);var A=I/2-L,F=[];if(f.length>0){var se=I-b-M,H=Math.round(I*1e3),V=tallDelim(f,Math.round(se*1e3)),R=new PathNode(f,V),J=(p/1e3).toFixed(3)+"em",Y=(H/1e3).toFixed(3)+"em",re=new SvgNode([R],{width:J,height:Y,viewBox:"0 0 "+p+" "+H}),Q=buildCommon.makeSvgSpan([],[re],s);Q.height=H/1e3,Q.style.width=J,Q.style.height=Y,F.push({type:"elem",elem:Q})}else{if(F.push(makeGlyphSpan(m,g,a)),F.push(lap),d===null){var j=I-b-M+2*lapInEms;F.push(makeInner(u,j,s))}else{var q=(I-b-M-x)/2+2*lapInEms;F.push(makeInner(u,q,s)),F.push(lap),F.push(makeGlyphSpan(d,g,a)),F.push(lap),F.push(makeInner(u,q,s))}F.push(lap),F.push(makeGlyphSpan(c,g,a))}var ee=s.havingBaseStyle(Style$1.TEXT),G=buildCommon.makeVList({positionType:"bottom",positionData:A,children:F},ee);return styleWrap(buildCommon.makeSpan(["delimsizing","mult"],[G],ee),Style$1.TEXT,s,l)},vbPad=80,emPad=.08,sqrtSvg=function r(e,n,o,s,a){var l=sqrtPath(e,s,o),c=new PathNode(e,l),d=new SvgNode([c],{width:"400em",height:makeEm(n),viewBox:"0 0 400000 "+o,preserveAspectRatio:"xMinYMin slice"});return buildCommon.makeSvgSpan(["hide-tail"],[d],a)},makeSqrtImage=function r(e,n){var o=n.havingBaseSizing(),s=traverseSequence("\\surd",e*o.sizeMultiplier,stackLargeDelimiterSequence,o),a=o.sizeMultiplier,l=Math.max(0,n.minRuleThickness-n.fontMetrics().sqrtRuleThickness),c,d=0,u=0,m=0,f;return s.type==="small"?(m=1e3+1e3*l+vbPad,e<1?a=1:e<1.4&&(a=.7),d=(1+l+emPad)/a,u=(1+l)/a,c=sqrtSvg("sqrtMain",d,m,l,n),c.style.minWidth="0.853em",f=.833/a):s.type==="large"?(m=(1e3+vbPad)*sizeToMaxHeight[s.size],u=(sizeToMaxHeight[s.size]+l)/a,d=(sizeToMaxHeight[s.size]+l+emPad)/a,c=sqrtSvg("sqrtSize"+s.size,d,m,l,n),c.style.minWidth="1.02em",f=1/a):(d=e+l+emPad,u=e+l,m=Math.floor(1e3*e+l)+vbPad,c=sqrtSvg("sqrtTall",d,m,l,n),c.style.minWidth="0.742em",f=1.056),c.height=u,c.style.height=makeEm(d),{span:c,advanceWidth:f,ruleWidth:(n.fontMetrics().sqrtRuleThickness+l)*a}},stackLargeDelimiters=["(","\\lparen",")","\\rparen","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","\u230A","\u230B","\\lceil","\\rceil","\u2308","\u2309","\\surd"],stackAlwaysDelimiters=["\\uparrow","\\downarrow","\\updownarrow","\\Uparrow","\\Downarrow","\\Updownarrow","|","\\|","\\vert","\\Vert","\\lvert","\\rvert","\\lVert","\\rVert","\\lgroup","\\rgroup","\u27EE","\u27EF","\\lmoustache","\\rmoustache","\u23B0","\u23B1"],stackNeverDelimiters=["<",">","\\langle","\\rangle","/","\\backslash","\\lt","\\gt"],sizeToMaxHeight=[0,1.2,1.8,2.4,3],makeSizedDelim=function r(e,n,o,s,a){if(e==="<"||e==="\\lt"||e==="\u27E8"?e="\\langle":(e===">"||e==="\\gt"||e==="\u27E9")&&(e="\\rangle"),utils.contains(stackLargeDelimiters,e)||utils.contains(stackNeverDelimiters,e))return makeLargeDelim(e,n,!1,o,s,a);if(utils.contains(stackAlwaysDelimiters,e))return makeStackedDelim(e,sizeToMaxHeight[n],!1,o,s,a);throw new ParseError("Illegal delimiter: '"+e+"'")},stackNeverDelimiterSequence=[{type:"small",style:Style$1.SCRIPTSCRIPT},{type:"small",style:Style$1.SCRIPT},{type:"small",style:Style$1.TEXT},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4}],stackAlwaysDelimiterSequence=[{type:"small",style:Style$1.SCRIPTSCRIPT},{type:"small",style:Style$1.SCRIPT},{type:"small",style:Style$1.TEXT},{type:"stack"}],stackLargeDelimiterSequence=[{type:"small",style:Style$1.SCRIPTSCRIPT},{type:"small",style:Style$1.SCRIPT},{type:"small",style:Style$1.TEXT},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4},{type:"stack"}],delimTypeToFont=function r(e){if(e.type==="small")return"Main-Regular";if(e.type==="large")return"Size"+e.size+"-Regular";if(e.type==="stack")return"Size4-Regular";throw new Error("Add support for delim type '"+e.type+"' here.")},traverseSequence=function r(e,n,o,s){for(var a=Math.min(2,3-s.style.size),l=a;l<o.length&&o[l].type!=="stack";l++){var c=getMetrics(e,delimTypeToFont(o[l]),"math"),d=c.height+c.depth;if(o[l].type==="small"){var u=s.havingBaseStyle(o[l].style);d*=u.sizeMultiplier}if(d>n)return o[l]}return o[o.length-1]},makeCustomSizedDelim=function r(e,n,o,s,a,l){e==="<"||e==="\\lt"||e==="\u27E8"?e="\\langle":(e===">"||e==="\\gt"||e==="\u27E9")&&(e="\\rangle");var c;utils.contains(stackNeverDelimiters,e)?c=stackNeverDelimiterSequence:utils.contains(stackLargeDelimiters,e)?c=stackLargeDelimiterSequence:c=stackAlwaysDelimiterSequence;var d=traverseSequence(e,n,c,s);return d.type==="small"?makeSmallDelim(e,d.style,o,s,a,l):d.type==="large"?makeLargeDelim(e,d.size,o,s,a,l):makeStackedDelim(e,n,o,s,a,l)},makeLeftRightDelim=function r(e,n,o,s,a,l){var c=s.fontMetrics().axisHeight*s.sizeMultiplier,d=901,u=5/s.fontMetrics().ptPerEm,m=Math.max(n-c,o+c),f=Math.max(m/500*d,2*m-u);return makeCustomSizedDelim(e,f,!0,s,a,l)},delimiter={sqrtImage:makeSqrtImage,sizedDelim:makeSizedDelim,sizeToMaxHeight,customSizedDelim:makeCustomSizedDelim,leftRightDelim:makeLeftRightDelim},delimiterSizes={"\\bigl":{mclass:"mopen",size:1},"\\Bigl":{mclass:"mopen",size:2},"\\biggl":{mclass:"mopen",size:3},"\\Biggl":{mclass:"mopen",size:4},"\\bigr":{mclass:"mclose",size:1},"\\Bigr":{mclass:"mclose",size:2},"\\biggr":{mclass:"mclose",size:3},"\\Biggr":{mclass:"mclose",size:4},"\\bigm":{mclass:"mrel",size:1},"\\Bigm":{mclass:"mrel",size:2},"\\biggm":{mclass:"mrel",size:3},"\\Biggm":{mclass:"mrel",size:4},"\\big":{mclass:"mord",size:1},"\\Big":{mclass:"mord",size:2},"\\bigg":{mclass:"mord",size:3},"\\Bigg":{mclass:"mord",size:4}},delimiters=["(","\\lparen",")","\\rparen","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","\u230A","\u230B","\\lceil","\\rceil","\u2308","\u2309","<",">","\\langle","\u27E8","\\rangle","\u27E9","\\lt","\\gt","\\lvert","\\rvert","\\lVert","\\rVert","\\lgroup","\\rgroup","\u27EE","\u27EF","\\lmoustache","\\rmoustache","\u23B0","\u23B1","/","\\backslash","|","\\vert","\\|","\\Vert","\\uparrow","\\Uparrow","\\downarrow","\\Downarrow","\\updownarrow","\\Updownarrow","."];function checkDelimiter(r,e){var n=checkSymbolNodeType(r);if(n&&utils.contains(delimiters,n.text))return n;throw n?new ParseError("Invalid delimiter '"+n.text+"' after '"+e.funcName+"'",r):new ParseError("Invalid delimiter type '"+r.type+"'",r)}defineFunction({type:"delimsizing",names:["\\bigl","\\Bigl","\\biggl","\\Biggl","\\bigr","\\Bigr","\\biggr","\\Biggr","\\bigm","\\Bigm","\\biggm","\\Biggm","\\big","\\Big","\\bigg","\\Bigg"],props:{numArgs:1,argTypes:["primitive"]},handler:(r,e)=>{var n=checkDelimiter(e[0],r);return{type:"delimsizing",mode:r.parser.mode,size:delimiterSizes[r.funcName].size,mclass:delimiterSizes[r.funcName].mclass,delim:n.text}},htmlBuilder:(r,e)=>r.delim==="."?buildCommon.makeSpan([r.mclass]):delimiter.sizedDelim(r.delim,r.size,e,r.mode,[r.mclass]),mathmlBuilder:r=>{var e=[];r.delim!=="."&&e.push(makeText(r.delim,r.mode));var n=new mathMLTree.MathNode("mo",e);r.mclass==="mopen"||r.mclass==="mclose"?n.setAttribute("fence","true"):n.setAttribute("fence","false"),n.setAttribute("stretchy","true");var o=makeEm(delimiter.sizeToMaxHeight[r.size]);return n.setAttribute("minsize",o),n.setAttribute("maxsize",o),n}});function assertParsed(r){if(!r.body)throw new Error("Bug: The leftright ParseNode wasn't fully parsed.")}defineFunction({type:"leftright-right",names:["\\right"],props:{numArgs:1,primitive:!0},handler:(r,e)=>{var n=r.parser.gullet.macros.get("\\current@color");if(n&&typeof n!="string")throw new ParseError("\\current@color set to non-string in \\right");return{type:"leftright-right",mode:r.parser.mode,delim:checkDelimiter(e[0],r).text,color:n}}}),defineFunction({type:"leftright",names:["\\left"],props:{numArgs:1,primitive:!0},handler:(r,e)=>{var n=checkDelimiter(e[0],r),o=r.parser;++o.leftrightDepth;var s=o.parseExpression(!1);--o.leftrightDepth,o.expect("\\right",!1);var a=assertNodeType(o.parseFunction(),"leftright-right");return{type:"leftright",mode:o.mode,body:s,left:n.text,right:a.delim,rightColor:a.color}},htmlBuilder:(r,e)=>{assertParsed(r);for(var n=buildExpression$1(r.body,e,!0,["mopen","mclose"]),o=0,s=0,a=!1,l=0;l<n.length;l++)n[l].isMiddle?a=!0:(o=Math.max(n[l].height,o),s=Math.max(n[l].depth,s));o*=e.sizeMultiplier,s*=e.sizeMultiplier;var c;if(r.left==="."?c=makeNullDelimiter(e,["mopen"]):c=delimiter.leftRightDelim(r.left,o,s,e,r.mode,["mopen"]),n.unshift(c),a)for(var d=1;d<n.length;d++){var u=n[d],m=u.isMiddle;m&&(n[d]=delimiter.leftRightDelim(m.delim,o,s,m.options,r.mode,[]))}var f;if(r.right===".")f=makeNullDelimiter(e,["mclose"]);else{var p=r.rightColor?e.withColor(r.rightColor):e;f=delimiter.leftRightDelim(r.right,o,s,p,r.mode,["mclose"])}return n.push(f),buildCommon.makeSpan(["minner"],n,e)},mathmlBuilder:(r,e)=>{assertParsed(r);var n=buildExpression(r.body,e);if(r.left!=="."){var o=new mathMLTree.MathNode("mo",[makeText(r.left,r.mode)]);o.setAttribute("fence","true"),n.unshift(o)}if(r.right!=="."){var s=new mathMLTree.MathNode("mo",[makeText(r.right,r.mode)]);s.setAttribute("fence","true"),r.rightColor&&s.setAttribute("mathcolor",r.rightColor),n.push(s)}return makeRow(n)}}),defineFunction({type:"middle",names:["\\middle"],props:{numArgs:1,primitive:!0},handler:(r,e)=>{var n=checkDelimiter(e[0],r);if(!r.parser.leftrightDepth)throw new ParseError("\\middle without preceding \\left",n);return{type:"middle",mode:r.parser.mode,delim:n.text}},htmlBuilder:(r,e)=>{var n;if(r.delim===".")n=makeNullDelimiter(e,[]);else{n=delimiter.sizedDelim(r.delim,1,e,r.mode,[]);var o={delim:r.delim,options:e};n.isMiddle=o}return n},mathmlBuilder:(r,e)=>{var n=r.delim==="\\vert"||r.delim==="|"?makeText("|","text"):makeText(r.delim,r.mode),o=new mathMLTree.MathNode("mo",[n]);return o.setAttribute("fence","true"),o.setAttribute("lspace","0.05em"),o.setAttribute("rspace","0.05em"),o}});var htmlBuilder$7=(r,e)=>{var n=buildCommon.wrapFragment(buildGroup$1(r.body,e),e),o=r.label.slice(1),s=e.sizeMultiplier,a,l=0,c=utils.isCharacterBox(r.body);if(o==="sout")a=buildCommon.makeSpan(["stretchy","sout"]),a.height=e.fontMetrics().defaultRuleThickness/s,l=-.5*e.fontMetrics().xHeight;else if(o==="phase"){var d=calculateSize({number:.6,unit:"pt"},e),u=calculateSize({number:.35,unit:"ex"},e),m=e.havingBaseSizing();s=s/m.sizeMultiplier;var f=n.height+n.depth+d+u;n.style.paddingLeft=makeEm(f/2+d);var p=Math.floor(1e3*f*s),g=phasePath(p),y=new SvgNode([new PathNode("phase",g)],{width:"400em",height:makeEm(p/1e3),viewBox:"0 0 400000 "+p,preserveAspectRatio:"xMinYMin slice"});a=buildCommon.makeSvgSpan(["hide-tail"],[y],e),a.style.height=makeEm(f),l=n.depth+d+u}else{/cancel/.test(o)?c||n.classes.push("cancel-pad"):o==="angl"?n.classes.push("anglpad"):n.classes.push("boxpad");var b=0,k=0,w=0;/box/.test(o)?(w=Math.max(e.fontMetrics().fboxrule,e.minRuleThickness),b=e.fontMetrics().fboxsep+(o==="colorbox"?0:w),k=b):o==="angl"?(w=Math.max(e.fontMetrics().defaultRuleThickness,e.minRuleThickness),b=4*w,k=Math.max(0,.25-n.depth)):(b=c?.2:0,k=b),a=stretchy.encloseSpan(n,o,b,k,e),/fbox|boxed|fcolorbox/.test(o)?(a.style.borderStyle="solid",a.style.borderWidth=makeEm(w)):o==="angl"&&w!==.049&&(a.style.borderTopWidth=makeEm(w),a.style.borderRightWidth=makeEm(w)),l=n.depth+k,r.backgroundColor&&(a.style.backgroundColor=r.backgroundColor,r.borderColor&&(a.style.borderColor=r.borderColor))}var B;if(r.backgroundColor)B=buildCommon.makeVList({positionType:"individualShift",children:[{type:"elem",elem:a,shift:l},{type:"elem",elem:n,shift:0}]},e);else{var M=/cancel|phase/.test(o)?["svg-align"]:[];B=buildCommon.makeVList({positionType:"individualShift",children:[{type:"elem",elem:n,shift:0},{type:"elem",elem:a,shift:l,wrapperClasses:M}]},e)}return/cancel/.test(o)&&(B.height=n.height,B.depth=n.depth),/cancel/.test(o)&&!c?buildCommon.makeSpan(["mord","cancel-lap"],[B],e):buildCommon.makeSpan(["mord"],[B],e)},mathmlBuilder$6=(r,e)=>{var n=0,o=new mathMLTree.MathNode(r.label.indexOf("colorbox")>-1?"mpadded":"menclose",[buildGroup(r.body,e)]);switch(r.label){case"\\cancel":o.setAttribute("notation","updiagonalstrike");break;case"\\bcancel":o.setAttribute("notation","downdiagonalstrike");break;case"\\phase":o.setAttribute("notation","phasorangle");break;case"\\sout":o.setAttribute("notation","horizontalstrike");break;case"\\fbox":o.setAttribute("notation","box");break;case"\\angl":o.setAttribute("notation","actuarial");break;case"\\fcolorbox":case"\\colorbox":if(n=e.fontMetrics().fboxsep*e.fontMetrics().ptPerEm,o.setAttribute("width","+"+2*n+"pt"),o.setAttribute("height","+"+2*n+"pt"),o.setAttribute("lspace",n+"pt"),o.setAttribute("voffset",n+"pt"),r.label==="\\fcolorbox"){var s=Math.max(e.fontMetrics().fboxrule,e.minRuleThickness);o.setAttribute("style","border: "+s+"em solid "+String(r.borderColor))}break;case"\\xcancel":o.setAttribute("notation","updiagonalstrike downdiagonalstrike");break}return r.backgroundColor&&o.setAttribute("mathbackground",r.backgroundColor),o};defineFunction({type:"enclose",names:["\\colorbox"],props:{numArgs:2,allowedInText:!0,argTypes:["color","text"]},handler(r,e,n){var{parser:o,funcName:s}=r,a=assertNodeType(e[0],"color-token").color,l=e[1];return{type:"enclose",mode:o.mode,label:s,backgroundColor:a,body:l}},htmlBuilder:htmlBuilder$7,mathmlBuilder:mathmlBuilder$6}),defineFunction({type:"enclose",names:["\\fcolorbox"],props:{numArgs:3,allowedInText:!0,argTypes:["color","color","text"]},handler(r,e,n){var{parser:o,funcName:s}=r,a=assertNodeType(e[0],"color-token").color,l=assertNodeType(e[1],"color-token").color,c=e[2];return{type:"enclose",mode:o.mode,label:s,backgroundColor:l,borderColor:a,body:c}},htmlBuilder:htmlBuilder$7,mathmlBuilder:mathmlBuilder$6}),defineFunction({type:"enclose",names:["\\fbox"],props:{numArgs:1,argTypes:["hbox"],allowedInText:!0},handler(r,e){var{parser:n}=r;return{type:"enclose",mode:n.mode,label:"\\fbox",body:e[0]}}}),defineFunction({type:"enclose",names:["\\cancel","\\bcancel","\\xcancel","\\sout","\\phase"],props:{numArgs:1},handler(r,e){var{parser:n,funcName:o}=r,s=e[0];return{type:"enclose",mode:n.mode,label:o,body:s}},htmlBuilder:htmlBuilder$7,mathmlBuilder:mathmlBuilder$6}),defineFunction({type:"enclose",names:["\\angl"],props:{numArgs:1,argTypes:["hbox"],allowedInText:!1},handler(r,e){var{parser:n}=r;return{type:"enclose",mode:n.mode,label:"\\angl",body:e[0]}}});var _environments={};function defineEnvironment(r){for(var{type:e,names:n,props:o,handler:s,htmlBuilder:a,mathmlBuilder:l}=r,c={type:e,numArgs:o.numArgs||0,allowedInText:!1,numOptionalArgs:0,handler:s},d=0;d<n.length;++d)_environments[n[d]]=c;a&&(_htmlGroupBuilders[e]=a),l&&(_mathmlGroupBuilders[e]=l)}var _macros={};function defineMacro(r,e){_macros[r]=e}function getHLines(r){var e=[];r.consumeSpaces();var n=r.fetch().text;for(n==="\\relax"&&(r.consume(),r.consumeSpaces(),n=r.fetch().text);n==="\\hline"||n==="\\hdashline";)r.consume(),e.push(n==="\\hdashline"),r.consumeSpaces(),n=r.fetch().text;return e}var validateAmsEnvironmentContext=r=>{var e=r.parser.settings;if(!e.displayMode)throw new ParseError("{"+r.envName+"} can be used only in display mode.")};function getAutoTag(r){if(r.indexOf("ed")===-1)return r.indexOf("*")===-1}function parseArray(r,e,n){var{hskipBeforeAndAfter:o,addJot:s,cols:a,arraystretch:l,colSeparationType:c,autoTag:d,singleRow:u,emptySingleRow:m,maxNumCols:f,leqno:p}=e;if(r.gullet.beginGroup(),u||r.gullet.macros.set("\\cr","\\\\\\relax"),!l){var g=r.gullet.expandMacroAsText("\\arraystretch");if(g==null)l=1;else if(l=parseFloat(g),!l||l<0)throw new ParseError("Invalid \\arraystretch: "+g)}r.gullet.beginGroup();var y=[],b=[y],k=[],w=[],B=d!=null?[]:void 0;function M(){d&&r.gullet.macros.set("\\@eqnsw","1",!0)}function x(){B&&(r.gullet.macros.get("\\df@tag")?(B.push(r.subparse([new Token("\\df@tag")])),r.gullet.macros.set("\\df@tag",void 0,!0)):B.push(!!d&&r.gullet.macros.get("\\@eqnsw")==="1"))}for(M(),w.push(getHLines(r));;){var v=r.parseExpression(!1,u?"\\end":"\\\\");r.gullet.endGroup(),r.gullet.beginGroup(),v={type:"ordgroup",mode:r.mode,body:v},n&&(v={type:"styling",mode:r.mode,style:n,body:[v]}),y.push(v);var _=r.fetch().text;if(_==="&"){if(f&&y.length===f){if(u||c)throw new ParseError("Too many tab characters: &",r.nextToken);r.settings.reportNonstrict("textEnv","Too few columns specified in the {array} column argument.")}r.consume()}else if(_==="\\end"){x(),y.length===1&&v.type==="styling"&&v.body[0].body.length===0&&(b.length>1||!m)&&b.pop(),w.length<b.length+1&&w.push([]);break}else if(_==="\\\\"){r.consume();var E=void 0;r.gullet.future().text!==" "&&(E=r.parseSizeGroup(!0)),k.push(E?E.value:null),x(),w.push(getHLines(r)),y=[],b.push(y),M()}else throw new ParseError("Expected & or \\\\ or \\cr or \\end",r.nextToken)}return r.gullet.endGroup(),r.gullet.endGroup(),{type:"array",mode:r.mode,addJot:s,arraystretch:l,body:b,cols:a,rowGaps:k,hskipBeforeAndAfter:o,hLinesBeforeRow:w,colSeparationType:c,tags:B,leqno:p}}function dCellStyle(r){return r.slice(0,1)==="d"?"display":"text"}var htmlBuilder$6=function r(e,n){var o,s,a=e.body.length,l=e.hLinesBeforeRow,c=0,d=new Array(a),u=[],m=Math.max(n.fontMetrics().arrayRuleWidth,n.minRuleThickness),f=1/n.fontMetrics().ptPerEm,p=5*f;if(e.colSeparationType&&e.colSeparationType==="small"){var g=n.havingStyle(Style$1.SCRIPT).sizeMultiplier;p=.2778*(g/n.sizeMultiplier)}var y=e.colSeparationType==="CD"?calculateSize({number:3,unit:"ex"},n):12*f,b=3*f,k=e.arraystretch*y,w=.7*k,B=.3*k,M=0;function x(he){for(var ue=0;ue<he.length;++ue)ue>0&&(M+=.25),u.push({pos:M,isDashed:he[ue]})}for(x(l[0]),o=0;o<e.body.length;++o){var v=e.body[o],_=w,E=B;c<v.length&&(c=v.length);var N=new Array(v.length);for(s=0;s<v.length;++s){var I=buildGroup$1(v[s],n);E<I.depth&&(E=I.depth),_<I.height&&(_=I.height),N[s]=I}var L=e.rowGaps[o],A=0;L&&(A=calculateSize(L,n),A>0&&(A+=B,E<A&&(E=A),A=0)),e.addJot&&(E+=b),N.height=_,N.depth=E,M+=_,N.pos=M,M+=E+A,d[o]=N,x(l[o+1])}var F=M/2+n.fontMetrics().axisHeight,se=e.cols||[],H=[],V,R,J=[];if(e.tags&&e.tags.some(he=>he))for(o=0;o<a;++o){var Y=d[o],re=Y.pos-F,Q=e.tags[o],j=void 0;Q===!0?j=buildCommon.makeSpan(["eqn-num"],[],n):Q===!1?j=buildCommon.makeSpan([],[],n):j=buildCommon.makeSpan([],buildExpression$1(Q,n,!0),n),j.depth=Y.depth,j.height=Y.height,J.push({type:"elem",elem:j,shift:re})}for(s=0,R=0;s<c||R<se.length;++s,++R){for(var q=se[R]||{},ee=!0;q.type==="separator";){if(ee||(V=buildCommon.makeSpan(["arraycolsep"],[]),V.style.width=makeEm(n.fontMetrics().doubleRuleSep),H.push(V)),q.separator==="|"||q.separator===":"){var G=q.separator==="|"?"solid":"dashed",te=buildCommon.makeSpan(["vertical-separator"],[],n);te.style.height=makeEm(M),te.style.borderRightWidth=makeEm(m),te.style.borderRightStyle=G,te.style.margin="0 "+makeEm(-m/2);var ce=M-F;ce&&(te.style.verticalAlign=makeEm(-ce)),H.push(te)}else throw new ParseError("Invalid separator type: "+q.separator);R++,q=se[R]||{},ee=!1}if(!(s>=c)){var W=void 0;(s>0||e.hskipBeforeAndAfter)&&(W=utils.deflt(q.pregap,p),W!==0&&(V=buildCommon.makeSpan(["arraycolsep"],[]),V.style.width=makeEm(W),H.push(V)));var U=[];for(o=0;o<a;++o){var P=d[o],Z=P[s];if(Z){var $=P.pos-F;Z.depth=P.depth,Z.height=P.height,U.push({type:"elem",elem:Z,shift:$})}}U=buildCommon.makeVList({positionType:"individualShift",children:U},n),U=buildCommon.makeSpan(["col-align-"+(q.align||"c")],[U]),H.push(U),(s<c-1||e.hskipBeforeAndAfter)&&(W=utils.deflt(q.postgap,p),W!==0&&(V=buildCommon.makeSpan(["arraycolsep"],[]),V.style.width=makeEm(W),H.push(V)))}}if(d=buildCommon.makeSpan(["mtable"],H),u.length>0){for(var K=buildCommon.makeLineSpan("hline",n,m),ne=buildCommon.makeLineSpan("hdashline",n,m),oe=[{type:"elem",elem:d,shift:0}];u.length>0;){var ae=u.pop(),de=ae.pos-F;ae.isDashed?oe.push({type:"elem",elem:ne,shift:de}):oe.push({type:"elem",elem:K,shift:de})}d=buildCommon.makeVList({positionType:"individualShift",children:oe},n)}if(J.length===0)return buildCommon.makeSpan(["mord"],[d],n);var le=buildCommon.makeVList({positionType:"individualShift",children:J},n);return le=buildCommon.makeSpan(["tag"],[le],n),buildCommon.makeFragment([d,le])},alignMap={c:"center ",l:"left ",r:"right "},mathmlBuilder$5=function r(e,n){for(var o=[],s=new mathMLTree.MathNode("mtd",[],["mtr-glue"]),a=new mathMLTree.MathNode("mtd",[],["mml-eqn-num"]),l=0;l<e.body.length;l++){for(var c=e.body[l],d=[],u=0;u<c.length;u++)d.push(new mathMLTree.MathNode("mtd",[buildGroup(c[u],n)]));e.tags&&e.tags[l]&&(d.unshift(s),d.push(s),e.leqno?d.unshift(a):d.push(a)),o.push(new mathMLTree.MathNode("mtr",d))}var m=new mathMLTree.MathNode("mtable",o),f=e.arraystretch===.5?.1:.16+e.arraystretch-1+(e.addJot?.09:0);m.setAttribute("rowspacing",makeEm(f));var p="",g="";if(e.cols&&e.cols.length>0){var y=e.cols,b="",k=!1,w=0,B=y.length;y[0].type==="separator"&&(p+="top ",w=1),y[y.length-1].type==="separator"&&(p+="bottom ",B-=1);for(var M=w;M<B;M++)y[M].type==="align"?(g+=alignMap[y[M].align],k&&(b+="none "),k=!0):y[M].type==="separator"&&k&&(b+=y[M].separator==="|"?"solid ":"dashed ",k=!1);m.setAttribute("columnalign",g.trim()),/[sd]/.test(b)&&m.setAttribute("columnlines",b.trim())}if(e.colSeparationType==="align"){for(var x=e.cols||[],v="",_=1;_<x.length;_++)v+=_%2?"0em ":"1em ";m.setAttribute("columnspacing",v.trim())}else e.colSeparationType==="alignat"||e.colSeparationType==="gather"?m.setAttribute("columnspacing","0em"):e.colSeparationType==="small"?m.setAttribute("columnspacing","0.2778em"):e.colSeparationType==="CD"?m.setAttribute("columnspacing","0.5em"):m.setAttribute("columnspacing","1em");var E="",N=e.hLinesBeforeRow;p+=N[0].length>0?"left ":"",p+=N[N.length-1].length>0?"right ":"";for(var I=1;I<N.length-1;I++)E+=N[I].length===0?"none ":N[I][0]?"dashed ":"solid ";return/[sd]/.test(E)&&m.setAttribute("rowlines",E.trim()),p!==""&&(m=new mathMLTree.MathNode("menclose",[m]),m.setAttribute("notation",p.trim())),e.arraystretch&&e.arraystretch<1&&(m=new mathMLTree.MathNode("mstyle",[m]),m.setAttribute("scriptlevel","1")),m},alignedHandler=function r(e,n){e.envName.indexOf("ed")===-1&&validateAmsEnvironmentContext(e);var o=[],s=e.envName.indexOf("at")>-1?"alignat":"align",a=e.envName==="split",l=parseArray(e.parser,{cols:o,addJot:!0,autoTag:a?void 0:getAutoTag(e.envName),emptySingleRow:!0,colSeparationType:s,maxNumCols:a?2:void 0,leqno:e.parser.settings.leqno},"display"),c,d=0,u={type:"ordgroup",mode:e.mode,body:[]};if(n[0]&&n[0].type==="ordgroup"){for(var m="",f=0;f<n[0].body.length;f++){var p=assertNodeType(n[0].body[f],"textord");m+=p.text}c=Number(m),d=c*2}var g=!d;l.body.forEach(function(w){for(var B=1;B<w.length;B+=2){var M=assertNodeType(w[B],"styling"),x=assertNodeType(M.body[0],"ordgroup");x.body.unshift(u)}if(g)d<w.length&&(d=w.length);else{var v=w.length/2;if(c<v)throw new ParseError("Too many math in a row: "+("expected "+c+", but got "+v),w[0])}});for(var y=0;y<d;++y){var b="r",k=0;y%2===1?b="l":y>0&&g&&(k=1),o[y]={type:"align",align:b,pregap:k,postgap:0}}return l.colSeparationType=g?"align":"alignat",l};defineEnvironment({type:"array",names:["array","darray"],props:{numArgs:1},handler(r,e){var n=checkSymbolNodeType(e[0]),o=n?[e[0]]:assertNodeType(e[0],"ordgroup").body,s=o.map(function(l){var c=assertSymbolNodeType(l),d=c.text;if("lcr".indexOf(d)!==-1)return{type:"align",align:d};if(d==="|")return{type:"separator",separator:"|"};if(d===":")return{type:"separator",separator:":"};throw new ParseError("Unknown column alignment: "+d,l)}),a={cols:s,hskipBeforeAndAfter:!0,maxNumCols:s.length};return parseArray(r.parser,a,dCellStyle(r.envName))},htmlBuilder:htmlBuilder$6,mathmlBuilder:mathmlBuilder$5}),defineEnvironment({type:"array",names:["matrix","pmatrix","bmatrix","Bmatrix","vmatrix","Vmatrix","matrix*","pmatrix*","bmatrix*","Bmatrix*","vmatrix*","Vmatrix*"],props:{numArgs:0},handler(r){var e={matrix:null,pmatrix:["(",")"],bmatrix:["[","]"],Bmatrix:["\\{","\\}"],vmatrix:["|","|"],Vmatrix:["\\Vert","\\Vert"]}[r.envName.replace("*","")],n="c",o={hskipBeforeAndAfter:!1,cols:[{type:"align",align:n}]};if(r.envName.charAt(r.envName.length-1)==="*"){var s=r.parser;if(s.consumeSpaces(),s.fetch().text==="["){if(s.consume(),s.consumeSpaces(),n=s.fetch().text,"lcr".indexOf(n)===-1)throw new ParseError("Expected l or c or r",s.nextToken);s.consume(),s.consumeSpaces(),s.expect("]"),s.consume(),o.cols=[{type:"align",align:n}]}}var a=parseArray(r.parser,o,dCellStyle(r.envName)),l=Math.max(0,...a.body.map(c=>c.length));return a.cols=new Array(l).fill({type:"align",align:n}),e?{type:"leftright",mode:r.mode,body:[a],left:e[0],right:e[1],rightColor:void 0}:a},htmlBuilder:htmlBuilder$6,mathmlBuilder:mathmlBuilder$5}),defineEnvironment({type:"array",names:["smallmatrix"],props:{numArgs:0},handler(r){var e={arraystretch:.5},n=parseArray(r.parser,e,"script");return n.colSeparationType="small",n},htmlBuilder:htmlBuilder$6,mathmlBuilder:mathmlBuilder$5}),defineEnvironment({type:"array",names:["subarray"],props:{numArgs:1},handler(r,e){var n=checkSymbolNodeType(e[0]),o=n?[e[0]]:assertNodeType(e[0],"ordgroup").body,s=o.map(function(l){var c=assertSymbolNodeType(l),d=c.text;if("lc".indexOf(d)!==-1)return{type:"align",align:d};throw new ParseError("Unknown column alignment: "+d,l)});if(s.length>1)throw new ParseError("{subarray} can contain only one column");var a={cols:s,hskipBeforeAndAfter:!1,arraystretch:.5};if(a=parseArray(r.parser,a,"script"),a.body.length>0&&a.body[0].length>1)throw new ParseError("{subarray} can contain only one column");return a},htmlBuilder:htmlBuilder$6,mathmlBuilder:mathmlBuilder$5}),defineEnvironment({type:"array",names:["cases","dcases","rcases","drcases"],props:{numArgs:0},handler(r){var e={arraystretch:1.2,cols:[{type:"align",align:"l",pregap:0,postgap:1},{type:"align",align:"l",pregap:0,postgap:0}]},n=parseArray(r.parser,e,dCellStyle(r.envName));return{type:"leftright",mode:r.mode,body:[n],left:r.envName.indexOf("r")>-1?".":"\\{",right:r.envName.indexOf("r")>-1?"\\}":".",rightColor:void 0}},htmlBuilder:htmlBuilder$6,mathmlBuilder:mathmlBuilder$5}),defineEnvironment({type:"array",names:["align","align*","aligned","split"],props:{numArgs:0},handler:alignedHandler,htmlBuilder:htmlBuilder$6,mathmlBuilder:mathmlBuilder$5}),defineEnvironment({type:"array",names:["gathered","gather","gather*"],props:{numArgs:0},handler(r){utils.contains(["gather","gather*"],r.envName)&&validateAmsEnvironmentContext(r);var e={cols:[{type:"align",align:"c"}],addJot:!0,colSeparationType:"gather",autoTag:getAutoTag(r.envName),emptySingleRow:!0,leqno:r.parser.settings.leqno};return parseArray(r.parser,e,"display")},htmlBuilder:htmlBuilder$6,mathmlBuilder:mathmlBuilder$5}),defineEnvironment({type:"array",names:["alignat","alignat*","alignedat"],props:{numArgs:1},handler:alignedHandler,htmlBuilder:htmlBuilder$6,mathmlBuilder:mathmlBuilder$5}),defineEnvironment({type:"array",names:["equation","equation*"],props:{numArgs:0},handler(r){validateAmsEnvironmentContext(r);var e={autoTag:getAutoTag(r.envName),emptySingleRow:!0,singleRow:!0,maxNumCols:1,leqno:r.parser.settings.leqno};return parseArray(r.parser,e,"display")},htmlBuilder:htmlBuilder$6,mathmlBuilder:mathmlBuilder$5}),defineEnvironment({type:"array",names:["CD"],props:{numArgs:0},handler(r){return validateAmsEnvironmentContext(r),parseCD(r.parser)},htmlBuilder:htmlBuilder$6,mathmlBuilder:mathmlBuilder$5}),defineMacro("\\nonumber","\\gdef\\@eqnsw{0}"),defineMacro("\\notag","\\nonumber"),defineFunction({type:"text",names:["\\hline","\\hdashline"],props:{numArgs:0,allowedInText:!0,allowedInMath:!0},handler(r,e){throw new ParseError(r.funcName+" valid only within array environment")}});var environments=_environments;defineFunction({type:"environment",names:["\\begin","\\end"],props:{numArgs:1,argTypes:["text"]},handler(r,e){var{parser:n,funcName:o}=r,s=e[0];if(s.type!=="ordgroup")throw new ParseError("Invalid environment name",s);for(var a="",l=0;l<s.body.length;++l)a+=assertNodeType(s.body[l],"textord").text;if(o==="\\begin"){if(!environments.hasOwnProperty(a))throw new ParseError("No such environment: "+a,s);var c=environments[a],{args:d,optArgs:u}=n.parseArguments("\\begin{"+a+"}",c),m={mode:n.mode,envName:a,parser:n},f=c.handler(m,d,u);n.expect("\\end",!1);var p=n.nextToken,g=assertNodeType(n.parseFunction(),"environment");if(g.name!==a)throw new ParseError("Mismatch: \\begin{"+a+"} matched by \\end{"+g.name+"}",p);return f}return{type:"environment",mode:n.mode,name:a,nameGroup:s}}});var htmlBuilder$5=(r,e)=>{var n=r.font,o=e.withFont(n);return buildGroup$1(r.body,o)},mathmlBuilder$4=(r,e)=>{var n=r.font,o=e.withFont(n);return buildGroup(r.body,o)},fontAliases={"\\Bbb":"\\mathbb","\\bold":"\\mathbf","\\frak":"\\mathfrak","\\bm":"\\boldsymbol"};defineFunction({type:"font",names:["\\mathrm","\\mathit","\\mathbf","\\mathnormal","\\mathsfit","\\mathbb","\\mathcal","\\mathfrak","\\mathscr","\\mathsf","\\mathtt","\\Bbb","\\bold","\\frak"],props:{numArgs:1,allowedInArgument:!0},handler:(r,e)=>{var{parser:n,funcName:o}=r,s=normalizeArgument(e[0]),a=o;return a in fontAliases&&(a=fontAliases[a]),{type:"font",mode:n.mode,font:a.slice(1),body:s}},htmlBuilder:htmlBuilder$5,mathmlBuilder:mathmlBuilder$4}),defineFunction({type:"mclass",names:["\\boldsymbol","\\bm"],props:{numArgs:1},handler:(r,e)=>{var{parser:n}=r,o=e[0],s=utils.isCharacterBox(o);return{type:"mclass",mode:n.mode,mclass:binrelClass(o),body:[{type:"font",mode:n.mode,font:"boldsymbol",body:o}],isCharacterBox:s}}}),defineFunction({type:"font",names:["\\rm","\\sf","\\tt","\\bf","\\it","\\cal"],props:{numArgs:0,allowedInText:!0},handler:(r,e)=>{var{parser:n,funcName:o,breakOnTokenText:s}=r,{mode:a}=n,l=n.parseExpression(!0,s),c="math"+o.slice(1);return{type:"font",mode:a,font:c,body:{type:"ordgroup",mode:n.mode,body:l}}},htmlBuilder:htmlBuilder$5,mathmlBuilder:mathmlBuilder$4});var adjustStyle=(r,e)=>{var n=e;return r==="display"?n=n.id>=Style$1.SCRIPT.id?n.text():Style$1.DISPLAY:r==="text"&&n.size===Style$1.DISPLAY.size?n=Style$1.TEXT:r==="script"?n=Style$1.SCRIPT:r==="scriptscript"&&(n=Style$1.SCRIPTSCRIPT),n},htmlBuilder$4=(r,e)=>{var n=adjustStyle(r.size,e.style),o=n.fracNum(),s=n.fracDen(),a;a=e.havingStyle(o);var l=buildGroup$1(r.numer,a,e);if(r.continued){var c=8.5/e.fontMetrics().ptPerEm,d=3.5/e.fontMetrics().ptPerEm;l.height=l.height<c?c:l.height,l.depth=l.depth<d?d:l.depth}a=e.havingStyle(s);var u=buildGroup$1(r.denom,a,e),m,f,p;r.hasBarLine?(r.barSize?(f=calculateSize(r.barSize,e),m=buildCommon.makeLineSpan("frac-line",e,f)):m=buildCommon.makeLineSpan("frac-line",e),f=m.height,p=m.height):(m=null,f=0,p=e.fontMetrics().defaultRuleThickness);var g,y,b;n.size===Style$1.DISPLAY.size||r.size==="display"?(g=e.fontMetrics().num1,f>0?y=3*p:y=7*p,b=e.fontMetrics().denom1):(f>0?(g=e.fontMetrics().num2,y=p):(g=e.fontMetrics().num3,y=3*p),b=e.fontMetrics().denom2);var k;if(m){var w=e.fontMetrics().axisHeight;g-l.depth-(w+.5*f)<y&&(g+=y-(g-l.depth-(w+.5*f))),w-.5*f-(u.height-b)<y&&(b+=y-(w-.5*f-(u.height-b)));var B=-(w-.5*f);k=buildCommon.makeVList({positionType:"individualShift",children:[{type:"elem",elem:u,shift:b},{type:"elem",elem:m,shift:B},{type:"elem",elem:l,shift:-g}]},e)}else{var M=g-l.depth-(u.height-b);M<y&&(g+=.5*(y-M),b+=.5*(y-M)),k=buildCommon.makeVList({positionType:"individualShift",children:[{type:"elem",elem:u,shift:b},{type:"elem",elem:l,shift:-g}]},e)}a=e.havingStyle(n),k.height*=a.sizeMultiplier/e.sizeMultiplier,k.depth*=a.sizeMultiplier/e.sizeMultiplier;var x;n.size===Style$1.DISPLAY.size?x=e.fontMetrics().delim1:n.size===Style$1.SCRIPTSCRIPT.size?x=e.havingStyle(Style$1.SCRIPT).fontMetrics().delim2:x=e.fontMetrics().delim2;var v,_;return r.leftDelim==null?v=makeNullDelimiter(e,["mopen"]):v=delimiter.customSizedDelim(r.leftDelim,x,!0,e.havingStyle(n),r.mode,["mopen"]),r.continued?_=buildCommon.makeSpan([]):r.rightDelim==null?_=makeNullDelimiter(e,["mclose"]):_=delimiter.customSizedDelim(r.rightDelim,x,!0,e.havingStyle(n),r.mode,["mclose"]),buildCommon.makeSpan(["mord"].concat(a.sizingClasses(e)),[v,buildCommon.makeSpan(["mfrac"],[k]),_],e)},mathmlBuilder$3=(r,e)=>{var n=new mathMLTree.MathNode("mfrac",[buildGroup(r.numer,e),buildGroup(r.denom,e)]);if(!r.hasBarLine)n.setAttribute("linethickness","0px");else if(r.barSize){var o=calculateSize(r.barSize,e);n.setAttribute("linethickness",makeEm(o))}var s=adjustStyle(r.size,e.style);if(s.size!==e.style.size){n=new mathMLTree.MathNode("mstyle",[n]);var a=s.size===Style$1.DISPLAY.size?"true":"false";n.setAttribute("displaystyle",a),n.setAttribute("scriptlevel","0")}if(r.leftDelim!=null||r.rightDelim!=null){var l=[];if(r.leftDelim!=null){var c=new mathMLTree.MathNode("mo",[new mathMLTree.TextNode(r.leftDelim.replace("\\",""))]);c.setAttribute("fence","true"),l.push(c)}if(l.push(n),r.rightDelim!=null){var d=new mathMLTree.MathNode("mo",[new mathMLTree.TextNode(r.rightDelim.replace("\\",""))]);d.setAttribute("fence","true"),l.push(d)}return makeRow(l)}return n};defineFunction({type:"genfrac",names:["\\dfrac","\\frac","\\tfrac","\\dbinom","\\binom","\\tbinom","\\\\atopfrac","\\\\bracefrac","\\\\brackfrac"],props:{numArgs:2,allowedInArgument:!0},handler:(r,e)=>{var{parser:n,funcName:o}=r,s=e[0],a=e[1],l,c=null,d=null,u="auto";switch(o){case"\\dfrac":case"\\frac":case"\\tfrac":l=!0;break;case"\\\\atopfrac":l=!1;break;case"\\dbinom":case"\\binom":case"\\tbinom":l=!1,c="(",d=")";break;case"\\\\bracefrac":l=!1,c="\\{",d="\\}";break;case"\\\\brackfrac":l=!1,c="[",d="]";break;default:throw new Error("Unrecognized genfrac command")}switch(o){case"\\dfrac":case"\\dbinom":u="display";break;case"\\tfrac":case"\\tbinom":u="text";break}return{type:"genfrac",mode:n.mode,continued:!1,numer:s,denom:a,hasBarLine:l,leftDelim:c,rightDelim:d,size:u,barSize:null}},htmlBuilder:htmlBuilder$4,mathmlBuilder:mathmlBuilder$3}),defineFunction({type:"genfrac",names:["\\cfrac"],props:{numArgs:2},handler:(r,e)=>{var{parser:n,funcName:o}=r,s=e[0],a=e[1];return{type:"genfrac",mode:n.mode,continued:!0,numer:s,denom:a,hasBarLine:!0,leftDelim:null,rightDelim:null,size:"display",barSize:null}}}),defineFunction({type:"infix",names:["\\over","\\choose","\\atop","\\brace","\\brack"],props:{numArgs:0,infix:!0},handler(r){var{parser:e,funcName:n,token:o}=r,s;switch(n){case"\\over":s="\\frac";break;case"\\choose":s="\\binom";break;case"\\atop":s="\\\\atopfrac";break;case"\\brace":s="\\\\bracefrac";break;case"\\brack":s="\\\\brackfrac";break;default:throw new Error("Unrecognized infix genfrac command")}return{type:"infix",mode:e.mode,replaceWith:s,token:o}}});var stylArray=["display","text","script","scriptscript"],delimFromValue=function r(e){var n=null;return e.length>0&&(n=e,n=n==="."?null:n),n};defineFunction({type:"genfrac",names:["\\genfrac"],props:{numArgs:6,allowedInArgument:!0,argTypes:["math","math","size","text","math","math"]},handler(r,e){var{parser:n}=r,o=e[4],s=e[5],a=normalizeArgument(e[0]),l=a.type==="atom"&&a.family==="open"?delimFromValue(a.text):null,c=normalizeArgument(e[1]),d=c.type==="atom"&&c.family==="close"?delimFromValue(c.text):null,u=assertNodeType(e[2],"size"),m,f=null;u.isBlank?m=!0:(f=u.value,m=f.number>0);var p="auto",g=e[3];if(g.type==="ordgroup"){if(g.body.length>0){var y=assertNodeType(g.body[0],"textord");p=stylArray[Number(y.text)]}}else g=assertNodeType(g,"textord"),p=stylArray[Number(g.text)];return{type:"genfrac",mode:n.mode,numer:o,denom:s,continued:!1,hasBarLine:m,barSize:f,leftDelim:l,rightDelim:d,size:p}},htmlBuilder:htmlBuilder$4,mathmlBuilder:mathmlBuilder$3}),defineFunction({type:"infix",names:["\\above"],props:{numArgs:1,argTypes:["size"],infix:!0},handler(r,e){var{parser:n,funcName:o,token:s}=r;return{type:"infix",mode:n.mode,replaceWith:"\\\\abovefrac",size:assertNodeType(e[0],"size").value,token:s}}}),defineFunction({type:"genfrac",names:["\\\\abovefrac"],props:{numArgs:3,argTypes:["math","size","math"]},handler:(r,e)=>{var{parser:n,funcName:o}=r,s=e[0],a=assert(assertNodeType(e[1],"infix").size),l=e[2],c=a.number>0;return{type:"genfrac",mode:n.mode,numer:s,denom:l,continued:!1,hasBarLine:c,barSize:a,leftDelim:null,rightDelim:null,size:"auto"}},htmlBuilder:htmlBuilder$4,mathmlBuilder:mathmlBuilder$3});var htmlBuilder$3=(r,e)=>{var n=e.style,o,s;r.type==="supsub"?(o=r.sup?buildGroup$1(r.sup,e.havingStyle(n.sup()),e):buildGroup$1(r.sub,e.havingStyle(n.sub()),e),s=assertNodeType(r.base,"horizBrace")):s=assertNodeType(r,"horizBrace");var a=buildGroup$1(s.base,e.havingBaseStyle(Style$1.DISPLAY)),l=stretchy.svgSpan(s,e),c;if(s.isOver?(c=buildCommon.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:a},{type:"kern",size:.1},{type:"elem",elem:l}]},e),c.children[0].children[0].children[1].classes.push("svg-align")):(c=buildCommon.makeVList({positionType:"bottom",positionData:a.depth+.1+l.height,children:[{type:"elem",elem:l},{type:"kern",size:.1},{type:"elem",elem:a}]},e),c.children[0].children[0].children[0].classes.push("svg-align")),o){var d=buildCommon.makeSpan(["mord",s.isOver?"mover":"munder"],[c],e);s.isOver?c=buildCommon.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:d},{type:"kern",size:.2},{type:"elem",elem:o}]},e):c=buildCommon.makeVList({positionType:"bottom",positionData:d.depth+.2+o.height+o.depth,children:[{type:"elem",elem:o},{type:"kern",size:.2},{type:"elem",elem:d}]},e)}return buildCommon.makeSpan(["mord",s.isOver?"mover":"munder"],[c],e)},mathmlBuilder$2=(r,e)=>{var n=stretchy.mathMLnode(r.label);return new mathMLTree.MathNode(r.isOver?"mover":"munder",[buildGroup(r.base,e),n])};defineFunction({type:"horizBrace",names:["\\overbrace","\\underbrace"],props:{numArgs:1},handler(r,e){var{parser:n,funcName:o}=r;return{type:"horizBrace",mode:n.mode,label:o,isOver:/^\\over/.test(o),base:e[0]}},htmlBuilder:htmlBuilder$3,mathmlBuilder:mathmlBuilder$2}),defineFunction({type:"href",names:["\\href"],props:{numArgs:2,argTypes:["url","original"],allowedInText:!0},handler:(r,e)=>{var{parser:n}=r,o=e[1],s=assertNodeType(e[0],"url").url;return n.settings.isTrusted({command:"\\href",url:s})?{type:"href",mode:n.mode,href:s,body:ordargument(o)}:n.formatUnsupportedCmd("\\href")},htmlBuilder:(r,e)=>{var n=buildExpression$1(r.body,e,!1);return buildCommon.makeAnchor(r.href,[],n,e)},mathmlBuilder:(r,e)=>{var n=buildExpressionRow(r.body,e);return n instanceof MathNode||(n=new MathNode("mrow",[n])),n.setAttribute("href",r.href),n}}),defineFunction({type:"href",names:["\\url"],props:{numArgs:1,argTypes:["url"],allowedInText:!0},handler:(r,e)=>{var{parser:n}=r,o=assertNodeType(e[0],"url").url;if(!n.settings.isTrusted({command:"\\url",url:o}))return n.formatUnsupportedCmd("\\url");for(var s=[],a=0;a<o.length;a++){var l=o[a];l==="~"&&(l="\\textasciitilde"),s.push({type:"textord",mode:"text",text:l})}var c={type:"text",mode:n.mode,font:"\\texttt",body:s};return{type:"href",mode:n.mode,href:o,body:ordargument(c)}}}),defineFunction({type:"hbox",names:["\\hbox"],props:{numArgs:1,argTypes:["text"],allowedInText:!0,primitive:!0},handler(r,e){var{parser:n}=r;return{type:"hbox",mode:n.mode,body:ordargument(e[0])}},htmlBuilder(r,e){var n=buildExpression$1(r.body,e,!1);return buildCommon.makeFragment(n)},mathmlBuilder(r,e){return new mathMLTree.MathNode("mrow",buildExpression(r.body,e))}}),defineFunction({type:"html",names:["\\htmlClass","\\htmlId","\\htmlStyle","\\htmlData"],props:{numArgs:2,argTypes:["raw","original"],allowedInText:!0},handler:(r,e)=>{var{parser:n,funcName:o,token:s}=r,a=assertNodeType(e[0],"raw").string,l=e[1];n.settings.strict&&n.settings.reportNonstrict("htmlExtension","HTML extension is disabled on strict mode");var c,d={};switch(o){case"\\htmlClass":d.class=a,c={command:"\\htmlClass",class:a};break;case"\\htmlId":d.id=a,c={command:"\\htmlId",id:a};break;case"\\htmlStyle":d.style=a,c={command:"\\htmlStyle",style:a};break;case"\\htmlData":{for(var u=a.split(","),m=0;m<u.length;m++){var f=u[m].split("=");if(f.length!==2)throw new ParseError("Error parsing key-value for \\htmlData");d["data-"+f[0].trim()]=f[1].trim()}c={command:"\\htmlData",attributes:d};break}default:throw new Error("Unrecognized html command")}return n.settings.isTrusted(c)?{type:"html",mode:n.mode,attributes:d,body:ordargument(l)}:n.formatUnsupportedCmd(o)},htmlBuilder:(r,e)=>{var n=buildExpression$1(r.body,e,!1),o=["enclosing"];r.attributes.class&&o.push(...r.attributes.class.trim().split(/\s+/));var s=buildCommon.makeSpan(o,n,e);for(var a in r.attributes)a!=="class"&&r.attributes.hasOwnProperty(a)&&s.setAttribute(a,r.attributes[a]);return s},mathmlBuilder:(r,e)=>buildExpressionRow(r.body,e)}),defineFunction({type:"htmlmathml",names:["\\html@mathml"],props:{numArgs:2,allowedInText:!0},handler:(r,e)=>{var{parser:n}=r;return{type:"htmlmathml",mode:n.mode,html:ordargument(e[0]),mathml:ordargument(e[1])}},htmlBuilder:(r,e)=>{var n=buildExpression$1(r.html,e,!1);return buildCommon.makeFragment(n)},mathmlBuilder:(r,e)=>buildExpressionRow(r.mathml,e)});var sizeData=function r(e){if(/^[-+]? *(\d+(\.\d*)?|\.\d+)$/.test(e))return{number:+e,unit:"bp"};var n=/([-+]?) *(\d+(?:\.\d*)?|\.\d+) *([a-z]{2})/.exec(e);if(!n)throw new ParseError("Invalid size: '"+e+"' in \\includegraphics");var o={number:+(n[1]+n[2]),unit:n[3]};if(!validUnit(o))throw new ParseError("Invalid unit: '"+o.unit+"' in \\includegraphics.");return o};defineFunction({type:"includegraphics",names:["\\includegraphics"],props:{numArgs:1,numOptionalArgs:1,argTypes:["raw","url"],allowedInText:!1},handler:(r,e,n)=>{var{parser:o}=r,s={number:0,unit:"em"},a={number:.9,unit:"em"},l={number:0,unit:"em"},c="";if(n[0])for(var d=assertNodeType(n[0],"raw").string,u=d.split(","),m=0;m<u.length;m++){var f=u[m].split("=");if(f.length===2){var p=f[1].trim();switch(f[0].trim()){case"alt":c=p;break;case"width":s=sizeData(p);break;case"height":a=sizeData(p);break;case"totalheight":l=sizeData(p);break;default:throw new ParseError("Invalid key: '"+f[0]+"' in \\includegraphics.")}}}var g=assertNodeType(e[0],"url").url;return c===""&&(c=g,c=c.replace(/^.*[\\/]/,""),c=c.substring(0,c.lastIndexOf("."))),o.settings.isTrusted({command:"\\includegraphics",url:g})?{type:"includegraphics",mode:o.mode,alt:c,width:s,height:a,totalheight:l,src:g}:o.formatUnsupportedCmd("\\includegraphics")},htmlBuilder:(r,e)=>{var n=calculateSize(r.height,e),o=0;r.totalheight.number>0&&(o=calculateSize(r.totalheight,e)-n);var s=0;r.width.number>0&&(s=calculateSize(r.width,e));var a={height:makeEm(n+o)};s>0&&(a.width=makeEm(s)),o>0&&(a.verticalAlign=makeEm(-o));var l=new Img(r.src,r.alt,a);return l.height=n,l.depth=o,l},mathmlBuilder:(r,e)=>{var n=new mathMLTree.MathNode("mglyph",[]);n.setAttribute("alt",r.alt);var o=calculateSize(r.height,e),s=0;if(r.totalheight.number>0&&(s=calculateSize(r.totalheight,e)-o,n.setAttribute("valign",makeEm(-s))),n.setAttribute("height",makeEm(o+s)),r.width.number>0){var a=calculateSize(r.width,e);n.setAttribute("width",makeEm(a))}return n.setAttribute("src",r.src),n}}),defineFunction({type:"kern",names:["\\kern","\\mkern","\\hskip","\\mskip"],props:{numArgs:1,argTypes:["size"],primitive:!0,allowedInText:!0},handler(r,e){var{parser:n,funcName:o}=r,s=assertNodeType(e[0],"size");if(n.settings.strict){var a=o[1]==="m",l=s.value.unit==="mu";a?(l||n.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+o+" supports only mu units, "+("not "+s.value.unit+" units")),n.mode!=="math"&&n.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+o+" works only in math mode")):l&&n.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+o+" doesn't support mu units")}return{type:"kern",mode:n.mode,dimension:s.value}},htmlBuilder(r,e){return buildCommon.makeGlue(r.dimension,e)},mathmlBuilder(r,e){var n=calculateSize(r.dimension,e);return new mathMLTree.SpaceNode(n)}}),defineFunction({type:"lap",names:["\\mathllap","\\mathrlap","\\mathclap"],props:{numArgs:1,allowedInText:!0},handler:(r,e)=>{var{parser:n,funcName:o}=r,s=e[0];return{type:"lap",mode:n.mode,alignment:o.slice(5),body:s}},htmlBuilder:(r,e)=>{var n;r.alignment==="clap"?(n=buildCommon.makeSpan([],[buildGroup$1(r.body,e)]),n=buildCommon.makeSpan(["inner"],[n],e)):n=buildCommon.makeSpan(["inner"],[buildGroup$1(r.body,e)]);var o=buildCommon.makeSpan(["fix"],[]),s=buildCommon.makeSpan([r.alignment],[n,o],e),a=buildCommon.makeSpan(["strut"]);return a.style.height=makeEm(s.height+s.depth),s.depth&&(a.style.verticalAlign=makeEm(-s.depth)),s.children.unshift(a),s=buildCommon.makeSpan(["thinbox"],[s],e),buildCommon.makeSpan(["mord","vbox"],[s],e)},mathmlBuilder:(r,e)=>{var n=new mathMLTree.MathNode("mpadded",[buildGroup(r.body,e)]);if(r.alignment!=="rlap"){var o=r.alignment==="llap"?"-1":"-0.5";n.setAttribute("lspace",o+"width")}return n.setAttribute("width","0px"),n}}),defineFunction({type:"styling",names:["\\(","$"],props:{numArgs:0,allowedInText:!0,allowedInMath:!1},handler(r,e){var{funcName:n,parser:o}=r,s=o.mode;o.switchMode("math");var a=n==="\\("?"\\)":"$",l=o.parseExpression(!1,a);return o.expect(a),o.switchMode(s),{type:"styling",mode:o.mode,style:"text",body:l}}}),defineFunction({type:"text",names:["\\)","\\]"],props:{numArgs:0,allowedInText:!0,allowedInMath:!1},handler(r,e){throw new ParseError("Mismatched "+r.funcName)}});var chooseMathStyle=(r,e)=>{switch(e.style.size){case Style$1.DISPLAY.size:return r.display;case Style$1.TEXT.size:return r.text;case Style$1.SCRIPT.size:return r.script;case Style$1.SCRIPTSCRIPT.size:return r.scriptscript;default:return r.text}};defineFunction({type:"mathchoice",names:["\\mathchoice"],props:{numArgs:4,primitive:!0},handler:(r,e)=>{var{parser:n}=r;return{type:"mathchoice",mode:n.mode,display:ordargument(e[0]),text:ordargument(e[1]),script:ordargument(e[2]),scriptscript:ordargument(e[3])}},htmlBuilder:(r,e)=>{var n=chooseMathStyle(r,e),o=buildExpression$1(n,e,!1);return buildCommon.makeFragment(o)},mathmlBuilder:(r,e)=>{var n=chooseMathStyle(r,e);return buildExpressionRow(n,e)}});var assembleSupSub=(r,e,n,o,s,a,l)=>{r=buildCommon.makeSpan([],[r]);var c=n&&utils.isCharacterBox(n),d,u;if(e){var m=buildGroup$1(e,o.havingStyle(s.sup()),o);u={elem:m,kern:Math.max(o.fontMetrics().bigOpSpacing1,o.fontMetrics().bigOpSpacing3-m.depth)}}if(n){var f=buildGroup$1(n,o.havingStyle(s.sub()),o);d={elem:f,kern:Math.max(o.fontMetrics().bigOpSpacing2,o.fontMetrics().bigOpSpacing4-f.height)}}var p;if(u&&d){var g=o.fontMetrics().bigOpSpacing5+d.elem.height+d.elem.depth+d.kern+r.depth+l;p=buildCommon.makeVList({positionType:"bottom",positionData:g,children:[{type:"kern",size:o.fontMetrics().bigOpSpacing5},{type:"elem",elem:d.elem,marginLeft:makeEm(-a)},{type:"kern",size:d.kern},{type:"elem",elem:r},{type:"kern",size:u.kern},{type:"elem",elem:u.elem,marginLeft:makeEm(a)},{type:"kern",size:o.fontMetrics().bigOpSpacing5}]},o)}else if(d){var y=r.height-l;p=buildCommon.makeVList({positionType:"top",positionData:y,children:[{type:"kern",size:o.fontMetrics().bigOpSpacing5},{type:"elem",elem:d.elem,marginLeft:makeEm(-a)},{type:"kern",size:d.kern},{type:"elem",elem:r}]},o)}else if(u){var b=r.depth+l;p=buildCommon.makeVList({positionType:"bottom",positionData:b,children:[{type:"elem",elem:r},{type:"kern",size:u.kern},{type:"elem",elem:u.elem,marginLeft:makeEm(a)},{type:"kern",size:o.fontMetrics().bigOpSpacing5}]},o)}else return r;var k=[p];if(d&&a!==0&&!c){var w=buildCommon.makeSpan(["mspace"],[],o);w.style.marginRight=makeEm(a),k.unshift(w)}return buildCommon.makeSpan(["mop","op-limits"],k,o)},noSuccessor=["\\smallint"],htmlBuilder$2=(r,e)=>{var n,o,s=!1,a;r.type==="supsub"?(n=r.sup,o=r.sub,a=assertNodeType(r.base,"op"),s=!0):a=assertNodeType(r,"op");var l=e.style,c=!1;l.size===Style$1.DISPLAY.size&&a.symbol&&!utils.contains(noSuccessor,a.name)&&(c=!0);var d;if(a.symbol){var u=c?"Size2-Regular":"Size1-Regular",m="";if((a.name==="\\oiint"||a.name==="\\oiiint")&&(m=a.name.slice(1),a.name=m==="oiint"?"\\iint":"\\iiint"),d=buildCommon.makeSymbol(a.name,u,"math",e,["mop","op-symbol",c?"large-op":"small-op"]),m.length>0){var f=d.italic,p=buildCommon.staticSvg(m+"Size"+(c?"2":"1"),e);d=buildCommon.makeVList({positionType:"individualShift",children:[{type:"elem",elem:d,shift:0},{type:"elem",elem:p,shift:c?.08:0}]},e),a.name="\\"+m,d.classes.unshift("mop"),d.italic=f}}else if(a.body){var g=buildExpression$1(a.body,e,!0);g.length===1&&g[0]instanceof SymbolNode?(d=g[0],d.classes[0]="mop"):d=buildCommon.makeSpan(["mop"],g,e)}else{for(var y=[],b=1;b<a.name.length;b++)y.push(buildCommon.mathsym(a.name[b],a.mode,e));d=buildCommon.makeSpan(["mop"],y,e)}var k=0,w=0;return(d instanceof SymbolNode||a.name==="\\oiint"||a.name==="\\oiiint")&&!a.suppressBaseShift&&(k=(d.height-d.depth)/2-e.fontMetrics().axisHeight,w=d.italic),s?assembleSupSub(d,n,o,e,l,w,k):(k&&(d.style.position="relative",d.style.top=makeEm(k)),d)},mathmlBuilder$1=(r,e)=>{var n;if(r.symbol)n=new MathNode("mo",[makeText(r.name,r.mode)]),utils.contains(noSuccessor,r.name)&&n.setAttribute("largeop","false");else if(r.body)n=new MathNode("mo",buildExpression(r.body,e));else{n=new MathNode("mi",[new TextNode(r.name.slice(1))]);var o=new MathNode("mo",[makeText("\u2061","text")]);r.parentIsSupSub?n=new MathNode("mrow",[n,o]):n=newDocumentFragment([n,o])}return n},singleCharBigOps={"\u220F":"\\prod","\u2210":"\\coprod","\u2211":"\\sum","\u22C0":"\\bigwedge","\u22C1":"\\bigvee","\u22C2":"\\bigcap","\u22C3":"\\bigcup","\u2A00":"\\bigodot","\u2A01":"\\bigoplus","\u2A02":"\\bigotimes","\u2A04":"\\biguplus","\u2A06":"\\bigsqcup"};defineFunction({type:"op",names:["\\coprod","\\bigvee","\\bigwedge","\\biguplus","\\bigcap","\\bigcup","\\intop","\\prod","\\sum","\\bigotimes","\\bigoplus","\\bigodot","\\bigsqcup","\\smallint","\u220F","\u2210","\u2211","\u22C0","\u22C1","\u22C2","\u22C3","\u2A00","\u2A01","\u2A02","\u2A04","\u2A06"],props:{numArgs:0},handler:(r,e)=>{var{parser:n,funcName:o}=r,s=o;return s.length===1&&(s=singleCharBigOps[s]),{type:"op",mode:n.mode,limits:!0,parentIsSupSub:!1,symbol:!0,name:s}},htmlBuilder:htmlBuilder$2,mathmlBuilder:mathmlBuilder$1}),defineFunction({type:"op",names:["\\mathop"],props:{numArgs:1,primitive:!0},handler:(r,e)=>{var{parser:n}=r,o=e[0];return{type:"op",mode:n.mode,limits:!1,parentIsSupSub:!1,symbol:!1,body:ordargument(o)}},htmlBuilder:htmlBuilder$2,mathmlBuilder:mathmlBuilder$1});var singleCharIntegrals={"\u222B":"\\int","\u222C":"\\iint","\u222D":"\\iiint","\u222E":"\\oint","\u222F":"\\oiint","\u2230":"\\oiiint"};defineFunction({type:"op",names:["\\arcsin","\\arccos","\\arctan","\\arctg","\\arcctg","\\arg","\\ch","\\cos","\\cosec","\\cosh","\\cot","\\cotg","\\coth","\\csc","\\ctg","\\cth","\\deg","\\dim","\\exp","\\hom","\\ker","\\lg","\\ln","\\log","\\sec","\\sin","\\sinh","\\sh","\\tan","\\tanh","\\tg","\\th"],props:{numArgs:0},handler(r){var{parser:e,funcName:n}=r;return{type:"op",mode:e.mode,limits:!1,parentIsSupSub:!1,symbol:!1,name:n}},htmlBuilder:htmlBuilder$2,mathmlBuilder:mathmlBuilder$1}),defineFunction({type:"op",names:["\\det","\\gcd","\\inf","\\lim","\\max","\\min","\\Pr","\\sup"],props:{numArgs:0},handler(r){var{parser:e,funcName:n}=r;return{type:"op",mode:e.mode,limits:!0,parentIsSupSub:!1,symbol:!1,name:n}},htmlBuilder:htmlBuilder$2,mathmlBuilder:mathmlBuilder$1}),defineFunction({type:"op",names:["\\int","\\iint","\\iiint","\\oint","\\oiint","\\oiiint","\u222B","\u222C","\u222D","\u222E","\u222F","\u2230"],props:{numArgs:0},handler(r){var{parser:e,funcName:n}=r,o=n;return o.length===1&&(o=singleCharIntegrals[o]),{type:"op",mode:e.mode,limits:!1,parentIsSupSub:!1,symbol:!0,name:o}},htmlBuilder:htmlBuilder$2,mathmlBuilder:mathmlBuilder$1});var htmlBuilder$1=(r,e)=>{var n,o,s=!1,a;r.type==="supsub"?(n=r.sup,o=r.sub,a=assertNodeType(r.base,"operatorname"),s=!0):a=assertNodeType(r,"operatorname");var l;if(a.body.length>0){for(var c=a.body.map(f=>{var p=f.text;return typeof p=="string"?{type:"textord",mode:f.mode,text:p}:f}),d=buildExpression$1(c,e.withFont("mathrm"),!0),u=0;u<d.length;u++){var m=d[u];m instanceof SymbolNode&&(m.text=m.text.replace(/\u2212/,"-").replace(/\u2217/,"*"))}l=buildCommon.makeSpan(["mop"],d,e)}else l=buildCommon.makeSpan(["mop"],[],e);return s?assembleSupSub(l,n,o,e,e.style,0,0):l},mathmlBuilder=(r,e)=>{for(var n=buildExpression(r.body,e.withFont("mathrm")),o=!0,s=0;s<n.length;s++){var a=n[s];if(!(a instanceof mathMLTree.SpaceNode))if(a instanceof mathMLTree.MathNode)switch(a.type){case"mi":case"mn":case"ms":case"mspace":case"mtext":break;case"mo":{var l=a.children[0];a.children.length===1&&l instanceof mathMLTree.TextNode?l.text=l.text.replace(/\u2212/,"-").replace(/\u2217/,"*"):o=!1;break}default:o=!1}else o=!1}if(o){var c=n.map(m=>m.toText()).join("");n=[new mathMLTree.TextNode(c)]}var d=new mathMLTree.MathNode("mi",n);d.setAttribute("mathvariant","normal");var u=new mathMLTree.MathNode("mo",[makeText("\u2061","text")]);return r.parentIsSupSub?new mathMLTree.MathNode("mrow",[d,u]):mathMLTree.newDocumentFragment([d,u])};defineFunction({type:"operatorname",names:["\\operatorname@","\\operatornamewithlimits"],props:{numArgs:1},handler:(r,e)=>{var{parser:n,funcName:o}=r,s=e[0];return{type:"operatorname",mode:n.mode,body:ordargument(s),alwaysHandleSupSub:o==="\\operatornamewithlimits",limits:!1,parentIsSupSub:!1}},htmlBuilder:htmlBuilder$1,mathmlBuilder}),defineMacro("\\operatorname","\\@ifstar\\operatornamewithlimits\\operatorname@"),defineFunctionBuilders({type:"ordgroup",htmlBuilder(r,e){return r.semisimple?buildCommon.makeFragment(buildExpression$1(r.body,e,!1)):buildCommon.makeSpan(["mord"],buildExpression$1(r.body,e,!0),e)},mathmlBuilder(r,e){return buildExpressionRow(r.body,e,!0)}}),defineFunction({type:"overline",names:["\\overline"],props:{numArgs:1},handler(r,e){var{parser:n}=r,o=e[0];return{type:"overline",mode:n.mode,body:o}},htmlBuilder(r,e){var n=buildGroup$1(r.body,e.havingCrampedStyle()),o=buildCommon.makeLineSpan("overline-line",e),s=e.fontMetrics().defaultRuleThickness,a=buildCommon.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:n},{type:"kern",size:3*s},{type:"elem",elem:o},{type:"kern",size:s}]},e);return buildCommon.makeSpan(["mord","overline"],[a],e)},mathmlBuilder(r,e){var n=new mathMLTree.MathNode("mo",[new mathMLTree.TextNode("\u203E")]);n.setAttribute("stretchy","true");var o=new mathMLTree.MathNode("mover",[buildGroup(r.body,e),n]);return o.setAttribute("accent","true"),o}}),defineFunction({type:"phantom",names:["\\phantom"],props:{numArgs:1,allowedInText:!0},handler:(r,e)=>{var{parser:n}=r,o=e[0];return{type:"phantom",mode:n.mode,body:ordargument(o)}},htmlBuilder:(r,e)=>{var n=buildExpression$1(r.body,e.withPhantom(),!1);return buildCommon.makeFragment(n)},mathmlBuilder:(r,e)=>{var n=buildExpression(r.body,e);return new mathMLTree.MathNode("mphantom",n)}}),defineFunction({type:"hphantom",names:["\\hphantom"],props:{numArgs:1,allowedInText:!0},handler:(r,e)=>{var{parser:n}=r,o=e[0];return{type:"hphantom",mode:n.mode,body:o}},htmlBuilder:(r,e)=>{var n=buildCommon.makeSpan([],[buildGroup$1(r.body,e.withPhantom())]);if(n.height=0,n.depth=0,n.children)for(var o=0;o<n.children.length;o++)n.children[o].height=0,n.children[o].depth=0;return n=buildCommon.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:n}]},e),buildCommon.makeSpan(["mord"],[n],e)},mathmlBuilder:(r,e)=>{var n=buildExpression(ordargument(r.body),e),o=new mathMLTree.MathNode("mphantom",n),s=new mathMLTree.MathNode("mpadded",[o]);return s.setAttribute("height","0px"),s.setAttribute("depth","0px"),s}}),defineFunction({type:"vphantom",names:["\\vphantom"],props:{numArgs:1,allowedInText:!0},handler:(r,e)=>{var{parser:n}=r,o=e[0];return{type:"vphantom",mode:n.mode,body:o}},htmlBuilder:(r,e)=>{var n=buildCommon.makeSpan(["inner"],[buildGroup$1(r.body,e.withPhantom())]),o=buildCommon.makeSpan(["fix"],[]);return buildCommon.makeSpan(["mord","rlap"],[n,o],e)},mathmlBuilder:(r,e)=>{var n=buildExpression(ordargument(r.body),e),o=new mathMLTree.MathNode("mphantom",n),s=new mathMLTree.MathNode("mpadded",[o]);return s.setAttribute("width","0px"),s}}),defineFunction({type:"raisebox",names:["\\raisebox"],props:{numArgs:2,argTypes:["size","hbox"],allowedInText:!0},handler(r,e){var{parser:n}=r,o=assertNodeType(e[0],"size").value,s=e[1];return{type:"raisebox",mode:n.mode,dy:o,body:s}},htmlBuilder(r,e){var n=buildGroup$1(r.body,e),o=calculateSize(r.dy,e);return buildCommon.makeVList({positionType:"shift",positionData:-o,children:[{type:"elem",elem:n}]},e)},mathmlBuilder(r,e){var n=new mathMLTree.MathNode("mpadded",[buildGroup(r.body,e)]),o=r.dy.number+r.dy.unit;return n.setAttribute("voffset",o),n}}),defineFunction({type:"internal",names:["\\relax"],props:{numArgs:0,allowedInText:!0},handler(r){var{parser:e}=r;return{type:"internal",mode:e.mode}}}),defineFunction({type:"rule",names:["\\rule"],props:{numArgs:2,numOptionalArgs:1,allowedInText:!0,allowedInMath:!0,argTypes:["size","size","size"]},handler(r,e,n){var{parser:o}=r,s=n[0],a=assertNodeType(e[0],"size"),l=assertNodeType(e[1],"size");return{type:"rule",mode:o.mode,shift:s&&assertNodeType(s,"size").value,width:a.value,height:l.value}},htmlBuilder(r,e){var n=buildCommon.makeSpan(["mord","rule"],[],e),o=calculateSize(r.width,e),s=calculateSize(r.height,e),a=r.shift?calculateSize(r.shift,e):0;return n.style.borderRightWidth=makeEm(o),n.style.borderTopWidth=makeEm(s),n.style.bottom=makeEm(a),n.width=o,n.height=s+a,n.depth=-a,n.maxFontSize=s*1.125*e.sizeMultiplier,n},mathmlBuilder(r,e){var n=calculateSize(r.width,e),o=calculateSize(r.height,e),s=r.shift?calculateSize(r.shift,e):0,a=e.color&&e.getColor()||"black",l=new mathMLTree.MathNode("mspace");l.setAttribute("mathbackground",a),l.setAttribute("width",makeEm(n)),l.setAttribute("height",makeEm(o));var c=new mathMLTree.MathNode("mpadded",[l]);return s>=0?c.setAttribute("height",makeEm(s)):(c.setAttribute("height",makeEm(s)),c.setAttribute("depth",makeEm(-s))),c.setAttribute("voffset",makeEm(s)),c}});function sizingGroup(r,e,n){for(var o=buildExpression$1(r,e,!1),s=e.sizeMultiplier/n.sizeMultiplier,a=0;a<o.length;a++){var l=o[a].classes.indexOf("sizing");l<0?Array.prototype.push.apply(o[a].classes,e.sizingClasses(n)):o[a].classes[l+1]==="reset-size"+e.size&&(o[a].classes[l+1]="reset-size"+n.size),o[a].height*=s,o[a].depth*=s}return buildCommon.makeFragment(o)}var sizeFuncs=["\\tiny","\\sixptsize","\\scriptsize","\\footnotesize","\\small","\\normalsize","\\large","\\Large","\\LARGE","\\huge","\\Huge"],htmlBuilder=(r,e)=>{var n=e.havingSize(r.size);return sizingGroup(r.body,n,e)};defineFunction({type:"sizing",names:sizeFuncs,props:{numArgs:0,allowedInText:!0},handler:(r,e)=>{var{breakOnTokenText:n,funcName:o,parser:s}=r,a=s.parseExpression(!1,n);return{type:"sizing",mode:s.mode,size:sizeFuncs.indexOf(o)+1,body:a}},htmlBuilder,mathmlBuilder:(r,e)=>{var n=e.havingSize(r.size),o=buildExpression(r.body,n),s=new mathMLTree.MathNode("mstyle",o);return s.setAttribute("mathsize",makeEm(n.sizeMultiplier)),s}}),defineFunction({type:"smash",names:["\\smash"],props:{numArgs:1,numOptionalArgs:1,allowedInText:!0},handler:(r,e,n)=>{var{parser:o}=r,s=!1,a=!1,l=n[0]&&assertNodeType(n[0],"ordgroup");if(l)for(var c="",d=0;d<l.body.length;++d){var u=l.body[d];if(c=u.text,c==="t")s=!0;else if(c==="b")a=!0;else{s=!1,a=!1;break}}else s=!0,a=!0;var m=e[0];return{type:"smash",mode:o.mode,body:m,smashHeight:s,smashDepth:a}},htmlBuilder:(r,e)=>{var n=buildCommon.makeSpan([],[buildGroup$1(r.body,e)]);if(!r.smashHeight&&!r.smashDepth)return n;if(r.smashHeight&&(n.height=0,n.children))for(var o=0;o<n.children.length;o++)n.children[o].height=0;if(r.smashDepth&&(n.depth=0,n.children))for(var s=0;s<n.children.length;s++)n.children[s].depth=0;var a=buildCommon.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:n}]},e);return buildCommon.makeSpan(["mord"],[a],e)},mathmlBuilder:(r,e)=>{var n=new mathMLTree.MathNode("mpadded",[buildGroup(r.body,e)]);return r.smashHeight&&n.setAttribute("height","0px"),r.smashDepth&&n.setAttribute("depth","0px"),n}}),defineFunction({type:"sqrt",names:["\\sqrt"],props:{numArgs:1,numOptionalArgs:1},handler(r,e,n){var{parser:o}=r,s=n[0],a=e[0];return{type:"sqrt",mode:o.mode,body:a,index:s}},htmlBuilder(r,e){var n=buildGroup$1(r.body,e.havingCrampedStyle());n.height===0&&(n.height=e.fontMetrics().xHeight),n=buildCommon.wrapFragment(n,e);var o=e.fontMetrics(),s=o.defaultRuleThickness,a=s;e.style.id<Style$1.TEXT.id&&(a=e.fontMetrics().xHeight);var l=s+a/4,c=n.height+n.depth+l+s,{span:d,ruleWidth:u,advanceWidth:m}=delimiter.sqrtImage(c,e),f=d.height-u;f>n.height+n.depth+l&&(l=(l+f-n.height-n.depth)/2);var p=d.height-n.height-l-u;n.style.paddingLeft=makeEm(m);var g=buildCommon.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:n,wrapperClasses:["svg-align"]},{type:"kern",size:-(n.height+p)},{type:"elem",elem:d},{type:"kern",size:u}]},e);if(r.index){var y=e.havingStyle(Style$1.SCRIPTSCRIPT),b=buildGroup$1(r.index,y,e),k=.6*(g.height-g.depth),w=buildCommon.makeVList({positionType:"shift",positionData:-k,children:[{type:"elem",elem:b}]},e),B=buildCommon.makeSpan(["root"],[w]);return buildCommon.makeSpan(["mord","sqrt"],[B,g],e)}else return buildCommon.makeSpan(["mord","sqrt"],[g],e)},mathmlBuilder(r,e){var{body:n,index:o}=r;return o?new mathMLTree.MathNode("mroot",[buildGroup(n,e),buildGroup(o,e)]):new mathMLTree.MathNode("msqrt",[buildGroup(n,e)])}});var styleMap={display:Style$1.DISPLAY,text:Style$1.TEXT,script:Style$1.SCRIPT,scriptscript:Style$1.SCRIPTSCRIPT};defineFunction({type:"styling",names:["\\displaystyle","\\textstyle","\\scriptstyle","\\scriptscriptstyle"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(r,e){var{breakOnTokenText:n,funcName:o,parser:s}=r,a=s.parseExpression(!0,n),l=o.slice(1,o.length-5);return{type:"styling",mode:s.mode,style:l,body:a}},htmlBuilder(r,e){var n=styleMap[r.style],o=e.havingStyle(n).withFont("");return sizingGroup(r.body,o,e)},mathmlBuilder(r,e){var n=styleMap[r.style],o=e.havingStyle(n),s=buildExpression(r.body,o),a=new mathMLTree.MathNode("mstyle",s),l={display:["0","true"],text:["0","false"],script:["1","false"],scriptscript:["2","false"]},c=l[r.style];return a.setAttribute("scriptlevel",c[0]),a.setAttribute("displaystyle",c[1]),a}});var htmlBuilderDelegate=function r(e,n){var o=e.base;if(o)if(o.type==="op"){var s=o.limits&&(n.style.size===Style$1.DISPLAY.size||o.alwaysHandleSupSub);return s?htmlBuilder$2:null}else if(o.type==="operatorname"){var a=o.alwaysHandleSupSub&&(n.style.size===Style$1.DISPLAY.size||o.limits);return a?htmlBuilder$1:null}else{if(o.type==="accent")return utils.isCharacterBox(o.base)?htmlBuilder$a:null;if(o.type==="horizBrace"){var l=!e.sub;return l===o.isOver?htmlBuilder$3:null}else return null}else return null};defineFunctionBuilders({type:"supsub",htmlBuilder(r,e){var n=htmlBuilderDelegate(r,e);if(n)return n(r,e);var{base:o,sup:s,sub:a}=r,l=buildGroup$1(o,e),c,d,u=e.fontMetrics(),m=0,f=0,p=o&&utils.isCharacterBox(o);if(s){var g=e.havingStyle(e.style.sup());c=buildGroup$1(s,g,e),p||(m=l.height-g.fontMetrics().supDrop*g.sizeMultiplier/e.sizeMultiplier)}if(a){var y=e.havingStyle(e.style.sub());d=buildGroup$1(a,y,e),p||(f=l.depth+y.fontMetrics().subDrop*y.sizeMultiplier/e.sizeMultiplier)}var b;e.style===Style$1.DISPLAY?b=u.sup1:e.style.cramped?b=u.sup3:b=u.sup2;var k=e.sizeMultiplier,w=makeEm(.5/u.ptPerEm/k),B=null;if(d){var M=r.base&&r.base.type==="op"&&r.base.name&&(r.base.name==="\\oiint"||r.base.name==="\\oiiint");(l instanceof SymbolNode||M)&&(B=makeEm(-l.italic))}var x;if(c&&d){m=Math.max(m,b,c.depth+.25*u.xHeight),f=Math.max(f,u.sub2);var v=u.defaultRuleThickness,_=4*v;if(m-c.depth-(d.height-f)<_){f=_-(m-c.depth)+d.height;var E=.8*u.xHeight-(m-c.depth);E>0&&(m+=E,f-=E)}var N=[{type:"elem",elem:d,shift:f,marginRight:w,marginLeft:B},{type:"elem",elem:c,shift:-m,marginRight:w}];x=buildCommon.makeVList({positionType:"individualShift",children:N},e)}else if(d){f=Math.max(f,u.sub1,d.height-.8*u.xHeight);var I=[{type:"elem",elem:d,marginLeft:B,marginRight:w}];x=buildCommon.makeVList({positionType:"shift",positionData:f,children:I},e)}else if(c)m=Math.max(m,b,c.depth+.25*u.xHeight),x=buildCommon.makeVList({positionType:"shift",positionData:-m,children:[{type:"elem",elem:c,marginRight:w}]},e);else throw new Error("supsub must have either sup or sub.");var L=getTypeOfDomTree(l,"right")||"mord";return buildCommon.makeSpan([L],[l,buildCommon.makeSpan(["msupsub"],[x])],e)},mathmlBuilder(r,e){var n=!1,o,s;r.base&&r.base.type==="horizBrace"&&(s=!!r.sup,s===r.base.isOver&&(n=!0,o=r.base.isOver)),r.base&&(r.base.type==="op"||r.base.type==="operatorname")&&(r.base.parentIsSupSub=!0);var a=[buildGroup(r.base,e)];r.sub&&a.push(buildGroup(r.sub,e)),r.sup&&a.push(buildGroup(r.sup,e));var l;if(n)l=o?"mover":"munder";else if(r.sub)if(r.sup){var c=r.base;c&&c.type==="op"&&c.limits&&e.style===Style$1.DISPLAY||c&&c.type==="operatorname"&&c.alwaysHandleSupSub&&(e.style===Style$1.DISPLAY||c.limits)?l="munderover":l="msubsup"}else{var d=r.base;d&&d.type==="op"&&d.limits&&(e.style===Style$1.DISPLAY||d.alwaysHandleSupSub)||d&&d.type==="operatorname"&&d.alwaysHandleSupSub&&(d.limits||e.style===Style$1.DISPLAY)?l="munder":l="msub"}else{var u=r.base;u&&u.type==="op"&&u.limits&&(e.style===Style$1.DISPLAY||u.alwaysHandleSupSub)||u&&u.type==="operatorname"&&u.alwaysHandleSupSub&&(u.limits||e.style===Style$1.DISPLAY)?l="mover":l="msup"}return new mathMLTree.MathNode(l,a)}}),defineFunctionBuilders({type:"atom",htmlBuilder(r,e){return buildCommon.mathsym(r.text,r.mode,e,["m"+r.family])},mathmlBuilder(r,e){var n=new mathMLTree.MathNode("mo",[makeText(r.text,r.mode)]);if(r.family==="bin"){var o=getVariant(r,e);o==="bold-italic"&&n.setAttribute("mathvariant",o)}else r.family==="punct"?n.setAttribute("separator","true"):(r.family==="open"||r.family==="close")&&n.setAttribute("stretchy","false");return n}});var defaultVariant={mi:"italic",mn:"normal",mtext:"normal"};defineFunctionBuilders({type:"mathord",htmlBuilder(r,e){return buildCommon.makeOrd(r,e,"mathord")},mathmlBuilder(r,e){var n=new mathMLTree.MathNode("mi",[makeText(r.text,r.mode,e)]),o=getVariant(r,e)||"italic";return o!==defaultVariant[n.type]&&n.setAttribute("mathvariant",o),n}}),defineFunctionBuilders({type:"textord",htmlBuilder(r,e){return buildCommon.makeOrd(r,e,"textord")},mathmlBuilder(r,e){var n=makeText(r.text,r.mode,e),o=getVariant(r,e)||"normal",s;return r.mode==="text"?s=new mathMLTree.MathNode("mtext",[n]):/[0-9]/.test(r.text)?s=new mathMLTree.MathNode("mn",[n]):r.text==="\\prime"?s=new mathMLTree.MathNode("mo",[n]):s=new mathMLTree.MathNode("mi",[n]),o!==defaultVariant[s.type]&&s.setAttribute("mathvariant",o),s}});var cssSpace={"\\nobreak":"nobreak","\\allowbreak":"allowbreak"},regularSpace={" ":{},"\\ ":{},"~":{className:"nobreak"},"\\space":{},"\\nobreakspace":{className:"nobreak"}};defineFunctionBuilders({type:"spacing",htmlBuilder(r,e){if(regularSpace.hasOwnProperty(r.text)){var n=regularSpace[r.text].className||"";if(r.mode==="text"){var o=buildCommon.makeOrd(r,e,"textord");return o.classes.push(n),o}else return buildCommon.makeSpan(["mspace",n],[buildCommon.mathsym(r.text,r.mode,e)],e)}else{if(cssSpace.hasOwnProperty(r.text))return buildCommon.makeSpan(["mspace",cssSpace[r.text]],[],e);throw new ParseError('Unknown type of space "'+r.text+'"')}},mathmlBuilder(r,e){var n;if(regularSpace.hasOwnProperty(r.text))n=new mathMLTree.MathNode("mtext",[new mathMLTree.TextNode("\xA0")]);else{if(cssSpace.hasOwnProperty(r.text))return new mathMLTree.MathNode("mspace");throw new ParseError('Unknown type of space "'+r.text+'"')}return n}});var pad=()=>{var r=new mathMLTree.MathNode("mtd",[]);return r.setAttribute("width","50%"),r};defineFunctionBuilders({type:"tag",mathmlBuilder(r,e){var n=new mathMLTree.MathNode("mtable",[new mathMLTree.MathNode("mtr",[pad(),new mathMLTree.MathNode("mtd",[buildExpressionRow(r.body,e)]),pad(),new mathMLTree.MathNode("mtd",[buildExpressionRow(r.tag,e)])])]);return n.setAttribute("width","100%"),n}});var textFontFamilies={"\\text":void 0,"\\textrm":"textrm","\\textsf":"textsf","\\texttt":"texttt","\\textnormal":"textrm"},textFontWeights={"\\textbf":"textbf","\\textmd":"textmd"},textFontShapes={"\\textit":"textit","\\textup":"textup"},optionsWithFont=(r,e)=>{var n=r.font;if(n){if(textFontFamilies[n])return e.withTextFontFamily(textFontFamilies[n]);if(textFontWeights[n])return e.withTextFontWeight(textFontWeights[n]);if(n==="\\emph")return e.fontShape==="textit"?e.withTextFontShape("textup"):e.withTextFontShape("textit")}else return e;return e.withTextFontShape(textFontShapes[n])};defineFunction({type:"text",names:["\\text","\\textrm","\\textsf","\\texttt","\\textnormal","\\textbf","\\textmd","\\textit","\\textup","\\emph"],props:{numArgs:1,argTypes:["text"],allowedInArgument:!0,allowedInText:!0},handler(r,e){var{parser:n,funcName:o}=r,s=e[0];return{type:"text",mode:n.mode,body:ordargument(s),font:o}},htmlBuilder(r,e){var n=optionsWithFont(r,e),o=buildExpression$1(r.body,n,!0);return buildCommon.makeSpan(["mord","text"],o,n)},mathmlBuilder(r,e){var n=optionsWithFont(r,e);return buildExpressionRow(r.body,n)}}),defineFunction({type:"underline",names:["\\underline"],props:{numArgs:1,allowedInText:!0},handler(r,e){var{parser:n}=r;return{type:"underline",mode:n.mode,body:e[0]}},htmlBuilder(r,e){var n=buildGroup$1(r.body,e),o=buildCommon.makeLineSpan("underline-line",e),s=e.fontMetrics().defaultRuleThickness,a=buildCommon.makeVList({positionType:"top",positionData:n.height,children:[{type:"kern",size:s},{type:"elem",elem:o},{type:"kern",size:3*s},{type:"elem",elem:n}]},e);return buildCommon.makeSpan(["mord","underline"],[a],e)},mathmlBuilder(r,e){var n=new mathMLTree.MathNode("mo",[new mathMLTree.TextNode("\u203E")]);n.setAttribute("stretchy","true");var o=new mathMLTree.MathNode("munder",[buildGroup(r.body,e),n]);return o.setAttribute("accentunder","true"),o}}),defineFunction({type:"vcenter",names:["\\vcenter"],props:{numArgs:1,argTypes:["original"],allowedInText:!1},handler(r,e){var{parser:n}=r;return{type:"vcenter",mode:n.mode,body:e[0]}},htmlBuilder(r,e){var n=buildGroup$1(r.body,e),o=e.fontMetrics().axisHeight,s=.5*(n.height-o-(n.depth+o));return buildCommon.makeVList({positionType:"shift",positionData:s,children:[{type:"elem",elem:n}]},e)},mathmlBuilder(r,e){return new mathMLTree.MathNode("mpadded",[buildGroup(r.body,e)],["vcenter"])}}),defineFunction({type:"verb",names:["\\verb"],props:{numArgs:0,allowedInText:!0},handler(r,e,n){throw new ParseError("\\verb ended by end of line instead of matching delimiter")},htmlBuilder(r,e){for(var n=makeVerb(r),o=[],s=e.havingStyle(e.style.text()),a=0;a<n.length;a++){var l=n[a];l==="~"&&(l="\\textasciitilde"),o.push(buildCommon.makeSymbol(l,"Typewriter-Regular",r.mode,s,["mord","texttt"]))}return buildCommon.makeSpan(["mord","text"].concat(s.sizingClasses(e)),buildCommon.tryCombineChars(o),s)},mathmlBuilder(r,e){var n=new mathMLTree.TextNode(makeVerb(r)),o=new mathMLTree.MathNode("mtext",[n]);return o.setAttribute("mathvariant","monospace"),o}});var makeVerb=r=>r.body.replace(/ /g,r.star?"\u2423":"\xA0"),functions=_functions,spaceRegexString=`[ \r
	]`,controlWordRegexString="\\\\[a-zA-Z@]+",controlSymbolRegexString="\\\\[^\uD800-\uDFFF]",controlWordWhitespaceRegexString="("+controlWordRegexString+")"+spaceRegexString+"*",controlSpaceRegexString=`\\\\(
|[ \r	]+
?)[ \r	]*`,combiningDiacriticalMarkString="[\u0300-\u036F]",combiningDiacriticalMarksEndRegex=new RegExp(combiningDiacriticalMarkString+"+$"),tokenRegexString="("+spaceRegexString+"+)|"+(controlSpaceRegexString+"|")+"([!-\\[\\]-\u2027\u202A-\uD7FF\uF900-\uFFFF]"+(combiningDiacriticalMarkString+"*")+"|[\uD800-\uDBFF][\uDC00-\uDFFF]"+(combiningDiacriticalMarkString+"*")+"|\\\\verb\\*([^]).*?\\4|\\\\verb([^*a-zA-Z]).*?\\5"+("|"+controlWordWhitespaceRegexString)+("|"+controlSymbolRegexString+")");class Lexer{constructor(e,n){this.input=void 0,this.settings=void 0,this.tokenRegex=void 0,this.catcodes=void 0,this.input=e,this.settings=n,this.tokenRegex=new RegExp(tokenRegexString,"g"),this.catcodes={"%":14,"~":13}}setCatcode(e,n){this.catcodes[e]=n}lex(){var e=this.input,n=this.tokenRegex.lastIndex;if(n===e.length)return new Token("EOF",new SourceLocation(this,n,n));var o=this.tokenRegex.exec(e);if(o===null||o.index!==n)throw new ParseError("Unexpected character: '"+e[n]+"'",new Token(e[n],new SourceLocation(this,n,n+1)));var s=o[6]||o[3]||(o[2]?"\\ ":" ");if(this.catcodes[s]===14){var a=e.indexOf(`
`,this.tokenRegex.lastIndex);return a===-1?(this.tokenRegex.lastIndex=e.length,this.settings.reportNonstrict("commentAtEnd","% comment has no terminating newline; LaTeX would fail because of commenting the end of math mode (e.g. $)")):this.tokenRegex.lastIndex=a+1,this.lex()}return new Token(s,new SourceLocation(this,n,this.tokenRegex.lastIndex))}}class Namespace{constructor(e,n){e===void 0&&(e={}),n===void 0&&(n={}),this.current=void 0,this.builtins=void 0,this.undefStack=void 0,this.current=n,this.builtins=e,this.undefStack=[]}beginGroup(){this.undefStack.push({})}endGroup(){if(this.undefStack.length===0)throw new ParseError("Unbalanced namespace destruction: attempt to pop global namespace; please report this as a bug");var e=this.undefStack.pop();for(var n in e)e.hasOwnProperty(n)&&(e[n]==null?delete this.current[n]:this.current[n]=e[n])}endGroups(){for(;this.undefStack.length>0;)this.endGroup()}has(e){return this.current.hasOwnProperty(e)||this.builtins.hasOwnProperty(e)}get(e){return this.current.hasOwnProperty(e)?this.current[e]:this.builtins[e]}set(e,n,o){if(o===void 0&&(o=!1),o){for(var s=0;s<this.undefStack.length;s++)delete this.undefStack[s][e];this.undefStack.length>0&&(this.undefStack[this.undefStack.length-1][e]=n)}else{var a=this.undefStack[this.undefStack.length-1];a&&!a.hasOwnProperty(e)&&(a[e]=this.current[e])}n==null?delete this.current[e]:this.current[e]=n}}var macros=_macros;defineMacro("\\noexpand",function(r){var e=r.popToken();return r.isExpandable(e.text)&&(e.noexpand=!0,e.treatAsRelax=!0),{tokens:[e],numArgs:0}}),defineMacro("\\expandafter",function(r){var e=r.popToken();return r.expandOnce(!0),{tokens:[e],numArgs:0}}),defineMacro("\\@firstoftwo",function(r){var e=r.consumeArgs(2);return{tokens:e[0],numArgs:0}}),defineMacro("\\@secondoftwo",function(r){var e=r.consumeArgs(2);return{tokens:e[1],numArgs:0}}),defineMacro("\\@ifnextchar",function(r){var e=r.consumeArgs(3);r.consumeSpaces();var n=r.future();return e[0].length===1&&e[0][0].text===n.text?{tokens:e[1],numArgs:0}:{tokens:e[2],numArgs:0}}),defineMacro("\\@ifstar","\\@ifnextchar *{\\@firstoftwo{#1}}"),defineMacro("\\TextOrMath",function(r){var e=r.consumeArgs(2);return r.mode==="text"?{tokens:e[0],numArgs:0}:{tokens:e[1],numArgs:0}});var digitToNumber={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,A:10,b:11,B:11,c:12,C:12,d:13,D:13,e:14,E:14,f:15,F:15};defineMacro("\\char",function(r){var e=r.popToken(),n,o="";if(e.text==="'")n=8,e=r.popToken();else if(e.text==='"')n=16,e=r.popToken();else if(e.text==="`")if(e=r.popToken(),e.text[0]==="\\")o=e.text.charCodeAt(1);else{if(e.text==="EOF")throw new ParseError("\\char` missing argument");o=e.text.charCodeAt(0)}else n=10;if(n){if(o=digitToNumber[e.text],o==null||o>=n)throw new ParseError("Invalid base-"+n+" digit "+e.text);for(var s;(s=digitToNumber[r.future().text])!=null&&s<n;)o*=n,o+=s,r.popToken()}return"\\@char{"+o+"}"});var newcommand=(r,e,n)=>{var o=r.consumeArg().tokens;if(o.length!==1)throw new ParseError("\\newcommand's first argument must be a macro name");var s=o[0].text,a=r.isDefined(s);if(a&&!e)throw new ParseError("\\newcommand{"+s+"} attempting to redefine "+(s+"; use \\renewcommand"));if(!a&&!n)throw new ParseError("\\renewcommand{"+s+"} when command "+s+" does not yet exist; use \\newcommand");var l=0;if(o=r.consumeArg().tokens,o.length===1&&o[0].text==="["){for(var c="",d=r.expandNextToken();d.text!=="]"&&d.text!=="EOF";)c+=d.text,d=r.expandNextToken();if(!c.match(/^\s*[0-9]+\s*$/))throw new ParseError("Invalid number of arguments: "+c);l=parseInt(c),o=r.consumeArg().tokens}return r.macros.set(s,{tokens:o,numArgs:l}),""};defineMacro("\\newcommand",r=>newcommand(r,!1,!0)),defineMacro("\\renewcommand",r=>newcommand(r,!0,!1)),defineMacro("\\providecommand",r=>newcommand(r,!0,!0)),defineMacro("\\message",r=>{var e=r.consumeArgs(1)[0];return console.log(e.reverse().map(n=>n.text).join("")),""}),defineMacro("\\errmessage",r=>{var e=r.consumeArgs(1)[0];return console.error(e.reverse().map(n=>n.text).join("")),""}),defineMacro("\\show",r=>{var e=r.popToken(),n=e.text;return console.log(e,r.macros.get(n),functions[n],symbols.math[n],symbols.text[n]),""}),defineMacro("\\bgroup","{"),defineMacro("\\egroup","}"),defineMacro("~","\\nobreakspace"),defineMacro("\\lq","`"),defineMacro("\\rq","'"),defineMacro("\\aa","\\r a"),defineMacro("\\AA","\\r A"),defineMacro("\\textcopyright","\\html@mathml{\\textcircled{c}}{\\char`\xA9}"),defineMacro("\\copyright","\\TextOrMath{\\textcopyright}{\\text{\\textcopyright}}"),defineMacro("\\textregistered","\\html@mathml{\\textcircled{\\scriptsize R}}{\\char`\xAE}"),defineMacro("\u212C","\\mathscr{B}"),defineMacro("\u2130","\\mathscr{E}"),defineMacro("\u2131","\\mathscr{F}"),defineMacro("\u210B","\\mathscr{H}"),defineMacro("\u2110","\\mathscr{I}"),defineMacro("\u2112","\\mathscr{L}"),defineMacro("\u2133","\\mathscr{M}"),defineMacro("\u211B","\\mathscr{R}"),defineMacro("\u212D","\\mathfrak{C}"),defineMacro("\u210C","\\mathfrak{H}"),defineMacro("\u2128","\\mathfrak{Z}"),defineMacro("\\Bbbk","\\Bbb{k}"),defineMacro("\xB7","\\cdotp"),defineMacro("\\llap","\\mathllap{\\textrm{#1}}"),defineMacro("\\rlap","\\mathrlap{\\textrm{#1}}"),defineMacro("\\clap","\\mathclap{\\textrm{#1}}"),defineMacro("\\mathstrut","\\vphantom{(}"),defineMacro("\\underbar","\\underline{\\text{#1}}"),defineMacro("\\not",'\\html@mathml{\\mathrel{\\mathrlap\\@not}}{\\char"338}'),defineMacro("\\neq","\\html@mathml{\\mathrel{\\not=}}{\\mathrel{\\char`\u2260}}"),defineMacro("\\ne","\\neq"),defineMacro("\u2260","\\neq"),defineMacro("\\notin","\\html@mathml{\\mathrel{{\\in}\\mathllap{/\\mskip1mu}}}{\\mathrel{\\char`\u2209}}"),defineMacro("\u2209","\\notin"),defineMacro("\u2258","\\html@mathml{\\mathrel{=\\kern{-1em}\\raisebox{0.4em}{$\\scriptsize\\frown$}}}{\\mathrel{\\char`\u2258}}"),defineMacro("\u2259","\\html@mathml{\\stackrel{\\tiny\\wedge}{=}}{\\mathrel{\\char`\u2258}}"),defineMacro("\u225A","\\html@mathml{\\stackrel{\\tiny\\vee}{=}}{\\mathrel{\\char`\u225A}}"),defineMacro("\u225B","\\html@mathml{\\stackrel{\\scriptsize\\star}{=}}{\\mathrel{\\char`\u225B}}"),defineMacro("\u225D","\\html@mathml{\\stackrel{\\tiny\\mathrm{def}}{=}}{\\mathrel{\\char`\u225D}}"),defineMacro("\u225E","\\html@mathml{\\stackrel{\\tiny\\mathrm{m}}{=}}{\\mathrel{\\char`\u225E}}"),defineMacro("\u225F","\\html@mathml{\\stackrel{\\tiny?}{=}}{\\mathrel{\\char`\u225F}}"),defineMacro("\u27C2","\\perp"),defineMacro("\u203C","\\mathclose{!\\mkern-0.8mu!}"),defineMacro("\u220C","\\notni"),defineMacro("\u231C","\\ulcorner"),defineMacro("\u231D","\\urcorner"),defineMacro("\u231E","\\llcorner"),defineMacro("\u231F","\\lrcorner"),defineMacro("\xA9","\\copyright"),defineMacro("\xAE","\\textregistered"),defineMacro("\uFE0F","\\textregistered"),defineMacro("\\ulcorner",'\\html@mathml{\\@ulcorner}{\\mathop{\\char"231c}}'),defineMacro("\\urcorner",'\\html@mathml{\\@urcorner}{\\mathop{\\char"231d}}'),defineMacro("\\llcorner",'\\html@mathml{\\@llcorner}{\\mathop{\\char"231e}}'),defineMacro("\\lrcorner",'\\html@mathml{\\@lrcorner}{\\mathop{\\char"231f}}'),defineMacro("\\vdots","{\\varvdots\\rule{0pt}{15pt}}"),defineMacro("\u22EE","\\vdots"),defineMacro("\\varGamma","\\mathit{\\Gamma}"),defineMacro("\\varDelta","\\mathit{\\Delta}"),defineMacro("\\varTheta","\\mathit{\\Theta}"),defineMacro("\\varLambda","\\mathit{\\Lambda}"),defineMacro("\\varXi","\\mathit{\\Xi}"),defineMacro("\\varPi","\\mathit{\\Pi}"),defineMacro("\\varSigma","\\mathit{\\Sigma}"),defineMacro("\\varUpsilon","\\mathit{\\Upsilon}"),defineMacro("\\varPhi","\\mathit{\\Phi}"),defineMacro("\\varPsi","\\mathit{\\Psi}"),defineMacro("\\varOmega","\\mathit{\\Omega}"),defineMacro("\\substack","\\begin{subarray}{c}#1\\end{subarray}"),defineMacro("\\colon","\\nobreak\\mskip2mu\\mathpunct{}\\mathchoice{\\mkern-3mu}{\\mkern-3mu}{}{}{:}\\mskip6mu\\relax"),defineMacro("\\boxed","\\fbox{$\\displaystyle{#1}$}"),defineMacro("\\iff","\\DOTSB\\;\\Longleftrightarrow\\;"),defineMacro("\\implies","\\DOTSB\\;\\Longrightarrow\\;"),defineMacro("\\impliedby","\\DOTSB\\;\\Longleftarrow\\;"),defineMacro("\\dddot","{\\overset{\\raisebox{-0.1ex}{\\normalsize ...}}{#1}}"),defineMacro("\\ddddot","{\\overset{\\raisebox{-0.1ex}{\\normalsize ....}}{#1}}");var dotsByToken={",":"\\dotsc","\\not":"\\dotsb","+":"\\dotsb","=":"\\dotsb","<":"\\dotsb",">":"\\dotsb","-":"\\dotsb","*":"\\dotsb",":":"\\dotsb","\\DOTSB":"\\dotsb","\\coprod":"\\dotsb","\\bigvee":"\\dotsb","\\bigwedge":"\\dotsb","\\biguplus":"\\dotsb","\\bigcap":"\\dotsb","\\bigcup":"\\dotsb","\\prod":"\\dotsb","\\sum":"\\dotsb","\\bigotimes":"\\dotsb","\\bigoplus":"\\dotsb","\\bigodot":"\\dotsb","\\bigsqcup":"\\dotsb","\\And":"\\dotsb","\\longrightarrow":"\\dotsb","\\Longrightarrow":"\\dotsb","\\longleftarrow":"\\dotsb","\\Longleftarrow":"\\dotsb","\\longleftrightarrow":"\\dotsb","\\Longleftrightarrow":"\\dotsb","\\mapsto":"\\dotsb","\\longmapsto":"\\dotsb","\\hookrightarrow":"\\dotsb","\\doteq":"\\dotsb","\\mathbin":"\\dotsb","\\mathrel":"\\dotsb","\\relbar":"\\dotsb","\\Relbar":"\\dotsb","\\xrightarrow":"\\dotsb","\\xleftarrow":"\\dotsb","\\DOTSI":"\\dotsi","\\int":"\\dotsi","\\oint":"\\dotsi","\\iint":"\\dotsi","\\iiint":"\\dotsi","\\iiiint":"\\dotsi","\\idotsint":"\\dotsi","\\DOTSX":"\\dotsx"};defineMacro("\\dots",function(r){var e="\\dotso",n=r.expandAfterFuture().text;return n in dotsByToken?e=dotsByToken[n]:(n.slice(0,4)==="\\not"||n in symbols.math&&utils.contains(["bin","rel"],symbols.math[n].group))&&(e="\\dotsb"),e});var spaceAfterDots={")":!0,"]":!0,"\\rbrack":!0,"\\}":!0,"\\rbrace":!0,"\\rangle":!0,"\\rceil":!0,"\\rfloor":!0,"\\rgroup":!0,"\\rmoustache":!0,"\\right":!0,"\\bigr":!0,"\\biggr":!0,"\\Bigr":!0,"\\Biggr":!0,$:!0,";":!0,".":!0,",":!0};defineMacro("\\dotso",function(r){var e=r.future().text;return e in spaceAfterDots?"\\ldots\\,":"\\ldots"}),defineMacro("\\dotsc",function(r){var e=r.future().text;return e in spaceAfterDots&&e!==","?"\\ldots\\,":"\\ldots"}),defineMacro("\\cdots",function(r){var e=r.future().text;return e in spaceAfterDots?"\\@cdots\\,":"\\@cdots"}),defineMacro("\\dotsb","\\cdots"),defineMacro("\\dotsm","\\cdots"),defineMacro("\\dotsi","\\!\\cdots"),defineMacro("\\dotsx","\\ldots\\,"),defineMacro("\\DOTSI","\\relax"),defineMacro("\\DOTSB","\\relax"),defineMacro("\\DOTSX","\\relax"),defineMacro("\\tmspace","\\TextOrMath{\\kern#1#3}{\\mskip#1#2}\\relax"),defineMacro("\\,","\\tmspace+{3mu}{.1667em}"),defineMacro("\\thinspace","\\,"),defineMacro("\\>","\\mskip{4mu}"),defineMacro("\\:","\\tmspace+{4mu}{.2222em}"),defineMacro("\\medspace","\\:"),defineMacro("\\;","\\tmspace+{5mu}{.2777em}"),defineMacro("\\thickspace","\\;"),defineMacro("\\!","\\tmspace-{3mu}{.1667em}"),defineMacro("\\negthinspace","\\!"),defineMacro("\\negmedspace","\\tmspace-{4mu}{.2222em}"),defineMacro("\\negthickspace","\\tmspace-{5mu}{.277em}"),defineMacro("\\enspace","\\kern.5em "),defineMacro("\\enskip","\\hskip.5em\\relax"),defineMacro("\\quad","\\hskip1em\\relax"),defineMacro("\\qquad","\\hskip2em\\relax"),defineMacro("\\tag","\\@ifstar\\tag@literal\\tag@paren"),defineMacro("\\tag@paren","\\tag@literal{({#1})}"),defineMacro("\\tag@literal",r=>{if(r.macros.get("\\df@tag"))throw new ParseError("Multiple \\tag");return"\\gdef\\df@tag{\\text{#1}}"}),defineMacro("\\bmod","\\mathchoice{\\mskip1mu}{\\mskip1mu}{\\mskip5mu}{\\mskip5mu}\\mathbin{\\rm mod}\\mathchoice{\\mskip1mu}{\\mskip1mu}{\\mskip5mu}{\\mskip5mu}"),defineMacro("\\pod","\\allowbreak\\mathchoice{\\mkern18mu}{\\mkern8mu}{\\mkern8mu}{\\mkern8mu}(#1)"),defineMacro("\\pmod","\\pod{{\\rm mod}\\mkern6mu#1}"),defineMacro("\\mod","\\allowbreak\\mathchoice{\\mkern18mu}{\\mkern12mu}{\\mkern12mu}{\\mkern12mu}{\\rm mod}\\,\\,#1"),defineMacro("\\newline","\\\\\\relax"),defineMacro("\\TeX","\\textrm{\\html@mathml{T\\kern-.1667em\\raisebox{-.5ex}{E}\\kern-.125emX}{TeX}}");var latexRaiseA=makeEm(fontMetricsData["Main-Regular"][84][1]-.7*fontMetricsData["Main-Regular"][65][1]);defineMacro("\\LaTeX","\\textrm{\\html@mathml{"+("L\\kern-.36em\\raisebox{"+latexRaiseA+"}{\\scriptstyle A}")+"\\kern-.15em\\TeX}{LaTeX}}"),defineMacro("\\KaTeX","\\textrm{\\html@mathml{"+("K\\kern-.17em\\raisebox{"+latexRaiseA+"}{\\scriptstyle A}")+"\\kern-.15em\\TeX}{KaTeX}}"),defineMacro("\\hspace","\\@ifstar\\@hspacer\\@hspace"),defineMacro("\\@hspace","\\hskip #1\\relax"),defineMacro("\\@hspacer","\\rule{0pt}{0pt}\\hskip #1\\relax"),defineMacro("\\ordinarycolon",":"),defineMacro("\\vcentcolon","\\mathrel{\\mathop\\ordinarycolon}"),defineMacro("\\dblcolon",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-.9mu}\\vcentcolon}}{\\mathop{\\char"2237}}'),defineMacro("\\coloneqq",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}=}}{\\mathop{\\char"2254}}'),defineMacro("\\Coloneqq",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}=}}{\\mathop{\\char"2237\\char"3d}}'),defineMacro("\\coloneq",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\mathrel{-}}}{\\mathop{\\char"3a\\char"2212}}'),defineMacro("\\Coloneq",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\mathrel{-}}}{\\mathop{\\char"2237\\char"2212}}'),defineMacro("\\eqqcolon",'\\html@mathml{\\mathrel{=\\mathrel{\\mkern-1.2mu}\\vcentcolon}}{\\mathop{\\char"2255}}'),defineMacro("\\Eqqcolon",'\\html@mathml{\\mathrel{=\\mathrel{\\mkern-1.2mu}\\dblcolon}}{\\mathop{\\char"3d\\char"2237}}'),defineMacro("\\eqcolon",'\\html@mathml{\\mathrel{\\mathrel{-}\\mathrel{\\mkern-1.2mu}\\vcentcolon}}{\\mathop{\\char"2239}}'),defineMacro("\\Eqcolon",'\\html@mathml{\\mathrel{\\mathrel{-}\\mathrel{\\mkern-1.2mu}\\dblcolon}}{\\mathop{\\char"2212\\char"2237}}'),defineMacro("\\colonapprox",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\approx}}{\\mathop{\\char"3a\\char"2248}}'),defineMacro("\\Colonapprox",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\approx}}{\\mathop{\\char"2237\\char"2248}}'),defineMacro("\\colonsim",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\sim}}{\\mathop{\\char"3a\\char"223c}}'),defineMacro("\\Colonsim",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\sim}}{\\mathop{\\char"2237\\char"223c}}'),defineMacro("\u2237","\\dblcolon"),defineMacro("\u2239","\\eqcolon"),defineMacro("\u2254","\\coloneqq"),defineMacro("\u2255","\\eqqcolon"),defineMacro("\u2A74","\\Coloneqq"),defineMacro("\\ratio","\\vcentcolon"),defineMacro("\\coloncolon","\\dblcolon"),defineMacro("\\colonequals","\\coloneqq"),defineMacro("\\coloncolonequals","\\Coloneqq"),defineMacro("\\equalscolon","\\eqqcolon"),defineMacro("\\equalscoloncolon","\\Eqqcolon"),defineMacro("\\colonminus","\\coloneq"),defineMacro("\\coloncolonminus","\\Coloneq"),defineMacro("\\minuscolon","\\eqcolon"),defineMacro("\\minuscoloncolon","\\Eqcolon"),defineMacro("\\coloncolonapprox","\\Colonapprox"),defineMacro("\\coloncolonsim","\\Colonsim"),defineMacro("\\simcolon","\\mathrel{\\sim\\mathrel{\\mkern-1.2mu}\\vcentcolon}"),defineMacro("\\simcoloncolon","\\mathrel{\\sim\\mathrel{\\mkern-1.2mu}\\dblcolon}"),defineMacro("\\approxcolon","\\mathrel{\\approx\\mathrel{\\mkern-1.2mu}\\vcentcolon}"),defineMacro("\\approxcoloncolon","\\mathrel{\\approx\\mathrel{\\mkern-1.2mu}\\dblcolon}"),defineMacro("\\notni","\\html@mathml{\\not\\ni}{\\mathrel{\\char`\u220C}}"),defineMacro("\\limsup","\\DOTSB\\operatorname*{lim\\,sup}"),defineMacro("\\liminf","\\DOTSB\\operatorname*{lim\\,inf}"),defineMacro("\\injlim","\\DOTSB\\operatorname*{inj\\,lim}"),defineMacro("\\projlim","\\DOTSB\\operatorname*{proj\\,lim}"),defineMacro("\\varlimsup","\\DOTSB\\operatorname*{\\overline{lim}}"),defineMacro("\\varliminf","\\DOTSB\\operatorname*{\\underline{lim}}"),defineMacro("\\varinjlim","\\DOTSB\\operatorname*{\\underrightarrow{lim}}"),defineMacro("\\varprojlim","\\DOTSB\\operatorname*{\\underleftarrow{lim}}"),defineMacro("\\gvertneqq","\\html@mathml{\\@gvertneqq}{\u2269}"),defineMacro("\\lvertneqq","\\html@mathml{\\@lvertneqq}{\u2268}"),defineMacro("\\ngeqq","\\html@mathml{\\@ngeqq}{\u2271}"),defineMacro("\\ngeqslant","\\html@mathml{\\@ngeqslant}{\u2271}"),defineMacro("\\nleqq","\\html@mathml{\\@nleqq}{\u2270}"),defineMacro("\\nleqslant","\\html@mathml{\\@nleqslant}{\u2270}"),defineMacro("\\nshortmid","\\html@mathml{\\@nshortmid}{\u2224}"),defineMacro("\\nshortparallel","\\html@mathml{\\@nshortparallel}{\u2226}"),defineMacro("\\nsubseteqq","\\html@mathml{\\@nsubseteqq}{\u2288}"),defineMacro("\\nsupseteqq","\\html@mathml{\\@nsupseteqq}{\u2289}"),defineMacro("\\varsubsetneq","\\html@mathml{\\@varsubsetneq}{\u228A}"),defineMacro("\\varsubsetneqq","\\html@mathml{\\@varsubsetneqq}{\u2ACB}"),defineMacro("\\varsupsetneq","\\html@mathml{\\@varsupsetneq}{\u228B}"),defineMacro("\\varsupsetneqq","\\html@mathml{\\@varsupsetneqq}{\u2ACC}"),defineMacro("\\imath","\\html@mathml{\\@imath}{\u0131}"),defineMacro("\\jmath","\\html@mathml{\\@jmath}{\u0237}"),defineMacro("\\llbracket","\\html@mathml{\\mathopen{[\\mkern-3.2mu[}}{\\mathopen{\\char`\u27E6}}"),defineMacro("\\rrbracket","\\html@mathml{\\mathclose{]\\mkern-3.2mu]}}{\\mathclose{\\char`\u27E7}}"),defineMacro("\u27E6","\\llbracket"),defineMacro("\u27E7","\\rrbracket"),defineMacro("\\lBrace","\\html@mathml{\\mathopen{\\{\\mkern-3.2mu[}}{\\mathopen{\\char`\u2983}}"),defineMacro("\\rBrace","\\html@mathml{\\mathclose{]\\mkern-3.2mu\\}}}{\\mathclose{\\char`\u2984}}"),defineMacro("\u2983","\\lBrace"),defineMacro("\u2984","\\rBrace"),defineMacro("\\minuso","\\mathbin{\\html@mathml{{\\mathrlap{\\mathchoice{\\kern{0.145em}}{\\kern{0.145em}}{\\kern{0.1015em}}{\\kern{0.0725em}}\\circ}{-}}}{\\char`\u29B5}}"),defineMacro("\u29B5","\\minuso"),defineMacro("\\darr","\\downarrow"),defineMacro("\\dArr","\\Downarrow"),defineMacro("\\Darr","\\Downarrow"),defineMacro("\\lang","\\langle"),defineMacro("\\rang","\\rangle"),defineMacro("\\uarr","\\uparrow"),defineMacro("\\uArr","\\Uparrow"),defineMacro("\\Uarr","\\Uparrow"),defineMacro("\\N","\\mathbb{N}"),defineMacro("\\R","\\mathbb{R}"),defineMacro("\\Z","\\mathbb{Z}"),defineMacro("\\alef","\\aleph"),defineMacro("\\alefsym","\\aleph"),defineMacro("\\Alpha","\\mathrm{A}"),defineMacro("\\Beta","\\mathrm{B}"),defineMacro("\\bull","\\bullet"),defineMacro("\\Chi","\\mathrm{X}"),defineMacro("\\clubs","\\clubsuit"),defineMacro("\\cnums","\\mathbb{C}"),defineMacro("\\Complex","\\mathbb{C}"),defineMacro("\\Dagger","\\ddagger"),defineMacro("\\diamonds","\\diamondsuit"),defineMacro("\\empty","\\emptyset"),defineMacro("\\Epsilon","\\mathrm{E}"),defineMacro("\\Eta","\\mathrm{H}"),defineMacro("\\exist","\\exists"),defineMacro("\\harr","\\leftrightarrow"),defineMacro("\\hArr","\\Leftrightarrow"),defineMacro("\\Harr","\\Leftrightarrow"),defineMacro("\\hearts","\\heartsuit"),defineMacro("\\image","\\Im"),defineMacro("\\infin","\\infty"),defineMacro("\\Iota","\\mathrm{I}"),defineMacro("\\isin","\\in"),defineMacro("\\Kappa","\\mathrm{K}"),defineMacro("\\larr","\\leftarrow"),defineMacro("\\lArr","\\Leftarrow"),defineMacro("\\Larr","\\Leftarrow"),defineMacro("\\lrarr","\\leftrightarrow"),defineMacro("\\lrArr","\\Leftrightarrow"),defineMacro("\\Lrarr","\\Leftrightarrow"),defineMacro("\\Mu","\\mathrm{M}"),defineMacro("\\natnums","\\mathbb{N}"),defineMacro("\\Nu","\\mathrm{N}"),defineMacro("\\Omicron","\\mathrm{O}"),defineMacro("\\plusmn","\\pm"),defineMacro("\\rarr","\\rightarrow"),defineMacro("\\rArr","\\Rightarrow"),defineMacro("\\Rarr","\\Rightarrow"),defineMacro("\\real","\\Re"),defineMacro("\\reals","\\mathbb{R}"),defineMacro("\\Reals","\\mathbb{R}"),defineMacro("\\Rho","\\mathrm{P}"),defineMacro("\\sdot","\\cdot"),defineMacro("\\sect","\\S"),defineMacro("\\spades","\\spadesuit"),defineMacro("\\sub","\\subset"),defineMacro("\\sube","\\subseteq"),defineMacro("\\supe","\\supseteq"),defineMacro("\\Tau","\\mathrm{T}"),defineMacro("\\thetasym","\\vartheta"),defineMacro("\\weierp","\\wp"),defineMacro("\\Zeta","\\mathrm{Z}"),defineMacro("\\argmin","\\DOTSB\\operatorname*{arg\\,min}"),defineMacro("\\argmax","\\DOTSB\\operatorname*{arg\\,max}"),defineMacro("\\plim","\\DOTSB\\mathop{\\operatorname{plim}}\\limits"),defineMacro("\\bra","\\mathinner{\\langle{#1}|}"),defineMacro("\\ket","\\mathinner{|{#1}\\rangle}"),defineMacro("\\braket","\\mathinner{\\langle{#1}\\rangle}"),defineMacro("\\Bra","\\left\\langle#1\\right|"),defineMacro("\\Ket","\\left|#1\\right\\rangle");var braketHelper=r=>e=>{var n=e.consumeArg().tokens,o=e.consumeArg().tokens,s=e.consumeArg().tokens,a=e.consumeArg().tokens,l=e.macros.get("|"),c=e.macros.get("\\|");e.macros.beginGroup();var d=f=>p=>{r&&(p.macros.set("|",l),s.length&&p.macros.set("\\|",c));var g=f;if(!f&&s.length){var y=p.future();y.text==="|"&&(p.popToken(),g=!0)}return{tokens:g?s:o,numArgs:0}};e.macros.set("|",d(!1)),s.length&&e.macros.set("\\|",d(!0));var u=e.consumeArg().tokens,m=e.expandTokens([...a,...u,...n]);return e.macros.endGroup(),{tokens:m.reverse(),numArgs:0}};defineMacro("\\bra@ket",braketHelper(!1)),defineMacro("\\bra@set",braketHelper(!0)),defineMacro("\\Braket","\\bra@ket{\\left\\langle}{\\,\\middle\\vert\\,}{\\,\\middle\\vert\\,}{\\right\\rangle}"),defineMacro("\\Set","\\bra@set{\\left\\{\\:}{\\;\\middle\\vert\\;}{\\;\\middle\\Vert\\;}{\\:\\right\\}}"),defineMacro("\\set","\\bra@set{\\{\\,}{\\mid}{}{\\,\\}}"),defineMacro("\\angln","{\\angl n}"),defineMacro("\\blue","\\textcolor{##6495ed}{#1}"),defineMacro("\\orange","\\textcolor{##ffa500}{#1}"),defineMacro("\\pink","\\textcolor{##ff00af}{#1}"),defineMacro("\\red","\\textcolor{##df0030}{#1}"),defineMacro("\\green","\\textcolor{##28ae7b}{#1}"),defineMacro("\\gray","\\textcolor{gray}{#1}"),defineMacro("\\purple","\\textcolor{##9d38bd}{#1}"),defineMacro("\\blueA","\\textcolor{##ccfaff}{#1}"),defineMacro("\\blueB","\\textcolor{##80f6ff}{#1}"),defineMacro("\\blueC","\\textcolor{##63d9ea}{#1}"),defineMacro("\\blueD","\\textcolor{##11accd}{#1}"),defineMacro("\\blueE","\\textcolor{##0c7f99}{#1}"),defineMacro("\\tealA","\\textcolor{##94fff5}{#1}"),defineMacro("\\tealB","\\textcolor{##26edd5}{#1}"),defineMacro("\\tealC","\\textcolor{##01d1c1}{#1}"),defineMacro("\\tealD","\\textcolor{##01a995}{#1}"),defineMacro("\\tealE","\\textcolor{##208170}{#1}"),defineMacro("\\greenA","\\textcolor{##b6ffb0}{#1}"),defineMacro("\\greenB","\\textcolor{##8af281}{#1}"),defineMacro("\\greenC","\\textcolor{##74cf70}{#1}"),defineMacro("\\greenD","\\textcolor{##1fab54}{#1}"),defineMacro("\\greenE","\\textcolor{##0d923f}{#1}"),defineMacro("\\goldA","\\textcolor{##ffd0a9}{#1}"),defineMacro("\\goldB","\\textcolor{##ffbb71}{#1}"),defineMacro("\\goldC","\\textcolor{##ff9c39}{#1}"),defineMacro("\\goldD","\\textcolor{##e07d10}{#1}"),defineMacro("\\goldE","\\textcolor{##a75a05}{#1}"),defineMacro("\\redA","\\textcolor{##fca9a9}{#1}"),defineMacro("\\redB","\\textcolor{##ff8482}{#1}"),defineMacro("\\redC","\\textcolor{##f9685d}{#1}"),defineMacro("\\redD","\\textcolor{##e84d39}{#1}"),defineMacro("\\redE","\\textcolor{##bc2612}{#1}"),defineMacro("\\maroonA","\\textcolor{##ffbde0}{#1}"),defineMacro("\\maroonB","\\textcolor{##ff92c6}{#1}"),defineMacro("\\maroonC","\\textcolor{##ed5fa6}{#1}"),defineMacro("\\maroonD","\\textcolor{##ca337c}{#1}"),defineMacro("\\maroonE","\\textcolor{##9e034e}{#1}"),defineMacro("\\purpleA","\\textcolor{##ddd7ff}{#1}"),defineMacro("\\purpleB","\\textcolor{##c6b9fc}{#1}"),defineMacro("\\purpleC","\\textcolor{##aa87ff}{#1}"),defineMacro("\\purpleD","\\textcolor{##7854ab}{#1}"),defineMacro("\\purpleE","\\textcolor{##543b78}{#1}"),defineMacro("\\mintA","\\textcolor{##f5f9e8}{#1}"),defineMacro("\\mintB","\\textcolor{##edf2df}{#1}"),defineMacro("\\mintC","\\textcolor{##e0e5cc}{#1}"),defineMacro("\\grayA","\\textcolor{##f6f7f7}{#1}"),defineMacro("\\grayB","\\textcolor{##f0f1f2}{#1}"),defineMacro("\\grayC","\\textcolor{##e3e5e6}{#1}"),defineMacro("\\grayD","\\textcolor{##d6d8da}{#1}"),defineMacro("\\grayE","\\textcolor{##babec2}{#1}"),defineMacro("\\grayF","\\textcolor{##888d93}{#1}"),defineMacro("\\grayG","\\textcolor{##626569}{#1}"),defineMacro("\\grayH","\\textcolor{##3b3e40}{#1}"),defineMacro("\\grayI","\\textcolor{##21242c}{#1}"),defineMacro("\\kaBlue","\\textcolor{##314453}{#1}"),defineMacro("\\kaGreen","\\textcolor{##71B307}{#1}");var implicitCommands={"^":!0,_:!0,"\\limits":!0,"\\nolimits":!0};class MacroExpander{constructor(e,n,o){this.settings=void 0,this.expansionCount=void 0,this.lexer=void 0,this.macros=void 0,this.stack=void 0,this.mode=void 0,this.settings=n,this.expansionCount=0,this.feed(e),this.macros=new Namespace(macros,n.macros),this.mode=o,this.stack=[]}feed(e){this.lexer=new Lexer(e,this.settings)}switchMode(e){this.mode=e}beginGroup(){this.macros.beginGroup()}endGroup(){this.macros.endGroup()}endGroups(){this.macros.endGroups()}future(){return this.stack.length===0&&this.pushToken(this.lexer.lex()),this.stack[this.stack.length-1]}popToken(){return this.future(),this.stack.pop()}pushToken(e){this.stack.push(e)}pushTokens(e){this.stack.push(...e)}scanArgument(e){var n,o,s;if(e){if(this.consumeSpaces(),this.future().text!=="[")return null;n=this.popToken(),{tokens:s,end:o}=this.consumeArg(["]"])}else({tokens:s,start:n,end:o}=this.consumeArg());return this.pushToken(new Token("EOF",o.loc)),this.pushTokens(s),n.range(o,"")}consumeSpaces(){for(;;){var e=this.future();if(e.text===" ")this.stack.pop();else break}}consumeArg(e){var n=[],o=e&&e.length>0;o||this.consumeSpaces();var s=this.future(),a,l=0,c=0;do{if(a=this.popToken(),n.push(a),a.text==="{")++l;else if(a.text==="}"){if(--l,l===-1)throw new ParseError("Extra }",a)}else if(a.text==="EOF")throw new ParseError("Unexpected end of input in a macro argument, expected '"+(e&&o?e[c]:"}")+"'",a);if(e&&o)if((l===0||l===1&&e[c]==="{")&&a.text===e[c]){if(++c,c===e.length){n.splice(-c,c);break}}else c=0}while(l!==0||o);return s.text==="{"&&n[n.length-1].text==="}"&&(n.pop(),n.shift()),n.reverse(),{tokens:n,start:s,end:a}}consumeArgs(e,n){if(n){if(n.length!==e+1)throw new ParseError("The length of delimiters doesn't match the number of args!");for(var o=n[0],s=0;s<o.length;s++){var a=this.popToken();if(o[s]!==a.text)throw new ParseError("Use of the macro doesn't match its definition",a)}}for(var l=[],c=0;c<e;c++)l.push(this.consumeArg(n&&n[c+1]).tokens);return l}countExpansion(e){if(this.expansionCount+=e,this.expansionCount>this.settings.maxExpand)throw new ParseError("Too many expansions: infinite loop or need to increase maxExpand setting")}expandOnce(e){var n=this.popToken(),o=n.text,s=n.noexpand?null:this._getExpansion(o);if(s==null||e&&s.unexpandable){if(e&&s==null&&o[0]==="\\"&&!this.isDefined(o))throw new ParseError("Undefined control sequence: "+o);return this.pushToken(n),!1}this.countExpansion(1);var a=s.tokens,l=this.consumeArgs(s.numArgs,s.delimiters);if(s.numArgs){a=a.slice();for(var c=a.length-1;c>=0;--c){var d=a[c];if(d.text==="#"){if(c===0)throw new ParseError("Incomplete placeholder at end of macro body",d);if(d=a[--c],d.text==="#")a.splice(c+1,1);else if(/^[1-9]$/.test(d.text))a.splice(c,2,...l[+d.text-1]);else throw new ParseError("Not a valid argument number",d)}}}return this.pushTokens(a),a.length}expandAfterFuture(){return this.expandOnce(),this.future()}expandNextToken(){for(;;)if(this.expandOnce()===!1){var e=this.stack.pop();return e.treatAsRelax&&(e.text="\\relax"),e}throw new Error}expandMacro(e){return this.macros.has(e)?this.expandTokens([new Token(e)]):void 0}expandTokens(e){var n=[],o=this.stack.length;for(this.pushTokens(e);this.stack.length>o;)if(this.expandOnce(!0)===!1){var s=this.stack.pop();s.treatAsRelax&&(s.noexpand=!1,s.treatAsRelax=!1),n.push(s)}return this.countExpansion(n.length),n}expandMacroAsText(e){var n=this.expandMacro(e);return n&&n.map(o=>o.text).join("")}_getExpansion(e){var n=this.macros.get(e);if(n==null)return n;if(e.length===1){var o=this.lexer.catcodes[e];if(o!=null&&o!==13)return}var s=typeof n=="function"?n(this):n;if(typeof s=="string"){var a=0;if(s.indexOf("#")!==-1)for(var l=s.replace(/##/g,"");l.indexOf("#"+(a+1))!==-1;)++a;for(var c=new Lexer(s,this.settings),d=[],u=c.lex();u.text!=="EOF";)d.push(u),u=c.lex();d.reverse();var m={tokens:d,numArgs:a};return m}return s}isDefined(e){return this.macros.has(e)||functions.hasOwnProperty(e)||symbols.math.hasOwnProperty(e)||symbols.text.hasOwnProperty(e)||implicitCommands.hasOwnProperty(e)}isExpandable(e){var n=this.macros.get(e);return n!=null?typeof n=="string"||typeof n=="function"||!n.unexpandable:functions.hasOwnProperty(e)&&!functions[e].primitive}}var unicodeSubRegEx=/^[]/,uSubsAndSups=Object.freeze({"\u208A":"+","\u208B":"-","\u208C":"=","\u208D":"(","\u208E":")","\u2080":"0","\u2081":"1","\u2082":"2","\u2083":"3","\u2084":"4","\u2085":"5","\u2086":"6","\u2087":"7","\u2088":"8","\u2089":"9","\u2090":"a","\u2091":"e","\u2095":"h","\u1D62":"i","\u2C7C":"j","\u2096":"k","\u2097":"l","\u2098":"m","\u2099":"n","\u2092":"o","\u209A":"p","\u1D63":"r","\u209B":"s","\u209C":"t","\u1D64":"u","\u1D65":"v","\u2093":"x","\u1D66":"\u03B2","\u1D67":"\u03B3","\u1D68":"\u03C1","\u1D69":"\u03D5","\u1D6A":"\u03C7","\u207A":"+","\u207B":"-","\u207C":"=","\u207D":"(","\u207E":")","\u2070":"0","\xB9":"1","\xB2":"2","\xB3":"3","\u2074":"4","\u2075":"5","\u2076":"6","\u2077":"7","\u2078":"8","\u2079":"9","\u1D2C":"A","\u1D2E":"B","\u1D30":"D","\u1D31":"E","\u1D33":"G","\u1D34":"H","\u1D35":"I","\u1D36":"J","\u1D37":"K","\u1D38":"L","\u1D39":"M","\u1D3A":"N","\u1D3C":"O","\u1D3E":"P","\u1D3F":"R","\u1D40":"T","\u1D41":"U","\u2C7D":"V","\u1D42":"W","\u1D43":"a","\u1D47":"b","\u1D9C":"c","\u1D48":"d","\u1D49":"e","\u1DA0":"f","\u1D4D":"g",\u02B0:"h","\u2071":"i",\u02B2:"j","\u1D4F":"k",\u02E1:"l","\u1D50":"m",\u207F:"n","\u1D52":"o","\u1D56":"p",\u02B3:"r",\u02E2:"s","\u1D57":"t","\u1D58":"u","\u1D5B":"v",\u02B7:"w",\u02E3:"x",\u02B8:"y","\u1DBB":"z","\u1D5D":"\u03B2","\u1D5E":"\u03B3","\u1D5F":"\u03B4","\u1D60":"\u03D5","\u1D61":"\u03C7","\u1DBF":"\u03B8"}),unicodeAccents={"\u0301":{text:"\\'",math:"\\acute"},"\u0300":{text:"\\`",math:"\\grave"},"\u0308":{text:'\\"',math:"\\ddot"},"\u0303":{text:"\\~",math:"\\tilde"},"\u0304":{text:"\\=",math:"\\bar"},"\u0306":{text:"\\u",math:"\\breve"},"\u030C":{text:"\\v",math:"\\check"},"\u0302":{text:"\\^",math:"\\hat"},"\u0307":{text:"\\.",math:"\\dot"},"\u030A":{text:"\\r",math:"\\mathring"},"\u030B":{text:"\\H"},"\u0327":{text:"\\c"}},unicodeSymbols={\u00E1:"a\u0301",\u00E0:"a\u0300",\u00E4:"a\u0308",\u01DF:"a\u0308\u0304",\u00E3:"a\u0303",\u0101:"a\u0304",\u0103:"a\u0306",\u1EAF:"a\u0306\u0301",\u1EB1:"a\u0306\u0300",\u1EB5:"a\u0306\u0303",\u01CE:"a\u030C",\u00E2:"a\u0302",\u1EA5:"a\u0302\u0301",\u1EA7:"a\u0302\u0300",\u1EAB:"a\u0302\u0303",\u0227:"a\u0307",\u01E1:"a\u0307\u0304",\u00E5:"a\u030A",\u01FB:"a\u030A\u0301",\u1E03:"b\u0307",\u0107:"c\u0301",\u1E09:"c\u0327\u0301",\u010D:"c\u030C",\u0109:"c\u0302",\u010B:"c\u0307",\u00E7:"c\u0327",\u010F:"d\u030C",\u1E0B:"d\u0307",\u1E11:"d\u0327",\u00E9:"e\u0301",\u00E8:"e\u0300",\u00EB:"e\u0308",\u1EBD:"e\u0303",\u0113:"e\u0304",\u1E17:"e\u0304\u0301",\u1E15:"e\u0304\u0300",\u0115:"e\u0306",\u1E1D:"e\u0327\u0306",\u011B:"e\u030C",\u00EA:"e\u0302",\u1EBF:"e\u0302\u0301",\u1EC1:"e\u0302\u0300",\u1EC5:"e\u0302\u0303",\u0117:"e\u0307",\u0229:"e\u0327",\u1E1F:"f\u0307",\u01F5:"g\u0301",\u1E21:"g\u0304",\u011F:"g\u0306",\u01E7:"g\u030C",\u011D:"g\u0302",\u0121:"g\u0307",\u0123:"g\u0327",\u1E27:"h\u0308",\u021F:"h\u030C",\u0125:"h\u0302",\u1E23:"h\u0307",\u1E29:"h\u0327",\u00ED:"i\u0301",\u00EC:"i\u0300",\u00EF:"i\u0308",\u1E2F:"i\u0308\u0301",\u0129:"i\u0303",\u012B:"i\u0304",\u012D:"i\u0306",\u01D0:"i\u030C",\u00EE:"i\u0302",\u01F0:"j\u030C",\u0135:"j\u0302",\u1E31:"k\u0301",\u01E9:"k\u030C",\u0137:"k\u0327",\u013A:"l\u0301",\u013E:"l\u030C",\u013C:"l\u0327",\u1E3F:"m\u0301",\u1E41:"m\u0307",\u0144:"n\u0301",\u01F9:"n\u0300",\u00F1:"n\u0303",\u0148:"n\u030C",\u1E45:"n\u0307",\u0146:"n\u0327",\u00F3:"o\u0301",\u00F2:"o\u0300",\u00F6:"o\u0308",\u022B:"o\u0308\u0304",\u00F5:"o\u0303",\u1E4D:"o\u0303\u0301",\u1E4F:"o\u0303\u0308",\u022D:"o\u0303\u0304",\u014D:"o\u0304",\u1E53:"o\u0304\u0301",\u1E51:"o\u0304\u0300",\u014F:"o\u0306",\u01D2:"o\u030C",\u00F4:"o\u0302",\u1ED1:"o\u0302\u0301",\u1ED3:"o\u0302\u0300",\u1ED7:"o\u0302\u0303",\u022F:"o\u0307",\u0231:"o\u0307\u0304",\u0151:"o\u030B",\u1E55:"p\u0301",\u1E57:"p\u0307",\u0155:"r\u0301",\u0159:"r\u030C",\u1E59:"r\u0307",\u0157:"r\u0327",\u015B:"s\u0301",\u1E65:"s\u0301\u0307",\u0161:"s\u030C",\u1E67:"s\u030C\u0307",\u015D:"s\u0302",\u1E61:"s\u0307",\u015F:"s\u0327",\u1E97:"t\u0308",\u0165:"t\u030C",\u1E6B:"t\u0307",\u0163:"t\u0327",\u00FA:"u\u0301",\u00F9:"u\u0300",\u00FC:"u\u0308",\u01D8:"u\u0308\u0301",\u01DC:"u\u0308\u0300",\u01D6:"u\u0308\u0304",\u01DA:"u\u0308\u030C",\u0169:"u\u0303",\u1E79:"u\u0303\u0301",\u016B:"u\u0304",\u1E7B:"u\u0304\u0308",\u016D:"u\u0306",\u01D4:"u\u030C",\u00FB:"u\u0302",\u016F:"u\u030A",\u0171:"u\u030B",\u1E7D:"v\u0303",\u1E83:"w\u0301",\u1E81:"w\u0300",\u1E85:"w\u0308",\u0175:"w\u0302",\u1E87:"w\u0307",\u1E98:"w\u030A",\u1E8D:"x\u0308",\u1E8B:"x\u0307",\u00FD:"y\u0301",\u1EF3:"y\u0300",\u00FF:"y\u0308",\u1EF9:"y\u0303",\u0233:"y\u0304",\u0177:"y\u0302",\u1E8F:"y\u0307",\u1E99:"y\u030A",\u017A:"z\u0301",\u017E:"z\u030C",\u1E91:"z\u0302",\u017C:"z\u0307",\u00C1:"A\u0301",\u00C0:"A\u0300",\u00C4:"A\u0308",\u01DE:"A\u0308\u0304",\u00C3:"A\u0303",\u0100:"A\u0304",\u0102:"A\u0306",\u1EAE:"A\u0306\u0301",\u1EB0:"A\u0306\u0300",\u1EB4:"A\u0306\u0303",\u01CD:"A\u030C",\u00C2:"A\u0302",\u1EA4:"A\u0302\u0301",\u1EA6:"A\u0302\u0300",\u1EAA:"A\u0302\u0303",\u0226:"A\u0307",\u01E0:"A\u0307\u0304",\u00C5:"A\u030A",\u01FA:"A\u030A\u0301",\u1E02:"B\u0307",\u0106:"C\u0301",\u1E08:"C\u0327\u0301",\u010C:"C\u030C",\u0108:"C\u0302",\u010A:"C\u0307",\u00C7:"C\u0327",\u010E:"D\u030C",\u1E0A:"D\u0307",\u1E10:"D\u0327",\u00C9:"E\u0301",\u00C8:"E\u0300",\u00CB:"E\u0308",\u1EBC:"E\u0303",\u0112:"E\u0304",\u1E16:"E\u0304\u0301",\u1E14:"E\u0304\u0300",\u0114:"E\u0306",\u1E1C:"E\u0327\u0306",\u011A:"E\u030C",\u00CA:"E\u0302",\u1EBE:"E\u0302\u0301",\u1EC0:"E\u0302\u0300",\u1EC4:"E\u0302\u0303",\u0116:"E\u0307",\u0228:"E\u0327",\u1E1E:"F\u0307",\u01F4:"G\u0301",\u1E20:"G\u0304",\u011E:"G\u0306",\u01E6:"G\u030C",\u011C:"G\u0302",\u0120:"G\u0307",\u0122:"G\u0327",\u1E26:"H\u0308",\u021E:"H\u030C",\u0124:"H\u0302",\u1E22:"H\u0307",\u1E28:"H\u0327",\u00CD:"I\u0301",\u00CC:"I\u0300",\u00CF:"I\u0308",\u1E2E:"I\u0308\u0301",\u0128:"I\u0303",\u012A:"I\u0304",\u012C:"I\u0306",\u01CF:"I\u030C",\u00CE:"I\u0302",\u0130:"I\u0307",\u0134:"J\u0302",\u1E30:"K\u0301",\u01E8:"K\u030C",\u0136:"K\u0327",\u0139:"L\u0301",\u013D:"L\u030C",\u013B:"L\u0327",\u1E3E:"M\u0301",\u1E40:"M\u0307",\u0143:"N\u0301",\u01F8:"N\u0300",\u00D1:"N\u0303",\u0147:"N\u030C",\u1E44:"N\u0307",\u0145:"N\u0327",\u00D3:"O\u0301",\u00D2:"O\u0300",\u00D6:"O\u0308",\u022A:"O\u0308\u0304",\u00D5:"O\u0303",\u1E4C:"O\u0303\u0301",\u1E4E:"O\u0303\u0308",\u022C:"O\u0303\u0304",\u014C:"O\u0304",\u1E52:"O\u0304\u0301",\u1E50:"O\u0304\u0300",\u014E:"O\u0306",\u01D1:"O\u030C",\u00D4:"O\u0302",\u1ED0:"O\u0302\u0301",\u1ED2:"O\u0302\u0300",\u1ED6:"O\u0302\u0303",\u022E:"O\u0307",\u0230:"O\u0307\u0304",\u0150:"O\u030B",\u1E54:"P\u0301",\u1E56:"P\u0307",\u0154:"R\u0301",\u0158:"R\u030C",\u1E58:"R\u0307",\u0156:"R\u0327",\u015A:"S\u0301",\u1E64:"S\u0301\u0307",\u0160:"S\u030C",\u1E66:"S\u030C\u0307",\u015C:"S\u0302",\u1E60:"S\u0307",\u015E:"S\u0327",\u0164:"T\u030C",\u1E6A:"T\u0307",\u0162:"T\u0327",\u00DA:"U\u0301",\u00D9:"U\u0300",\u00DC:"U\u0308",\u01D7:"U\u0308\u0301",\u01DB:"U\u0308\u0300",\u01D5:"U\u0308\u0304",\u01D9:"U\u0308\u030C",\u0168:"U\u0303",\u1E78:"U\u0303\u0301",\u016A:"U\u0304",\u1E7A:"U\u0304\u0308",\u016C:"U\u0306",\u01D3:"U\u030C",\u00DB:"U\u0302",\u016E:"U\u030A",\u0170:"U\u030B",\u1E7C:"V\u0303",\u1E82:"W\u0301",\u1E80:"W\u0300",\u1E84:"W\u0308",\u0174:"W\u0302",\u1E86:"W\u0307",\u1E8C:"X\u0308",\u1E8A:"X\u0307",\u00DD:"Y\u0301",\u1EF2:"Y\u0300",\u0178:"Y\u0308",\u1EF8:"Y\u0303",\u0232:"Y\u0304",\u0176:"Y\u0302",\u1E8E:"Y\u0307",\u0179:"Z\u0301",\u017D:"Z\u030C",\u1E90:"Z\u0302",\u017B:"Z\u0307",\u03AC:"\u03B1\u0301",\u1F70:"\u03B1\u0300",\u1FB1:"\u03B1\u0304",\u1FB0:"\u03B1\u0306",\u03AD:"\u03B5\u0301",\u1F72:"\u03B5\u0300",\u03AE:"\u03B7\u0301",\u1F74:"\u03B7\u0300",\u03AF:"\u03B9\u0301",\u1F76:"\u03B9\u0300",\u03CA:"\u03B9\u0308",\u0390:"\u03B9\u0308\u0301",\u1FD2:"\u03B9\u0308\u0300",\u1FD1:"\u03B9\u0304",\u1FD0:"\u03B9\u0306",\u03CC:"\u03BF\u0301",\u1F78:"\u03BF\u0300",\u03CD:"\u03C5\u0301",\u1F7A:"\u03C5\u0300",\u03CB:"\u03C5\u0308",\u03B0:"\u03C5\u0308\u0301",\u1FE2:"\u03C5\u0308\u0300",\u1FE1:"\u03C5\u0304",\u1FE0:"\u03C5\u0306",\u03CE:"\u03C9\u0301",\u1F7C:"\u03C9\u0300",\u038E:"\u03A5\u0301",\u1FEA:"\u03A5\u0300",\u03AB:"\u03A5\u0308",\u1FE9:"\u03A5\u0304",\u1FE8:"\u03A5\u0306",\u038F:"\u03A9\u0301",\u1FFA:"\u03A9\u0300"};class Parser{constructor(e,n){this.mode=void 0,this.gullet=void 0,this.settings=void 0,this.leftrightDepth=void 0,this.nextToken=void 0,this.mode="math",this.gullet=new MacroExpander(e,n,this.mode),this.settings=n,this.leftrightDepth=0}expect(e,n){if(n===void 0&&(n=!0),this.fetch().text!==e)throw new ParseError("Expected '"+e+"', got '"+this.fetch().text+"'",this.fetch());n&&this.consume()}consume(){this.nextToken=null}fetch(){return this.nextToken==null&&(this.nextToken=this.gullet.expandNextToken()),this.nextToken}switchMode(e){this.mode=e,this.gullet.switchMode(e)}parse(){this.settings.globalGroup||this.gullet.beginGroup(),this.settings.colorIsTextColor&&this.gullet.macros.set("\\color","\\textcolor");try{var e=this.parseExpression(!1);return this.expect("EOF"),this.settings.globalGroup||this.gullet.endGroup(),e}finally{this.gullet.endGroups()}}subparse(e){var n=this.nextToken;this.consume(),this.gullet.pushToken(new Token("}")),this.gullet.pushTokens(e);var o=this.parseExpression(!1);return this.expect("}"),this.nextToken=n,o}parseExpression(e,n){for(var o=[];;){this.mode==="math"&&this.consumeSpaces();var s=this.fetch();if(Parser.endOfExpression.indexOf(s.text)!==-1||n&&s.text===n||e&&functions[s.text]&&functions[s.text].infix)break;var a=this.parseAtom(n);if(a){if(a.type==="internal")continue}else break;o.push(a)}return this.mode==="text"&&this.formLigatures(o),this.handleInfixNodes(o)}handleInfixNodes(e){for(var n=-1,o,s=0;s<e.length;s++)if(e[s].type==="infix"){if(n!==-1)throw new ParseError("only one infix operator per group",e[s].token);n=s,o=e[s].replaceWith}if(n!==-1&&o){var a,l,c=e.slice(0,n),d=e.slice(n+1);c.length===1&&c[0].type==="ordgroup"?a=c[0]:a={type:"ordgroup",mode:this.mode,body:c},d.length===1&&d[0].type==="ordgroup"?l=d[0]:l={type:"ordgroup",mode:this.mode,body:d};var u;return o==="\\\\abovefrac"?u=this.callFunction(o,[a,e[n],l],[]):u=this.callFunction(o,[a,l],[]),[u]}else return e}handleSupSubscript(e){var n=this.fetch(),o=n.text;this.consume(),this.consumeSpaces();var s=this.parseGroup(e);if(!s)throw new ParseError("Expected group after '"+o+"'",n);return s}formatUnsupportedCmd(e){for(var n=[],o=0;o<e.length;o++)n.push({type:"textord",mode:"text",text:e[o]});var s={type:"text",mode:this.mode,body:n},a={type:"color",mode:this.mode,color:this.settings.errorColor,body:[s]};return a}parseAtom(e){var n=this.parseGroup("atom",e);if(this.mode==="text")return n;for(var o,s;;){this.consumeSpaces();var a=this.fetch();if(a.text==="\\limits"||a.text==="\\nolimits"){if(n&&n.type==="op"){var l=a.text==="\\limits";n.limits=l,n.alwaysHandleSupSub=!0}else if(n&&n.type==="operatorname")n.alwaysHandleSupSub&&(n.limits=a.text==="\\limits");else throw new ParseError("Limit controls must follow a math operator",a);this.consume()}else if(a.text==="^"){if(o)throw new ParseError("Double superscript",a);o=this.handleSupSubscript("superscript")}else if(a.text==="_"){if(s)throw new ParseError("Double subscript",a);s=this.handleSupSubscript("subscript")}else if(a.text==="'"){if(o)throw new ParseError("Double superscript",a);var c={type:"textord",mode:this.mode,text:"\\prime"},d=[c];for(this.consume();this.fetch().text==="'";)d.push(c),this.consume();this.fetch().text==="^"&&d.push(this.handleSupSubscript("superscript")),o={type:"ordgroup",mode:this.mode,body:d}}else if(uSubsAndSups[a.text]){var u=unicodeSubRegEx.test(a.text),m=[];for(m.push(new Token(uSubsAndSups[a.text])),this.consume();;){var f=this.fetch().text;if(!uSubsAndSups[f]||unicodeSubRegEx.test(f)!==u)break;m.unshift(new Token(uSubsAndSups[f])),this.consume()}var p=this.subparse(m);u?s={type:"ordgroup",mode:"math",body:p}:o={type:"ordgroup",mode:"math",body:p}}else break}return o||s?{type:"supsub",mode:this.mode,base:n,sup:o,sub:s}:n}parseFunction(e,n){var o=this.fetch(),s=o.text,a=functions[s];if(!a)return null;if(this.consume(),n&&n!=="atom"&&!a.allowedInArgument)throw new ParseError("Got function '"+s+"' with no arguments"+(n?" as "+n:""),o);if(this.mode==="text"&&!a.allowedInText)throw new ParseError("Can't use function '"+s+"' in text mode",o);if(this.mode==="math"&&a.allowedInMath===!1)throw new ParseError("Can't use function '"+s+"' in math mode",o);var{args:l,optArgs:c}=this.parseArguments(s,a);return this.callFunction(s,l,c,o,e)}callFunction(e,n,o,s,a){var l={funcName:e,parser:this,token:s,breakOnTokenText:a},c=functions[e];if(c&&c.handler)return c.handler(l,n,o);throw new ParseError("No function handler for "+e)}parseArguments(e,n){var o=n.numArgs+n.numOptionalArgs;if(o===0)return{args:[],optArgs:[]};for(var s=[],a=[],l=0;l<o;l++){var c=n.argTypes&&n.argTypes[l],d=l<n.numOptionalArgs;(n.primitive&&c==null||n.type==="sqrt"&&l===1&&a[0]==null)&&(c="primitive");var u=this.parseGroupOfType("argument to '"+e+"'",c,d);if(d)a.push(u);else if(u!=null)s.push(u);else throw new ParseError("Null argument, please report this as a bug")}return{args:s,optArgs:a}}parseGroupOfType(e,n,o){switch(n){case"color":return this.parseColorGroup(o);case"size":return this.parseSizeGroup(o);case"url":return this.parseUrlGroup(o);case"math":case"text":return this.parseArgumentGroup(o,n);case"hbox":{var s=this.parseArgumentGroup(o,"text");return s!=null?{type:"styling",mode:s.mode,body:[s],style:"text"}:null}case"raw":{var a=this.parseStringGroup("raw",o);return a!=null?{type:"raw",mode:"text",string:a.text}:null}case"primitive":{if(o)throw new ParseError("A primitive argument cannot be optional");var l=this.parseGroup(e);if(l==null)throw new ParseError("Expected group as "+e,this.fetch());return l}case"original":case null:case void 0:return this.parseArgumentGroup(o);default:throw new ParseError("Unknown group type as "+e,this.fetch())}}consumeSpaces(){for(;this.fetch().text===" ";)this.consume()}parseStringGroup(e,n){var o=this.gullet.scanArgument(n);if(o==null)return null;for(var s="",a;(a=this.fetch()).text!=="EOF";)s+=a.text,this.consume();return this.consume(),o.text=s,o}parseRegexGroup(e,n){for(var o=this.fetch(),s=o,a="",l;(l=this.fetch()).text!=="EOF"&&e.test(a+l.text);)s=l,a+=s.text,this.consume();if(a==="")throw new ParseError("Invalid "+n+": '"+o.text+"'",o);return o.range(s,a)}parseColorGroup(e){var n=this.parseStringGroup("color",e);if(n==null)return null;var o=/^(#[a-f0-9]{3}|#?[a-f0-9]{6}|[a-z]+)$/i.exec(n.text);if(!o)throw new ParseError("Invalid color: '"+n.text+"'",n);var s=o[0];return/^[0-9a-f]{6}$/i.test(s)&&(s="#"+s),{type:"color-token",mode:this.mode,color:s}}parseSizeGroup(e){var n,o=!1;if(this.gullet.consumeSpaces(),!e&&this.gullet.future().text!=="{"?n=this.parseRegexGroup(/^[-+]? *(?:$|\d+|\d+\.\d*|\.\d*) *[a-z]{0,2} *$/,"size"):n=this.parseStringGroup("size",e),!n)return null;!e&&n.text.length===0&&(n.text="0pt",o=!0);var s=/([-+]?) *(\d+(?:\.\d*)?|\.\d+) *([a-z]{2})/.exec(n.text);if(!s)throw new ParseError("Invalid size: '"+n.text+"'",n);var a={number:+(s[1]+s[2]),unit:s[3]};if(!validUnit(a))throw new ParseError("Invalid unit: '"+a.unit+"'",n);return{type:"size",mode:this.mode,value:a,isBlank:o}}parseUrlGroup(e){this.gullet.lexer.setCatcode("%",13),this.gullet.lexer.setCatcode("~",12);var n=this.parseStringGroup("url",e);if(this.gullet.lexer.setCatcode("%",14),this.gullet.lexer.setCatcode("~",13),n==null)return null;var o=n.text.replace(/\\([#$%&~_^{}])/g,"$1");return{type:"url",mode:this.mode,url:o}}parseArgumentGroup(e,n){var o=this.gullet.scanArgument(e);if(o==null)return null;var s=this.mode;n&&this.switchMode(n),this.gullet.beginGroup();var a=this.parseExpression(!1,"EOF");this.expect("EOF"),this.gullet.endGroup();var l={type:"ordgroup",mode:this.mode,loc:o.loc,body:a};return n&&this.switchMode(s),l}parseGroup(e,n){var o=this.fetch(),s=o.text,a;if(s==="{"||s==="\\begingroup"){this.consume();var l=s==="{"?"}":"\\endgroup";this.gullet.beginGroup();var c=this.parseExpression(!1,l),d=this.fetch();this.expect(l),this.gullet.endGroup(),a={type:"ordgroup",mode:this.mode,loc:SourceLocation.range(o,d),body:c,semisimple:s==="\\begingroup"||void 0}}else if(a=this.parseFunction(n,e)||this.parseSymbol(),a==null&&s[0]==="\\"&&!implicitCommands.hasOwnProperty(s)){if(this.settings.throwOnError)throw new ParseError("Undefined control sequence: "+s,o);a=this.formatUnsupportedCmd(s),this.consume()}return a}formLigatures(e){for(var n=e.length-1,o=0;o<n;++o){var s=e[o],a=s.text;a==="-"&&e[o+1].text==="-"&&(o+1<n&&e[o+2].text==="-"?(e.splice(o,3,{type:"textord",mode:"text",loc:SourceLocation.range(s,e[o+2]),text:"---"}),n-=2):(e.splice(o,2,{type:"textord",mode:"text",loc:SourceLocation.range(s,e[o+1]),text:"--"}),n-=1)),(a==="'"||a==="`")&&e[o+1].text===a&&(e.splice(o,2,{type:"textord",mode:"text",loc:SourceLocation.range(s,e[o+1]),text:a+a}),n-=1)}}parseSymbol(){var e=this.fetch(),n=e.text;if(/^\\verb[^a-zA-Z]/.test(n)){this.consume();var o=n.slice(5),s=o.charAt(0)==="*";if(s&&(o=o.slice(1)),o.length<2||o.charAt(0)!==o.slice(-1))throw new ParseError(`\\verb assertion failed --
                    please report what input caused this bug`);return o=o.slice(1,-1),{type:"verb",mode:"text",body:o,star:s}}unicodeSymbols.hasOwnProperty(n[0])&&!symbols[this.mode][n[0]]&&(this.settings.strict&&this.mode==="math"&&this.settings.reportNonstrict("unicodeTextInMathMode",'Accented Unicode text character "'+n[0]+'" used in math mode',e),n=unicodeSymbols[n[0]]+n.slice(1));var a=combiningDiacriticalMarksEndRegex.exec(n);a&&(n=n.substring(0,a.index),n==="i"?n="\u0131":n==="j"&&(n="\u0237"));var l;if(symbols[this.mode][n]){this.settings.strict&&this.mode==="math"&&extraLatin.indexOf(n)>=0&&this.settings.reportNonstrict("unicodeTextInMathMode",'Latin-1/Unicode text character "'+n[0]+'" used in math mode',e);var c=symbols[this.mode][n].group,d=SourceLocation.range(e),u;if(ATOMS.hasOwnProperty(c)){var m=c;u={type:"atom",mode:this.mode,family:m,loc:d,text:n}}else u={type:c,mode:this.mode,loc:d,text:n};l=u}else if(n.charCodeAt(0)>=128)this.settings.strict&&(supportedCodepoint(n.charCodeAt(0))?this.mode==="math"&&this.settings.reportNonstrict("unicodeTextInMathMode",'Unicode text character "'+n[0]+'" used in math mode',e):this.settings.reportNonstrict("unknownSymbol",'Unrecognized Unicode character "'+n[0]+'"'+(" ("+n.charCodeAt(0)+")"),e)),l={type:"textord",mode:"text",loc:SourceLocation.range(e),text:n};else return null;if(this.consume(),a)for(var f=0;f<a[0].length;f++){var p=a[0][f];if(!unicodeAccents[p])throw new ParseError("Unknown accent ' "+p+"'",e);var g=unicodeAccents[p][this.mode]||unicodeAccents[p].text;if(!g)throw new ParseError("Accent "+p+" unsupported in "+this.mode+" mode",e);l={type:"accent",mode:this.mode,loc:SourceLocation.range(e),label:g,isStretchy:!1,isShifty:!0,base:l}}return l}}Parser.endOfExpression=["}","\\endgroup","\\end","\\right","&"];var parseTree=function r(e,n){if(!(typeof e=="string"||e instanceof String))throw new TypeError("KaTeX can only parse string typed expression");var o=new Parser(e,n);delete o.gullet.macros.current["\\df@tag"];var s=o.parse();if(delete o.gullet.macros.current["\\current@color"],delete o.gullet.macros.current["\\color"],o.gullet.macros.get("\\df@tag")){if(!n.displayMode)throw new ParseError("\\tag works only in display equations");s=[{type:"tag",mode:"text",body:s,tag:o.subparse([new Token("\\df@tag")])}]}return s},render=function r(e,n,o){n.textContent="";var s=renderToDomTree(e,o).toNode();n.appendChild(s)};typeof document<"u"&&document.compatMode!=="CSS1Compat"&&(typeof console<"u"&&console.warn("Warning: KaTeX doesn't work in quirks mode. Make sure your website has a suitable doctype."),render=function(){throw new ParseError("KaTeX doesn't work in quirks mode.")});var renderToString=function r(e,n){var o=renderToDomTree(e,n).toMarkup();return o},generateParseTree=function r(e,n){var o=new Settings(n);return parseTree(e,o)},renderError=function r(e,n,o){if(o.throwOnError||!(e instanceof ParseError))throw e;var s=buildCommon.makeSpan(["katex-error"],[new SymbolNode(n)]);return s.setAttribute("title",e.toString()),s.setAttribute("style","color:"+o.errorColor),s},renderToDomTree=function r(e,n){var o=new Settings(n);try{var s=parseTree(e,o);return buildTree(s,e,o)}catch(a){return renderError(a,e,o)}},renderToHTMLTree=function r(e,n){var o=new Settings(n);try{var s=parseTree(e,o);return buildHTMLTree(s,e,o)}catch(a){return renderError(a,e,o)}},version="0.16.19",__domTree={Span,Anchor,SymbolNode,SvgNode,PathNode,LineNode},katex={version,render,renderToString,ParseError,SETTINGS_SCHEMA,__parse:generateParseTree,__renderToDomTree:renderToDomTree,__renderToHTMLTree:renderToHTMLTree,__setFontMetrics:setFontMetrics,__defineSymbol:defineSymbol,__defineFunction:defineFunction,__defineMacro:defineMacro,__domTree};const pe=class pe{constructor(e,n,o,s){ge(this,"dom");ge(this,"pmView");ge(this,"getPos");ge(this,"katexContainer");ge(this,"ctx");ge(this,"onBlur",e=>{this.deselect()});ge(this,"src","");this.pmView=n,this.getPos=o,this.dom=document.createElement("span"),this.ctx=s;const a=e.attrs.src;this.src=a,this.katexContainer=document.createElement("span"),this.katexContainer.classList.add(pe.KATEX_CONTAINER_CLASS),this.renderEquation(),this.dom.append(this.katexContainer),this.katexContainer.addEventListener("click",()=>{this.showMathEditor()})}renderEquation(){this.src.trim().length>0?(katex.render(this.src,this.katexContainer,pe.KATEX_RENDER_OPTION),this.katexContainer.classList.remove("empty")):(this.katexContainer.textContent="EMPTY EQUATION",this.katexContainer.classList.add("empty"))}showMathEditor(){const e=this.pmView.state.doc.nodeAt(this.getPos());if(!e)return;const n=e.attrs.src;this.ctx.openFloatingMathInput(this.katexContainer,n,o=>{this.src=o,this.renderEquation()},()=>this.skipLeft(),()=>this.skipRight(),()=>this.skipRight(),()=>this.deleteThisNode())}syncToProseMirror(){const e=this.getPos(),n=this.pmView.state.schema.nodes.mathInline.create({src:this.src}),o=this.pmView.state.tr.replaceRangeWith(e,e+1,n);return o.setSelection(NodeSelection.create(o.doc,e)),o}skipRight(){const e=this.getPos(),n=this.syncToProseMirror();let o;try{o=TextSelection.create(n.doc,e+1)}catch{o=AllSelection.atEnd(n.doc)}n.setSelection(o),this.pmView.dispatch(n),this.pmView.focus()}skipLeft(){const e=this.getPos(),n=this.syncToProseMirror();let o;try{o=TextSelection.create(n.doc,e-1)}catch{o=AllSelection.atStart(n.doc)}n.setSelection(o),this.pmView.dispatch(n),this.pmView.focus()}deleteThisNode(){const e=this.getPos(),n=NodeSelection.create(this.pmView.state.doc,e),o=this.pmView.state.tr.setSelection(n);o.deleteSelection(),this.pmView.dispatch(o),this.pmView.focus()}stopEvent(){return!0}ignoreMutation(){return!1}selectNode(){this.showMathEditor()}deselect(){}destroy(){this.katexContainer.innerHTML="",this.katexContainer.remove()}};ge(pe,"KATEX_RENDER_OPTION",{displayMode:!1,throwOnError:!1}),ge(pe,"KATEX_CONTAINER_CLASS","math-inline--katex");let MathInlineKatex=pe;const mkKeymapPlugin=r=>{const e=r.keymapContext;if(!e)throw new Error("Cannot find keymap context");const n=computed(()=>generateKeydownHandler(e.prosemirrorKeymap.value,o=>[o.state,o.dispatch,o],(o,s)=>s));return new Plugin({props:{handleKeyDown:(o,s)=>{n.value(o,s)}}})},generateImageName=(r,e)=>`${r}__${nanoid()}.${e}`,mkPasteImagePlugin=r=>{const e=useTaskQueue(),n=r.imagesContext,o=r.lastFocusContext,s=r.pathsContext,a=r.blocksContext;return new Plugin({props:{handlePaste(l,c,d){var k;if(!n||!o||!s||!a)return!1;const u=o.lastFocusedBlockTree.value,m=o.lastFocusedDiId.value,f=m?u==null?void 0:u.getDi(m):null;if(!u||!m||!f||!DI_FILTERS.isBlockDi(f))return!1;const p=f.block.id;let g=null,y=null;const b=(k=c.clipboardData)==null?void 0:k.items;if(!(!b||b.length==0)){for(let w=0;w<b.length;w++){const B=b[w],M=B.type.match(/image\/([a-z]+)/);M&&(g=M[1],y=B.getAsFile())}if(g&&y){const w=generateImageName(y.name,g),B=[BLOCK_CONTENT_TYPES.IMAGE,w,"left",null,null,[]];let M=null;l.state.doc.content.size==0?(M=p,e.addTask(()=>{a.blockEditor.changeBlockContent({blockId:p,content:B})})):e.addTask(()=>{const x=a.blockEditor,{newNormalBlockId:v}=x.insertNormalBlock({pos:{baseBlockId:p,offset:1},content:B})??{};M=v??null}),M&&n.uploadImage(y,w)}}}}})},blockTags={ADDRESS:!0,ARTICLE:!0,ASIDE:!0,BLOCKQUOTE:!0,BODY:!0,CANVAS:!0,DD:!0,DIV:!0,DL:!0,FIELDSET:!0,FIGCAPTION:!0,FIGURE:!0,FOOTER:!0,FORM:!0,H1:!0,H2:!0,H3:!0,H4:!0,H5:!0,H6:!0,HEADER:!0,HGROUP:!0,HR:!0,LI:!0,NOSCRIPT:!0,OL:!0,OUTPUT:!0,P:!0,PRE:!0,SECTION:!0,TABLE:!0,TFOOT:!0,UL:!0},ignoreTags={HEAD:!0,NOSCRIPT:!0,OBJECT:!0,SCRIPT:!0,STYLE:!0,TITLE:!0};function parseHtml(r,e){const n=new DOMParser().parseFromString(e,"text/html"),o=[],s={},a=DOMParser$1.fromSchema(r);function l(d,u,m){let f=a.parse(d);if(f.content.size===0)return;const p=[],g=linkify(f.content,p),y=Slice.maxOpen(g);f=f.replace(0,f.content.size,y);const b=nanoid();s[b]={id:b,content:[BLOCK_CONTENT_TYPES.TEXT,f.toJSON()],children:[],parentId:m},u.push(s[b])}function c(d,u,m){if(d instanceof HTMLOListElement||d instanceof HTMLUListElement){const f=u.length===0?u:u[u.length-1].children,p=u.length===0?m:u[u.length-1].id;for(const g of d.childNodes)c(g,f,p)}else if(d instanceof HTMLElement&&blockTags[d.tagName]){const f=[...d.childNodes.values()];for(let p=0;p<f.length;p++){let g=p;for(;g<f.length;g++){const y=f[g];if(y instanceof HTMLElement&&blockTags[y.tagName])break}if(g>p){const y=document.createElement("div");y.append(...f.slice(p,g)),l(y,u,m),y.remove()}g<f.length&&c(f[g],u,m),p=g}}else{if(d instanceof HTMLElement&&ignoreTags[d.tagName])return;l(d,u,m)}}return c(n.body,o,void 0),[o,s]}const hrefToTitle=(r,e)=>{const n=[];e.state.doc.descendants((o,s)=>{const a=r.marks.link.isInSet(o.marks);a&&n.push(a.attrs.href)});for(const o of n)fetchWebpageTitle({webpageUrl:o}).then(s=>{if(!s.success)return;const a=s.data.title;if(!a||e.isDestroyed)return;let l=null;if(e.state.doc.descendants((m,f)=>{if(l)return!1;const p=r.marks.link.isInSet(m.marks);if(p&&p.attrs.href===o)return l={node:m,pos:f},!1}),!l)return;const c=r.marks.link.create({href:o}),d=r.text(a,[c]),u=e.state.tr.replaceWith(l.pos,l.pos+l.node.nodeSize,d);e.dispatch(u)})},mkPasteTextPlugin=r=>{var s,a;const e=r.lastFocusContext,n=(s=r.blocksContext)==null?void 0:s.blocksManager,o=(a=r.blocksContext)==null?void 0:a.blockEditor;return new Plugin({props:{handlePaste(l,c){var k,w;if(!e||!n||!o)return!1;c.preventDefault(),c.stopImmediatePropagation();const d=useTaskQueue(),u=e.lastFocusedBlockTree.value,m=e.lastFocusedDiId.value,f=m?u==null?void 0:u.getDi(m):null;if(!u||!m||!f||!DI_FILTERS.isBlockDi(f))return!1;const p=l.state.doc.textContent.trim()==="",g=f.block.id,y=r.getSchema(),b=(k=c.clipboardData)==null?void 0:k.getData("text/html");if(b){const[B,M]=parseHtml(y,b);if(B.length===0)return!1;if(Object.keys(M).length===1){const x=Object.values(M)[0];if(x.content[0]===BLOCK_CONTENT_TYPES.TEXT){const v=Node$1.fromJSON(y,x.content[1]),_=l.state.tr.replaceSelectionWith(v);return l.dispatch(_),hrefToTitle(y,l),!0}}return d.addTask(async()=>{const x=n.createBlockTransaction({type:"ui"});if(Object.values(M).forEach(v=>{v.parentId!=null&&x.addBlock({type:"normalBlock",id:v.id,parentId:v.parentId,childrenIds:v.children.map(_=>_.id),fold:!1,content:v.content,metadata:{}})}),o.insertNormalBlocks({pos:{baseBlockId:g,offset:1},blocks:B.map(v=>({id:v.id,content:v.content,childrenIds:v.children.map(_=>_.id)})),tr:x,commit:!1}),p&&x.deleteBlock(g),x.commit(),u){await u.nextUpdate();const v=B[B.length-1].id;if(v){const _=u.findDi(E=>E.type==="basic-block"&&E.block.id===v);_&&(u.focusDi(_.itemId),u.moveCursorToTheEnd(_.itemId))}}}),hrefToTitle(y,l),!0}else{const B=(w=c.clipboardData)==null?void 0:w.getData("text/plain");if(!B)return!1;const M=B.split(/\r?\n/).filter(x=>x.trim());return M.length===0?!1:(d.addTask(async()=>{const x=n.createBlockTransaction({type:"ui"});if(M.length===1){const _=plainTextToPmNode(M[0],y),E=l.state.tr.replaceSelectionWith(_);l.dispatch(E),hrefToTitle(y,l);return}const{newNormalBlockIds:v}=o.insertNormalBlocks({pos:{baseBlockId:g,offset:1},blocks:M.map(_=>({content:plainTextToTextContent(_,y)})),tr:x,commit:!1})??{};if(p&&x.deleteBlock(g),x.commit(),u){await u.nextUpdate();const _=v==null?void 0:v[v.length-1];if(_){const E=u.findDi(N=>N.type==="basic-block"&&N.block.id===_);E&&(u.focusDi(E.itemId),u.moveCursorToTheEnd(E.itemId))}}hrefToTitle(y,l)}),!0)}}}})},_sfc_main$1y=defineComponent({__name:"TextContent",props:{blockTree:{},itemId:{},block:{},readonly:{type:Boolean},highlightTerms:{},highlightRefs:{}},setup(r){const e=r,{blocksManager:n,blockEditor:o}=BlocksContext.useContext(),s=FloatingMathInputContext.useContext(),a=useTaskQueue(),l=shallowRef(null),c=ref(null),d={mathInline(p,g,y){return new MathInlineKatex(p,g,y,s)}},u=computed(()=>getPmSchema({getBlockRef:n.getBlockRef})),m=({newDoc:p,oldSelection:g,newSelection:y})=>{const b=e.block.id,k=[BLOCK_CONTENT_TYPES.TEXT,p];l.value=p,a.addTask(({mergedTasks:w})=>{var x;const B=w[0],M=n.createBlockTransaction({type:"ui"});o.changeBlockContent({blockId:b,content:k,tr:M,commit:!1}),M.meta.envUndoStrategy="create",M.envInfo.onCreate={...M.envInfo.onCreate,selection:((x=B==null?void 0:B.meta)==null?void 0:x.oldSelection)??g},M.commit()},{type:"updateBlockContent"+b,delay:500,debounce:!0,meta:{oldSelection:g,newSelection:y}})},f=p=>e.readonly?[]:[inputRules({rules:[openRefSuggestions(p),turnToCodeBlock(p)]}),mkKeymapPlugin(p),mkPasteImagePlugin(p),mkPasteTextPlugin(p)];return watch(()=>e.block.content,p=>{var y;if(p[0]!=BLOCK_CONTENT_TYPES.TEXT)return;const g=e.block.origin;g.type==="ui"&&((y=g.changeSources)!=null&&y.includes(e.block.id))&&l.value!==null||(l.value=p[1])},{immediate:!0}),onMounted(()=>{var p,g;if(e.itemId){const y=(p=c.value)==null?void 0:p.getEditorView();y&&((g=e.blockTree)==null||g.registerEditorView(e.itemId,y))}}),onUnmounted(()=>{var p,g;if(e.itemId){const y=(p=c.value)==null?void 0:p.getEditorView();y&&((g=e.blockTree)==null||g.unregisterEditorView(e.itemId,y),y.destroy())}}),(p,g)=>(openBlock(),createBlock(_sfc_main$1z,{class:"text-content block-content",ref_key:"pmWrapper",ref:c,doc:l.value,"onUpdate:doc":g[0]||(g[0]=y=>l.value=y),schema:u.value,readonly:p.readonly,"plugins-builder":f,"disable-spellcheck-when-blur":!0,"on-doc-changed":m,"node-views":d,"highlight-terms":p.highlightTerms,"highlight-refs":p.highlightRefs},null,8,["doc","schema","readonly","highlight-terms","highlight-refs"]))}}),_sfc_main$1x=defineComponent({__name:"Popover",props:{defaultOpen:{type:Boolean},open:{type:Boolean},modal:{type:Boolean}},emits:["update:open"],setup(r,{emit:e}){const n=xe(r,e);return(o,s)=>(openBlock(),createBlock(unref(ys),normalizeProps(guardReactiveProps(unref(n))),{default:withCtx(()=>[renderSlot(o.$slots,"default")]),_:3},16))}}),_sfc_main$1w=defineComponent({inheritAttrs:!1,__name:"PopoverContent",props:{forceMount:{type:Boolean},trapFocus:{type:Boolean},side:{},sideOffset:{default:4},align:{default:"center"},alignOffset:{},avoidCollisions:{type:Boolean},collisionBoundary:{},collisionPadding:{},arrowPadding:{},sticky:{},hideWhenDetached:{type:Boolean},updatePositionStrategy:{},prioritizePosition:{type:Boolean},asChild:{type:Boolean},as:{},disableOutsidePointerEvents:{type:Boolean},class:{}},emits:["escapeKeyDown","pointerDownOutside","focusOutside","interactOutside","openAutoFocus","closeAutoFocus"],setup(r,{emit:e}){const n=r,o=e,s=computed(()=>{const{class:l,...c}=n;return c}),a=xe(s,o);return(l,c)=>(openBlock(),createBlock(unref(bs),{style:{backgroundColor:"red"}},{default:withCtx(()=>[createVNode(unref(ws),mergeProps({...unref(a),...l.$attrs},{class:unref(cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n.class)}),{default:withCtx(()=>[renderSlot(l.$slots,"default")]),_:3},16,["class"])]),_:3}))}}),_sfc_main$1v=defineComponent({__name:"PopoverTrigger",props:{asChild:{type:Boolean},as:{}},setup(r){const e=r;return(n,o)=>(openBlock(),createBlock(unref(gs),normalizeProps(guardReactiveProps(e)),{default:withCtx(()=>[renderSlot(n.$slots,"default")]),_:3},16))}}),BlockMoverContext=createContext(()=>{const{blocksManager:r,blockEditor:e}=BlocksContext.useContext(),{lastFocusedBlockTree:n,lastFocusedDiId:o}=LastFocusContext.useContext(),{search:s}=IndexContext.useContext(),a=ref(null),l=computed({get:()=>a.value!==null,set:v=>!v&&(a.value=null)}),c=ref(""),d=ref(0),u=ref([]),m=ref(!1),{toast:f}=useToast(),{t:p}=useI18n(),g="block-mover-content";let y=!1;const b=useDebounceFn(()=>{if(!c.value||c.value.trim().length==0){u.value=[];return}const v=s(c.value);u.value=v.slice(0,100).map(_=>r.getBlockRef(_)).filter(_=>{const E=_.value;return E!=null&&E.content[0]===BLOCK_CONTENT_TYPES.TEXT}),d.value=0},100),k=(v,_=500)=>(m.value=!0,setTimeout(()=>m.value=!1,_),v()),w=v=>{if(v==null)return;const _=n.value,E=o.value,N=E?_==null?void 0:_.getDi(E):null;if(!_||!E||!N||!DI_FILTERS.isBlockDi(N))return;const I=N.block.id,L=useTaskQueue(),A={parentId:v,childIndex:"last-space"};L.addTask(async()=>{e!=null&&(y&&e.insertNormalBlock({pos:{baseBlockId:I,offset:0},content:blockRefToTextContent(I)}),e.moveBlock({blockId:I,pos:A}),f({title:p("kbView.blockMover.moveSuccess",{count:1}),action:h(_sfc_main$1D,{altText:p("kbView.blockMover.focusMovedBlock"),onClick:F=>{F.stopPropagation(),_.focusDi(E,{highlight:!0,expandIfFold:!0})}},{default:()=>p("kbView.blockMover.focusMovedBlock")})}),a.value=null)})},B=(v,_={})=>{c.value=_.initQuery??"",y=_.leaveRef??!1,_.leaveMirror,d.value=0,a.value=v},M=()=>{setTimeout(()=>{const v=document.body.querySelector(`.${g} .focus`);v instanceof HTMLElement&&v.scrollIntoView({block:"nearest"})})},x=generateKeydownHandlerSimple({Escape:{run:v=>v.isComposing||v.keyCode===229?!1:(a.value=null,w(null),!0),preventDefault:!0,stopPropagation:!0},Enter:{run:v=>{var E,N;if(v.isComposing||v.keyCode===229)return!1;const _=(N=(E=u.value[d.value])==null?void 0:E.value)==null?void 0:N.id;return _!=null&&w(_),!0},preventDefault:!0,stopPropagation:!0},Backspace:{run:v=>v.isComposing||v.keyCode===229?!1:c.value.length==0?(w(null),!0):!1,preventDefault:!0,stopPropagation:!0},ArrowUp:{run:v=>v.isComposing||v.keyCode===229?!1:k(()=>(d.value>0?d.value--:d.value=u.value.length-1,M(),!0)),preventDefault:!0,stopPropagation:!0},ArrowDown:{run:v=>v.isComposing||v.keyCode===229?!1:k(()=>(d.value<u.value.length-1?d.value++:d.value=0,M(),!0)),preventDefault:!0,stopPropagation:!0},Home:{run:v=>v.isComposing||v.keyCode===229?!1:k(()=>(d.value=0,M(),!0)),preventDefault:!0,stopPropagation:!0},End:{run:v=>v.isComposing||v.keyCode===229?!1:k(()=>(d.value=u.value.length-1,M(),!0)),preventDefault:!0,stopPropagation:!0}});return{showPos:a,open:l,query:c,cb:w,focusItemIndex:d,suggestions:u,suppressMouseOver:m,updateSuggestions:b,withScrollSuppressed:k,openBlockMover:B,handleKeydown:x,contentClass:g}}),calcPopoverPos=(r,e,n,o,s={})=>{const a=s.offset??(m=>m),l=s.minMargin??20,c=window.innerWidth,d=window.innerHeight,u=a({leftDown:{x:n-r,y:o},leftUp:{x:n-r,y:o-e},rightDown:{x:n,y:o},rightUp:{x:n,y:o-e}});for(const m of["leftDown","leftUp"])u[m].x<l&&(u[m].x=l);for(const m of["rightDown","rightUp"])u[m].x+r>c-l&&(u[m].x=c-l-r);for(const m of["leftUp","rightUp"])u[m].y<l&&(u[m].y=l);for(const m of["leftDown","rightDown"])u[m].y+e>d-l&&(u[m].y=d-l-e);if(s.avoidColideWith){const m=s.avoidColideWith.getBoundingClientRect(),f=s.minCollisionDist??10;for(const p of["leftDown","leftUp","rightDown","rightUp"]){const g=u[p];g.x<m.right+f&&g.x+r>m.left-f&&g.y<m.bottom+f&&g.y+e>m.top-f&&(g.x<m.left?g.x=Math.max(m.left-f-r,l):g.x=Math.min(m.right+f,c-l-r),g.y<m.top?g.y=Math.max(m.top-f-e,l):g.y=Math.min(m.bottom+f,d-l-e))}}return u},clip=(r,e,n)=>(e>n&&([e,n]=[n,e]),r<e?e:r>n?n:r),_hoisted_1$z={class:"relative px-1"},_hoisted_2$i={class:"my-2 max-h-[240px] overflow-y-auto px-1"},_hoisted_3$e=["onMouseover"],_hoisted_4$b={key:0,class:"text-center"},_hoisted_5$6={class:"text-sm text-muted-foreground"},_sfc_main$1u=defineComponent({__name:"BlockMover",setup(r){const{showPos:e,open:n,query:o,focusItemIndex:s,suggestions:a,suppressMouseOver:l,updateSuggestions:c,contentClass:d,handleKeydown:u}=BlockMoverContext.useContext(),m=computed(()=>o.value.length==0?[]:hybridTokenize(o.value,!1,1,!1)??[]);return watch(e,async()=>{if(await nextTick(),!e.value||!(document.querySelector("[data-radix-popper-content-wrapper]")instanceof HTMLElement))return;const{x:f,y:p}=e.value,g=calcPopoverPos(300,300,f,p,{offset:y=>(y.leftDown.y+=30,y.rightDown.y+=30,y)});document.body.style.setProperty("--popover-x",`${g.rightDown.x}px`),document.body.style.setProperty("--popover-y",`${g.rightDown.y}px`)}),(f,p)=>(openBlock(),createBlock(unref(_sfc_main$1x),{open:unref(n),"onUpdate:open":p[2]||(p[2]=g=>isRef(n)?n.value=g:null)},{default:withCtx(()=>[createVNode(unref(_sfc_main$1w),{class:normalizeClass(`${unref(d)} py-2 pb-0 px-1 max-h-[300px] max-w-[300px] overflow-hidden`),"trap-focus":"",tabindex:"-1",onKeydown:unref(u)},{default:withCtx(()=>[createBaseVNode("div",_hoisted_1$z,[createVNode(unref(Search),{class:"absolute left-3 top-1/2 -translate-y-1/2 size-4 text-muted-foreground"}),createVNode(unref(_sfc_main$1H),{onInput:p[0]||(p[0]=g=>!g.isComposing&&unref(c)()),onCompositionend:unref(c),modelValue:unref(o),"onUpdate:modelValue":p[1]||(p[1]=g=>isRef(o)?o.value=g:null),placeholder:f.$t("kbView.blockMover.inputPlaceholder"),class:"h-[32px] pl-8 rounded-sm focus-visible:outline-none focus-visible:ring-transparent"},null,8,["onCompositionend","modelValue","placeholder"])]),createBaseVNode("div",_hoisted_2$i,[(openBlock(!0),createElementBlock(Fragment$1,null,renderList(unref(a),(g,y)=>(openBlock(),createElementBlock("div",{key:g.value.id,class:normalizeClass(["relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 text-sm outline-none [&.focus]:bg-accent [&.focus]:text-accent-foreground",{focus:unref(s)===y}]),onMouseover:b=>!unref(l)&&(s.value=y)},[g.value.content[0]===unref(BLOCK_CONTENT_TYPES).TEXT?(openBlock(),createBlock(_sfc_main$1y,{key:0,block:g.value,readonly:!0,class:"*:cursor-default","highlight-terms":m.value},null,8,["block","highlight-terms"])):createCommentVNode("",!0)],42,_hoisted_3$e))),128)),unref(a).length===0?(openBlock(),createElementBlock("div",_hoisted_4$b,[createBaseVNode("span",_hoisted_5$6,toDisplayString(f.$t("kbView.refSuggestions.noSuggestions")),1)])):createCommentVNode("",!0)])]),_:1},8,["class","onKeydown"])]),_:1},8,["open"]))}}),BlockSelectDragContext=createContext(()=>{const r=ref({topLevelOnly:[],allNonFolded:[]}),e=ref(null),n=ref(!1);return{selectedBlockIds:r,draggingDropPos:e,dragging:n}}),generateDisplayItems=r=>{const{rootBlockId:e,rootBlockLevel:n,enlargeRootBlock:o,showBacklinks:s,showPotentialLinks:a,blocksManager:l,expandedBP:c,getBacklinksContext:d,getIndexContext:u}=r,m=[],f=l.getBlock(e);if(!f)return m;o&&m.push({type:"root-block",itemId:`root-block-${e}`,block:f}),l.forDescendantsWithMissingBlock({rootBlockId:e,rootBlockLevel:o?-1:n,nonFoldOnly:!0,includeSelf:!o,onEachBlock:(g,y)=>{m.push({type:"basic-block",itemId:`block-${g.id}`,block:g,level:y})},onMissingBlock:(g,y,b)=>{m.push({type:"missing-block",itemId:`missing-block-${g}-${b}`,blockId:g,parentId:y,level:b})}});let p=[void 0];return s&&addBacklinkItems(e,m,l,p,c,d),a&&addPotentialLinksItems(e,m,l,p,c,d,u),m},addBacklinkItems=(r,e,n,o,s,a)=>{const{getBacklinksConsideringAliases:l}=a()??{};if(!l)return;const c=l(r);if(c.size<=0)return;const d=new Set(c),u=new Set;let m;do{m=d.size;for(const f of d)u.has(f)||n.getBlockPath(f).slice(1).some(p=>d.has(p.id)&&!u.has(p.id))&&u.add(f);for(const f of u)d.delete(f)}while(d.size!==m);e.push({type:"backlink-header",itemId:`backlink-header-${r}`,blockId:r,backlinks:[...c]});for(const f of d){const p=n.getBlock(f);p&&(e.push({type:"backlink-block",itemId:`backlink-block-${f}`,block:p,refBlockId:r}),n.forDescendants({rootBlockId:f,rootBlockLevel:0,nonFoldOnly:!0,includeSelf:!1,ignore:g=>s[g.id]?"keep-self-and-descendants":"ignore-descendants",onEachBlock:(g,y)=>{e.push({type:"backlink-descendant",itemId:`backlink-descendant-${f}-${g.id}`,block:g,level:y})}}))}o[0]=c},addPotentialLinksItems=(r,e,n,o,s,a,l)=>{const{getBacklinksConsideringAliases:c}=a()??{},{search:d}=l()??{};if(!d||!c)return;const u=o[0]??c(r),m=n.getBlock(r);if(m&&m.content[0]===BLOCK_CONTENT_TYPES.TEXT){const f=d(m.ctext).map(p=>n.getBlock(p)).filter(p=>p!=null).filter(p=>!u.has(p.id)&&p.id!==r).filter(p=>p.content[0]===BLOCK_CONTENT_TYPES.TEXT);if(f.length>0){e.push({type:"potential-links-header",itemId:`potential-links-header-${r}`,blockId:r,potentialLinks:f.map(p=>p.id)});for(const p of f){const g=n.getBlock(p.id);g&&(e.push({type:"potential-links-block",itemId:`potential-links-block-${p.id}`,block:g,refBlockId:r}),n.forDescendants({rootBlockId:p.id,rootBlockLevel:0,nonFoldOnly:!0,includeSelf:!1,ignore:y=>s[y.id]?"keep-self-and-descendants":"ignore-descendants",onEachBlock:(y,b)=>{e.push({type:"potential-links-descendant",itemId:`potential-links-descendant-${y.id}`,block:y,level:b})}}))}}}},inViewport=(r,e=60,n=0)=>{const o=r.getBoundingClientRect();return o.top<window.innerHeight-n&&o.bottom>e},getHoveredElementWithClass=(r,e)=>{let n=r,o;for(;n instanceof Node;){if(n instanceof HTMLElement&&n.classList.contains(e)){o=n;break}n=n.parentNode}return o instanceof Element?o:null},mitt=()=>{const r=_mitt();return Object.assign(r,{once:(e,n)=>{const o=s=>{r.off(e,o),n(s)};r.on(e,o)}})};function vue3h(r,e,n){const{attrs:o,on:s,...a}=e;let l={};return s&&Object.entries(s).forEach(c=>{const[d,u]=c;l[`on${d[0].toUpperCase()+d.slice(1)}`]=u}),h(r,{...o,...l,...a},n)}const _h=vue3h;function vue3hChild(r,e,n){const{attrs:o,on:s,...a}=e;let l={};return s&&Object.entries(s).forEach(c=>{const[d,u]=c;l[`on${d[0].toUpperCase()+d.slice(1)}`]=u}),h(r,{...o,...l,...a},{default:()=>n})}const _hChild=vue3hChild;function vue3getSlot(r,e){var n;return(n=r.$slots)==null?void 0:n[e]}const getSlot=vue3getSlot,useObserverItem=r=>{const e=ref(null);return onMounted(()=>{r.resizeObserver&&e.value&&r.resizeObserver.observe(e.value)}),onBeforeUnmount(()=>{r.resizeObserver&&e.value&&r.resizeObserver.unobserve(e.value)}),{itemRefEl:e}},ObserverItem=defineComponent({name:"ObserverItem",props:{resizeObserver:{type:ResizeObserver,require:!0},id:{type:[String,Number],require:!0}},setup(r){return useObserverItem(r)},render(){var r;const{id:e}=this;return _h("div",{ref:"itemRefEl",attrs:{"data-id":e}},[(r=getSlot(this,"default"))==null?void 0:r()])}}),defaultProps={itemGap:0,fixed:!1,buffer:0,bufferTop:0,bufferBottom:0,scrollDistance:0,horizontal:!1,fixSelection:!1,start:0,offset:0,listStyle:"",listClass:"",itemStyle:"",itemClass:"",headerClass:"",headerStyle:"",footerClass:"",footerStyle:"",stickyHeaderClass:"",stickyHeaderStyle:"",stickyFooterClass:"",stickyFooterStyle:""};function useVirtList(r,e){const n=new Proxy(r,{get($,K){var ne;return(ne=Reflect.get($,K))!=null?ne:Reflect.get(defaultProps,K)}}),o=ref(null),s=ref(null),a=ref(null),l=ref(null),c=ref(null),d=ref(null),u=new Map,m=ref(0);let f="backward",p=!1,g=!1,y=!1,b=null;const k=shallowReactive({clientSize:0,headerSize:0,footerSize:0,stickyHeaderSize:0,stickyFooterSize:0}),w=shallowReactive({views:0,offset:0,listTotalSize:0,virtualSize:0,inViewBegin:0,inViewEnd:0,renderBegin:0,renderEnd:0,bufferTop:0,bufferBottom:0});function B(){const $=n.horizontal?"scrollLeft":"scrollTop";return o.value?o.value[$]:0}function M(){return k.headerSize+k.footerSize+k.stickyHeaderSize+k.stickyFooterSize}function x(){return w.listTotalSize+k.headerSize+k.footerSize+k.stickyHeaderSize+k.stickyFooterSize}function v($){var K;return n.fixed?n.minSize+n.itemGap:(K=u.get(String($)))!=null?K:n.minSize+n.itemGap}function _($,K){u.set(String($),K)}function E($){u.delete(String($))}function N($){var K,ne;if(n.fixed)return{top:(n.minSize+n.itemGap)*$,current:n.minSize+n.itemGap,bottom:(n.minSize+n.itemGap)*($+1)};const{itemKey:oe}=n;let ae=k.headerSize;for(let le=0;le<=$-1;le+=1){const he=v((K=n.list[le])==null?void 0:K[oe]);ae+=he}const de=v((ne=n.list[$])==null?void 0:ne[oe]);return{top:ae,current:de,bottom:ae+de}}function I($){y=!0;const K=n.horizontal?"scrollLeft":"scrollTop";o.value&&(o.value[K]=$)}async function L($){if($<0)return;if($>=n.list.length-1){se();return}let{top:K}=N($);I(K);const ne=()=>{const{top:oe}=N($);if(I(oe),K!==oe){K=oe,b=ne;return}b=null};b=ne}async function A($){var K;const{top:ne,bottom:oe}=N($),ae=B(),de=B()+k.clientSize,le=v((K=n.list[$])==null?void 0:K[n.itemKey]);if(ne<ae&&ae<oe&&le<k.clientSize){I(ne);return}if(ne+k.stickyHeaderSize<de&&de<oe+k.stickyHeaderSize&&le<k.clientSize){I(oe-k.clientSize+k.stickyHeaderSize);return}if(ne+k.stickyHeaderSize>=de){L($);return}if(oe<=ae){L($);return}}async function F(){let $=0;function K(){$+=1,I(0),setTimeout(()=>{var ne;if($>10)return;const oe=n.horizontal?"scrollLeft":"scrollTop";((ne=o==null?void 0:o.value)==null?void 0:ne[oe])!==0&&K()},3)}K()}async function se(){let $=0;function K(){$+=1,I(x()),setTimeout(()=>{$>10||Math.abs(Math.round(w.offset+k.clientSize)-Math.round(x()))>2&&K()},3)}K()}function H($){var K;$<w.inViewBegin&&(p=!0),w.inViewBegin=$,w.inViewEnd=Math.min($+w.views,n.list.length-1),(K=e==null?void 0:e.rangeUpdate)==null||K.call(e,w.inViewBegin,w.inViewEnd)}function V(){var $,K;const{views:ne,offset:oe,inViewBegin:ae}=w,{itemKey:de}=n,le=oe-k.headerSize;let he=ae,ue=ce();if(le<0){H(0);return}if(f==="forward"){if(le>=ue)return;for(let me=he-1;me>=0;me-=1){const fe=v(($=n.list[me])==null?void 0:$[de]);if(ue-=fe,ue<=le&&le<ue+fe){he=me;break}}}if(f==="backward"){if(le<=ue)return;for(let me=he;me<=n.list.length-1;me+=1){const fe=v((K=n.list[me])==null?void 0:K[de]);if(ue<=le&&le<ue+fe){he=me;break}ue+=fe}p=!1}he!==w.inViewBegin&&H(he)}function R($){var K,ne,oe;(K=e==null?void 0:e.scroll)==null||K.call(e,$);const ae=B();ae!==w.offset&&(f=ae<w.offset?"forward":"backward",w.offset=ae,V(),f==="forward"&&w.offset-n.scrollDistance<=0&&((ne=e==null?void 0:e.toTop)==null||ne.call(e,n.list[0])),f==="backward"&&Math.round(w.offset+n.scrollDistance)>=Math.round(w.listTotalSize+M()-k.clientSize)&&((oe=e==null?void 0:e.toBottom)==null||oe.call(e,n.list[n.list.length-1])))}function J(){const $=Math.ceil(k.clientSize/(n.minSize+n.itemGap))+1;w.views=$}function Y(){J(),H(w.inViewBegin)}function re(){var $;if(n.fixed){w.listTotalSize=(n.minSize+n.itemGap)*n.list.length;return}const{itemKey:K}=n;let ne=0;for(let oe=0;oe<=n.list.length-1;oe+=1)ne+=v(($=n.list[oe])==null?void 0:$[K]);w.listTotalSize=ne}function Q(){w.offset=0,w.listTotalSize=0,w.virtualSize=0,w.inViewBegin=0,w.inViewEnd=0,w.renderBegin=0,w.renderEnd=0,u.clear(),ee()}function j($){re();let K=0;$.forEach(ne=>{K+=v(ne[n.itemKey])}),te(),I(w.offset-K),V()}function q($){re();let K=0;$.forEach(ne=>{K+=v(ne[n.itemKey])}),te(),I(w.offset+K),g=!0,y=!1,V()}function ee(){m.value+=1}let G;typeof ResizeObserver<"u"&&(G=new ResizeObserver($=>{var K;let ne=0;for(const oe of $){const ae=oe.target.dataset.id;if(ae){const de=v(ae);let le=0;if(oe.borderBoxSize){const he=Array.isArray(oe.borderBoxSize)?oe.borderBoxSize[0]:oe.borderBoxSize;le=n.horizontal?he.inlineSize:he.blockSize}else le=n.horizontal?oe.contentRect.width:oe.contentRect.height;ae==="client"?(k.clientSize=le,Y()):ae==="header"?k.headerSize=le:ae==="footer"?k.footerSize=le:ae==="stickyHeader"?k.stickyHeaderSize=le:ae==="stickyFooter"?k.stickyFooterSize=le:de!==le&&(_(ae,le),ne+=le-de,(K=e==null?void 0:e.itemResize)==null||K.call(e,ae,le))}}w.listTotalSize+=ne,b&&b(),(p||g)&&ne!==0&&!y&&(p=!1,g=!1,I(w.offset+ne)),y=!1}));const te=()=>{var $;let K=0;const ne=w.renderBegin;for(let oe=0;oe<ne;oe++)K+=v(($=n.list[oe])==null?void 0:$[n.itemKey]);w.virtualSize=K};onBeforeMount(()=>{n.bufferTop?w.bufferTop=n.bufferTop:w.bufferTop=n.buffer,n.bufferBottom?w.bufferBottom=n.bufferBottom:w.bufferBottom=n.buffer}),onMounted(()=>{o.value&&(o.value.addEventListener("scroll",R),G==null||G.observe(o.value)),c.value&&(G==null||G.observe(c.value)),d.value&&(G==null||G.observe(d.value)),a.value&&(G==null||G.observe(a.value)),l.value&&(G==null||G.observe(l.value)),n.start?L(n.start):n.offset&&I(n.offset)}),onBeforeUnmount(()=>{o.value&&(o.value.removeEventListener("scroll",R),G==null||G.unobserve(o.value),k.clientSize=0),c.value&&(G==null||G.unobserve(c.value),k.stickyHeaderSize=0),d.value&&(G==null||G.unobserve(d.value),k.stickyFooterSize=0),a.value&&(G==null||G.unobserve(a.value),k.headerSize=0),l.value&&(G==null||G.unobserve(l.value),k.footerSize=0)});function ce(){return w.virtualSize+W(w.renderBegin,w.inViewBegin)}function W($,K){var ne;const oe=Math.min($,K),ae=Math.max($,K);let de=0;for(let le=oe;le<ae;le+=1)de+=v((ne=n.list[le])==null?void 0:ne[n.itemKey]);return de}function U(){return w}const P=shallowRef([]);function Z($,K){const ne=w.renderBegin;w.renderBegin=$,w.renderEnd=K,$>ne?w.virtualSize+=W($,ne):w.virtualSize-=W($,ne),P.value=n.list.slice(w.renderBegin,w.renderEnd+1),te()}return watch(()=>[w.inViewBegin,w.inViewEnd,m.value],($,K)=>{if($&&K){const[ne]=$,oe=w.renderBegin;let ae=ne,de=w.inViewEnd;if(ae=Math.max(0,ae-w.bufferTop),de=Math.min(de+w.bufferBottom,n.list.length-1>0?n.list.length-1:0),n==null?void 0:n.renderControl){const{begin:le,end:he}=n.renderControl(ne,w.inViewEnd);ae=le,de=he}w.renderBegin=ae,w.renderEnd=de,ae>oe?w.virtualSize+=W(ae,oe):w.virtualSize-=W(ae,oe),P.value=n.list.slice(w.renderBegin,w.renderEnd+1)}},{immediate:!0}),watch(()=>n.list.length,()=>{if(n.list.length<=0){Q();return}re(),H(w.inViewBegin),te(),ee()},{immediate:!0}),{props:n,renderList:P,clientRefEl:o,listRefEl:s,headerRefEl:a,footerRefEl:l,stickyHeaderRefEl:c,stickyFooterRefEl:d,reactiveData:w,slotSize:k,sizesMap:u,resizeObserver:G,getReactiveData:U,getOffset:B,getSlotSize:M,reset:Q,scrollToIndex:L,manualRender:Z,scrollIntoView:A,scrollToTop:F,scrollToBottom:se,scrollToOffset:I,getItemSize:v,deleteItemSize:E,deletedList2Top:j,addedList2Top:q,getItemPosByIndex:N,forceUpdate:ee}}const VirtList=defineComponent({name:"VirtList",emits:{scroll:r=>r,toTop:r=>r,toBottom:r=>r,itemResize:(r,e)=>!0,rangeUpdate:(r,e)=>!0},props:{list:{type:Array,default:()=>[]},itemKey:{type:[String,Number],required:!0},minSize:{type:Number,default:20,required:!0},itemGap:{type:Number,default:0},renderControl:{type:Function,default:void 0},fixed:{type:Boolean,default:!1},buffer:{type:Number,default:0},bufferTop:{type:Number,default:0},bufferBottom:{type:Number,default:0},scrollDistance:{type:Number,default:0},horizontal:{type:Boolean,default:!1},start:{type:Number,default:0},offset:{type:Number,default:0},listStyle:{type:String,default:""},listClass:{type:String,default:""},itemStyle:{type:String,default:""},itemClass:{type:String,default:""},headerClass:{type:String,default:""},headerStyle:{type:String,default:""},footerClass:{type:String,default:""},footerStyle:{type:String,default:""},stickyHeaderClass:{type:String,default:""},stickyHeaderStyle:{type:String,default:""},stickyFooterClass:{type:String,default:""},stickyFooterStyle:{type:String,default:""}},setup(r,e){return useVirtList(r,{scroll:n=>{e.emit("scroll",n)},toTop:n=>{e.emit("toTop",n)},toBottom:n=>{e.emit("toBottom",n)},itemResize:(n,o)=>{e.emit("itemResize",n,o)},rangeUpdate:(n,o)=>{e.emit("rangeUpdate",n,o)}})},render(){const{renderList:r,reactiveData:e,resizeObserver:n}=this,{itemGap:o,itemKey:s,horizontal:a,listStyle:l,listClass:c,itemStyle:d,itemClass:u,headerClass:m,headerStyle:f,footerClass:p,footerStyle:g,stickyHeaderClass:y,stickyHeaderStyle:b,stickyFooterClass:k,stickyFooterStyle:w}=this.props,B=()=>{var A;return getSlot(this,"stickyHeader")?_h("div",{key:"slot-sticky-header",class:y,style:`position: sticky; z-index: 10; ${a?"left: 0":"top: 0;"} ${b}`,ref:"stickyHeaderRefEl",attrs:{"data-id":"stickyHeader"}},[(A=getSlot(this,"stickyHeader"))==null?void 0:A()]):null},M=()=>{var A;return getSlot(this,"stickyFooter")?_h("div",{key:"slot-sticky-footer",class:k,style:`position: sticky; z-index: 10; ${a?"right: 0":"bottom: 0;"} ${w}`,ref:"stickyFooterRefEl",attrs:{"data-id":"stickyFooter"}},[(A=getSlot(this,"stickyFooter"))==null?void 0:A()]):null},x=()=>{var A;return getSlot(this,"header")?_h("div",{key:"slot-header",class:m,style:f,ref:"headerRefEl",attrs:{"data-id":"header"}},[(A=getSlot(this,"header"))==null?void 0:A()]):null},v=()=>{var A;return getSlot(this,"footer")?_h("div",{key:"slot-footer",class:p,style:g,ref:"footerRefEl",attrs:{"data-id":"footer"}},[(A=getSlot(this,"footer"))==null?void 0:A()]):null},{listTotalSize:_,virtualSize:E,renderBegin:N}=e,I=o>0?`padding: ${o/2}px 0; `:"",L=()=>{var A,F;const se=[];for(let R=0;R<r.length;R+=1){const J=r[R];se.push(_hChild(ObserverItem,{key:J[s],class:u,style:`${I}${d}`,attrs:{id:J[s],resizeObserver:n}},(A=getSlot(this,"default"))==null?void 0:A({itemData:J,index:N+R})))}if(se.length===0&&getSlot(this,"empty")){const R=this.slotSize.clientSize-this.getSlotSize();se.push(_h("div",{key:`slot-empty-${R}`,style:`height: ${R}px`},[(F=getSlot(this,"empty"))==null?void 0:F()]))}const H=a?`will-change: width; min-width: ${_}px; display: flex; ${l}`:`will-change: height; min-height: ${_}px; ${l}`,V=a?`width: ${E}px; will-change: width;`:`height: ${E}px; will-change: height;`;return _h("div",{ref:"listRefEl",class:c,style:H},[_h("div",{style:V}),se])};return _h("div",{ref:"clientRefEl",class:"virt-list__client",style:"width: 100%; height: 100%; overflow: auto;",attrs:{"data-id":"client"}},[B(),x(),L(),v(),M()])}});function legacy(r){return new LanguageSupport(StreamLanguage.define(r))}function sql(r){return __vitePreload(()=>import("./index-CoBdcKs7.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]),import.meta.url).then(e=>e.sql({dialect:e[r]}))}const languages=[LanguageDescription.of({name:"C",extensions:["c","h","ino"],load(){return __vitePreload(()=>import("./index-B71Wb_qo.js"),__vite__mapDeps([10,1,2,3,4,5,6,7,8,9]),import.meta.url).then(r=>r.cpp())}}),LanguageDescription.of({name:"C++",alias:["cpp"],extensions:["cpp","c++","cc","cxx","hpp","h++","hh","hxx"],load(){return __vitePreload(()=>import("./index-B71Wb_qo.js"),__vite__mapDeps([10,1,2,3,4,5,6,7,8,9]),import.meta.url).then(r=>r.cpp())}}),LanguageDescription.of({name:"CQL",alias:["cassandra"],extensions:["cql"],load(){return sql("Cassandra")}}),LanguageDescription.of({name:"CSS",extensions:["css"],load(){return __vitePreload(()=>import("./index-3pL4yDd7.js"),__vite__mapDeps([11,1,2,3,4,5,6,7,8,9]),import.meta.url).then(r=>r.css())}}),LanguageDescription.of({name:"Go",extensions:["go"],load(){return __vitePreload(()=>import("./index-Bj0L4Za6.js"),__vite__mapDeps([12,1,2,3,4,5,6,7,8,9]),import.meta.url).then(r=>r.go())}}),LanguageDescription.of({name:"HTML",alias:["xhtml"],extensions:["html","htm","handlebars","hbs"],load(){return __vitePreload(()=>import("./index-UQjh9F23.js"),__vite__mapDeps([13,1,11,2,3,4,5,6,7,8,9,14]),import.meta.url).then(r=>r.html())}}),LanguageDescription.of({name:"Java",extensions:["java"],load(){return __vitePreload(()=>import("./index-ehJIvk1g.js"),__vite__mapDeps([15,1,2,3,4,5,6,7,8,9]),import.meta.url).then(r=>r.java())}}),LanguageDescription.of({name:"JavaScript",alias:["ecmascript","js","node"],extensions:["js","mjs","cjs"],load(){return __vitePreload(()=>import("./index-2aCpt5ux.js"),__vite__mapDeps([14,1,2,3,4,5,6,7,8,9]),import.meta.url).then(r=>r.javascript())}}),LanguageDescription.of({name:"JSON",alias:["json5"],extensions:["json","map"],load(){return __vitePreload(()=>import("./index-DT8Hmtjo.js"),__vite__mapDeps([16,1,2,3,4,5,6,7,8,9]),import.meta.url).then(r=>r.json())}}),LanguageDescription.of({name:"JSX",extensions:["jsx"],load(){return __vitePreload(()=>import("./index-2aCpt5ux.js"),__vite__mapDeps([14,1,2,3,4,5,6,7,8,9]),import.meta.url).then(r=>r.javascript({jsx:!0}))}}),LanguageDescription.of({name:"LESS",extensions:["less"],load(){return __vitePreload(()=>import("./index-DZhRMKXa.js"),__vite__mapDeps([17,11,1,2,3,4,5,6,7,8,9]),import.meta.url).then(r=>r.less())}}),LanguageDescription.of({name:"Liquid",extensions:["liquid"],load(){return __vitePreload(()=>import("./index-CWQp13jX.js"),__vite__mapDeps([18,13,1,11,2,3,4,5,6,7,8,9,14]),import.meta.url).then(r=>r.liquid())}}),LanguageDescription.of({name:"MariaDB SQL",load(){return sql("MariaSQL")}}),LanguageDescription.of({name:"Markdown",extensions:["md","markdown","mkd"],load(){return __vitePreload(()=>import("./index-DFX7lOOU.js"),__vite__mapDeps([19,13,1,11,2,3,4,5,6,7,8,9,14]),import.meta.url).then(r=>r.markdown())}}),LanguageDescription.of({name:"MS SQL",load(){return sql("MSSQL")}}),LanguageDescription.of({name:"MySQL",load(){return sql("MySQL")}}),LanguageDescription.of({name:"PHP",extensions:["php","php3","php4","php5","php7","phtml"],load(){return __vitePreload(()=>import("./index-E9SIhi8b.js"),__vite__mapDeps([20,1,13,11,2,3,4,5,6,7,8,9,14]),import.meta.url).then(r=>r.php())}}),LanguageDescription.of({name:"PLSQL",extensions:["pls"],load(){return sql("PLSQL")}}),LanguageDescription.of({name:"PostgreSQL",load(){return sql("PostgreSQL")}}),LanguageDescription.of({name:"Python",extensions:["BUILD","bzl","py","pyw"],filename:/^(BUCK|BUILD)$/,load(){return __vitePreload(()=>import("./index-DwbOYRBb.js"),__vite__mapDeps([21,1,2,3,4,5,6,7,8,9]),import.meta.url).then(r=>r.python())}}),LanguageDescription.of({name:"Rust",extensions:["rs"],load(){return __vitePreload(()=>import("./index-CcuegdXj.js"),__vite__mapDeps([22,1,2,3,4,5,6,7,8,9]),import.meta.url).then(r=>r.rust())}}),LanguageDescription.of({name:"Sass",extensions:["sass"],load(){return __vitePreload(()=>import("./index-Bh6poQ78.js"),__vite__mapDeps([23,1,11,2,3,4,5,6,7,8,9]),import.meta.url).then(r=>r.sass({indented:!0}))}}),LanguageDescription.of({name:"SCSS",extensions:["scss"],load(){return __vitePreload(()=>import("./index-Bh6poQ78.js"),__vite__mapDeps([23,1,11,2,3,4,5,6,7,8,9]),import.meta.url).then(r=>r.sass())}}),LanguageDescription.of({name:"SQL",extensions:["sql"],load(){return sql("StandardSQL")}}),LanguageDescription.of({name:"SQLite",load(){return sql("SQLite")}}),LanguageDescription.of({name:"TSX",extensions:["tsx"],load(){return __vitePreload(()=>import("./index-2aCpt5ux.js"),__vite__mapDeps([14,1,2,3,4,5,6,7,8,9]),import.meta.url).then(r=>r.javascript({jsx:!0,typescript:!0}))}}),LanguageDescription.of({name:"TypeScript",alias:["ts"],extensions:["ts","mts","cts"],load(){return __vitePreload(()=>import("./index-2aCpt5ux.js"),__vite__mapDeps([14,1,2,3,4,5,6,7,8,9]),import.meta.url).then(r=>r.javascript({typescript:!0}))}}),LanguageDescription.of({name:"WebAssembly",extensions:["wat","wast"],load(){return __vitePreload(()=>import("./index-CPX9qP5g.js"),__vite__mapDeps([24,1,2,3,4,5,6,7,8,9]),import.meta.url).then(r=>r.wast())}}),LanguageDescription.of({name:"XML",alias:["rss","wsdl","xsd"],extensions:["xml","xsl","xsd","svg"],load(){return __vitePreload(()=>import("./index-CYLSigZA.js"),__vite__mapDeps([25,1,2,3,4,5,6,7,8,9]),import.meta.url).then(r=>r.xml())}}),LanguageDescription.of({name:"YAML",alias:["yml"],extensions:["yaml","yml"],load(){return __vitePreload(()=>import("./index-CfaQeutw.js"),__vite__mapDeps([26,1,2,3,4,5,6,7,8,9]),import.meta.url).then(r=>r.yaml())}}),LanguageDescription.of({name:"APL",extensions:["dyalog","apl"],load(){return __vitePreload(()=>import("./apl-B4CMkyY2.js"),[],import.meta.url).then(r=>legacy(r.apl))}}),LanguageDescription.of({name:"PGP",alias:["asciiarmor"],extensions:["asc","pgp","sig"],load(){return __vitePreload(()=>import("./asciiarmor-Df11BRmG.js"),[],import.meta.url).then(r=>legacy(r.asciiArmor))}}),LanguageDescription.of({name:"ASN.1",extensions:["asn","asn1"],load(){return __vitePreload(()=>import("./asn1-CGOzndHr.js"),[],import.meta.url).then(r=>legacy(r.asn1({})))}}),LanguageDescription.of({name:"Asterisk",filename:/^extensions\.conf$/i,load(){return __vitePreload(()=>import("./asterisk-B-8jnY81.js"),[],import.meta.url).then(r=>legacy(r.asterisk))}}),LanguageDescription.of({name:"Brainfuck",extensions:["b","bf"],load(){return __vitePreload(()=>import("./brainfuck-C4LP7Hcl.js"),[],import.meta.url).then(r=>legacy(r.brainfuck))}}),LanguageDescription.of({name:"Cobol",extensions:["cob","cpy"],load(){return __vitePreload(()=>import("./cobol-_hGpxIKP.js"),[],import.meta.url).then(r=>legacy(r.cobol))}}),LanguageDescription.of({name:"C#",alias:["csharp","cs"],extensions:["cs"],load(){return __vitePreload(()=>import("./clike-wD8xDpL-.js"),[],import.meta.url).then(r=>legacy(r.csharp))}}),LanguageDescription.of({name:"Clojure",extensions:["clj","cljc","cljx"],load(){return __vitePreload(()=>import("./clojure-BMjYHr_A.js"),[],import.meta.url).then(r=>legacy(r.clojure))}}),LanguageDescription.of({name:"ClojureScript",extensions:["cljs"],load(){return __vitePreload(()=>import("./clojure-BMjYHr_A.js"),[],import.meta.url).then(r=>legacy(r.clojure))}}),LanguageDescription.of({name:"Closure Stylesheets (GSS)",extensions:["gss"],load(){return __vitePreload(()=>import("./css-BnMrqG3P.js"),[],import.meta.url).then(r=>legacy(r.gss))}}),LanguageDescription.of({name:"CMake",extensions:["cmake","cmake.in"],filename:/^CMakeLists\.txt$/,load(){return __vitePreload(()=>import("./cmake-BQqOBYOt.js"),[],import.meta.url).then(r=>legacy(r.cmake))}}),LanguageDescription.of({name:"CoffeeScript",alias:["coffee","coffee-script"],extensions:["coffee"],load(){return __vitePreload(()=>import("./coffeescript-S37ZYGWr.js"),[],import.meta.url).then(r=>legacy(r.coffeeScript))}}),LanguageDescription.of({name:"Common Lisp",alias:["lisp"],extensions:["cl","lisp","el"],load(){return __vitePreload(()=>import("./commonlisp-DBKNyK5s.js"),[],import.meta.url).then(r=>legacy(r.commonLisp))}}),LanguageDescription.of({name:"Cypher",extensions:["cyp","cypher"],load(){return __vitePreload(()=>import("./cypher-C_CwsFkJ.js"),[],import.meta.url).then(r=>legacy(r.cypher))}}),LanguageDescription.of({name:"Cython",extensions:["pyx","pxd","pxi"],load(){return __vitePreload(()=>import("./python-BuPzkPfP.js"),[],import.meta.url).then(r=>legacy(r.cython))}}),LanguageDescription.of({name:"Crystal",extensions:["cr"],load(){return __vitePreload(()=>import("./crystal-SjHAIU92.js"),[],import.meta.url).then(r=>legacy(r.crystal))}}),LanguageDescription.of({name:"D",extensions:["d"],load(){return __vitePreload(()=>import("./d-pRatUO7H.js"),[],import.meta.url).then(r=>legacy(r.d))}}),LanguageDescription.of({name:"Dart",extensions:["dart"],load(){return __vitePreload(()=>import("./clike-wD8xDpL-.js"),[],import.meta.url).then(r=>legacy(r.dart))}}),LanguageDescription.of({name:"diff",extensions:["diff","patch"],load(){return __vitePreload(()=>import("./diff-DbItnlRl.js"),[],import.meta.url).then(r=>legacy(r.diff))}}),LanguageDescription.of({name:"Dockerfile",filename:/^Dockerfile$/,load(){return __vitePreload(()=>import("./dockerfile-BuNIbK2j.js"),__vite__mapDeps([27,28]),import.meta.url).then(r=>legacy(r.dockerFile))}}),LanguageDescription.of({name:"DTD",extensions:["dtd"],load(){return __vitePreload(()=>import("./dtd-DF_7sFjM.js"),[],import.meta.url).then(r=>legacy(r.dtd))}}),LanguageDescription.of({name:"Dylan",extensions:["dylan","dyl","intr"],load(){return __vitePreload(()=>import("./dylan-DwRh75JA.js"),[],import.meta.url).then(r=>legacy(r.dylan))}}),LanguageDescription.of({name:"EBNF",load(){return __vitePreload(()=>import("./ebnf-CDyGwa7X.js"),[],import.meta.url).then(r=>legacy(r.ebnf))}}),LanguageDescription.of({name:"ECL",extensions:["ecl"],load(){return __vitePreload(()=>import("./ecl-Cabwm37j.js"),[],import.meta.url).then(r=>legacy(r.ecl))}}),LanguageDescription.of({name:"edn",extensions:["edn"],load(){return __vitePreload(()=>import("./clojure-BMjYHr_A.js"),[],import.meta.url).then(r=>legacy(r.clojure))}}),LanguageDescription.of({name:"Eiffel",extensions:["e"],load(){return __vitePreload(()=>import("./eiffel-CnydiIhH.js"),[],import.meta.url).then(r=>legacy(r.eiffel))}}),LanguageDescription.of({name:"Elm",extensions:["elm"],load(){return __vitePreload(()=>import("./elm-vLlmbW-K.js"),[],import.meta.url).then(r=>legacy(r.elm))}}),LanguageDescription.of({name:"Erlang",extensions:["erl"],load(){return __vitePreload(()=>import("./erlang-BNw1qcRV.js"),[],import.meta.url).then(r=>legacy(r.erlang))}}),LanguageDescription.of({name:"Esper",load(){return __vitePreload(()=>import("./sql-C4g8LzGK.js"),[],import.meta.url).then(r=>legacy(r.esper))}}),LanguageDescription.of({name:"Factor",extensions:["factor"],load(){return __vitePreload(()=>import("./factor-D8pE9siL.js"),__vite__mapDeps([29,28]),import.meta.url).then(r=>legacy(r.factor))}}),LanguageDescription.of({name:"FCL",load(){return __vitePreload(()=>import("./fcl-Kvtd6kyn.js"),[],import.meta.url).then(r=>legacy(r.fcl))}}),LanguageDescription.of({name:"Forth",extensions:["forth","fth","4th"],load(){return __vitePreload(()=>import("./forth-Ffai-XNe.js"),[],import.meta.url).then(r=>legacy(r.forth))}}),LanguageDescription.of({name:"Fortran",extensions:["f","for","f77","f90","f95"],load(){return __vitePreload(()=>import("./fortran-DYz_wnZ1.js"),[],import.meta.url).then(r=>legacy(r.fortran))}}),LanguageDescription.of({name:"F#",alias:["fsharp"],extensions:["fs"],load(){return __vitePreload(()=>import("./mllike-C_8OmSiT.js"),[],import.meta.url).then(r=>legacy(r.fSharp))}}),LanguageDescription.of({name:"Gas",extensions:["s"],load(){return __vitePreload(()=>import("./gas-Bneqetm1.js"),[],import.meta.url).then(r=>legacy(r.gas))}}),LanguageDescription.of({name:"Gherkin",extensions:["feature"],load(){return __vitePreload(()=>import("./gherkin-heZmZLOM.js"),[],import.meta.url).then(r=>legacy(r.gherkin))}}),LanguageDescription.of({name:"Groovy",extensions:["groovy","gradle"],filename:/^Jenkinsfile$/,load(){return __vitePreload(()=>import("./groovy-D9Dt4D0W.js"),[],import.meta.url).then(r=>legacy(r.groovy))}}),LanguageDescription.of({name:"Haskell",extensions:["hs"],load(){return __vitePreload(()=>import("./haskell-BWDZoCOh.js"),[],import.meta.url).then(r=>legacy(r.haskell))}}),LanguageDescription.of({name:"Haxe",extensions:["hx"],load(){return __vitePreload(()=>import("./haxe-pv4rovob.js"),[],import.meta.url).then(r=>legacy(r.haxe))}}),LanguageDescription.of({name:"HXML",extensions:["hxml"],load(){return __vitePreload(()=>import("./haxe-pv4rovob.js"),[],import.meta.url).then(r=>legacy(r.hxml))}}),LanguageDescription.of({name:"HTTP",load(){return __vitePreload(()=>import("./http-DBlCnlav.js"),[],import.meta.url).then(r=>legacy(r.http))}}),LanguageDescription.of({name:"IDL",extensions:["pro"],load(){return __vitePreload(()=>import("./idl-BEugSyMb.js"),[],import.meta.url).then(r=>legacy(r.idl))}}),LanguageDescription.of({name:"JSON-LD",alias:["jsonld"],extensions:["jsonld"],load(){return __vitePreload(()=>import("./javascript-iSgyE4tI.js"),[],import.meta.url).then(r=>legacy(r.jsonld))}}),LanguageDescription.of({name:"Jinja2",extensions:["j2","jinja","jinja2"],load(){return __vitePreload(()=>import("./jinja2-C4DGRd-O.js"),[],import.meta.url).then(r=>legacy(r.jinja2))}}),LanguageDescription.of({name:"Julia",extensions:["jl"],load(){return __vitePreload(()=>import("./julia-DuME0IfC.js"),[],import.meta.url).then(r=>legacy(r.julia))}}),LanguageDescription.of({name:"Kotlin",extensions:["kt","kts"],load(){return __vitePreload(()=>import("./clike-wD8xDpL-.js"),[],import.meta.url).then(r=>legacy(r.kotlin))}}),LanguageDescription.of({name:"LiveScript",alias:["ls"],extensions:["ls"],load(){return __vitePreload(()=>import("./livescript-BwQOo05w.js"),[],import.meta.url).then(r=>legacy(r.liveScript))}}),LanguageDescription.of({name:"Lua",extensions:["lua"],load(){return __vitePreload(()=>import("./lua-BgMRiT3U.js"),[],import.meta.url).then(r=>legacy(r.lua))}}),LanguageDescription.of({name:"mIRC",extensions:["mrc"],load(){return __vitePreload(()=>import("./mirc-0pArz5Cm.js"),[],import.meta.url).then(r=>legacy(r.mirc))}}),LanguageDescription.of({name:"Mathematica",extensions:["m","nb","wl","wls"],load(){return __vitePreload(()=>import("./mathematica-DTrFuWx2.js"),[],import.meta.url).then(r=>legacy(r.mathematica))}}),LanguageDescription.of({name:"Modelica",extensions:["mo"],load(){return __vitePreload(()=>import("./modelica-Dc1JOy9r.js"),[],import.meta.url).then(r=>legacy(r.modelica))}}),LanguageDescription.of({name:"MUMPS",extensions:["mps"],load(){return __vitePreload(()=>import("./mumps-BT43cFF4.js"),[],import.meta.url).then(r=>legacy(r.mumps))}}),LanguageDescription.of({name:"Mbox",extensions:["mbox"],load(){return __vitePreload(()=>import("./mbox-CNhZ1qSd.js"),[],import.meta.url).then(r=>legacy(r.mbox))}}),LanguageDescription.of({name:"Nginx",filename:/nginx.*\.conf$/i,load(){return __vitePreload(()=>import("./nginx-DdIZxoE0.js"),[],import.meta.url).then(r=>legacy(r.nginx))}}),LanguageDescription.of({name:"NSIS",extensions:["nsh","nsi"],load(){return __vitePreload(()=>import("./nsis-CEAdamBV.js"),__vite__mapDeps([30,28]),import.meta.url).then(r=>legacy(r.nsis))}}),LanguageDescription.of({name:"NTriples",extensions:["nt","nq"],load(){return __vitePreload(()=>import("./ntriples-BfvgReVJ.js"),[],import.meta.url).then(r=>legacy(r.ntriples))}}),LanguageDescription.of({name:"Objective-C",alias:["objective-c","objc"],extensions:["m"],load(){return __vitePreload(()=>import("./clike-wD8xDpL-.js"),[],import.meta.url).then(r=>legacy(r.objectiveC))}}),LanguageDescription.of({name:"Objective-C++",alias:["objective-c++","objc++"],extensions:["mm"],load(){return __vitePreload(()=>import("./clike-wD8xDpL-.js"),[],import.meta.url).then(r=>legacy(r.objectiveCpp))}}),LanguageDescription.of({name:"OCaml",extensions:["ml","mli","mll","mly"],load(){return __vitePreload(()=>import("./mllike-C_8OmSiT.js"),[],import.meta.url).then(r=>legacy(r.oCaml))}}),LanguageDescription.of({name:"Octave",extensions:["m"],load(){return __vitePreload(()=>import("./octave-Ck1zUtKM.js"),[],import.meta.url).then(r=>legacy(r.octave))}}),LanguageDescription.of({name:"Oz",extensions:["oz"],load(){return __vitePreload(()=>import("./oz-BzwKVEFT.js"),[],import.meta.url).then(r=>legacy(r.oz))}}),LanguageDescription.of({name:"Pascal",extensions:["p","pas"],load(){return __vitePreload(()=>import("./pascal-B1wCu0_E.js"),[],import.meta.url).then(r=>legacy(r.pascal))}}),LanguageDescription.of({name:"Perl",extensions:["pl","pm"],load(){return __vitePreload(()=>import("./perl-CdXCOZ3F.js"),[],import.meta.url).then(r=>legacy(r.perl))}}),LanguageDescription.of({name:"Pig",extensions:["pig"],load(){return __vitePreload(()=>import("./pig-DHho59qG.js"),[],import.meta.url).then(r=>legacy(r.pig))}}),LanguageDescription.of({name:"PowerShell",extensions:["ps1","psd1","psm1"],load(){return __vitePreload(()=>import("./powershell-CFHJl5sT.js"),[],import.meta.url).then(r=>legacy(r.powerShell))}}),LanguageDescription.of({name:"Properties files",alias:["ini","properties"],extensions:["properties","ini","in"],load(){return __vitePreload(()=>import("./properties-C78fOPTZ.js"),[],import.meta.url).then(r=>legacy(r.properties))}}),LanguageDescription.of({name:"ProtoBuf",extensions:["proto"],load(){return __vitePreload(()=>import("./protobuf-ChK-085T.js"),[],import.meta.url).then(r=>legacy(r.protobuf))}}),LanguageDescription.of({name:"Pug",alias:["jade"],extensions:["pug","jade"],load(){return __vitePreload(()=>import("./pug-BmUsPMDj.js"),__vite__mapDeps([31,32]),import.meta.url).then(r=>legacy(r.pug))}}),LanguageDescription.of({name:"Puppet",extensions:["pp"],load(){return __vitePreload(()=>import("./puppet-DMA9R1ak.js"),[],import.meta.url).then(r=>legacy(r.puppet))}}),LanguageDescription.of({name:"Q",extensions:["q"],load(){return __vitePreload(()=>import("./q-ZnEupP5q.js"),[],import.meta.url).then(r=>legacy(r.q))}}),LanguageDescription.of({name:"R",alias:["rscript"],extensions:["r","R"],load(){return __vitePreload(()=>import("./r-DUYO_cvP.js"),[],import.meta.url).then(r=>legacy(r.r))}}),LanguageDescription.of({name:"RPM Changes",load(){return __vitePreload(()=>import("./rpm-CTu-6PCP.js"),[],import.meta.url).then(r=>legacy(r.rpmChanges))}}),LanguageDescription.of({name:"RPM Spec",extensions:["spec"],load(){return __vitePreload(()=>import("./rpm-CTu-6PCP.js"),[],import.meta.url).then(r=>legacy(r.rpmSpec))}}),LanguageDescription.of({name:"Ruby",alias:["jruby","macruby","rake","rb","rbx"],extensions:["rb"],filename:/^(Gemfile|Rakefile)$/,load(){return __vitePreload(()=>import("./ruby-B2Rjki9n.js"),[],import.meta.url).then(r=>legacy(r.ruby))}}),LanguageDescription.of({name:"SAS",extensions:["sas"],load(){return __vitePreload(()=>import("./sas-B4kiWyti.js"),[],import.meta.url).then(r=>legacy(r.sas))}}),LanguageDescription.of({name:"Scala",extensions:["scala"],load(){return __vitePreload(()=>import("./clike-wD8xDpL-.js"),[],import.meta.url).then(r=>legacy(r.scala))}}),LanguageDescription.of({name:"Scheme",extensions:["scm","ss"],load(){return __vitePreload(()=>import("./scheme-w3NHGvyK.js"),[],import.meta.url).then(r=>legacy(r.scheme))}}),LanguageDescription.of({name:"Shell",alias:["bash","sh","zsh"],extensions:["sh","ksh","bash"],filename:/^PKGBUILD$/,load(){return __vitePreload(()=>import("./shell-CjFT_Tl9.js"),[],import.meta.url).then(r=>legacy(r.shell))}}),LanguageDescription.of({name:"Sieve",extensions:["siv","sieve"],load(){return __vitePreload(()=>import("./sieve-C3Gn_uJK.js"),[],import.meta.url).then(r=>legacy(r.sieve))}}),LanguageDescription.of({name:"Smalltalk",extensions:["st"],load(){return __vitePreload(()=>import("./smalltalk-CnHTOXQT.js"),[],import.meta.url).then(r=>legacy(r.smalltalk))}}),LanguageDescription.of({name:"Solr",load(){return __vitePreload(()=>import("./solr-DehyRSwq.js"),[],import.meta.url).then(r=>legacy(r.solr))}}),LanguageDescription.of({name:"SML",extensions:["sml","sig","fun","smackspec"],load(){return __vitePreload(()=>import("./mllike-C_8OmSiT.js"),[],import.meta.url).then(r=>legacy(r.sml))}}),LanguageDescription.of({name:"SPARQL",alias:["sparul"],extensions:["rq","sparql"],load(){return __vitePreload(()=>import("./sparql-DkYu6x3z.js"),[],import.meta.url).then(r=>legacy(r.sparql))}}),LanguageDescription.of({name:"Spreadsheet",alias:["excel","formula"],load(){return __vitePreload(()=>import("./spreadsheet-BCZA_wO0.js"),[],import.meta.url).then(r=>legacy(r.spreadsheet))}}),LanguageDescription.of({name:"Squirrel",extensions:["nut"],load(){return __vitePreload(()=>import("./clike-wD8xDpL-.js"),[],import.meta.url).then(r=>legacy(r.squirrel))}}),LanguageDescription.of({name:"Stylus",extensions:["styl"],load(){return __vitePreload(()=>import("./stylus-BdAi1jBa.js"),[],import.meta.url).then(r=>legacy(r.stylus))}}),LanguageDescription.of({name:"Swift",extensions:["swift"],load(){return __vitePreload(()=>import("./swift-BzpIVaGY.js"),[],import.meta.url).then(r=>legacy(r.swift))}}),LanguageDescription.of({name:"sTeX",load(){return __vitePreload(()=>import("./stex-C3f8Ysf7.js"),[],import.meta.url).then(r=>legacy(r.stex))}}),LanguageDescription.of({name:"LaTeX",alias:["tex"],extensions:["text","ltx","tex"],load(){return __vitePreload(()=>import("./stex-C3f8Ysf7.js"),[],import.meta.url).then(r=>legacy(r.stex))}}),LanguageDescription.of({name:"SystemVerilog",extensions:["v","sv","svh"],load(){return __vitePreload(()=>import("./verilog-C6RDOZhf.js"),[],import.meta.url).then(r=>legacy(r.verilog))}}),LanguageDescription.of({name:"Tcl",extensions:["tcl"],load(){return __vitePreload(()=>import("./tcl-BOR0Rekm.js"),[],import.meta.url).then(r=>legacy(r.tcl))}}),LanguageDescription.of({name:"Textile",extensions:["textile"],load(){return __vitePreload(()=>import("./textile-CnDTJFAw.js"),[],import.meta.url).then(r=>legacy(r.textile))}}),LanguageDescription.of({name:"TiddlyWiki",load(){return __vitePreload(()=>import("./tiddlywiki-DO-Gjzrf.js"),[],import.meta.url).then(r=>legacy(r.tiddlyWiki))}}),LanguageDescription.of({name:"Tiki wiki",load(){return __vitePreload(()=>import("./tiki-DGYXhP31.js"),[],import.meta.url).then(r=>legacy(r.tiki))}}),LanguageDescription.of({name:"TOML",extensions:["toml"],load(){return __vitePreload(()=>import("./toml-BXUEaScT.js"),[],import.meta.url).then(r=>legacy(r.toml))}}),LanguageDescription.of({name:"Troff",extensions:["1","2","3","4","5","6","7","8","9"],load(){return __vitePreload(()=>import("./troff-wAsdV37c.js"),[],import.meta.url).then(r=>legacy(r.troff))}}),LanguageDescription.of({name:"TTCN",extensions:["ttcn","ttcn3","ttcnpp"],load(){return __vitePreload(()=>import("./ttcn-BSZjDM4v.js"),[],import.meta.url).then(r=>legacy(r.ttcn))}}),LanguageDescription.of({name:"TTCN_CFG",extensions:["cfg"],load(){return __vitePreload(()=>import("./ttcn-cfg-BIkV9KBc.js"),[],import.meta.url).then(r=>legacy(r.ttcnCfg))}}),LanguageDescription.of({name:"Turtle",extensions:["ttl"],load(){return __vitePreload(()=>import("./turtle-B1tBg_DP.js"),[],import.meta.url).then(r=>legacy(r.turtle))}}),LanguageDescription.of({name:"Web IDL",extensions:["webidl"],load(){return __vitePreload(()=>import("./webidl-ZXfAyPTL.js"),[],import.meta.url).then(r=>legacy(r.webIDL))}}),LanguageDescription.of({name:"VB.NET",extensions:["vb"],load(){return __vitePreload(()=>import("./vb-CmGdzxic.js"),[],import.meta.url).then(r=>legacy(r.vb))}}),LanguageDescription.of({name:"VBScript",extensions:["vbs"],load(){return __vitePreload(()=>import("./vbscript-BuJXcnF6.js"),[],import.meta.url).then(r=>legacy(r.vbScript))}}),LanguageDescription.of({name:"Velocity",extensions:["vtl"],load(){return __vitePreload(()=>import("./velocity-Dq6fSHCB.js"),[],import.meta.url).then(r=>legacy(r.velocity))}}),LanguageDescription.of({name:"Verilog",extensions:["v"],load(){return __vitePreload(()=>import("./verilog-C6RDOZhf.js"),[],import.meta.url).then(r=>legacy(r.verilog))}}),LanguageDescription.of({name:"VHDL",extensions:["vhd","vhdl"],load(){return __vitePreload(()=>import("./vhdl-lSbBsy5d.js"),[],import.meta.url).then(r=>legacy(r.vhdl))}}),LanguageDescription.of({name:"XQuery",extensions:["xy","xquery"],load(){return __vitePreload(()=>import("./xquery-WRlm2TX8.js"),[],import.meta.url).then(r=>legacy(r.xQuery))}}),LanguageDescription.of({name:"Yacas",extensions:["ys"],load(){return __vitePreload(()=>import("./yacas-BJ4BC0dw.js"),[],import.meta.url).then(r=>legacy(r.yacas))}}),LanguageDescription.of({name:"Z80",extensions:["z80"],load(){return __vitePreload(()=>import("./z80-Hz9HOZM7.js"),[],import.meta.url).then(r=>legacy(r.z80))}}),LanguageDescription.of({name:"MscGen",extensions:["mscgen","mscin","msc"],load(){return __vitePreload(()=>import("./mscgen-BA5vi2Kp.js"),[],import.meta.url).then(r=>legacy(r.mscgen))}}),LanguageDescription.of({name:"X\xF9",extensions:["xu"],load(){return __vitePreload(()=>import("./mscgen-BA5vi2Kp.js"),[],import.meta.url).then(r=>legacy(r.xu))}}),LanguageDescription.of({name:"MsGenny",extensions:["msgenny"],load(){return __vitePreload(()=>import("./mscgen-BA5vi2Kp.js"),[],import.meta.url).then(r=>legacy(r.msgenny))}}),LanguageDescription.of({name:"Vue",extensions:["vue"],load(){return __vitePreload(()=>import("./index-CRcCKETb.js"),__vite__mapDeps([33,13,1,11,2,3,4,5,6,7,8,9,14]),import.meta.url).then(r=>r.vue())}}),LanguageDescription.of({name:"Angular Template",load(){return __vitePreload(()=>import("./index-CiQB8x9P.js"),__vite__mapDeps([34,13,1,11,2,3,4,5,6,7,8,9,14]),import.meta.url).then(r=>r.angular())}})],mkContentChangePlugin=(r,e)=>EditorView.updateListener.of(n=>{if(!e()||!n.docChanged)return;const o=n.startState.doc.toString(),s=n.state.doc.toString();r(s,o)}),updateHighlightTermsEffect=StateEffect.define(),highlightMark=Decoration.mark({class:"highlight-keep"}),highlighted=StateField.define({create:()=>Decoration.none,update:(r,e)=>{for(const n of e.effects)if(n.is(updateHighlightTermsEffect)){r=r.update({filter:()=>!1}),r=r.update({add:n.value.ranges.map(({from:o,to:s})=>highlightMark.range(o,s))});break}return r=r.map(e.changes),r},provide:r=>EditorView.decorations.from(r)}),updateHighlightTerms=(r,e)=>{let n=[];for(const{from:s,to:a}of e.visibleRanges){let l;const c=e.state.doc.sliceString(s,a).toLowerCase();for(const d of r)for(l=-1;(l=c.indexOf(d,l+1))!=-1;)n.push({from:s+l,to:s+l+d.length})}n=n.sort((s,a)=>s.from-a.from);const o=[];return e.state.field(highlighted,!1)||o.push(StateEffect.appendConfig.of(highlighted)),o.push(updateHighlightTermsEffect.of({ranges:n})),e.dispatch({effects:o}),!0},base00="#40464a",base01="#DDDDDD",base02="#B9D2FF",base03="#b0b0b0",base05="#e0e0e0",base06="#808080",base07="#000000",base08="#A54543",base09="#fc6d24",base0A="#fda331",base0B="#8abeb7",base0C="#b5bd68",base0D="#6fb3d2",base0E="#cc99cc",base0F="#6987AF",invalid=base09,darkBackground="#292d30",highlightBackground=base02+"30",tooltipBackground=base01,selection=base00,cursor=base01,basicDarkTheme=EditorView.theme({"&":{color:base01,backgroundColor:"transparent"},".cm-content":{caretColor:cursor},".cm-cursor, .cm-dropCursor":{borderLeftColor:cursor},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:selection},".cm-panels":{backgroundColor:darkBackground,color:base03},".cm-panels.cm-panels-top":{borderBottom:"2px solid black"},".cm-panels.cm-panels-bottom":{borderTop:"2px solid black"},".cm-searchMatch":{backgroundColor:base02,outline:`1px solid ${base03}`,color:base07},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:base05,color:base07},".cm-activeLine":{backgroundColor:"transparent"},".cm-selectionMatch":{backgroundColor:highlightBackground},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{outline:`1px solid ${base03}`},"&.cm-focused .cm-matchingBracket":{backgroundColor:base02,color:base07},".cm-gutters":{borderRight:"1px solid #ffffff10",color:base06,backgroundColor:darkBackground},".cm-activeLineGutter":{backgroundColor:highlightBackground},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:base02},".cm-tooltip":{border:"none",backgroundColor:tooltipBackground},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:tooltipBackground,borderBottomColor:tooltipBackground},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{backgroundColor:highlightBackground,color:base03}}},{dark:!0}),basicDarkHighlightStyle=HighlightStyle.define([{tag:tags.keyword,color:base0A},{tag:[tags.name,tags.deleted,tags.character,tags.propertyName,tags.macroName],color:base0C},{tag:[tags.variableName],color:base0D},{tag:[tags.function(tags.variableName)],color:base0A},{tag:[tags.labelName],color:base09},{tag:[tags.color,tags.constant(tags.name),tags.standard(tags.name)],color:base0A},{tag:[tags.definition(tags.name),tags.separator],color:base0E},{tag:[tags.brace],color:base0E},{tag:[tags.annotation],color:invalid},{tag:[tags.number,tags.changed,tags.annotation,tags.modifier,tags.self,tags.namespace],color:base0A},{tag:[tags.typeName,tags.className],color:base0D},{tag:[tags.operator,tags.operatorKeyword],color:base0E},{tag:[tags.tagName],color:base0A},{tag:[tags.squareBracket],color:base0E},{tag:[tags.angleBracket],color:base0E},{tag:[tags.attributeName],color:base0D},{tag:[tags.regexp],color:base0A},{tag:[tags.quote],color:base01},{tag:[tags.string],color:base0C},{tag:tags.link,color:base0F,textDecoration:"underline",textUnderlinePosition:"under"},{tag:[tags.url,tags.escape,tags.special(tags.string)],color:base0B},{tag:[tags.meta],color:base08},{tag:[tags.comment],color:base06,fontStyle:"italic"},{tag:tags.monospace,color:base01},{tag:tags.strong,fontWeight:"bold",color:base0A},{tag:tags.emphasis,fontStyle:"italic",color:base0D},{tag:tags.strikethrough,textDecoration:"line-through"},{tag:tags.heading,fontWeight:"bold",color:base01},{tag:tags.special(tags.heading1),fontWeight:"bold",color:base01},{tag:tags.heading1,fontWeight:"bold",color:base01},{tag:[tags.heading2,tags.heading3,tags.heading4],fontWeight:"bold",color:base01},{tag:[tags.heading5,tags.heading6],color:base01},{tag:[tags.atom,tags.bool,tags.special(tags.variableName)],color:base0B},{tag:[tags.processingInstruction,tags.inserted],color:base0B},{tag:[tags.contentSeparator],color:base0D},{tag:tags.invalid,color:base02,borderBottom:`1px dotted ${invalid}`}]),basicDark=[basicDarkTheme,syntaxHighlighting(basicDarkHighlightStyle)],config={name:"basicLight",dark:!1,background:"transparent",foreground:"#24292f",selection:"var(--selection-bg-color)",cursor:"#24292f",dropdownBackground:"#fff",dropdownBorder:"#e1e4e8",activeLine:"#c6c6c622",matchingBracket:"#34d05840",keyword:"#cf222e",storage:"#d73a49",variable:"#24292f",parameter:"#24292f",function:"#005cc5",string:"#0a3069",constant:"#0550ae",type:"#005cc5",class:"#cf222e",number:"#005cc5",comment:"#929ca6",heading:"#005cc5",invalid:"#cb2431",regexp:"#032f62"},basicLightTheme=EditorView.theme({"&":{color:config.foreground,backgroundColor:config.background},".cm-content":{caretColor:config.cursor},".cm-cursor, .cm-dropCursor":{borderLeftColor:config.cursor},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:config.selection},".cm-panels":{backgroundColor:config.dropdownBackground,color:config.foreground},".cm-panels.cm-panels-top":{borderBottom:"2px solid black"},".cm-panels.cm-panels-bottom":{borderTop:"2px solid black"},".cm-searchMatch":{backgroundColor:config.dropdownBackground,outline:`1px solid ${config.dropdownBorder}`},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:config.selection},".cm-activeLine":{backgroundColor:config.activeLine},".cm-selectionMatch":{backgroundColor:config.selection},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{backgroundColor:config.matchingBracket,outline:"none"},".cm-gutters":{backgroundColor:config.background,color:config.foreground,border:"none"},".cm-activeLineGutter":{backgroundColor:config.background},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:config.foreground},".cm-tooltip":{border:`1px solid ${config.dropdownBorder}`,backgroundColor:config.dropdownBackground,color:config.foreground},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:config.foreground,borderBottomColor:config.foreground},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{background:config.selection,color:config.foreground}}},{dark:config.dark}),basicLightSyntaxTheme=HighlightStyle.define([{tag:tags.keyword,color:config.keyword},{tag:[tags.name,tags.deleted,tags.character,tags.macroName],color:config.variable},{tag:[tags.propertyName],color:config.function},{tag:[tags.processingInstruction,tags.string,tags.inserted,tags.special(tags.string)],color:config.string},{tag:[tags.function(tags.variableName),tags.labelName],color:config.function},{tag:[tags.color,tags.constant(tags.name),tags.standard(tags.name)],color:config.constant},{tag:[tags.definition(tags.name),tags.separator],color:config.variable},{tag:[tags.className],color:config.class},{tag:[tags.number,tags.changed,tags.annotation,tags.modifier,tags.self,tags.namespace],color:config.number},{tag:[tags.typeName],color:config.type,fontStyle:config.type},{tag:[tags.operator,tags.operatorKeyword],color:config.keyword},{tag:[tags.url,tags.escape,tags.regexp,tags.link],color:config.regexp},{tag:[tags.meta,tags.comment],color:config.comment,fontStyle:"italic"},{tag:tags.strong,fontWeight:"bold"},{tag:tags.emphasis,fontStyle:"italic"},{tag:tags.link,textDecoration:"underline"},{tag:tags.heading,fontWeight:"bold",color:config.heading},{tag:[tags.atom,tags.bool,tags.special(tags.variableName)],color:config.variable},{tag:tags.invalid,color:config.invalid},{tag:tags.strikethrough,textDecoration:"line-through"}]),basicLight=[basicLightTheme,syntaxHighlighting(basicLightSyntaxTheme)],_sfc_main$1t=defineComponent({__name:"CodeMirror",props:mergeModels({theme:{},readonly:{type:Boolean},lang:{},extensionsBuilder:{type:Function},highlightTerms:{},onSrcChanged:{type:Function},keymap:{}},{src:{},srcModifiers:{}}),emits:["update:src"],setup(r,{expose:e}){const n=r;e({getEditorView:()=>s,getWrapperDom:()=>a.value});const o=useModel(r,"src");let s=null;const a=ref(null),l=new Compartment,c=new Compartment,d=new Compartment,u=ThemeContext.useContext(),m={light:basicLight,dark:basicDark};watch(o,()=>{if(s){if(o.value!=s.state.doc.toString()){const b=s.state.selection.toJSON();s.dispatch({changes:{from:0,to:s.state.doc.length,insert:o.value},selection:EditorSelection.fromJSON(b)})}updateHighlightTerms(n.highlightTerms??[],s)}}),watch(()=>n.highlightTerms,()=>{s&&updateHighlightTerms(n.highlightTerms??[],s)});const f=async b=>{if(!s)return;if(b==""||b=="unknown"){s.dispatch({effects:l.reconfigure([])});return}const k=await LanguageDescription.matchLanguageName(languages,b,!0);if(!k)return;const w=await k.load();s.dispatch({effects:l.reconfigure([w])})};watch(()=>n.lang,f);const p=b=>{if(!s)return;const k=b??(u==null?void 0:u.theme.value)??"dark",w=m[k];w&&s.dispatch({effects:c.reconfigure([w])})};watch(()=>n.theme,p);const g=b=>{if(!s)return;const k=Object.values(b??{});s.dispatch({effects:d.reconfigure(keymap.of(k))})};watch(()=>n.keymap,g);const y=()=>{var k;const b=((k=n.extensionsBuilder)==null?void 0:k.call(n))??[];return n.readonly?[l.of([]),c.of([]),EditorState.readOnly.of(!0),...b]:[minimalSetup,l.of([]),c.of([]),d.of([]),EditorState.readOnly.of(!1),mkContentChangePlugin((w,B)=>{n.onSrcChanged?n.onSrcChanged(w,B):o.value=w},()=>!0),...b]};return onMounted(()=>{a.value&&(s=new EditorView({doc:o.value??"",extensions:y(),parent:a.value}),f(n.lang??""),p(n.theme),g(n.keymap??{}))}),onUnmounted(()=>{setTimeout(()=>{s&&s.destroy()},1e3)}),(b,k)=>(openBlock(),createElementBlock("div",{class:"code-mirror-wrapper",ref_key:"$wrapper",ref:a},null,512))}}),_sfc_main$1s=defineComponent({__name:"CodeContent",props:{blockTree:{},itemId:{},block:{},readonly:{type:Boolean}},setup(r){const e=r,{blockEditor:n}=BlocksContext.useContext(),o=useTaskQueue(),s=ref(null),a=ref(null),{codemirrorKeymap:l}=KeymapContext.useContext(),c=()=>e.readonly?[]:[indentOnInput(),bracketMatching(),closeBrackets()],d=u=>{const m=e.block.id,f=[BLOCK_CONTENT_TYPES.CODE,u,e.block.content[2]];o.addTask(()=>{n.changeBlockContent({blockId:m,content:f})},{type:"updateBlockContent"+m,delay:500,debounce:!0})};return watch(()=>e.block.content,u=>{u[0]===BLOCK_CONTENT_TYPES.CODE&&(s.value=u[1])},{immediate:!0}),onMounted(()=>{var u,m;if(e.itemId){const f=(u=a.value)==null?void 0:u.getEditorView();f&&((m=e.blockTree)==null||m.registerEditorView(e.itemId,f))}}),onUnmounted(()=>{var u,m;if(e.itemId){const f=(u=a.value)==null?void 0:u.getEditorView();f&&((m=e.blockTree)==null||m.unregisterEditorView(e.itemId,f),f.destroy())}}),(u,m)=>(openBlock(),createBlock(_sfc_main$1t,{class:"code-content block-content",ref_key:"cmWrapper",ref:a,src:s.value,"onUpdate:src":m[0]||(m[0]=f=>s.value=f),readonly:u.readonly,lang:u.block.content[2],"extensions-builder":c,"on-src-changed":d,keymap:unref(l)},null,8,["src","readonly","lang","keymap"]))}}),_sfc_main$1r=defineComponent({__name:"DropdownMenu",props:{defaultOpen:{type:Boolean},open:{type:Boolean},dir:{},modal:{type:Boolean}},emits:["update:open"],setup(r,{emit:e}){const n=xe(r,e);return(o,s)=>(openBlock(),createBlock(unref(sh),normalizeProps(guardReactiveProps(unref(n))),{default:withCtx(()=>[renderSlot(o.$slots,"default")]),_:3},16))}}),_sfc_main$1q=defineComponent({__name:"DropdownMenuContent",props:{forceMount:{type:Boolean},loop:{type:Boolean},side:{},sideOffset:{default:4},align:{},alignOffset:{},avoidCollisions:{type:Boolean},collisionBoundary:{},collisionPadding:{},arrowPadding:{},sticky:{},hideWhenDetached:{type:Boolean},updatePositionStrategy:{},prioritizePosition:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},emits:["escapeKeyDown","pointerDownOutside","focusOutside","interactOutside","closeAutoFocus"],setup(r,{emit:e}){const n=r,o=e,s=computed(()=>{const{class:l,...c}=n;return c}),a=xe(s,o);return(l,c)=>(openBlock(),createBlock(unref(ih),null,{default:withCtx(()=>[createVNode(unref(uh),mergeProps(unref(a),{class:unref(cn)("z-50 min-w-32 overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n.class)}),{default:withCtx(()=>[renderSlot(l.$slots,"default")]),_:3},16,["class"])]),_:3}))}}),_sfc_main$1p=defineComponent({__name:"DropdownMenuGroup",props:{asChild:{type:Boolean},as:{}},setup(r){const e=r;return(n,o)=>(openBlock(),createBlock(unref(fh),normalizeProps(guardReactiveProps(e)),{default:withCtx(()=>[renderSlot(n.$slots,"default")]),_:3},16))}}),_sfc_main$1o=defineComponent({__name:"DropdownMenuItem",props:{disabled:{type:Boolean},textValue:{},asChild:{type:Boolean},as:{},class:{},inset:{type:Boolean}},setup(r){const e=r,n=computed(()=>{const{class:s,...a}=e;return a}),o=At(n);return(s,a)=>(openBlock(),createBlock(unref(ch$1),mergeProps(unref(o),{class:unref(cn)("dropdown-menu-item relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s.inset&&"pl-8",e.class)}),{default:withCtx(()=>[renderSlot(s.$slots,"default")]),_:3},16,["class"]))}}),_sfc_main$1n=defineComponent({__name:"DropdownMenuSub",props:{defaultOpen:{type:Boolean},open:{type:Boolean}},emits:["update:open"],setup(r,{emit:e}){const n=xe(r,e);return(o,s)=>(openBlock(),createBlock(unref(bh),normalizeProps(guardReactiveProps(unref(n))),{default:withCtx(()=>[renderSlot(o.$slots,"default")]),_:3},16))}}),_sfc_main$1m=defineComponent({__name:"DropdownMenuSubContent",props:{forceMount:{type:Boolean},loop:{type:Boolean},sideOffset:{},alignOffset:{},avoidCollisions:{type:Boolean},collisionBoundary:{},collisionPadding:{},arrowPadding:{},sticky:{},hideWhenDetached:{type:Boolean},updatePositionStrategy:{},prioritizePosition:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},emits:["escapeKeyDown","pointerDownOutside","focusOutside","interactOutside","entryFocus","openAutoFocus","closeAutoFocus"],setup(r,{emit:e}){const n=r,o=e,s=computed(()=>{const{class:l,...c}=n;return c}),a=xe(s,o);return(l,c)=>(openBlock(),createBlock(unref(Ch),mergeProps(unref(a),{class:unref(cn)("z-50 min-w-32 overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n.class)}),{default:withCtx(()=>[renderSlot(l.$slots,"default")]),_:3},16,["class"]))}}),_sfc_main$1l=defineComponent({__name:"DropdownMenuSubTrigger",props:{disabled:{type:Boolean},textValue:{},asChild:{type:Boolean},as:{},class:{}},setup(r){const e=r,n=computed(()=>{const{class:s,...a}=e;return a}),o=At(n);return(s,a)=>(openBlock(),createBlock(unref(wh),mergeProps(unref(o),{class:unref(cn)("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",e.class)}),{default:withCtx(()=>[renderSlot(s.$slots,"default"),createVNode(unref(ChevronRight),{class:"ml-auto h-4 w-4"})]),_:3},16,["class"]))}}),_sfc_main$1k=defineComponent({__name:"DropdownMenuTrigger",props:{disabled:{type:Boolean},asChild:{type:Boolean},as:{}},setup(r){const e=At(r);return(n,o)=>(openBlock(),createBlock(unref(rh),mergeProps({class:"outline-none"},unref(e)),{default:withCtx(()=>[renderSlot(n.$slots,"default")]),_:3},16))}}),_hoisted_1$y=["data-showDropdown","data-path"],_hoisted_2$h={key:0,class:"flex items-center text-muted-foreground"},_hoisted_3$d={class:"image-fit-container relative w-fit bg-background"},_hoisted_4$a=["src"],_sfc_main$1j=defineComponent({__name:"ImageContent",props:{blockTree:{},block:{},itemId:{}},setup(r){const e=r,{useImage:n}=ImagesContext.useContext(),o=ref(null),s=ref(null),a=useTaskQueue(),{blockEditor:l,blocksManager:c}=BlocksContext.useContext();let d=0;const u=generateKeydownHandlerSimple({Backspace:{run:x=>x.isComposing||x.keyCode===229?!1:(a.addTask(()=>{l.deleteBlock({blockId:e.block.id})}),!0),stopPropagation:!0,preventDefault:!0},Enter:{run:x=>{if(x.isComposing||x.keyCode===229)return!1;const v=e.itemId,_=e.blockTree;return!v||!_?!1:(a.addTask(async()=>{const E={baseBlockId:e.block.id,offset:1},N=getPmSchema({getBlockRef:c.getBlockRef});l.insertNormalBlock({pos:E,content:plainTextToTextContent("",N)});const I=_.getDiBelow(v);await _.nextUpdate(),I&&_.focusDi(I[0].itemId)}),!0)},stopPropagation:!0,preventDefault:!0},ArrowDown:{run:x=>{if(x.isComposing||x.keyCode===229)return!1;const v=e.blockTree;if(!v)return!1;const _=v.getDiBelow(e.itemId);return _&&v.focusDi(_[0].itemId),!0},stopPropagation:!0,preventDefault:!0},ArrowUp:{run:x=>{if(x.isComposing||x.keyCode===229)return!1;const v=e.blockTree;if(!v)return!1;const _=v.getDiAbove(e.itemId);return _&&v.focusDi(_[0].itemId),!0},stopPropagation:!0,preventDefault:!0},ArrowLeft:{run:x=>{if(x.isComposing||x.keyCode===229)return!1;const v=e.blockTree;if(!v)return!1;const _=v.getPredecessorDi(e.itemId);return _&&v.focusDi(_[0].itemId),!0},stopPropagation:!0,preventDefault:!0},ArrowRight:{run:x=>{if(x.isComposing||x.keyCode===229)return!1;const v=e.blockTree;if(!v)return!1;const _=v.getSuccessorDi(e.itemId);return _&&v.focusDi(_[0].itemId),!0},stopPropagation:!0,preventDefault:!0},"*":{run:()=>!0,stopPropagation:!0,preventDefault:!0},Tab:{run:x=>x.isComposing||x.keyCode===229?!1:(a.addTask(()=>{l.promoteBlock({blockId:e.block.id})}),!0),stopPropagation:!0,preventDefault:!0},"Shift-Tab":{run:x=>x.isComposing||x.keyCode===229?!1:(a.addTask(()=>{l.demoteBlock({blockId:e.block.id})}),!0),stopPropagation:!0,preventDefault:!0}}),m=x=>{const v=x.target;v.blur(),v.contentEditable="false",v.innerHTML="",setTimeout(()=>{v.contentEditable="true",v.focus()},0)},f=n(()=>e.block.content[1]),p=ref(!1),g=x=>{a.addTask(()=>{const v=e.block.id,_=[...e.block.content],E=_[5]??[];E.includes(x)?E.splice(E.indexOf(x),1):E.push(x),_[5]=E,l.changeBlockContent({blockId:v,content:_})})},y=x=>(e.block.content[5]??[]).includes(x),b=()=>{a.addTask(()=>{l.deleteBlock({blockId:e.block.id})})},k=x=>{const v=x.clientX-d+3,_=o.value;_&&(_.style.width=Math.min(_.naturalWidth,v)+"px")},w=()=>{var _;const x=o.value;if(!x)return;const v=x.clientWidth;a.addTask(()=>{const E=e.block.id,N=[...e.block.content];N[4]=v,l.changeBlockContent({blockId:E,content:N})}),(_=document.getElementById("cursor-style"))==null||_.remove(),document.removeEventListener("mousemove",k),document.removeEventListener("mouseup",w),document.removeEventListener("mouseleave",w)},B=x=>{var E;const v=(E=o.value)==null?void 0:E.getBoundingClientRect();if(!v)return;d=v.left;const _=document.createElement("style");_.innerHTML="*{cursor: col-resize!important;}",_.id="cursor-style",document.head.appendChild(_),x.preventDefault(),x.stopPropagation(),document.addEventListener("mousemove",k),document.addEventListener("mouseup",w),document.addEventListener("mouseleave",w)},M=async()=>{const x=e.block.content;if(x[0]!==BLOCK_CONTENT_TYPES.IMAGE)return;const v=await fsClearScannedImage({path:x[1]});v.success&&a.addTask(()=>{const _=[...x];_[1]=v.data.path,l.changeBlockContent({blockId:e.block.id,content:_})})};return(x,v)=>{var _,E,N,I,L,A;return x.block.content[0]===unref(BLOCK_CONTENT_TYPES).IMAGE&&unref(f)?(openBlock(),createElementBlock("div",{key:0,class:"block-content image-content relative","data-showDropdown":p.value,"data-path":x.block.content[1]},[unref(f).status==="fetching"?(openBlock(),createElementBlock("div",_hoisted_2$h,[createVNode(unref(LoaderCircle),{class:"size-4 mr-2 animate-spin"}),createTextVNode(" "+toDisplayString(x.$t("kbView.imageContent.fetchingImage")),1)])):unref(f).status==="synced"?(openBlock(),createElementBlock("div",{key:1,class:normalizeClass(["image-container flex select-none my-2 shrink-0",{imageBlend:(_=e.block.content[5])==null?void 0:_.includes("blend"),imageBlendLuminosity:(E=e.block.content[5])==null?void 0:E.includes("blendLuminosity"),imageCircle:(N=e.block.content[5])==null?void 0:N.includes("circle"),imageInvert:(I=e.block.content[5])==null?void 0:I.includes("invert"),imageInvertW:(L=e.block.content[5])==null?void 0:L.includes("invertW"),imageOutline:(A=e.block.content[5])==null?void 0:A.includes("outline")}]),ref_key:"imageElContainerRef",ref:s},[createBaseVNode("div",_hoisted_3$d,[createBaseVNode("img",{ref_key:"imageElRef",ref:o,class:"rounded",style:normalizeStyle({width:x.block.content[4]?x.block.content[4]+"px":"unset"}),src:unref(f).url},null,12,_hoisted_4$a),createBaseVNode("div",{class:"absolute right-[2px] top-1/2 -translate-y-1/2 h-full max-h-[40px] rounded w-1 bg-muted cursor-col-resize",onMousedown:B},null,32),createVNode(unref(_sfc_main$1r),{open:p.value,"onUpdate:open":v[2]||(v[2]=F=>p.value=F),modal:!1},{default:withCtx(()=>[createVNode(unref(_sfc_main$1k),{"as-child":""},{default:withCtx(()=>[createVNode(unref(_sfc_main$1I),{variant:"outline",size:"icon",class:"image-actions absolute top-2 right-2"},{default:withCtx(()=>[createVNode(unref(EllipsisVertical),{class:"size-4"})]),_:1})]),_:1}),createVNode(unref(_sfc_main$1q),{class:"w-52 mx-4"},{default:withCtx(()=>[createVNode(unref(_sfc_main$1o),null,{default:withCtx(()=>[createVNode(unref(MessageSquareMore),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(x.$t("kbView.imageContent.addCaption")),1)]),_:1}),createVNode(unref(_sfc_main$1o),null,{default:withCtx(()=>[createVNode(unref(Download),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(x.$t("kbView.imageContent.download")),1)]),_:1}),createVNode(unref(_sfc_main$1o),null,{default:withCtx(()=>[createVNode(unref(Info),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(x.$t("kbView.imageContent.metadata")),1)]),_:1}),createVNode(unref(_sfc_main$1o),{onClick:M},{default:withCtx(()=>[createVNode(unref(FileScan),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(x.$t("kbView.imageContent.clearScannedImage")),1)]),_:1}),createVNode(unref(_sfc_main$1n),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1l),null,{default:withCtx(()=>[createVNode(unref(Blend),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(x.$t("kbView.imageContent.filter")),1)]),_:1}),createVNode(unref(ih),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1m),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1o),{class:normalizeClass({active:y("invert")}),onClick:v[0]||(v[0]=F=>g("invert"))},{default:withCtx(()=>[createTextVNode(toDisplayString(x.$t("kbView.imageContent.invert")),1)]),_:1},8,["class"]),createVNode(unref(_sfc_main$1o),{class:normalizeClass({active:y("invertW")}),onClick:v[1]||(v[1]=F=>g("invertW"))},{default:withCtx(()=>[createTextVNode(toDisplayString(x.$t("kbView.imageContent.invertW")),1)]),_:1},8,["class"])]),_:1})]),_:1})]),_:1}),createVNode(unref(_sfc_main$1o),{class:"!text-red-500",onClick:b},{default:withCtx(()=>[createVNode(unref(Trash2),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(x.$t("kbView.imageContent.deleteImage")),1)]),_:1})]),_:1})]),_:1},8,["open"])]),createBaseVNode("div",{class:"cursor-container flex-grow !outline-none min-w-1",contenteditable:"",onKeydown:v[3]||(v[3]=(...F)=>unref(u)&&unref(u)(...F)),onCompositionstart:m},null,32)],2)):createCommentVNode("",!0)],8,_hoisted_1$y)):createCommentVNode("",!0)}}}),_sfc_main$1i=defineComponent({__name:"ScrollBar",props:{orientation:{default:"vertical"},forceMount:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},setup(r){const e=r,n=computed(()=>{const{class:o,...s}=e;return s});return(o,s)=>(openBlock(),createBlock(unref(My),mergeProps(n.value,{class:unref(cn)("flex touch-none select-none transition-colors",o.orientation==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-px",o.orientation==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-px",e.class)}),{default:withCtx(()=>[createVNode(unref(Vy),{class:"relative flex-1 rounded-full bg-border"})]),_:1},16,["class"]))}}),_sfc_main$1h=defineComponent({__name:"ScrollArea",props:{type:{},dir:{},scrollHideDelay:{},asChild:{type:Boolean},as:{},class:{},maxHeight:{}},setup(r){const e=r,n=computed(()=>{const{class:o,...s}=e;return s});return(o,s)=>(openBlock(),createBlock(unref(Oy),mergeProps(n.value,{class:unref(cn)("relative overflow-hidden",e.class)}),{default:withCtx(()=>[createVNode(unref(ky),{class:"h-full w-full rounded-[inherit]",style:normalizeStyle({maxHeight:e.maxHeight})},{default:withCtx(()=>[renderSlot(o.$slots,"default")]),_:3},8,["style"]),createVNode(_sfc_main$1i),createVNode(unref(Fy))]),_:3},16,["class"]))}}),_sfc_main$1g=defineComponent({__name:"MathContent",props:{blockTree:{},block:{},readonly:{type:Boolean},itemId:{}},setup(r){const e=r,n=useTaskQueue(),{blockEditor:o}=BlocksContext.useContext(),s=FloatingMathInputContext.useContext(),a=ref(null);let l="";const c={displayMode:!0,throwOnError:!1},d=()=>{const y=a.value;y&&(l.trim().length>0?(katex.render(l,y,c),y.classList.remove("empty")):(y.textContent="EMPTY EQUATION",y.classList.add("empty")))},u=()=>{const y=e.block.content,b=a.value;!b||y[0]!==BLOCK_CONTENT_TYPES.MATH||s.openFloatingMathInput(b,y[1],k=>{l=k,g()},m,f,f,p)},m=()=>{const y=e.blockTree;if(!y)return;const b=y.getDiAbove(e.itemId);b&&y.focusDi(b[0].itemId,{scrollIntoView:!0})},f=()=>{const y=e.blockTree;if(!y)return;const b=y.getDiBelow(e.itemId);b&&y.focusDi(b[0].itemId,{scrollIntoView:!0})},p=()=>{n.addTask(()=>{o.deleteBlock({blockId:e.block.id})})},g=()=>{n.addTask(()=>{o.changeBlockContent({blockId:e.block.id,content:[BLOCK_CONTENT_TYPES.MATH,l]})})};return watch(()=>e.block.content,y=>{y[0]===BLOCK_CONTENT_TYPES.MATH&&(l=y[1],nextTick(()=>{d()}))},{immediate:!0}),(y,b)=>y.block.content[0]===unref(BLOCK_CONTENT_TYPES).MATH?(openBlock(),createElementBlock("div",{key:0,class:"math-content block-content overflow-x-auto [&.empty]:italic [&.empty]:text-muted-foreground [&.empty]:!w-fit",ref_key:"$contentEl",ref:a,onClick:u},null,512)):createCommentVNode("",!0)}}),_sfc_main$1f=defineComponent({__name:"BlockContent",props:{block:{},itemId:{},blockTree:{},readonly:{type:Boolean},highlightTerms:{},highlightRefs:{}},setup(r){return(e,n)=>e.block.content[0]===unref(BLOCK_CONTENT_TYPES).TEXT?(openBlock(),createBlock(_sfc_main$1y,{key:0,block:e.block,"block-tree":e.blockTree,readonly:e.readonly,"highlight-terms":e.highlightTerms,"highlight-refs":e.highlightRefs,"item-id":e.itemId},null,8,["block","block-tree","readonly","highlight-terms","highlight-refs","item-id"])):e.block.content[0]===unref(BLOCK_CONTENT_TYPES).MATH?(openBlock(),createBlock(_sfc_main$1g,{key:1,block:e.block,"block-tree":e.blockTree,readonly:e.readonly,"item-id":e.itemId},null,8,["block","block-tree","readonly","item-id"])):e.block.content[0]===unref(BLOCK_CONTENT_TYPES).CODE?(openBlock(),createBlock(_sfc_main$1s,{key:2,block:e.block,"block-tree":e.blockTree,readonly:e.readonly,"item-id":e.itemId},null,8,["block","block-tree","readonly","item-id"])):e.block.content[0]===unref(BLOCK_CONTENT_TYPES).IMAGE?(openBlock(),createBlock(_sfc_main$1j,{key:3,block:e.block,"block-tree":e.blockTree,"item-id":e.itemId},null,8,["block","block-tree","item-id"])):createCommentVNode("",!0)}}),FavoriteContext=createContext(()=>{const{blocksManager:r}=BlocksContext.useContext(),e=useLocalStorage("favoriteBlockIds",[]),n=computed({get:()=>e.value.map(o=>r.getBlock(o)).filter(o=>!!o),set:o=>{e.value=o.map(s=>s.id)}});return{favoriteBlockIds:e,favoriteBlocks:n}}),addIndentation$1=(r,e={})=>{const n=e.char||" ",o=e.count||2;let s=0;const a=[];return r.reverse().reduce((l,c)=>{a.length&&s&&a[s]&&a[s]===c.substring(1,a[s].length+1)&&(a.splice(s,1),s--);const d=[`${n.repeat(s?s*o:0)}${c}`,...l];return c.substring(0,2)==="</"&&(s++,a[s]=c.substring(2,c.length-1)),d},[]).join(`
`)};var addIndentation_1=addIndentation$1;const removeEmptyLines=r=>r.trim().replace(/(^(\s|\t)+|(( |\t)+)$)/gm,""),mergeAttributesWithElements$1=r=>{const e=removeEmptyLines(r).split(`
`),n=[];let o="";for(let s=0;s<e.length;s+=1){const a=e[s];if(a.endsWith("/>")){n.push(`${o}${a.slice(0,-2)} />`),o="";continue}if(a.endsWith(">")){n.push(`${o}${a.startsWith(">")||a.startsWith("<")?"":" "}${a}`),o="";continue}o+=o.length?` ${a}`:a}return n};var toLines={mergeAttributesWithElements:mergeAttributesWithElements$1,removeEmptyLines};const addIndentation=addIndentation_1,{mergeAttributesWithElements}=toLines,prettify=(r,e={})=>{const n=mergeAttributesWithElements(r);return addIndentation(n,e)};var src=prettify;const prettify$1=getDefaultExportFromCjs(src),ExporterContext=createContext(()=>{const{blocksManager:r}=BlocksContext.useContext(),e=ref(!1),n=ref(void 0);return{open:e,blockId:n,openExporter:o=>{e.value=!0,n.value=o},closeExporter:()=>{e.value=!1,n.value=void 0},exportSubtreeToPlainText:(o,s={})=>{s.nonFoldOnly??(s.nonFoldOnly=!1);let a="";return r.forDescendants({onEachBlock:(l,c)=>{a+="  ".repeat(c)+"- "+l.ctext+`
`},rootBlockId:o,rootBlockLevel:0,nonFoldOnly:s.nonFoldOnly,includeSelf:!0}),a},exportSubtreeToHtml:(o,s={})=>{s.nonFoldOnly??(s.nonFoldOnly=!1);const a=document.createElement("ul"),l=getPmSchema({getBlockRef:r.getBlockRef}),c=DOMSerializer.fromSchema(l),d=(m,f)=>{if(m.fold&&s.nonFoldOnly)return;const p=document.createElement("li");if(m.content[0]===BLOCK_CONTENT_TYPES.TEXT){const g=Node$1.fromJSON(l,m.content[1]),y=c.serializeFragment(g.content);p.appendChild(y)}if(m.childrenRefs.length>0){const g=document.createElement("ul");for(const y of m.childrenRefs)if(y.value&&!y.value.deleted){const b=toRaw(y.value);d(b,g)}p.appendChild(g)}f.appendChild(p)},u=r.getBlock(o);return u?(d(u,a),prettify$1(a.outerHTML)):(console.error("Cannot find root block",o),"")},exportSubtreeToMarkdown:o=>"",exportSubtreeToPdf:o=>""}}),FieldValueInspectorContext=createContext(()=>{const r=ref(!1),e=ref(void 0);return{open:r,blockId:e,openFieldValuesInspector:n=>{r.value=!0,e.value=n}}}),_sfc_main$1e=defineComponent({__name:"BlockContextMenu",props:{blockId:{}},setup(r){const e=useTaskQueue(),{blockEditor:n,blocksManager:o}=BlocksContext.useContext(),{openBlockMover:s}=BlockMoverContext.useContext(),{favoriteBlockIds:a}=FavoriteContext.useContext(),{sidePaneBlockIds:l}=SidebarContext.useContext(),{lastFocusedBlockTree:c}=LastFocusContext.useContext(),{openExporter:d}=ExporterContext.useContext(),{openFieldValuesInspector:u}=FieldValueInspectorContext.useContext(),m=["red","green","blue","yellow","gray","orange","purple"],f=(x,v)=>(!x&&v&&e.addTask(async()=>{await n.deleteBlock({blockId:v})}),!!v),p=(x,v,_)=>{if(!x&&v&&_){const E={x:_.clientX,y:_.clientY};setTimeout(()=>{s(E)},200)}return!!v},g=(x,v,_)=>{if(!x&&v&&_){const E={x:_.clientX,y:_.clientY};setTimeout(()=>{s(E,{leaveRef:!0})},200)}return!!v},y=(x,v)=>{const _=!!v&&!l.value.includes(v);return!x&&_&&l.value.push(v),!!v&&_},b=(x,v)=>{const _=!!v&&!a.value.includes(v);return!x&&_&&a.value.push(v),!!v&&_},k=(x,v)=>(!x&&v&&e.addTask(async()=>{const _={baseBlockId:v,offset:1},E=c.value;if(!E)return;await n.insertMirrorBlock({pos:_,srcBlockId:v});const N=E.getDiBelow(v);N&&E.focusDi(N[0].itemId)}),!!v),w=(x,v,_)=>(!x&&v&&d(v),!!v),B=(x,v)=>(!x&&v&&u(v),!!v),M=x=>(v,_,E)=>(!v&&_&&E&&e.addTask(async()=>{const N=o.getBlock(_);N&&n.setBlockMetadata({blockId:_,metadata:{...N.metadata,blockRefColor:x}})}),!!_);return(x,v)=>(openBlock(),createBlock(unref(_sfc_main$1r),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1k),null,{default:withCtx(()=>[renderSlot(x.$slots,"default")]),_:3}),createVNode(unref(_sfc_main$1q),{class:"min-w-[200px] overflow-y-auto max-h-[var(--radix-dropdown-menu-content-available-height)]"},{default:withCtx(()=>[createVNode(unref(_sfc_main$1o),{class:"!text-red-500",disabled:!f(!0,x.blockId,void 0),onClick:v[0]||(v[0]=_=>f(!1,x.blockId,_))},{default:withCtx(()=>[createVNode(unref(Trash2),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(x.$t("kbView.command.deleteBlock")),1)]),_:1},8,["disabled"]),createVNode(unref(_sfc_main$1o),{disabled:!B(!0,x.blockId,void 0),onClick:v[1]||(v[1]=_=>B(!1,x.blockId,_))},{default:withCtx(()=>[createVNode(unref(Database),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(x.$t("kbView.command.openFieldValuesInspector")),1)]),_:1},8,["disabled"]),createVNode(unref(_sfc_main$1o),null,{default:withCtx(()=>[createVNode(unref(Copy),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(x.$t("kbView.command.copyBlockReference")),1)]),_:1}),createVNode(unref(_sfc_main$1o),null,{default:withCtx(()=>[createVNode(unref(FlipHorizontal),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(x.$t("kbView.command.copyBlockMirror")),1)]),_:1}),createVNode(unref(_sfc_main$1o),{disabled:!k(!0,x.blockId,void 0),onClick:v[2]||(v[2]=_=>k(!1,x.blockId,_))},{default:withCtx(()=>[createVNode(unref(FlipHorizontal),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(x.$t("kbView.command.insertMirrorBelow")),1)]),_:1},8,["disabled"]),createVNode(unref(_sfc_main$1o),{disabled:!b(!0,x.blockId,void 0),onClick:v[3]||(v[3]=_=>b(!1,x.blockId,_))},{default:withCtx(()=>[createVNode(unref(Bookmark),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(x.$t("kbView.command.addToFavorite")),1)]),_:1},8,["disabled"]),createVNode(unref(_sfc_main$1o),{disabled:!y(!0,x.blockId,void 0),onClick:v[4]||(v[4]=_=>y(!1,x.blockId,_))},{default:withCtx(()=>[createVNode(unref(PanelLeft),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(x.$t("kbView.command.addToSidepane")),1)]),_:1},8,["disabled"]),createVNode(unref(_sfc_main$1o),{disabled:!p(!0,x.blockId,void 0),onClick:v[5]||(v[5]=_=>p(!1,x.blockId,_))},{default:withCtx(()=>[createVNode(unref(ArrowRight),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(x.$t("kbView.command.moveBlock")),1)]),_:1},8,["disabled"]),createVNode(unref(_sfc_main$1o),{disabled:!g(!0,x.blockId,void 0),onClick:v[6]||(v[6]=_=>g(!1,x.blockId,_))},{default:withCtx(()=>[createVNode(unref(ArrowRight),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(x.$t("kbView.command.moveBlockLeaveRef")),1)]),_:1},8,["disabled"]),createVNode(unref(_sfc_main$1o),{disabled:!p(!0,x.blockId,void 0),onClick:v[7]||(v[7]=_=>p(!1,x.blockId,_))},{default:withCtx(()=>[createVNode(unref(ArrowRight),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(x.$t("kbView.command.moveBlockLeaveMirror")),1)]),_:1},8,["disabled"]),createVNode(unref(_sfc_main$1n),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1l),null,{default:withCtx(()=>[createVNode(unref(ArrowUpNarrowWide),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(x.$t("kbView.command.sortDirectChildren")),1)]),_:1}),createVNode(unref(_sfc_main$1m),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1o),null,{default:withCtx(()=>[createVNode(unref(ArrowUpAZ),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(x.$t("kbView.command.sortDictAsc")),1)]),_:1}),createVNode(unref(_sfc_main$1o),null,{default:withCtx(()=>[createVNode(unref(ArrowDownAZ),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(x.$t("kbView.command.sortDictDesc")),1)]),_:1}),createVNode(unref(_sfc_main$1o),null,{default:withCtx(()=>[createVNode(unref(CalendarArrowUp),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(x.$t("kbView.command.ctimeAsc")),1)]),_:1}),createVNode(unref(_sfc_main$1o),null,{default:withCtx(()=>[createVNode(unref(CalendarArrowDown),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(x.$t("kbView.command.ctimeDesc")),1)]),_:1}),createVNode(unref(_sfc_main$1o),null,{default:withCtx(()=>[createVNode(unref(CalendarArrowUp),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(x.$t("kbView.command.mtimeAsc")),1)]),_:1}),createVNode(unref(_sfc_main$1o),null,{default:withCtx(()=>[createVNode(unref(CalendarArrowDown),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(x.$t("kbView.command.mtimeDesc")),1)]),_:1})]),_:1})]),_:1}),createVNode(unref(_sfc_main$1n),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1l),null,{default:withCtx(()=>[createVNode(unref(Paintbrush),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(x.$t("kbView.command.setBlockRefColor")),1)]),_:1}),createVNode(unref(_sfc_main$1m),null,{default:withCtx(()=>[(openBlock(),createElementBlock(Fragment$1,null,renderList(m,_=>createVNode(unref(_sfc_main$1o),{key:_,disabled:!M(_)(!0,x.blockId,void 0),onClick:E=>M(_)(!1,x.blockId,E)},{default:withCtx(()=>[createBaseVNode("div",{class:"size-4 mr-2 rounded-sm",style:normalizeStyle({backgroundColor:`var(--highlight-${_})`})},null,4),createTextVNode(" "+toDisplayString(x.$t(`kbView.command.${_}`)),1)]),_:2},1032,["disabled","onClick"])),64))]),_:1})]),_:1}),createVNode(unref(_sfc_main$1o),{disabled:!w(!0,x.blockId,void 0),onClick:v[8]||(v[8]=_=>w(!1,x.blockId,_))},{default:withCtx(()=>[createVNode(unref(Download),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(x.$t("kbView.command.export")),1)]),_:1},8,["disabled"])]),_:1})]),_:3}))}}),fieldValueTypeSchema=z.discriminatedUnion("type",[z.object({type:z.literal("richtext")}),z.object({type:z.literal("blockRef")}),z.object({type:z.literal("array"),itemType:z.enum(["richtext","blockRef","block"])})]),fieldMetadataSchema=z.object({buildIndex:z.boolean().optional(),valueType:fieldValueTypeSchema}),FieldsManagerContext=createContext(()=>{const{blocksManager:r}=BlocksContext.useContext(),e=ref(null),n=getPmSchema({getBlockRef:r.getBlockRef}),o=()=>{if(!e.value){e.value=new Set;for(const p of r.loadedBlocks.values()){const g=p.value;g&&g.type==="normalBlock"&&"field"in g.metadata&&e.value.add(g.id)}}},s=p=>(o(),e.value.has(p)),a=(p,g)=>{if(!p)return null;let y=p.firstChild;if(!y||y.type.name!=="blockRef_v2")return null;const b=y.attrs.toBlockId;if(!s(b))return null;if(p=p.cut(y.nodeSize),y=p.firstChild,y&&y.isText){const k=y.text;if(!k||!k.startsWith(":")&&!k.startsWith("\uFF1A"))return null;p=p.cut(1)}return g&&(g.fieldName=b),p},l=(p,g)=>{if(!p)return null;let y=p.firstChild;if(y&&y.isText){const b=y.text;if(!b)return null;const k=b.search(/\S|$/);p=p.cut(k)}return p},c=(p,g)=>{if(!p)return null;let y=p.firstChild;if(!y||y.type.name!=="blockRef_v2")return null;const{toBlockId:b,tag:k}=y.attrs??{};return p=p.cut(y.nodeSize),g&&(g.toBlockId=b),g&&(g.tag=k),p},d=(p,g)=>{if(r.getBlock(p))throw new Error(`Field ${p} already exists`);const y=getPmSchema({getBlockRef:r.getBlockRef});r.addBlock({id:p,type:"normalBlock",content:plainTextToTextContent(p,y),fold:!0,parentId:"root",childrenIds:[],metadata:{field:g}},{type:"ui"}),o(),e.value.add(p)},u=(p,g)=>{const y=r.getBlock(p);if(!y||y.type!=="normalBlock")throw new Error(`Field ${p} not found`);r.updateBlock({...y,metadata:g},{type:"ui"})},m=p=>{var b;const g=r.getBlock(p);if(!g||g.content[0]!==BLOCK_CONTENT_TYPES.TEXT)return null;const y=fieldMetadataSchema.safeParse((b=g.metadata)==null?void 0:b.field);return y.success?y.data:null},f=p=>{if(!p||p.type!=="normalBlock"||p.content[0]!==BLOCK_CONTENT_TYPES.TEXT)return;let g=null;try{g=Node$1.fromJSON(n,p.content[1]).content}catch{}if(!g)return;const y={};if(g=a(g,y),!g||!y.fieldName||!s(y.fieldName))return;const b=m(y.fieldName);if(b){if(b.valueType.type==="richtext")return{fieldName:y.fieldName,metadata:b,value:g};if(b.valueType.type==="blockRef"){const k={};return g=a(g),g=l(g),g=c(g,k),g?{fieldName:k.fieldName,metadata:b,value:k.toBlockId}:void 0}else{let k=[];for(const w of p.childrenRefs){const B=w.value;if(!B||B.type!=="normalBlock"||B.content[0]!==BLOCK_CONTENT_TYPES.TEXT)continue;let M=null;try{M=Node$1.fromJSON(n,B.content[1]).content}catch{}if(!M)return;if(b.valueType.itemType==="richtext")k.push(M);else if(b.valueType.itemType==="blockRef"){const x={};if(M=l(M),M=c(M,x),!M)return;k.push(x.toBlockId)}else b.valueType.itemType==="block"&&k.push(B.id)}return{fieldName:y.fieldName,metadata:b,value:k}}}};return{addField:d,setFieldMetadata:u,getFieldMetadata:m,getFieldValues:p=>{const g=r.getSrcBlock(p);if(!g)return null;const y={};for(const b of g.childrenRefs){const k=b.value;if(!k)continue;const w=f(k);if(!w)continue;const{fieldName:B,metadata:M,value:x}=w;y[B]=x}return y}}}),BacklinksContext=createContext(()=>{const{registerSettingGroup:r,registerSettingItem:e}=SettingsContext.useContext(),{blocksManager:n}=BlocksContext.useContext(),{getBacklinks:o}=IndexContext.useContext(),{getFieldValues:s}=FieldsManagerContext.useContext(),a=g=>g?n.getBlock(g)?void 0:"\u65E0\u6548\u7684\u5757 ID":"\u6CA1\u6709\u6307\u5B9A\u5757 ID";r({key:"backlinks",label:{en:"Backlinks",zh:"\u5757\u5F15\u7528 & \u53CD\u5411\u94FE\u63A5"}});const l="backlinks.showCounter",c=!0,d=useLocalStorage(l,c);e({id:l,groupKey:"backlinks",label:{zh:"\u5757\u53F3\u4FA7\u663E\u793A\u53CD\u5411\u94FE\u63A5\u4E2A\u6570"},desc:{zh:"\u5982\u679C\u5F00\u542F\uFF0C\u5219\u5982\u679C\u4E00\u4E2A\u5757\u6709\u53CD\u5411\u94FE\u63A5\uFF0C\u5219\u4F1A\u5728\u5757\u53F3\u4FA7\u4EE5\u60AC\u6D6E\u80F6\u56CA\u7684\u5F62\u5F0F\u663E\u793A\u53CD\u5411\u94FE\u63A5\u4E2A\u6570\u3002\u70B9\u51FB\u5373\u53EF\u6253\u5F00\u4E00\u4E2A\u60AC\u6D6E\u7A97\u53E3\uFF0C\u7528\u4E8E\u6D4F\u89C8\u8FD9\u4E2A\u5757\u7684\u6240\u6709\u53CD\u5411\u94FE\u63A5\u3002"},defaultValue:c,value:useWritableComputedRef(d),componentType:{type:"switch"}});const u="backlinks.putNewBlockAt",m="",f=useLocalStorage(u,m);e({id:u,groupKey:"backlinks",label:{zh:"\u65B0\u5757\u63D2\u5165\u4F4D\u7F6E"},desc:{zh:"\u5728\u5F15\u7528\u8865\u5168\u83DC\u5355\u4E2D\uFF0C\u9009\u62E9\u521B\u5EFA\u65B0\u5757\u65F6\u65B0\u5757\u63D2\u5165\u7684\u4F4D\u7F6E\u3002\u5982\u679C\u4E0D\u6307\u5B9A\uFF0C\u9ED8\u8BA4\u4F1A\u63D2\u5165\u6839\u5757\u672B\u5C3E\u3002"},defaultValue:m,value:useWritableComputedRef(f),componentType:{type:"textInput",validator:a}});const p=(g,y=!0)=>{var w;const b=y?[g]:[],k=s(g)??{};if("Alias"in k){const B=k.Alias,M=z.array(z.string()).safeParse(B);return M.success&&b.push(...M.data),b}{const B=n.getBlock(g);if(!B)return b;const M=(w=B.parentRef.value)==null?void 0:w.parentRef.value;if(!M)return b;const x=s(M.id)??{};if("Alias"in x){const v=x.Alias,_=z.array(z.string()).safeParse(v);return _.success&&b.push(..._.data),b}}return b};return{showBacklinksCounter:d,getAllAliases:p,getBacklinksConsideringAliases:(g,y="both")=>{const b=p(g),k=new Set;for(const w of b){const B=o(w,y);for(const M of B??[])k.add(M)}return k}}}),_sfc_main$1d=defineComponent({__name:"Breadcrumb",props:{class:{}},setup(r){const e=r;return(n,o)=>(openBlock(),createElementBlock("nav",{"aria-label":"breadcrumb",class:normalizeClass(e.class)},[renderSlot(n.$slots,"default")],2))}}),_sfc_main$1c=defineComponent({__name:"BreadcrumbItem",props:{class:{}},setup(r){const e=r;return(n,o)=>(openBlock(),createElementBlock("li",{class:normalizeClass(unref(cn)("inline-flex items-center gap-1.5",e.class))},[renderSlot(n.$slots,"default")],2))}}),_sfc_main$1b=defineComponent({__name:"BreadcrumbLink",props:{asChild:{type:Boolean},as:{default:"a"},class:{}},setup(r){const e=r;return(n,o)=>(openBlock(),createBlock(unref(O),{as:n.as,"as-child":n.asChild,class:normalizeClass(unref(cn)("transition-colors hover:text-foreground",e.class))},{default:withCtx(()=>[renderSlot(n.$slots,"default")]),_:3},8,["as","as-child","class"]))}}),_sfc_main$1a=defineComponent({__name:"BreadcrumbList",props:{class:{}},setup(r){const e=r;return(n,o)=>(openBlock(),createElementBlock("ol",{class:normalizeClass(unref(cn)("flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5",e.class))},[renderSlot(n.$slots,"default")],2))}}),_sfc_main$19=defineComponent({__name:"BreadcrumbSeparator",props:{class:{}},setup(r){const e=r;return(n,o)=>(openBlock(),createElementBlock("li",{role:"presentation","aria-hidden":"true",class:normalizeClass(unref(cn)("[&>svg]:w-3.5 [&>svg]:h-3.5",e.class))},[renderSlot(n.$slots,"default",{},()=>[createVNode(unref(ChevronRight))])],2))}}),_sfc_main$18=defineComponent({__name:"BlockPath",props:{blockId:{},includeSelf:{type:Boolean}},emits:["click-path-segment"],setup(r,{emit:e}){const n=r,o=e,{blocksManager:s}=BlocksContext.useContext(),a=computed(()=>{const l=[...s.getBlockPath(n.blockId)];return l.reverse(),n.includeSelf||l.pop(),l});return(l,c)=>(openBlock(),createBlock(unref(_sfc_main$1d),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1a),{class:"!gap-x-1 !gap-y-0"},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment$1,null,renderList(a.value,(d,u)=>(openBlock(),createElementBlock(Fragment$1,{key:d.id},[createVNode(unref(_sfc_main$1c),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1b),{class:"no-underline cursor-pointer",onClick:m=>o("click-path-segment",d.id)},{default:withCtx(()=>[createVNode(_sfc_main$1f,{class:"!max-w-[unset] *:cursor-pointer",block:d,"block-tree":void 0,readonly:!0},null,8,["block"])]),_:2},1032,["onClick"])]),_:2},1024),u!==a.value.length-1?(openBlock(),createBlock(unref(_sfc_main$19),{key:0},{default:withCtx(()=>c[0]||(c[0]=[createTextVNode(" / ")])),_:1})):createCommentVNode("",!0)],64))),128))]),_:1})]),_:1}))}}),_hoisted_1$x={key:0,class:"rounded-md bg-muted px-1 min-w-5 h-fit flex items-center justify-center text-sm text-muted-foreground select-none cursor-pointer"},_hoisted_2$g={class:"pointer-events-none select-none"},_sfc_main$17=defineComponent({__name:"BacklinksCounter",props:{blockId:{}},setup(r){const e=r,{blocksManager:n}=BlocksContext.useContext(),{getBacklinksConsideringAliases:o,getAllAliases:s}=BacklinksContext.useContext(),a=computed(()=>o(e.blockId)),l=computed(()=>s(e.blockId)),c=computed(()=>[...a.value].map(d=>n.getBlock(d)).filter(d=>d!==null));return(d,u)=>(openBlock(),createBlock(unref(_sfc_main$1r),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1k),null,{default:withCtx(()=>[a.value.size>0?(openBlock(),createElementBlock("div",_hoisted_1$x,toDisplayString(a.value.size),1)):createCommentVNode("",!0)]),_:1}),createVNode(unref(_sfc_main$1q),{class:"w-[300px] max-h-[300px] overflow-y-auto"},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment$1,null,renderList(c.value,m=>(openBlock(),createBlock(unref(_sfc_main$1o),{key:m.id,class:"w-full block"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_2$g,[createVNode(_sfc_main$1f,{class:"flex-grow !max-w-[unset]",block:m,"block-tree":void 0,readonly:!0,"highlight-refs":l.value},null,8,["block","highlight-refs"]),createVNode(_sfc_main$18,{class:"*:text-xs mt-1","block-id":m.id},null,8,["block-id"])])]),_:2},1024))),128)),createVNode(unref(_sfc_main$1I),{variant:"outline",size:"sm",class:"w-full mt-2"},{default:withCtx(()=>[createTextVNode(toDisplayString(d.$t("kbView.backlinks.openBacklinksPanel")),1)]),_:1})]),_:1})]),_:1}))}}),_hoisted_1$w=["data-item-type","data-block-id","data-item-id","data-block-level","data-block-ref-color"],_hoisted_2$f={class:"indent-lines"},_hoisted_3$c=["data-level"],_hoisted_4$9={class:"relative block-content-container"},_hoisted_5$5={key:0,class:"block-buttons"},_hoisted_6$2={class:"more-button"},_sfc_main$16=defineComponent({__name:"BasicBlockItem",props:{blockTree:{default:void 0},block:{},level:{},hideFoldButton:{type:Boolean,default:!1},hideContextMenu:{type:Boolean,default:!1},hideBullet:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},highlightTerms:{default:()=>[]},highlightRefs:{default:()=>[]},itemType:{default:"basic-block"},itemId:{default:void 0},fold:{type:Boolean,default:void 0},handleClickFoldButton:{type:Function,default:void 0}},setup(r){const e=r,n=useTaskQueue(),{blockEditor:o}=BlocksContext.useContext(),{lastFocusedDiId:s,lastFocusedBlockTree:a}=LastFocusContext.useContext(),{mainRootBlockId:l}=MainTreeContext.useContext(),{selectedBlockIds:c,draggingDropPos:d,dragging:u}=BlockSelectDragContext.useContext(),{getMirrors:m}=IndexContext.useContext(),f=computed(()=>m(e.block.id)),p=computed(()=>f.value.size>0||e.block.type==="mirrorBlock"),g=computed(()=>e.fold??e.block.fold),y=computed(()=>e.block.childrenIds.length>0),b=computed(()=>c.value.allNonFolded.includes(e.block.id)),k=()=>{s.value=e.itemId??null,a.value=e.blockTree??null,u.value||(c.value={topLevelOnly:[],allNonFolded:[]})},w=()=>{if(e.handleClickFoldButton){e.handleClickFoldButton();return}else{const M=e.block.id;n.addTask(()=>o.toggleFold(M))}},B=()=>{l.value=e.block.id};return(M,x)=>{var v,_;return openBlock(),createElementBlock("div",{class:normalizeClass(["block-item",{hasChildren:y.value,fold:g.value,selected:b.value,[M.itemType]:!0}]),"data-item-type":M.itemType,"data-block-id":M.block.id,"data-item-id":M.itemId,"data-block-level":M.level,"data-block-ref-color":(v=M.block.metadata)==null?void 0:v.blockRefColor,onFocusin:k},[createBaseVNode("div",_hoisted_2$f,[(openBlock(!0),createElementBlock(Fragment$1,null,renderList(M.level,E=>(openBlock(),createElementBlock("div",{class:"indent-line",key:E,"data-level":E},null,8,_hoisted_3$c))),128))]),createBaseVNode("div",_hoisted_4$9,[M.hideContextMenu?createCommentVNode("",!0):(openBlock(),createElementBlock("div",_hoisted_5$5,[createVNode(_sfc_main$1e,{"block-id":M.block.id},{default:withCtx(()=>[createBaseVNode("div",_hoisted_6$2,[createVNode(unref(Ellipsis))])]),_:1},8,["block-id"]),M.hideFoldButton?createCommentVNode("",!0):(openBlock(),createElementBlock("div",{key:0,class:"fold-button",onClick:w},[createVNode(unref(Triangle))]))])),M.hideBullet?createCommentVNode("",!0):(openBlock(),createElementBlock("div",{key:1,class:"bullet shrink-0",onClick:B},[p.value?(openBlock(),createBlock(unref(Diamond),{key:0,class:"diamond"})):(openBlock(),createBlock(unref(Circle),{key:1,class:"circle"}))])),createVNode(_sfc_main$1f,{block:M.block,"item-id":M.itemId,"block-tree":M.blockTree,readonly:M.readonly,"highlight-terms":M.highlightTerms,"highlight-refs":M.highlightRefs},null,8,["block","item-id","block-tree","readonly","highlight-terms","highlight-refs"]),createVNode(_sfc_main$17,{"block-id":M.block.id},null,8,["block-id"])]),((_=unref(d))==null?void 0:_.itemId)===M.itemId?(openBlock(),createElementBlock("div",{key:0,class:"absolute bottom-[-2px] left-0 h-[2px] rounded w-[40%] bg-blue-500",style:normalizeStyle({marginLeft:unref(d).relIndent+"px"})},null,4)):createCommentVNode("",!0)],42,_hoisted_1$w)}}}),_sfc_main$15=defineComponent({__name:"BacklinksBlockItem",props:{blockTree:{default:void 0},refBlockId:{},itemId:{default:void 0},block:{},readonly:{type:Boolean,default:!1},highlightTerms:{default:()=>[]},highlightRefs:{default:()=>[]}},setup(r){const e=r,n=computed(()=>{const s=e.blockTree;return s?!s.expandedBP.value[e.block.id]:e.block.fold}),o=()=>{const s=e.blockTree;if(!s)return;const a=s.expandedBP.value;a[e.block.id]?delete a[e.block.id]:a[e.block.id]=!0};return(s,a)=>(openBlock(),createBlock(_sfc_main$16,mergeProps(s.$props,{"item-type":"backlink-block",level:0,"highlight-refs":[...s.highlightRefs,s.refBlockId],fold:n.value,"item-id":s.itemId,"handle-click-fold-button":o}),null,16,["highlight-refs","fold","item-id"]))}}),_hoisted_1$v={class:"block-item flex items-center ml-6 mt-10 mb-2 text-muted-foreground","data-item-type":"backlink-header"},_sfc_main$14=defineComponent({__name:"BacklinksHeaderItem",props:{blockId:{},backlinks:{}},setup(r){return(e,n)=>(openBlock(),createElementBlock("div",_hoisted_1$v,[createVNode(unref(Link),{class:"size-4 mr-2"}),createBaseVNode("div",null,toDisplayString(e.$t("kbView.backlinksPanel.nBacklinks",{count:e.backlinks.length})),1),createVNode(unref(_sfc_main$1r),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1k),{"as-child":""},{default:withCtx(()=>[createVNode(unref(Ellipsis),{class:"size-4 ml-2 cursor-pointer hover:text-primary transition-colors"})]),_:1}),createVNode(unref(_sfc_main$1q),{class:"min-w-[200px]"},{default:withCtx(()=>[createVNode(unref(_sfc_main$1p),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1o),null,{default:withCtx(()=>[createVNode(unref(ListTree),{class:"size-4 mr-2"}),n[0]||(n[0]=createTextVNode(" \u663E\u793A\u8DEF\u5F84 "))]),_:1}),createVNode(unref(_sfc_main$1n),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1l),null,{default:withCtx(()=>[createVNode(unref(PanelsTopLeft),{class:"size-4 mr-2"}),n[1]||(n[1]=createTextVNode(" \u5207\u6362\u89C6\u56FE "))]),_:1}),createVNode(unref(ih),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1m),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1o),null,{default:withCtx(()=>[createVNode(unref(List),{class:"size-4 mr-2"}),n[2]||(n[2]=createTextVNode(" \u5217\u8868\u89C6\u56FE "))]),_:1}),createVNode(unref(_sfc_main$1o),null,{default:withCtx(()=>[createVNode(unref(Table),{class:"size-4 mr-2"}),n[3]||(n[3]=createTextVNode(" \u8868\u683C\u89C6\u56FE "))]),_:1}),createVNode(unref(_sfc_main$1o),null,{default:withCtx(()=>[createVNode(unref(Kanban),{class:"size-4 mr-2"}),n[4]||(n[4]=createTextVNode(" \u770B\u677F\u89C6\u56FE "))]),_:1})]),_:1})]),_:1})]),_:1}),createVNode(unref(_sfc_main$1n),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1l),null,{default:withCtx(()=>[createVNode(unref(ArrowUpNarrowWide),{class:"size-4 mr-2"}),n[5]||(n[5]=createTextVNode(" \u6392\u5E8F\u89C4\u5219 "))]),_:1}),createVNode(unref(ih),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1m),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1o),null,{default:withCtx(()=>[createVNode(unref(ArrowUpAZ),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(e.$t("kbView.command.sortDictAsc")),1)]),_:1}),createVNode(unref(_sfc_main$1o),null,{default:withCtx(()=>[createVNode(unref(ArrowDownAZ),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(e.$t("kbView.command.sortDictDesc")),1)]),_:1}),createVNode(unref(_sfc_main$1o),null,{default:withCtx(()=>[createVNode(unref(CalendarArrowUp),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(e.$t("kbView.command.ctimeAsc")),1)]),_:1}),createVNode(unref(_sfc_main$1o),null,{default:withCtx(()=>[createVNode(unref(CalendarArrowDown),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(e.$t("kbView.command.ctimeDesc")),1)]),_:1}),createVNode(unref(_sfc_main$1o),null,{default:withCtx(()=>[createVNode(unref(CalendarArrowUp),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(e.$t("kbView.command.mtimeAsc")),1)]),_:1}),createVNode(unref(_sfc_main$1o),null,{default:withCtx(()=>[createVNode(unref(CalendarArrowDown),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(e.$t("kbView.command.mtimeDesc")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]))}}),_sfc_main$13=defineComponent({__name:"PotentialLinksBlockItem",props:{blockTree:{default:void 0},refBlockId:{},block:{},readonly:{type:Boolean,default:!1},itemId:{default:void 0},highlightTerms:{default:()=>[]},highlightRefs:{default:()=>[]}},setup(r){const e=r,n=computed(()=>{const s=e.blockTree;return s?!s.expandedBP.value[e.block.id]:e.block.fold}),o=()=>{const s=e.blockTree;if(!s)return;const a=s.expandedBP.value;a[e.block.id]?delete a[e.block.id]:a[e.block.id]=!0};return(s,a)=>(openBlock(),createBlock(_sfc_main$16,mergeProps(s.$props,{"item-type":"potential-links-block",level:0,"highlight-refs":[...s.highlightRefs??[],s.refBlockId],fold:n.value,"item-id":s.itemId,"handle-click-fold-button":o}),null,16,["highlight-refs","fold","item-id"]))}}),_hoisted_1$u={class:"block-item flex items-center ml-6 mt-10 text-muted-foreground mb-2","data-item-type":"potential-links-header"},_sfc_main$12=defineComponent({__name:"PotentialLinksHeaderItem",props:{blockId:{},potentialLinks:{}},setup(r){return(e,n)=>(openBlock(),createElementBlock("div",_hoisted_1$u,[createVNode(unref(Link),{class:"size-4 mr-2"}),createBaseVNode("div",null,toDisplayString(e.$t("kbView.backlinksPanel.nPotentialLinks",{count:e.potentialLinks.length})),1)]))}}),_sfc_main$11=defineComponent({__name:"BacklinksDescendantItem",props:{blockTree:{default:void 0},block:{},level:{},itemId:{default:void 0},readonly:{type:Boolean,default:!1},highlightTerms:{default:()=>[]},highlightRefs:{default:()=>[]}},setup(r){const e=r,n=computed(()=>{const s=e.blockTree;return s&&s.expandedBP.value[e.block.id]?!1:e.block.fold}),o=()=>{const s=e.blockTree;if(!s)return;const a=s.expandedBP.value;a[e.block.id]?delete a[e.block.id]:a[e.block.id]=!0};return(s,a)=>(openBlock(),createBlock(_sfc_main$16,mergeProps(s.$props,{"item-type":"backlink-descendant",fold:n.value,"item-id":s.itemId,"handle-click-fold-button":o}),null,16,["fold","item-id"]))}}),_sfc_main$10=defineComponent({__name:"PotentialLinksDescendantItem",props:{blockTree:{default:void 0},block:{},level:{},readonly:{type:Boolean,default:!1},itemId:{default:void 0},highlightTerms:{default:()=>[]},highlightRefs:{default:()=>[]}},setup(r){const e=r,n=computed(()=>{const s=e.blockTree;return s&&s.expandedBP.value[e.block.id]?!1:e.block.fold}),o=()=>{const s=e.blockTree;if(!s)return;const a=s.expandedBP.value;a[e.block.id]?delete a[e.block.id]:a[e.block.id]=!0};return(s,a)=>(openBlock(),createBlock(_sfc_main$16,mergeProps(s.$props,{"item-type":"potential-links-descendant",fold:n.value,"handle-click-fold-button":o,"item-id":s.itemId}),null,16,["fold","item-id"]))}}),_hoisted_1$t=["data-item-type","data-block-id","data-block-level"],_hoisted_2$e={class:"indent-lines"},_hoisted_3$b=["data-level"],_hoisted_4$8={class:"relative block-content-container"},_hoisted_5$4={class:"block-buttons"},_hoisted_6$1={class:"more-button"},_hoisted_7$1={class:"bullet shrink-0"},_sfc_main$$=defineComponent({__name:"MissingBlockItem",props:{blockTree:{default:void 0},blockId:{},level:{},hideBullet:{type:Boolean,default:!1},itemType:{default:"missing-block"},itemId:{default:void 0}},setup(r){const e=r,{selectedBlockIds:n,draggingDropPos:o}=BlockSelectDragContext.useContext(),s=computed(()=>n.value.allNonFolded.includes(e.blockId));return(a,l)=>{var c;return openBlock(),createElementBlock("div",{class:normalizeClass(["missing-block-item block-item",{selected:s.value,[a.itemType]:!0}]),"data-item-type":a.itemType,"data-block-id":a.blockId,"data-block-level":a.level},[createBaseVNode("div",_hoisted_2$e,[(openBlock(!0),createElementBlock(Fragment$1,null,renderList(a.level,d=>(openBlock(),createElementBlock("div",{class:"indent-line",key:d,"data-level":d},null,8,_hoisted_3$b))),128))]),createBaseVNode("div",_hoisted_4$8,[createBaseVNode("div",_hoisted_5$4,[createVNode(_sfc_main$1e,{"block-id":a.blockId},{default:withCtx(()=>[createBaseVNode("div",_hoisted_6$1,[createVNode(unref(Ellipsis))])]),_:1},8,["block-id"])]),createBaseVNode("div",_hoisted_7$1,[createVNode(unref(Circle),{class:"circle"})]),l[0]||(l[0]=createBaseVNode("div",{class:"text-red-500"},"Missing Block",-1))]),((c=unref(o))==null?void 0:c.itemId)===a.itemId?(openBlock(),createElementBlock("div",{key:0,class:"absolute bottom-[-2px] left-0 h-[2px] rounded w-[40%] bg-blue-500",style:normalizeStyle({marginLeft:unref(o).relIndent+"px"})},null,4)):createCommentVNode("",!0)],10,_hoisted_1$t)}}}),_sfc_main$_=defineComponent({__name:"RootBlockItem",props:{blockTree:{default:void 0},itemId:{default:void 0},block:{},readonly:{type:Boolean,default:!1},highlightTerms:{default:()=>[]},highlightRefs:{default:()=>[]}},setup(r){return(e,n)=>(openBlock(),createBlock(_sfc_main$16,mergeProps(e.$props,{class:"root-block","item-type":"root-block",level:0,"highlight-refs":e.highlightRefs,fold:!1,"item-id":e.itemId,"hide-bullet":!0,"hide-fold-button":!0,"hide-context-menu":!0}),null,16,["highlight-refs","item-id"]))}}),_hoisted_1$s=["block-tree-id"],_sfc_main$Z=defineComponent({__name:"BlockTree",props:{id:{},virtual:{type:Boolean,default:!0},rootBlockId:{},rootBlockLevel:{},enlargeRootBlock:{type:Boolean,default:!1},showBacklinks:{type:Boolean,default:!0},showPotentialLinks:{type:Boolean,default:!0},paddingBottom:{default:200},paddingTop:{default:0}},setup(r,{expose:e}){const n=r,o=useEventBus(),s=BlockTreeContext.useContext(),a=BacklinksContext.useContext(),l=IndexContext.useContext(),{blocksManager:c,blockEditor:d}=BlocksContext.useContext(),u=BlockSelectDragContext.useContext(),m=ref(null),f=ref(null),p=shallowRef(),g=mitt(),y=o.eventRefs.afterBlocksTrCommit,b=new Map,k=ref({}),w=()=>{var U,P;const W=n.id;console.time(`calc displayItems ${W}`),p.value=generateDisplayItems({rootBlockId:n.rootBlockId,rootBlockLevel:n.rootBlockLevel,enlargeRootBlock:n.enlargeRootBlock,blocksManager:c,showBacklinks:n.showBacklinks??!0,showPotentialLinks:n.showPotentialLinks??!0,expandedBP:k.value,getBacklinksContext:()=>a,getIndexContext:()=>l}),console.timeEnd(`calc displayItems ${W}`),(P=(U=f.value)==null?void 0:U.forceUpdate)==null||P.call(U),nextTick(()=>{g.emit("displayItemsUpdated",[p.value])})};watch(k,w,{deep:!0}),watch([()=>n.rootBlockId,y],w,{immediate:!0});const B=W=>new Promise(U=>{g.once("displayItemsUpdated",()=>{W&&W(),U()})}),M=(W,U)=>{for(let P=0;P<p.value.length;P++)if(p.value[P].itemId===W){for(let Z=P-1;Z>=0;Z--){const $=p.value[Z];if(!U||U($))return[$,Z]}return null}return null},x=(W,U)=>{for(let P=0;P<p.value.length;P++)if(p.value[P].itemId===W){for(let Z=P+1;Z<p.value.length;Z++){const $=p.value[Z];if(!U||U($))return[$,Z]}return null}return null},v=(W,U)=>M(W,U),_=(W,U)=>x(W,U),E=W=>{var U;return((U=m.value)==null?void 0:U.querySelector(`[data-id="${W}"]`))??null},N=W=>b.get(W)??null,I=(W,U)=>{b.set(W,U)},L=(W,U)=>{const P=b.get(W);P===U&&!P.dom.isConnected&&b.delete(W)},A=W=>{var Z,$;const U=E(W);if(U&&inViewport(U))return!0;const P=p.value.findIndex(K=>K.itemId==W);if(P!=null&&P>=0){const K=(Z=f.value)==null?void 0:Z.getItemPosByIndex(P);if(K){const{top:ne}=K;($=f.value)==null||$.scrollToOffset(ne-60)}}return!0},F=async(W,U={})=>{var de;let{scrollIntoView:P,highlight:Z,expandIfFold:$}=U;if(P??(P=!0),Z??(Z=!1),$??($=!1),P&&!A(W))return;await timeout(0);const K=N(W);K&&K.focus();const ne=(de=E(W))==null?void 0:de.querySelector(".block-item");if(!ne)return;const oe=ne.querySelector(".math-content");oe instanceof HTMLElement&&oe.click();const ae=ne.querySelector(".cursor-container");ae instanceof HTMLElement&&ae.focus(),Z&&(ne.classList.add("highlight-keep"),setTimeout(()=>{ne.classList.add("highlight-fade")},1e3),setTimeout(()=>{ne.classList.remove("highlight-keep"),ne.classList.remove("highlight-fade")},3e3))},se=W=>{var U;return((U=p.value)==null?void 0:U.find(P=>W(P)))??null},H=W=>{const U=N(W);if(U instanceof EditorView$1){const P=U.state.tr,Z=AllSelection.atEnd(U.state.doc);P.setSelection(Z),U.dispatch(P)}else if(U instanceof EditorView){const P=U.state.doc.length;U.dispatch({selection:{anchor:P}})}},V=W=>{const U=N(W);if(U instanceof EditorView$1){const P=U.state.tr,Z=AllSelection.atStart(U.state.doc);P.setSelection(Z),U.dispatch(P)}else U instanceof EditorView&&U.dispatch({selection:{anchor:0}})},R=W=>{var U;return((U=p.value)==null?void 0:U.find(P=>P.itemId===W))??null},J={getProps:()=>n,getId:()=>n.id,getDom:()=>m.value,getRootBlockId:()=>n.rootBlockId,getDisplayItems:()=>p.value,getDi:R,findDi:se,localEventBus:g,expandedBP:k,nextUpdate:B,getEditorViews:()=>b,getEditorView:N,registerEditorView:I,unregisterEditorView:L,getSuccessorDi:x,getPredecessorDi:M,getDiAbove:v,getDiBelow:_,focusDi:F,getDomOfDi:E,moveCursorToTheEnd:H,moveCursorToBegin:V};e(J);let Y=null,re=null,Q=!1,j=null;const q=()=>{var W;if(!j){const U=(W=m.value)==null?void 0:W.querySelector(".indent-line");if(U){const P=parseFloat(window.getComputedStyle(U).marginRight);j={width:U.clientWidth,rightMargin:P}}}return j},ee=W=>{if(u.dragging.value=!1,Q){const U=useTaskQueue(),P=u.draggingDropPos.value;if(!P)return;const{itemId:Z,absLevel:$}=P,K=R(Z);if(!K||!DI_FILTERS.isBlockDi(K))return;const ne=u.selectedBlockIds.value,oe=c.getBlockLevel(K.block.id);$>oe?U.addTask(()=>{const ae=d.normalizePos({parentId:K.block.id,childIndex:"first"});ae&&d.moveBlocks({blockIds:ne.topLevelOnly,pos:ae})}):U.addTask(()=>{const ae=d.normalizePos({baseBlockId:K.block.id,offset:1});ae&&d.moveBlocks({blockIds:ne.topLevelOnly,pos:ae})})}Y=null,re=null,Q=!1,u.draggingDropPos.value=null,document.removeEventListener("pointermove",te),document.removeEventListener("pointerup",ee),document.removeEventListener("pointerleave",ee)},G=()=>{u.draggingDropPos.value=null},te=useThrottleFn(W=>{var U,P;if(!(Date.now().valueOf()-(re??0)<200))if(u.dragging.value=!0,W.preventDefault(),W.stopPropagation(),Q){const Z=getHoveredElementWithClass(W.target,"block-item"),$=Z==null?void 0:Z.dataset.itemId,K=parseInt(Z==null?void 0:Z.dataset.blockLevel);if(!$)return G();const{width:ne,rightMargin:oe}=q(),ae=Math.floor((W.x+oe)/(ne+oe)),de=u.selectedBlockIds.value,le=Z.getBoundingClientRect();if(W.y<le.y+le.height/2){const he=v($,DI_FILTERS.isBlockDi);if(!he||!DI_FILTERS.isBlockDi(he[0]))return G();const ue=he[0].block,me=c.getBlockPath(ue.id);if(!me)return G();const fe=me.length-1-n.rootBlockLevel;for(const Ce of de.allNonFolded)if(me.find(ve=>ve.id===Ce))return G();const ye=ue.fold&&ue.childrenIds.length>0,be=clip(ae,ye?fe:fe+1,K);u.draggingDropPos.value={itemId:he[0].itemId,relIndent:be*(ne+oe)+ne,absLevel:be+n.rootBlockLevel}}else{let he;const ue=_($,DI_FILTERS.isBlockDi),me=Z.classList.contains("fold")&&Z.classList.contains("hasChildren");if(!ue)he=clip(ae,me?K:K+1,1);else{if(!DI_FILTERS.isBlockDi(ue[0]))return G();const fe=ue[0].block,ye=c.getBlockPath(fe.id);if(!ye)return G();const be=ye.length-1-n.rootBlockLevel;he=clip(ae,me?K:K+1,be)}u.draggingDropPos.value={itemId:$,relIndent:he*(ne+oe)+ne,absLevel:he+n.rootBlockLevel}}}else{const Z=(U=getHoveredElementWithClass(W.target,"block-item"))==null?void 0:U.dataset.itemId,$=Z?R(Z):null;if(!Z||!$||!DI_FILTERS.isBlockDi($)||Y==null||!DI_FILTERS.isBlockDi(Y))return;if(Y.itemId===Z){u.selectedBlockIds.value={topLevelOnly:[],allNonFolded:[]},F(Z,{scrollIntoView:!1});return}(P=document.activeElement)==null||P.blur(),u.selectedBlockIds.value={topLevelOnly:[],allNonFolded:[]};const K=c.getBlockPath(Y.block.id).map(de=>de.id),ne=c.getBlockPath($.block.id).map(de=>de.id);let oe=-1,ae=-1;for(let de=0;de<K.length;de++){const le=ne.indexOf(K[de]);if(le!=-1){oe=de,ae=le;break}}if(oe!==-1&&ae!==-1)if(oe===0||ae===0){const de=K[oe],le={topLevelOnly:[de],allNonFolded:[]};c.forDescendants({rootBlockId:de,rootBlockLevel:0,nonFoldOnly:!0,includeSelf:!0,onEachBlock:he=>{le.allNonFolded.push(he.id)}}),u.selectedBlockIds.value=le}else{const de=K[oe],le=c.getBlock(de);if(!le)return;const he=K[oe-1],ue=ne[ae-1],me=le.childrenIds.indexOf(he),fe=le.childrenIds.indexOf(ue),ye=Math.min(me,fe),be=Math.max(me,fe),Ce={topLevelOnly:le.childrenIds.slice(ye,be+1),allNonFolded:[]};for(let ve=ye;ve<=be;ve++){const Ie=le.childrenIds[ve];c.forDescendants({rootBlockId:Ie,rootBlockLevel:0,nonFoldOnly:!0,includeSelf:!0,onEachBlock:Ae=>{Ce.allNonFolded.push(Ae.id)}})}u.selectedBlockIds.value=Ce}}},100),ce=W=>{const U=getHoveredElementWithClass(W.target,"block-item");if(!U)return;const P=U.dataset.itemId,Z=P?R(P):null;if(!(!P||!Z||!DI_FILTERS.isBlockDi(Z))){if(Y=Z,re=Date.now().valueOf(),u.dragging.value=!1,getHoveredElementWithClass(W.target,"bullet")&&(Q=!0,u.selectedBlockIds.value.topLevelOnly.length===0)){const $={topLevelOnly:[Z.block.id],allNonFolded:[]};c.forDescendants({rootBlockId:Z.block.id,rootBlockLevel:0,nonFoldOnly:!0,includeSelf:!0,onEachBlock:K=>{$.allNonFolded.push(K.id)}}),u.selectedBlockIds.value=$}document.addEventListener("pointermove",te),document.addEventListener("pointerup",ee),document.addEventListener("pointerleave",ee)}};return onMounted(()=>{const W=m.value;W&&Object.assign(W,{controller:J}),s.registerBlockTree(J)}),onUnmounted(()=>{s.unregisterBlockTree(n.id)}),(W,U)=>(openBlock(),createElementBlock("div",{class:"block-tree select-none",ref_key:"$blockTree",ref:m,"block-tree-id":W.id,style:normalizeStyle({"--padding-bottom":`${W.paddingBottom}px`,"--padding-top":`${W.paddingTop}px`}),onPointerdown:ce},[W.virtual?(openBlock(),createBlock(unref(VirtList),{key:0,itemKey:"itemId",class:"vlist",list:p.value,buffer:10,minSize:24,ref_key:"$vlist",ref:f,itemClass:"block-container"},{header:withCtx(()=>U[0]||(U[0]=[])),default:withCtx(({itemData:P})=>[P.type=="root-block"?(openBlock(),createBlock(_sfc_main$_,{key:P.itemId,"item-id":P.itemId,"block-tree":J,block:P.block,"highlight-terms":P.highlightTerms,"highlight-refs":P.highlightRefs},null,8,["item-id","block","highlight-terms","highlight-refs"])):createCommentVNode("",!0),P.type=="basic-block"?(openBlock(),createBlock(_sfc_main$16,{key:P.itemId,"item-id":P.itemId,"block-tree":J,block:P.block,level:P.level,"highlight-terms":P.highlightTerms,"highlight-refs":P.highlightRefs},null,8,["item-id","block","level","highlight-terms","highlight-refs"])):createCommentVNode("",!0),P.type=="backlink-header"?(openBlock(),createBlock(_sfc_main$14,{key:P.itemId,"block-tree":J,"block-id":P.blockId,backlinks:P.backlinks},null,8,["block-id","backlinks"])):createCommentVNode("",!0),P.type=="backlink-block"?(openBlock(),createBlock(_sfc_main$15,{key:P.itemId,"item-id":P.itemId,"block-tree":J,block:P.block,"ref-block-id":P.refBlockId,readonly:P.readonly,"highlight-terms":P.highlightTerms,"highlight-refs":P.highlightRefs},null,8,["item-id","block","ref-block-id","readonly","highlight-terms","highlight-refs"])):createCommentVNode("",!0),P.type=="backlink-descendant"?(openBlock(),createBlock(_sfc_main$11,{key:P.itemId,"item-id":P.itemId,"block-tree":J,block:P.block,level:P.level,readonly:P.readonly,"highlight-terms":P.highlightTerms,"highlight-refs":P.highlightRefs},null,8,["item-id","block","level","readonly","highlight-terms","highlight-refs"])):createCommentVNode("",!0),P.type=="potential-links-header"?(openBlock(),createBlock(_sfc_main$12,{key:P.itemId,"block-id":P.blockId,"potential-links":P.potentialLinks},null,8,["block-id","potential-links"])):createCommentVNode("",!0),P.type=="potential-links-block"?(openBlock(),createBlock(_sfc_main$13,{key:P.itemId,"item-id":P.itemId,"block-tree":J,block:P.block,"ref-block-id":P.refBlockId,readonly:P.readonly,"highlight-terms":P.highlightTerms,"highlight-refs":P.highlightRefs},null,8,["item-id","block","ref-block-id","readonly","highlight-terms","highlight-refs"])):createCommentVNode("",!0),P.type=="potential-links-descendant"?(openBlock(),createBlock(_sfc_main$10,{key:P.itemId,"item-id":P.itemId,"block-tree":J,block:P.block,level:P.level,readonly:P.readonly,"highlight-terms":P.highlightTerms,"highlight-refs":P.highlightRefs},null,8,["item-id","block","level","readonly","highlight-terms","highlight-refs"])):createCommentVNode("",!0),P.type=="missing-block"?(openBlock(),createBlock(_sfc_main$$,{key:P.itemId,"item-id":P.itemId,"block-id":P.blockId,level:P.level},null,8,["item-id","block-id","level"])):createCommentVNode("",!0)]),footer:withCtx(()=>U[1]||(U[1]=[])),_:1},8,["list"])):createCommentVNode("",!0)],44,_hoisted_1$s))}});function copyAsHtml(r){const e=new Blob([r],{type:"text/html"}),n=[new ClipboardItem({[e.type]:e})];navigator.clipboard.write(n)}function copyAsPlainText(r){navigator.clipboard.writeText(r)}const _hoisted_1$r={class:"flex flex-col gap-4 py-2"},_hoisted_2$d={class:"flex flex-col space-y-2"},_hoisted_3$a={key:0,class:"flex flex-col space-y-2"},_hoisted_4$7={class:"max-h-[30vh] max-w-full overflow-y-auto overflow-x-hidden text-wrap"},_hoisted_5$3={class:"text-wrap"},_sfc_main$Y=defineComponent({__name:"Exporter",setup(r){const{open:e,blockId:n,closeExporter:o,exportSubtreeToHtml:s,exportSubtreeToMarkdown:a,exportSubtreeToPdf:l,exportSubtreeToPlainText:c}=ExporterContext.useContext(),d=ref("html"),u=computed(()=>{if(!n.value)return"";switch(d.value){case"html":return s(n.value);case"markdown":return a(n.value);case"plainText":return c(n.value);default:return""}});function m(){d.value==="html"?copyAsHtml(u.value):(d.value==="markdown"||d.value==="plainText")&&copyAsPlainText(u.value),o()}function f(){if(d.value!=="pdf"){const p=new Blob([u.value],{type:"text/plain"}),g=URL.createObjectURL(p),y=document.createElement("a");y.href=g;const b=d.value==="html"?"html":d.value==="markdown"?"md":"txt";y.download=`export_${dayjs().format("YYYY-MM-DD-HH-mm-ss")}.${b}`,y.click(),URL.revokeObjectURL(g)}o()}return(p,g)=>(openBlock(),createBlock(unref(_sfc_main$1T),{open:unref(e),"onUpdate:open":g[1]||(g[1]=y=>!y&&unref(o)())},{default:withCtx(()=>[createVNode(unref(_sfc_main$1S),{class:"max-w-[80vw] w-[500px] flex flex-col gap-4"},{default:withCtx(()=>[createVNode(unref(_sfc_main$1J),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1K),null,{default:withCtx(()=>[createTextVNode(toDisplayString(p.$t("kbView.exporter.title")),1)]),_:1}),createVNode(unref(_sfc_main$1L),null,{default:withCtx(()=>[createTextVNode(toDisplayString(p.$t("kbView.exporter.description")),1)]),_:1})]),_:1}),createBaseVNode("div",_hoisted_1$r,[createBaseVNode("div",_hoisted_2$d,[createVNode(unref(_sfc_main$1M),null,{default:withCtx(()=>[createTextVNode(toDisplayString(p.$t("kbView.exporter.exportFormat")),1)]),_:1}),createVNode(unref(_sfc_main$1N),{modelValue:d.value,"onUpdate:modelValue":g[0]||(g[0]=y=>d.value=y)},{default:withCtx(()=>[createVNode(unref(_sfc_main$1O),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1B))]),_:1}),createVNode(unref(_sfc_main$1P),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1C),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1Q),{value:"html"},{default:withCtx(()=>g[2]||(g[2]=[createTextVNode("HTML")])),_:1}),createVNode(unref(_sfc_main$1Q),{value:"markdown"},{default:withCtx(()=>g[3]||(g[3]=[createTextVNode("Markdown")])),_:1}),createVNode(unref(_sfc_main$1Q),{value:"pdf"},{default:withCtx(()=>g[4]||(g[4]=[createTextVNode("PDF")])),_:1}),createVNode(unref(_sfc_main$1Q),{value:"plainText"},{default:withCtx(()=>g[5]||(g[5]=[createTextVNode("Plain Text")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),d.value!=="pdf"?(openBlock(),createElementBlock("div",_hoisted_3$a,[createVNode(unref(_sfc_main$1M),null,{default:withCtx(()=>[createTextVNode(toDisplayString(p.$t("kbView.exporter.preview")),1)]),_:1}),createBaseVNode("div",_hoisted_4$7,[createBaseVNode("pre",_hoisted_5$3,toDisplayString(u.value),1)])])):createCommentVNode("",!0)]),createVNode(unref(_sfc_main$1R),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1I),{variant:"outline",onClick:unref(o)},{default:withCtx(()=>[createTextVNode(toDisplayString(p.$t("kbView.exporter.cancel")),1)]),_:1},8,["onClick"]),createVNode(unref(_sfc_main$1I),{variant:"outline",disabled:d.value==="pdf",onClick:m},{default:withCtx(()=>[createVNode(unref(Clipboard),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(p.$t("kbView.exporter.copyToClipboard")),1)]),_:1},8,["disabled"]),createVNode(unref(_sfc_main$1I),{variant:"outline",onClick:f},{default:withCtx(()=>[createVNode(unref(File),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(p.$t("kbView.exporter.exportToFile")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["open"]))}}),_sfc_main$X=defineComponent({__name:"FieldValueInspector",setup(r){const{open:e,blockId:n}=FieldValueInspectorContext.useContext(),{getFieldValues:o}=FieldsManagerContext.useContext(),s=computed(()=>n.value?o(n.value):{});return(a,l)=>(openBlock(),createBlock(unref(_sfc_main$1T),{open:unref(e),"onUpdate:open":l[0]||(l[0]=c=>isRef(e)?e.value=c:null)},{default:withCtx(()=>[createVNode(unref(_sfc_main$1S),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1J),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1K),null,{default:withCtx(()=>[createTextVNode(toDisplayString(a.$t("kbView.fieldValuesInspector.title")),1)]),_:1}),createVNode(unref(_sfc_main$1L),null,{default:withCtx(()=>[createTextVNode(toDisplayString(a.$t("kbView.fieldValuesInspector.description")),1)]),_:1}),createBaseVNode("pre",null,toDisplayString(JSON.stringify(s.value,null,2)),1)]),_:1})]),_:1})]),_:1},8,["open"]))}}),BasicSettingsContext=createContext(()=>{const{registerSettingGroup:r,registerSettingItem:e}=SettingsContext.useContext();r({key:"basic",label:{zh:"\u57FA\u672C\u8BBE\u7F6E"}});const n="basic.textFontFamily",o="",s=useLocalStorage(n,o);e({id:n,groupKey:"basic",label:{zh:"\u6B63\u6587\u5B57\u4F53"},desc:{zh:"\u6307\u5B9A\u7B14\u8BB0\u6B63\u6587\u7684\u5B57\u4F53\u3002"},defaultValue:o,value:useWritableComputedRef(s),componentType:{type:"fontSelector"}});const a="basic.uiFontFamily",l="",c=useLocalStorage(a,l);e({id:a,groupKey:"basic",label:{zh:"\u754C\u9762\u5B57\u4F53"},desc:{zh:"\u6307\u5B9A\u8F6F\u4EF6\u754C\u9762\u5B57\u4F53\u3002\u5728\u4E0D\u6307\u5B9A\u5176\u4ED6\u5B57\u4F53\u7684\u60C5\u51B5\u4E0B\uFF0C\u8BE5\u5B57\u4F53\u5C06\u6210\u4E3A\u8F6F\u4EF6\u7684\u57FA\u7840\u5B57\u4F53\u3002"},defaultValue:l,value:useWritableComputedRef(c),componentType:{type:"fontSelector"}});const d="basic.monospaceFontFamily",u="",m=useLocalStorage(d,u);e({id:d,groupKey:"basic",label:{zh:"\u4EE3\u7801\u5757\u5B57\u4F53"},desc:{zh:"\u6307\u5B9A\u884C\u5185\u4EE3\u7801\u3001\u4EE3\u7801\u5757\u7B49\u9700\u8981\u7B49\u5BBD\u5B57\u4F53\u7684\u573A\u666F\u4F7F\u7528\u7684\u5B57\u4F53\u3002"},defaultValue:u,value:useWritableComputedRef(m),componentType:{type:"fontSelector"}});const f="basic.enableFloatingEditor",p=!1,g=useLocalStorage(f,p);return e({id:f,groupKey:"basic",label:{zh:"\u542F\u7528\u6D6E\u52A8\u7F16\u8F91\u5668"},desc:{zh:"\u542F\u7528\u540E\uFF0C\u5728\u5757\u5F15\u7528\u5757\u4E0A\u6309 Ctrl / Command \u952E\u65F6\uFF0C\u4F1A\u5F39\u51FA\u6D6E\u52A8\u7F16\u8F91\u5668\u3002"},defaultValue:p,value:useWritableComputedRef(g),componentType:{type:"switch"}}),{textFontFamily:s,uiFontFamily:c,monospaceFontFamily:m,enableFloatingEditor:g}}),FloatingEditorContext=createContext(()=>{const r=ref(null),e=ref(!1),n=ref(null),{enableFloatingEditor:o}=BasicSettingsContext.useContext(),s=(c,d)=>{o.value&&(n.value=c,r.value=d)},a=()=>{n.value=null,r.value=null,e.value=!1},l=c=>{c.ctrlKey&&r.value&&(e.value=!0)};return onMounted(()=>{window.addEventListener("keydown",l)}),onUnmounted(()=>{window.removeEventListener("keydown",l)}),{showPos:r,open:e,openedBlockId:n,openFloatingEditor:s,closeFloatingEditor:a}}),_sfc_main$W=defineComponent({__name:"FloatingEditor",setup(r){const{showPos:e,open:n,openedBlockId:o}=FloatingEditorContext.useContext();return watch(n,async()=>{if(await nextTick(),!e.value||!(document.querySelector("[data-radix-popper-content-wrapper]")instanceof HTMLElement))return;const{x:s,y:a}=e.value,l=calcPopoverPos(300,300,s,a,{offset:c=>(c.leftUp.y-=30,c.rightUp.y-=30,c)});document.body.style.setProperty("--popover-x",`${l.rightDown.x}px`),document.body.style.setProperty("--popover-y",`${l.rightDown.y}px`)}),(s,a)=>(openBlock(),createBlock(_sfc_main$1x,{open:unref(n),"onUpdate:open":a[0]||(a[0]=l=>isRef(n)?n.value=l:null)},{default:withCtx(()=>[createVNode(_sfc_main$1v),createVNode(_sfc_main$1w,{class:"floating-editor-content p-2 w-[400px] h-[400px] overflow-hidden"},{default:withCtx(()=>[unref(o)?(openBlock(),createBlock(_sfc_main$Z,{key:0,class:"h-full",id:"floating-editor","root-block-id":unref(o),"root-block-level":0,"padding-bottom":0},null,8,["root-block-id"])):createCommentVNode("",!0)]),_:1})]),_:1},8,["open"]))}}),PasteDialogContext=createContext(()=>{const r=ref(!1),e=ref("waiting"),n=ref(""),o=ref("");return{open:r,status:e,progress:n,content:o,showPasteDialog:s=>{o.value=s,e.value="waiting",n.value="",r.value=!0},closePasteDialog:()=>{r.value=!1,o.value=""}}}),_sfc_main$V=defineComponent({__name:"PasteDialog",setup(r){BlocksContext.useContext(),LastFocusContext.useContext();const{open:e,status:n,content:o,closePasteDialog:s}=PasteDialogContext.useContext(),a=computed(()=>{const c=o.value.split(/\r?\n/).filter(m=>m.trim()),d=o.value.length,u=c.length;return{charCount:d,blockCount:u}}),l=async()=>{};return(c,d)=>(openBlock(),createBlock(unref(_sfc_main$1_),{open:unref(e)},{default:withCtx(()=>[createVNode(unref(_sfc_main$1Z),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1U),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1V),null,{default:withCtx(()=>[createTextVNode(toDisplayString(c.$t("kbView.pasteDialog.title")),1)]),_:1}),createVNode(unref(_sfc_main$1W),null,{default:withCtx(()=>[createTextVNode(toDisplayString(c.$t("kbView.pasteDialog.description",{blockCount:a.value.blockCount,charCount:a.value.charCount})),1)]),_:1})]),_:1}),createVNode(unref(_sfc_main$1X),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1Y),{disabled:unref(n)==="pasting",onClick:unref(s)},{default:withCtx(()=>[createTextVNode(toDisplayString(c.$t("kbView.pasteDialog.cancelBtn")),1)]),_:1},8,["disabled","onClick"]),createVNode(unref(_sfc_main$1A),{disabled:unref(n)==="pasting",onClick:l},{default:withCtx(()=>[unref(n)==="waiting"?(openBlock(),createElementBlock(Fragment$1,{key:0},[createTextVNode(toDisplayString(c.$t("kbView.pasteDialog.confirmBtn")),1)],64)):unref(n)==="pasting"?(openBlock(),createElementBlock(Fragment$1,{key:1},[createVNode(unref(LoaderCircle),{class:"size-4 mr-2 animate-spin"}),createTextVNode(" "+toDisplayString(c.$t("kbView.pasteDialog.pasting")),1)],64)):unref(n)==="done"?(openBlock(),createElementBlock(Fragment$1,{key:2},[createVNode(unref(Check),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(c.$t("kbView.pasteDialog.done")),1)],64)):unref(n)==="failed"?(openBlock(),createElementBlock(Fragment$1,{key:3},[createVNode(unref(X),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(c.$t("kbView.pasteDialog.failed")),1)],64)):createCommentVNode("",!0)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"]))}}),_hoisted_1$q={class:"relative px-1"},_hoisted_2$c={class:"my-2 max-h-[240px] overflow-y-auto px-1"},_hoisted_3$9=["onMouseover"],_hoisted_4$6={key:0,class:"text-center"},_hoisted_5$2={class:"text-sm text-muted-foreground"},_sfc_main$U=defineComponent({__name:"RefSuggestions",setup(r){const{showPos:e,open:n,query:o,cb:s,focusItemIndex:a,suggestions:l,suppressMouseOver:c,updateSuggestions:d,withScrollSuppressed:u}=RefSuggestionsContext.useContext(),m=computed(()=>o.value.length==0?[]:hybridTokenize(o.value,!1,1,!1)??[]);watch(e,async()=>{if(await nextTick(),!e.value||!(document.querySelector("[data-radix-popper-content-wrapper]")instanceof HTMLElement))return;const{x:b,y:k}=e.value,w=calcPopoverPos(300,300,b,k,{offset:B=>(B.leftDown.y+=30,B.rightDown.y+=30,B)});document.body.style.setProperty("--popover-x",`${w.rightDown.x}px`),document.body.style.setProperty("--popover-y",`${w.rightDown.y}px`)});const f=b=>{b.isComposing||d()},p=b=>{d()},g=()=>{setTimeout(()=>{const b=document.body.querySelector(".ref-suggestions-content .focus");b instanceof HTMLElement&&b.scrollIntoView({block:"nearest"})})},y=generateKeydownHandlerSimple({Escape:{run:b=>{var k;return b.isComposing||b.keyCode===229?!1:((k=s.value)==null||k.call(s,null),!0)}},Enter:{run:b=>{var k,w,B;return b.isComposing||b.keyCode===229?!1:((B=s.value)==null||B.call(s,((w=(k=l.value[a.value])==null?void 0:k.value)==null?void 0:w.id)??null),!0)},preventDefault:!0,stopPropagation:!0},Backspace:{run:b=>{var k;return b.isComposing||b.keyCode===229?!1:o.value.length==0?(e.value=null,(k=s.value)==null||k.call(s,null),!0):!1},preventDefault:!0,stopPropagation:!0},ArrowUp:{run:b=>b.isComposing||b.keyCode===229?!1:u(()=>(a.value>0?a.value--:a.value=l.value.length-1,g(),!0)),preventDefault:!0,stopPropagation:!0},ArrowDown:{run:b=>b.isComposing||b.keyCode===229?!1:u(()=>(a.value<l.value.length-1?a.value++:a.value=0,g(),!0)),preventDefault:!0,stopPropagation:!0},Home:{run:b=>b.isComposing||b.keyCode===229?!1:u(()=>(a.value=0,g(),!0))},End:{run:b=>b.isComposing||b.keyCode===229?!1:u(()=>(a.value=l.value.length-1,g(),!0)),preventDefault:!0,stopPropagation:!0}});return(b,k)=>(openBlock(),createBlock(unref(_sfc_main$1x),{open:unref(n),"onUpdate:open":k[2]||(k[2]=w=>isRef(n)?n.value=w:null)},{default:withCtx(()=>[createVNode(unref(_sfc_main$1w),{class:"ref-suggestions-content py-2 pb-0 px-1 max-h-[300px] max-w-[300px] overflow-hidden","trap-focus":"",tabindex:"-1",onKeydown:unref(y)},{default:withCtx(()=>[createBaseVNode("div",_hoisted_1$q,[createVNode(unref(Search),{class:"absolute left-3 top-1/2 -translate-y-1/2 size-4 text-muted-foreground"}),createVNode(unref(_sfc_main$1H),{onInput:f,onCompositionend:p,modelValue:unref(o),"onUpdate:modelValue":k[0]||(k[0]=w=>isRef(o)?o.value=w:null),class:"h-[32px] pl-8 rounded-sm focus-visible:outline-none focus-visible:ring-transparent"},null,8,["modelValue"])]),createBaseVNode("div",_hoisted_2$c,[(openBlock(!0),createElementBlock(Fragment$1,null,renderList(unref(l),(w,B)=>(openBlock(),createElementBlock("div",{key:w.value.id,class:normalizeClass(["relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 text-sm outline-none [&.focus]:bg-accent [&.focus]:text-accent-foreground",{focus:unref(a)===B}]),onMouseover:M=>!unref(c)&&(a.value=B),onClick:k[1]||(k[1]=M=>{var x,v,_;return(_=unref(s))==null?void 0:_(((v=(x=unref(l)[unref(a)])==null?void 0:x.value)==null?void 0:v.id)??null)})},[createVNode(_sfc_main$1f,{block:w.value,readonly:!0,class:"*:cursor-default","highlight-terms":m.value},null,8,["block","highlight-terms"])],42,_hoisted_3$9))),128)),unref(l).length===0?(openBlock(),createElementBlock("div",_hoisted_4$6,[createBaseVNode("span",_hoisted_5$2,toDisplayString(b.$t("kbView.refSuggestions.noSuggestions")),1)])):createCommentVNode("",!0)])]),_:1},8,["onKeydown"])]),_:1},8,["open"]))}}),SettingsPanelContext=createContext(()=>{const r=SettingsContext.useContext(),e=ref(!1),n=Object.keys(r.settingGroups.value)[0],o=ref(n);return{open:e,activeGroupKey:o}}),getTrans=(r,e)=>r[e]||r.en_US||r.zh||Object.values(r)[0],_hoisted_1$p={class:"italic text-muted-foreground"},_sfc_main$T=defineComponent({__name:"KeybindingInput",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(r){const e=useModel(r,"modelValue"),n=o=>{const s=[];(o.metaKey||o.ctrlKey)&&s.push("Mod"),o.altKey&&s.push("Alt"),o.shiftKey&&s.push("Shift"),s.push(o.key),e.value=s.join("-")};return(o,s)=>(openBlock(),createBlock(unref(_sfc_main$1I),{variant:"outline",size:"sm",class:"font-normal focus:bg-muted",onKeydown:withModifiers(n,["prevent"]),onClick:s[0]||(s[0]=withModifiers(()=>{},["prevent"]))},{default:withCtx(()=>[e.value?(openBlock(),createElementBlock(Fragment$1,{key:0},[createTextVNode(toDisplayString(e.value)+" ",1),createVNode(unref(X),{class:"ml-2 size-4"})],64)):(openBlock(),createElementBlock(Fragment$1,{key:1},[createBaseVNode("span",_hoisted_1$p,toDisplayString(o.$t("kbView.keybindingInput.empty")),1),createVNode(unref(Plus),{class:"ml-2 size-4"})],64))]),_:1}))}}),_sfc_main$S=defineComponent({__name:"ResetButton",props:{item:{}},setup(r){return(e,n)=>(openBlock(),createBlock(unref(_sfc_main$1G),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1E),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1I),{variant:"ghost",size:"icon",onClick:n[0]||(n[0]=o=>e.item.value.value=e.item.defaultValue)},{default:withCtx(()=>[createVNode(unref(RefreshCcw),{class:"size-4"})]),_:1})]),_:1}),createVNode(unref(_sfc_main$1F),null,{default:withCtx(()=>[createTextVNode(toDisplayString(e.$t("kbView.settingsPanel.reset")),1)]),_:1})]),_:1}))}}),_hoisted_1$o={class:"flex items-center gap-2"},_hoisted_2$b={key:0,class:"text-red-500 text-sm mt-2"},_sfc_main$R=defineComponent({__name:"TextInputComp",props:{item:{}},setup(r){const e=r,n=computed(()=>{const o=e.item.componentType.validator;if(o)return o(e.item.value.value)});return(o,s)=>(openBlock(),createElementBlock("div",null,[createBaseVNode("div",_hoisted_1$o,[createVNode(unref(_sfc_main$1H),{modelValue:o.item.value.value,"onUpdate:modelValue":s[0]||(s[0]=a=>o.item.value.value=a)},null,8,["modelValue"]),createVNode(_sfc_main$S,{item:o.item},null,8,["item"])]),n.value?(openBlock(),createElementBlock("div",_hoisted_2$b,toDisplayString(n.value),1)):createCommentVNode("",!0)]))}}),_hoisted_1$n={class:"flex items-center gap-2"},_sfc_main$Q=defineComponent({__name:"IntegerInputComp",props:{item:{}},setup(r){return(e,n)=>(openBlock(),createElementBlock("div",_hoisted_1$n,[createVNode(unref(_sfc_main$1H),{modelValue:e.item.value.value,"onUpdate:modelValue":n[0]||(n[0]=o=>e.item.value.value=o),type:"number",min:e.item.componentType.min,max:e.item.componentType.max},null,8,["modelValue","min","max"]),createVNode(_sfc_main$S,{item:e.item},null,8,["item"])]))}}),_hoisted_1$m={class:"relative"},_hoisted_2$a={key:0,class:"text-red-500 text-sm mt-2"},_hoisted_3$8={class:"absolute right-0 top-0 m-2"},_sfc_main$P=defineComponent({__name:"JsonComp",props:{item:{}},setup(r){const e=r,n=computed(()=>{const o=e.item.componentType.schema;if(o)return o.safeParse(e.item.value.value)});return(o,s)=>(openBlock(),createElementBlock("div",_hoisted_1$m,[createVNode(_sfc_main$1t,{class:"border rounded-md min-h-[100px] p-2 cursor-text",src:o.item.value.value,"onUpdate:src":s[0]||(s[0]=a=>o.item.value.value=a),lang:"json"},null,8,["src"]),n.value&&!n.value.success?(openBlock(),createElementBlock("div",_hoisted_2$a,toDisplayString(o.$t("kbView.settingsPanel.invalidJson")),1)):createCommentVNode("",!0),createBaseVNode("div",_hoisted_3$8,[createVNode(_sfc_main$S,{item:o.item},null,8,["item"])])]))}}),_hoisted_1$l={class:"flex items-center gap-2"},_sfc_main$O=defineComponent({__name:"KeybindingComp",props:{item:{}},setup(r){return(e,n)=>(openBlock(),createElementBlock("div",_hoisted_1$l,[createVNode(_sfc_main$T,{class:"my-2",modelValue:e.item.value.value,"onUpdate:modelValue":n[0]||(n[0]=o=>e.item.value.value=o)},null,8,["modelValue"]),createVNode(_sfc_main$S,{item:e.item},null,8,["item"])]))}}),_hoisted_1$k={class:"flex items-center gap-2"},_sfc_main$N=defineComponent({__name:"SelectComp",props:{item:{}},setup(r){const{locale:e}=useI18n();return(n,o)=>(openBlock(),createElementBlock("div",_hoisted_1$k,[createVNode(unref(_sfc_main$1N),{modelValue:n.item.value.value,"onUpdate:modelValue":o[0]||(o[0]=s=>n.item.value.value=s)},{default:withCtx(()=>[createVNode(unref(_sfc_main$1O),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1B))]),_:1}),createVNode(unref(_sfc_main$1P),null,{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment$1,null,renderList(n.item.componentType.options,s=>(openBlock(),createBlock(unref(_sfc_main$1Q),{key:s.value,value:s.value},{default:withCtx(()=>[createTextVNode(toDisplayString(unref(getTrans)(s.label,unref(e))),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),createVNode(_sfc_main$S,{item:n.item},null,8,["item"])]))}}),_sfc_main$M=defineComponent({__name:"Switch",props:{defaultChecked:{type:Boolean},checked:{type:Boolean},disabled:{type:Boolean},required:{type:Boolean},name:{},id:{},value:{},asChild:{type:Boolean},as:{},class:{}},emits:["update:checked"],setup(r,{emit:e}){const n=r,o=e,s=computed(()=>{const{class:l,...c}=n;return c}),a=xe(s,o);return(l,c)=>(openBlock(),createBlock(unref(mg),mergeProps(unref(a),{class:unref(cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",n.class)}),{default:withCtx(()=>[createVNode(unref(hg),{class:normalizeClass(unref(cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5"))},{default:withCtx(()=>[renderSlot(l.$slots,"thumb")]),_:3},8,["class"])]),_:3},16,["class"]))}}),_hoisted_1$j={class:"flex items-center gap-x-2 pt-2"},_sfc_main$L=defineComponent({__name:"SwitchComp",props:{item:{}},setup(r){return(e,n)=>(openBlock(),createElementBlock("div",_hoisted_1$j,[createVNode(unref(_sfc_main$M),{checked:e.item.value.value,"onUpdate:checked":n[0]||(n[0]=o=>e.item.value.value=o)},null,8,["checked"]),createVNode(_sfc_main$S,{item:e.item},null,8,["item"])]))}}),checkFontAvailability=r=>{const e=document.createElement("span");e.innerHTML=Array(100).join("wi"),e.style.cssText=["position: absolute","width: auto","font-size: 128px","left: -9999px"].join(" !important;");const n=c=>(e.style.fontFamily=c,e.clientWidth);document.body.appendChild(e);const o=n("monospace"),s=n("sans-serif"),a=n("serif"),l=r.map(c=>o!==n(c+" ,monospace")||s!==n(c+" ,sans-serif")||a!==n(c+" ,serif"));return document.body.removeChild(e),l},_hoisted_1$i={class:"flex items-center gap-2"},_hoisted_2$9={class:"flex items-center"},_hoisted_3$7={key:0,class:"text-muted-foreground ml-2"},_sfc_main$K=defineComponent({__name:"FontSelector",props:{item:{},fontList:{}},setup(r){const e=["Arial","Helvetica","Times New Roman","Courier New","Verdana","Tahoma","Trebuchet MS","Georgia","Impact","Palatino Linotype","Century Gothic","Gill Sans","Lucida Sans Unicode","Lucida Console","Comic Sans MS","Arial Black","Garamond","Franklin Gothic Medium","Book Antiqua","Calibri","Cambria","Candara","Consolas","Constantia","Corbel","Segoe UI","Segoe Print","Segoe Script","Optima","Rockwell","Baskerville","Didot","Futura","Geneva","Courier","Brush Script MT","Hobo Std","Papyrus","MS Serif","MS Sans Serif","Roboto","Open Sans","Lato","Montserrat","Source Sans Pro","Poppins","Raleway","Merriweather","Nunito","Playfair Display","Ubuntu","Noto Sans","Oswald","PT Sans","PT Serif","Work Sans","Cabin","Quicksand","Josefin Sans","Droid Sans","Inconsolata","Lobster","Pacifico","Indie Flower","Amatic SC","Anton","Abril Fatface","Bitter","Dancing Script","Exo 2","Fjalla One","Karla","Mulish","Righteous","Satisfy","Shadows Into Light","Signika","Slabo 27px","Zilla Slab","Overpass","Microsoft YaHei","SimSun","SimHei","FangSong","NSimSun","STXihei","STKaiti","STSong","STZhongsong","STHupo","STXinwei","STLiti","FangSong_GB2312","YouYuan","FZHei-B01S","FZShuSong-Z01","Source Han Sans","Source Han Serif","Monospace","Cursive"],n=checkFontAvailability(e);return(o,s)=>(openBlock(),createElementBlock("div",_hoisted_1$i,[createVNode(unref(_sfc_main$1N),{modelValue:o.item.value.value,"onUpdate:modelValue":s[0]||(s[0]=a=>o.item.value.value=a)},{default:withCtx(()=>[createVNode(unref(_sfc_main$1O),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1B),{class:"text-muted-foreground",placeholder:o.$t("kbView.fontSelector.notSpecified")},null,8,["placeholder"])]),_:1}),createVNode(unref(_sfc_main$1P),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1C),null,{default:withCtx(()=>[(openBlock(),createElementBlock(Fragment$1,null,renderList(e,(a,l)=>createVNode(unref(_sfc_main$1Q),{key:l,value:a,style:normalizeStyle({fontFamily:a})},{default:withCtx(()=>[createBaseVNode("div",_hoisted_2$9,[createBaseVNode("div",null,toDisplayString(a),1),unref(n)[l]?createCommentVNode("",!0):(openBlock(),createElementBlock("div",_hoisted_3$7,toDisplayString(o.$t("kbView.fontSelector.notAvailable")),1))])]),_:2},1032,["value","style"])),64))]),_:1})]),_:1})]),_:1},8,["modelValue"]),createVNode(_sfc_main$S,{item:o.item},null,8,["item"])]))}}),_sfc_main$J=defineComponent({__name:"AutoComplete",props:{onSelectItem:{type:Function}},setup(r){const e=ref({showSuggestions:!1,focusItemEl:void 0,itemEls:new Map,getContentEl:void 0,suppressMouseover:!1,emitInputValue:void 0,onSelectItem:r.onSelectItem});return provide("context",e),watch(()=>e.value.itemEls,()=>{const n=e.value.itemEls.keys().next().value;n&&(e.value.focusItemEl=n,n.scrollIntoView({block:"nearest"}))},{deep:!0}),(n,o)=>(openBlock(),createBlock(unref(_sfc_main$1x),{open:e.value.showSuggestions,"data-width":e.value.width},{default:withCtx(()=>[renderSlot(n.$slots,"default")]),_:3},8,["open","data-width"]))}}),_sfc_main$I=defineComponent({__name:"AutoCompleteTrigger",props:{asChild:{type:Boolean},class:{}},setup(r){const e=r,n=computed(()=>{const{class:s,...a}=e;return a}),o=At(n);return(s,a)=>(openBlock(),createBlock(unref(Ss),mergeProps(unref(o),{class:unref(cn)("",e.class)}),{default:withCtx(()=>[renderSlot(s.$slots,"default")]),_:3},16,["class"]))}}),_sfc_main$H=defineComponent({__name:"AutoCompleteInput",props:{defaultValue:{},modelValue:{},class:{}},emits:["update:modelValue"],setup(r,{emit:e}){const n=inject("context"),o=r,s=e,a=useVModel(o,"modelValue",s,{passive:!0,defaultValue:o.defaultValue});onMounted(()=>{n.value.emitInputValue=c=>{s("update:modelValue",c)}});const l=generateKeydownHandlerSimple({ArrowDown:{run:useThrottleFn(c=>{var f;if(c.isComposing||c.keyCode===229)return!1;const d=(f=n.value.getContentEl())==null?void 0:f.querySelectorAll(".AutoCompleteSuggestionItem");if(!d)return!1;const u=[...d].findIndex(p=>p instanceof HTMLElement&&p.dataset.focus==="true");if(u===-1)return!1;const m=u===d.length-1?0:u+1;return n.value.focusItemEl=d[m],n.value.suppressMouseover=!0,d[m].scrollIntoView({block:"nearest"}),setTimeout(()=>{n.value.suppressMouseover=!1},100),!0},100)},ArrowUp:{run:useThrottleFn(c=>{var f;if(c.isComposing||c.keyCode===229)return!1;const d=(f=n.value.getContentEl())==null?void 0:f.querySelectorAll(".AutoCompleteSuggestionItem");if(!d)return!1;const u=[...d].findIndex(p=>p instanceof HTMLElement&&p.dataset.focus==="true");if(u===-1)return!1;const m=u===0?d.length-1:u-1;return n.value.focusItemEl=d[m],n.value.suppressMouseover=!0,d[m].scrollIntoView({block:"nearest"}),setTimeout(()=>{n.value.suppressMouseover=!1},100),!0},100)},Enter:{run:c=>{if(c.isComposing||c.keyCode===229)return!1;const d=n.value.focusItemEl,u=n.value.itemEls;if(!d)return!1;const m=u.get(d);return n.value.onSelectItem?n.value.onSelectItem(m):s("update:modelValue",m),!0}}});return(c,d)=>(openBlock(),createBlock(unref(_sfc_main$1H),{modelValue:unref(a),"onUpdate:modelValue":d[0]||(d[0]=u=>isRef(a)?a.value=u:null),onFocus:d[1]||(d[1]=u=>unref(n).showSuggestions=!0),onBlur:d[2]||(d[2]=u=>unref(n).showSuggestions=!1),onKeydown:unref(l),class:normalizeClass(unref(cn)("",o.class))},null,8,["modelValue","onKeydown","class"]))}}),_sfc_main$G=defineComponent({__name:"AutoCompleteContent",props:{class:{}},setup(r){const e=ref(null),n=inject("context"),o=r,s=computed(()=>{const{class:l,...c}=o;return c}),a=At(s);return onMounted(()=>{n.value.getContentEl=()=>e.value}),(l,c)=>(openBlock(),createBlock(unref(_sfc_main$1w),mergeProps(unref(a),{class:unref(cn)("pl-2 pr-1 py-2",o.class),sticky:"always",style:{width:"var(--radix-popover-trigger-width)"}}),{default:withCtx(()=>[createBaseVNode("div",{ref_key:"elRef",ref:e,class:"overflow-y-auto max-h-[50vh] pr-1"},[renderSlot(l.$slots,"default")],512)]),_:3},16,["class"]))}}),_hoisted_1$h=["data-focus"],_sfc_main$F=defineComponent({__name:"AutoCompleteSuggestionItem",props:{value:{},class:{}},setup(r){const e=inject("context"),n=ref(null),o=r,s=computed(()=>{const{class:l,...c}=o;return c}),a=At(s);return onMounted(()=>{const l=n.value;l&&e.value.itemEls.set(l,o.value)}),onBeforeUnmount(()=>{const l=n.value;l&&e.value.itemEls.delete(l)}),(l,c)=>(openBlock(),createElementBlock("div",mergeProps(unref(a),{ref_key:"elRef",ref:n,onMouseover:c[0]||(c[0]=()=>!unref(e).suppressMouseover&&(unref(e).focusItemEl=n.value)),"data-focus":unref(e).focusItemEl===n.value,tabindex:"-1",class:unref(cn)("AutoCompleteSuggestionItem flex cursor-default outline-none text-sm transition-colors select-none items-center data-[focus=true]:bg-accent data-[focus=true]:text-accent-foreground rounded-sm px-2 py-1.5",o.class)}),[renderSlot(l.$slots,"default")],16,_hoisted_1$h))}}),_sfc_main$E={},_hoisted_1$g={class:"flex items-center justify-center text-sm text-muted-foreground py-2"};function _sfc_render$5(r,e){return openBlock(),createElementBlock("div",_hoisted_1$g,[renderSlot(r.$slots,"default")])}const AutoCompleteNoResult=_export_sfc(_sfc_main$E,[["render",_sfc_render$5]]),_hoisted_1$f={class:"flex items-center gap-2"},_hoisted_2$8={key:0,class:"text-red-500 text-sm mt-2"},_sfc_main$D=defineComponent({__name:"BlockIdInputComp",props:{item:{}},setup(r){const e=r,{blocksManager:n}=BlocksContext.useContext(),{search:o}=IndexContext.useContext(),{t:s}=useI18n(),a=ref([]),l=computed(()=>{const p=e.item.value.value;return p.length==0?[]:hybridTokenize(p,!1,1)??[]}),c=ref(-1),d=ref([!0,!1,!1,!1,!1]),u=computed(()=>{const p=e.item.value.value;if(!(p.trim().length!==0&&n.getBlock(p.trim())))return s("kbView.settingsPanel.invalidBlockId")}),m=()=>{const p=e.item.value.value;if(p.trim().length===0){a.value=[];return}a.value=o(p).map(g=>n.getBlock(g)).filter(g=>g!==null).filter(g=>g.type=="normalBlock"&&d.value[g.content[0]]),c.value=a.value.length>0?0:-1},f=useDebounceFn(p=>{p.isComposing||m()},500);return(p,g)=>(openBlock(),createElementBlock(Fragment$1,null,[createBaseVNode("div",_hoisted_1$f,[createVNode(unref(_sfc_main$J),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$I),{"as-child":""},{default:withCtx(()=>[createVNode(unref(_sfc_main$H),{modelValue:p.item.value.value,"onUpdate:modelValue":g[0]||(g[0]=y=>p.item.value.value=y),onInput:unref(f)},null,8,["modelValue","onInput"])]),_:1}),createVNode(unref(_sfc_main$G),null,{default:withCtx(()=>[a.value.length==0?(openBlock(),createBlock(unref(AutoCompleteNoResult),{key:0},{default:withCtx(()=>[createTextVNode(toDisplayString(p.$t("kbView.settingsPanel.noResult")),1)]),_:1})):createCommentVNode("",!0),(openBlock(!0),createElementBlock(Fragment$1,null,renderList(a.value,y=>(openBlock(),createBlock(unref(_sfc_main$F),{value:y.id,key:y.id},{default:withCtx(()=>[(openBlock(),createBlock(_sfc_main$1f,{key:y.id,readonly:!0,block:y,"highlight-terms":l.value},null,8,["block","highlight-terms"]))]),_:2},1032,["value"]))),128))]),_:1})]),_:1}),createVNode(_sfc_main$S,{item:p.item},null,8,["item"])]),u.value?(openBlock(),createElementBlock("div",_hoisted_2$8,toDisplayString(u.value),1)):createCommentVNode("",!0)],64))}}),_hoisted_1$e={class:"left w-[200px] bg-sidebar-bg border-r p-2 pr-1 flex flex-col text-sidebar-fg"},_hoisted_2$7={class:"flex flex-col gap-1"},_hoisted_3$6={class:"right w-0 flex flex-col items-center flex-grow pr-1"},_hoisted_4$5={class:"flex flex-col gap-y-6 w-full overflow-y-auto overflow-x-hidden px-4 py-8"},_sfc_main$C=defineComponent({__name:"SettingsPanel",setup(r){const{locale:e}=useI18n(),{open:n,activeGroupKey:o}=SettingsPanelContext.useContext(),{settingGroups:s,getAllSettingItemsInGroup:a}=SettingsContext.useContext();return(l,c)=>(openBlock(),createBlock(unref(_sfc_main$1T),{open:unref(n),"onUpdate:open":c[0]||(c[0]=d=>isRef(n)?n.value=d:null)},{default:withCtx(()=>[createVNode(unref(_sfc_main$1S),{class:"flex flex-row gap-0 max-w-[80vw] max-h-[80vh] w-[800px] h-[600px] p-0 !outline-none"},{default:withCtx(()=>[createVNode(unref(_sfc_main$1J),{class:"hidden"},{default:withCtx(()=>[createVNode(unref(_sfc_main$1K),null,{default:withCtx(()=>[createTextVNode(toDisplayString(l.$t("kbView.settingsPanel.title")),1)]),_:1})]),_:1}),createBaseVNode("div",_hoisted_1$e,[c[1]||(c[1]=createBaseVNode("div",{class:"text-sm text-muted-foreground font-semibold px-4 py-2"},"Settings",-1)),createBaseVNode("div",_hoisted_2$7,[(openBlock(!0),createElementBlock(Fragment$1,null,renderList(unref(s),d=>(openBlock(),createBlock(unref(_sfc_main$1I),{key:d.key,variant:"ghost","data-active":d.key===unref(o),class:"w-full h-7 justify-start font-normal text-sidebar-fg data-[active=true]:bg-accent",onClick:u=>o.value=d.key},{default:withCtx(()=>[createTextVNode(toDisplayString(unref(getTrans)(d.label,unref(e))),1)]),_:2},1032,["data-active","onClick"]))),128))])]),createBaseVNode("div",_hoisted_3$6,[createBaseVNode("div",_hoisted_4$5,[(openBlock(!0),createElementBlock(Fragment$1,null,renderList(unref(a)(unref(o)),d=>(openBlock(),createElementBlock("div",{class:"flex flex-col",key:d.id},[createVNode(unref(_sfc_main$1M),{class:"mb-2"},{default:withCtx(()=>[createTextVNode(toDisplayString(unref(getTrans)(d.label,unref(e))),1)]),_:2},1024),d.desc?(openBlock(),createBlock(unref(_sfc_main$1M),{key:0,class:"text-[.8em] text-muted-foreground mb-2 whitespace-pre-wrap"},{default:withCtx(()=>[createTextVNode(toDisplayString(unref(getTrans)(d.desc,unref(e))),1)]),_:2},1024)):createCommentVNode("",!0),d.componentType.type==="textInput"?(openBlock(),createBlock(_sfc_main$R,{key:1,item:d},null,8,["item"])):d.componentType.type==="integerInput"?(openBlock(),createBlock(_sfc_main$Q,{key:2,item:d},null,8,["item"])):d.componentType.type==="json"?(openBlock(),createBlock(_sfc_main$P,{key:3,item:d},null,8,["item"])):d.componentType.type==="keybindingInput"?(openBlock(),createBlock(_sfc_main$O,{key:4,item:d},null,8,["item"])):d.componentType.type==="select"?(openBlock(),createBlock(_sfc_main$N,{key:5,item:d},null,8,["item"])):d.componentType.type==="switch"?(openBlock(),createBlock(_sfc_main$L,{key:6,item:d},null,8,["item"])):d.componentType.type==="fontSelector"?(openBlock(),createBlock(_sfc_main$K,{key:7,item:d},null,8,["item"])):d.componentType.type==="blockIdInput"?(openBlock(),createBlock(_sfc_main$D,{key:8,item:d},null,8,["item"])):createCommentVNode("",!0)]))),128))])])]),_:1})]),_:1},8,["open"]))}}),createCreateNewTreeDialogContext=createContext(()=>{const r=ref(!1),e=ref("waiting");return{open:r,status:e,openCreateNewTreeDialog:()=>{r.value=!0,e.value="waiting"},closeCreateNewTreeDialog:()=>{r.value=!1,e.value="waiting"}}}),_sfc_main$B=defineComponent({__name:"FloatingMathInput",setup(r){const e=ref(null),n=computed({get:()=>e.value!==null,set:g=>!g&&(e.value=null)}),o=ref(""),s=ref(null),{registerFloatingMathInput:a}=FloatingMathInputContext.useContext();let l=null,c=null,d=null,u=null,m=null,f=null;const p=()=>[EditorView.lineWrapping,keymap.of([{key:"Escape",run:()=>(n.value=!1,m==null||m(),!0),stopPropagation:!0},{key:"ArrowLeft",run:()=>{var b;const g=(b=s.value)==null?void 0:b.getEditorView();if(!g)return!1;const y=g.state.selection;return y.ranges.length===1&&y.ranges[0].empty&&y.ranges[0].anchor===0?(n.value=!1,d==null||d(),!0):!1}},{key:"ArrowRight",run:()=>{var k;const g=(k=s.value)==null?void 0:k.getEditorView();if(!g)return!1;const y=g.state.selection,b=g.state.doc.length;return y.ranges.length===1&&y.ranges[0].empty&&y.ranges[0].head===b?(n.value=!1,u==null||u(),!0):!1}},{key:"Backspace",run:()=>{var y;const g=(y=s.value)==null?void 0:y.getEditorView();return g&&g.state.doc.length===0?(n.value=!1,f==null||f(),!0):!1}},{key:"Delete",run:()=>{var y;const g=(y=s.value)==null?void 0:y.getEditorView();return g&&g.state.doc.length===0?(n.value=!1,f==null||f(),!0):!1}}])];return watch(e,async()=>{var x;if(await nextTick(),!e.value)return;const g=document.querySelector("[data-radix-popper-content-wrapper]");if(!(g instanceof HTMLElement))return;const{x:y,y:b}=e.value,k=g.getBoundingClientRect(),w=(l==null?void 0:l.getBoundingClientRect())??{height:0},B=calcPopoverPos(k.width,k.height,y,b,{offset:v=>(v.leftUp.y-=w.height+10,v.rightUp.y-=w.height+10,v.leftDown.y+=10,v.rightDown.y+=10,v),avoidColideWith:l,minCollisionDist:10}),M=(x=s.value)==null?void 0:x.getEditorView();M&&(M.focus(),M.dispatch({selection:{anchor:0,head:M.state.doc.length}}),document.body.style.setProperty("--popover-x",`${B.rightDown.x}px`),document.body.style.setProperty("--popover-y",`${B.rightDown.y}px`))}),onMounted(()=>{a((g,y,b,k,w,B,M)=>{l=g,o.value=y,c=b,d=k,u=w,m=B,f=M;const x=l.getBoundingClientRect();e.value={x:x.left+x.width/2,y:x.bottom}})}),(g,y)=>(openBlock(),createBlock(unref(_sfc_main$1x),{open:n.value,"onUpdate:open":y[2]||(y[2]=b=>n.value=b)},{default:withCtx(()=>[createVNode(unref(_sfc_main$1v)),createVNode(unref(_sfc_main$1w),{class:"ref-suggestions-content p-2 pb-1",onPointerDownOutside:y[1]||(y[1]=()=>{var b;return(b=unref(m))==null?void 0:b()}),"trap-focus":"",tabindex:"-1"},{default:withCtx(()=>[createVNode(_sfc_main$1t,{src:o.value,"onUpdate:src":y[0]||(y[0]=b=>o.value=b),class:"flex-grow",ref_key:"codeMirror",ref:s,lang:"latex",extensionsBuilder:p,"on-src-changed":unref(c)??void 0},null,8,["src","on-src-changed"]),createVNode(_sfc_main$1M,{class:"text-muted-foreground text-[.8em] font-normal text-right mr-2"},{default:withCtx(()=>y[3]||(y[3]=[createTextVNode('Press "Esc" to close')])),_:1})]),_:1})]),_:1},8,["open"]))}}),_sfc_main$A=defineComponent({__name:"Checkbox",props:{defaultChecked:{type:Boolean},checked:{type:[Boolean,String]},disabled:{type:Boolean},required:{type:Boolean},name:{},value:{},id:{},asChild:{type:Boolean},as:{},class:{}},emits:["update:checked"],setup(r,{emit:e}){const n=r,o=e,s=computed(()=>{const{class:l,...c}=n;return c}),a=xe(s,o);return(l,c)=>(openBlock(),createBlock(unref(zv),mergeProps(unref(a),{class:unref(cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",n.class)}),{default:withCtx(()=>[createVNode(unref(Kv),{class:"flex h-full w-full items-center justify-center text-current"},{default:withCtx(()=>[renderSlot(l.$slots,"default",{},()=>[createVNode(unref(Check),{class:"h-4 w-4"})])]),_:3})]),_:3},16,["class"]))}}),_hoisted_1$d={class:"relative border-b"},_hoisted_2$6={class:"absolute left-3 top-1/2 -translate-y-1/2"},_hoisted_3$5={class:"absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-x-2"},_hoisted_4$4={class:"text-[.8em] text-muted-foreground mb-1"},_hoisted_5$1={class:"text-[.8em]"},_hoisted_6={key:0,class:"max-h-[60vh] overflow-y-auto pt-2 px-2 mr-1"},_hoisted_7=["onMouseover"],_hoisted_8={key:1,class:"text-center text-sm text-muted-foreground pt-4 pb-2"},_hoisted_9={key:1,class:"text-center text-sm text-muted-foreground pt-4 pb-2"},_hoisted_10={key:2,class:"text-center text-xs text-muted2-foreground py-2"},_hoisted_11={key:3,class:"text-center text-xs text-muted2-foreground py-2"},_sfc_main$z=defineComponent({__name:"FusionCommand",setup(r){const e=BlockTreeContext.useContext(),{inputText:n,mode:o,blockSearchResult:s,focusIndex:a,contentEl:l,suppressMouseOver:c,open:d,allowedBlockTypes:u,queryTerms:m,updateBlockSearchResult:f}=FusionCommandContext.useContext(),p=useDebounceFn(B=>{B.isComposing||o.value==="searchBlock"&&f()},500),g=()=>{n.value="",s.value=[]},y=()=>{setTimeout(()=>{var M;const B=(M=l.value)==null?void 0:M.querySelector(".fusion-command-content .focus");B instanceof HTMLElement&&B.scrollIntoView({block:"nearest"})})},b=(B,M=500)=>(c.value=!0,setTimeout(()=>c.value=!1,M),B()),k=()=>{if(a.value===-1)return!1;const B=s.value[a.value];if(!B)return!1;const M=e.getBlockTree("main");if(!M)return!1;d.value=!1;const x=M.findDi(v=>v.type==="basic-block"&&v.block.id===B.id);x&&M.focusDi(x.itemId,{highlight:!0,expandIfFold:!0})},w=generateKeydownHandlerSimple({ArrowUp:{run:B=>B.isComposing||B.keyCode===229?!1:b(()=>(a.value>0?a.value--:a.value=s.value.length-1,y(),!0)),stopPropagation:!0,preventDefault:!0},ArrowDown:{run:B=>B.isComposing||B.keyCode===229?!1:b(()=>(a.value<s.value.length-1?a.value++:a.value=0,y(),!0)),stopPropagation:!0,preventDefault:!0},Home:{run:B=>B.isComposing||B.keyCode===229?!1:b(()=>(a.value=0,y(),!0)),stopPropagation:!0,preventDefault:!0},End:{run:B=>B.isComposing||B.keyCode===229?!1:b(()=>(a.value=s.value.length-1,y(),!0)),stopPropagation:!0,preventDefault:!0},Enter:{run:B=>B.isComposing||B.keyCode===229?!1:(k(),!0),stopPropagation:!0,preventDefault:!0},"Mod-Enter":{run:B=>!(B.isComposing||B.keyCode===229),stopPropagation:!0,preventDefault:!0},Escape:{run:B=>B.isComposing||B.keyCode===229?!1:(d.value=!1,!0),stopPropagation:!0,preventDefault:!0}});return(B,M)=>(openBlock(),createBlock(unref(_sfc_main$1T),{class:"fusion-command",open:unref(d),"onUpdate:open":M[3]||(M[3]=x=>isRef(d)?d.value=x:null)},{default:withCtx(()=>[createVNode(unref(_sfc_main$1S),{class:"fusion-command-content fixed left-1/2 top-1/2 z-50 w-full max-w-lg -translate-x-1/2 -translate-y-1/2 bg-background border p-0 [&>button]:hidden overflow-hidden gap-y-0"},{default:withCtx(()=>[createVNode(unref(_sfc_main$1J),{class:"hidden"},{default:withCtx(()=>[createVNode(unref(_sfc_main$1K)),createVNode(unref(_sfc_main$1L))]),_:1}),createBaseVNode("div",{ref_key:"contentEl",ref:l,onKeydown:M[2]||(M[2]=(...x)=>unref(w)&&unref(w)(...x))},[createBaseVNode("div",_hoisted_1$d,[createVNode(unref(_sfc_main$1H),{class:"border-none relative focus-visible:ring-0 focus-visible:ring-offset-0 outline-none pl-10 pr-20",modelValue:unref(n),"onUpdate:modelValue":M[0]||(M[0]=x=>isRef(n)?n.value=x:null),placeholder:B.$t("kbView.fusionCommand.searchPlaceholder"),onInputCapture:unref(p),onCompositionend:unref(p)},null,8,["modelValue","placeholder","onInputCapture","onCompositionend"]),createBaseVNode("div",_hoisted_2$6,[unref(o)==="searchBlock"?(openBlock(),createBlock(unref(Search),{key:0,class:"size-4"})):(openBlock(),createBlock(unref(Command),{key:1,class:"size-4"}))]),createBaseVNode("div",_hoisted_3$5,[unref(o)==="searchBlock"?(openBlock(),createBlock(unref(_sfc_main$1x),{key:0},{default:withCtx(()=>[createVNode(unref(_sfc_main$1v),null,{default:withCtx(()=>[createVNode(unref(SlidersHorizontal),{class:"size-4 text-muted-foreground hover:text-foreground transition cursor-pointer"})]),_:1}),createVNode(unref(_sfc_main$1w),{class:"w-40 p-2"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_4$4,toDisplayString(B.$t("kbView.fusionCommand.allowedBlockTypes")),1),(openBlock(!0),createElementBlock(Fragment$1,null,renderList(unref(u),(x,v)=>(openBlock(),createElementBlock("div",{key:v,class:"flex items-center gap-x-1"},[createVNode(_sfc_main$A,{checked:unref(u)[v],class:"size-3 mr-1","onUpdate:checked":_=>unref(u)[v]=_},null,8,["checked","onUpdate:checked"]),createBaseVNode("div",_hoisted_5$1,toDisplayString(unref(BLOCK_TYPE_ZH_NAMES)[v]),1)]))),128))]),_:1})]),_:1})):createCommentVNode("",!0),createVNode(unref(Delete),{class:"size-4 text-muted-foreground hover:text-foreground transition cursor-pointer",onClick:g})])]),unref(o)==="searchBlock"?(openBlock(),createElementBlock(Fragment$1,{key:0},[unref(s).length>0?(openBlock(),createElementBlock("div",_hoisted_6,[(openBlock(!0),createElementBlock(Fragment$1,null,renderList(unref(s),(x,v)=>(openBlock(),createElementBlock("div",{tabindex:"0",class:normalizeClass([{focus:unref(a)===v},"cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors [&.focus]:bg-accent [&.focus]:text-accent-foreground [&_.text-content]:cursor-default *:pointer-events-none"]),onMouseover:_=>!unref(c)&&(a.value=v),onClick:M[1]||(M[1]=_=>k())},[(openBlock(),createBlock(_sfc_main$1f,{key:x.id,readonly:!0,block:x,"highlight-terms":unref(m)},null,8,["block","highlight-terms"]))],42,_hoisted_7))),256))])):(openBlock(),createElementBlock("div",_hoisted_8,toDisplayString(B.$t("kbView.fusionCommand.noResults")),1))],64)):(openBlock(),createElementBlock(Fragment$1,{key:1},[unref(s).length>0?(openBlock(),createBlock(_sfc_main$1h,{key:0,"max-height":"60vh"},{default:withCtx(()=>M[4]||(M[4]=[createBaseVNode("div",{class:"px-2 py-2"},null,-1)])),_:1})):(openBlock(),createElementBlock("div",_hoisted_9,toDisplayString(B.$t("kbView.fusionCommand.noCommandResults")),1))],64)),unref(o)==="searchBlock"?(openBlock(),createElementBlock("div",_hoisted_10,toDisplayString(B.$t("kbView.fusionCommand.searchHelp")),1)):(openBlock(),createElementBlock("div",_hoisted_11,toDisplayString(B.$t("kbView.fusionCommand.commandHelp")),1))],544)]),_:1})]),_:1},8,["open"]))}}),BlockContentSchema_v1=z.discriminatedUnion("type",[z.object({type:z.literal("text"),docContent:z.any()}),z.object({type:z.literal("image"),path:z.string(),uploadStatus:z.union([z.literal("notUploaded"),z.literal("uploading"),z.literal("uploaded")]),align:z.union([z.literal("left"),z.literal("center")]),caption:z.string().optional(),width:z.number().optional()}),z.object({type:z.literal("code"),code:z.string(),lang:z.string().optional()}),z.object({type:z.literal("mathDisplay"),src:z.string()})]),NormalBlockSchema_v1=z.object({id:z.string().uuid(),type:z.literal("normalBlock"),parent:z.union([z.string().uuid(),z.literal("null")]),childrenIds:z.array(z.string().uuid()),fold:z.boolean(),content:BlockContentSchema_v1,metadata:z.any()}),MirrorBlockSchema_v1=z.object({id:z.string().uuid(),type:z.literal("mirrorBlock"),parent:z.string().uuid(),childrenIds:z.array(z.string().uuid()),fold:z.boolean(),src:z.string().uuid()}),VirtualBlockSchema_v1=z.object({id:z.string().uuid(),type:z.literal("virtualBlock"),parent:z.string().uuid(),childrenIds:z.union([z.array(z.string().uuid()),z.literal("null")]),fold:z.boolean(),src:z.string().uuid()}),BlockSchema_v1=z.discriminatedUnion("type",[NormalBlockSchema_v1,MirrorBlockSchema_v1,VirtualBlockSchema_v1]),BackupSchema_v1=z.object({blocks:z.array(BlockSchema_v1)}),parseV1Backup=r=>{const e=BackupSchema_v1.safeParse(JSON.parse(r));if(!e.success)return console.warn("Invalid backup",e.error),null;const n=o=>({id:o.id,type:o.type,fold:o.fold,parentId:o.parent,childrenIds:o.childrenIds=="null"?[]:o.childrenIds,...o.type==="normalBlock"?{content:o.content.type==="text"?[BLOCK_CONTENT_TYPES.TEXT,o.content.docContent]:o.content.type==="code"?[BLOCK_CONTENT_TYPES.CODE,o.content.code,o.content.lang]:o.content.type=="image"?[BLOCK_CONTENT_TYPES.IMAGE,o.content.path,o.content.align,o.content.caption,o.content.width]:o.content.type=="mathDisplay"?[BLOCK_CONTENT_TYPES.MATH,o.content.src]:void 0,metadata:o.metadata}:{},...o.type==="mirrorBlock"?{src:o.src}:{},...o.type==="virtualBlock"?{src:o.src,childrenCreated:o.childrenIds!="null"}:{}});return e.data.blocks.map(n).filter(o=>!!o)},importBlocks=(r,e)=>{const n=[],o=new Set(r.map(c=>c.id)),s=[];for(const c of r)o.has(c.parentId)||(c.parentId="root",n.push(c)),s.push(c);console.log(n);const a=e.createBlockTransaction({type:"ui"});s.reverse();for(const c of s)a.addBlock(c);const l=e.getBlock("root");l&&(a.updateBlock({...l,childrenIds:[...l.childrenIds,n[0].id]}),a.commit())},_sfc_main$y=defineComponent({__name:"Importer",props:{open:{type:Boolean},openModifiers:{}},emits:["update:open"],setup(r){const e=ref(null),n=useModel(r,"open"),o=ref("idle"),{blocksManager:s}=BlocksContext.useContext(),a=c=>{const d=c.target;d.files&&(e.value=d.files[0])},l=async()=>{if(o.value==="idle"){if(!e.value)throw new Error("IMPOSSIBLE");o.value="importing";try{const c=await e.value.text(),d=parseV1Backup(c);await importBlocks(d,s),o.value="success"}catch(c){console.error(c),o.value="error"}}else o.value==="error"?o.value="idle":o.value==="success"&&(n.value=!1)};return(c,d)=>(openBlock(),createBlock(unref(_sfc_main$1T),{class:"importer",open:n.value,"onUpdate:open":d[1]||(d[1]=u=>n.value=u)},{default:withCtx(()=>[createVNode(unref(_sfc_main$1S),{class:"max-w-[340px]"},{default:withCtx(()=>[createVNode(unref(_sfc_main$1J),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1K),null,{default:withCtx(()=>d[2]||(d[2]=[createTextVNode("\u5BFC\u5165")])),_:1})]),_:1}),createVNode(unref(_sfc_main$1H),{type:"file",accept:"application/json",multiple:!1,onChange:a}),createVNode(unref(_sfc_main$1R),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1I),{variant:"outline",size:"sm",onClick:d[0]||(d[0]=u=>n.value=!1)},{default:withCtx(()=>d[3]||(d[3]=[createTextVNode("\u53D6\u6D88")])),_:1}),createVNode(unref(_sfc_main$1I),{type:"submit",size:"sm",disabled:!e.value,onClick:l},{default:withCtx(()=>[o.value==="idle"?(openBlock(),createElementBlock(Fragment$1,{key:0},[createTextVNode(" \u5BFC\u5165 ")],64)):o.value==="importing"?(openBlock(),createElementBlock(Fragment$1,{key:1},[createVNode(unref(LoaderCircle),{class:"size-4 mr-2 animate-spin"}),d[4]||(d[4]=createTextVNode(" \u6B63\u5728\u5BFC\u5165... "))],64)):o.value==="success"?(openBlock(),createElementBlock(Fragment$1,{key:2},[createVNode(unref(Check),{class:"size-4 mr-2"}),d[5]||(d[5]=createTextVNode(" \u5BFC\u5165\u6210\u529F "))],64)):(openBlock(),createElementBlock(Fragment$1,{key:3},[createVNode(unref(X),{class:"size-4 mr-2"}),d[6]||(d[6]=createTextVNode(" \u5BFC\u5165\u5931\u8D25 "))],64))]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"]))}}),AttachmentsManagerContext=createContext(()=>{const{dbBasePath:r,attachmentsBasePath:e,attachmentsFolderName:n}=PathsContext.useContext(),o=ref(!1),s=ref({}),a=ref("idle"),l=ref("idle"),c=ref([]),d=ref(null),u=ref("alphabet"),m=computed(()=>{let p=s.value;for(const g of c.value)if(g in p&&p[g].isDirectory)p=p[g].subDirents;else return{};return p}),f=computed(()=>Object.values(m.value).sort((p,g)=>p.isDirectory&&!g.isDirectory?-1:!p.isDirectory&&g.isDirectory?1:u.value==="alphabet"?p.name.localeCompare(g.name):0));return{open:o,files:s,refetchFiles:async(p,g)=>{a.value="fetching";const y=await fsLs({basePath:p??"",includeHidden:!0,recursive:!0,maxDepth:g??1e3});y.success?(s.value=y.data,a.value="success"):a.value="failed"},attachmentsFolderName:n,fetchFilesStatus:a,uploadStatus:l,currentPathSegments:c,dbBasePath:r,attachmentsBasePath:e,currentFiles:m,activeDirent:d,sortBy:u,orderedFiles:f}}),_sfc_main$x=defineComponent({__name:"CalendarCell",props:{date:{},asChild:{type:Boolean},as:{},class:{}},setup(r){const e=r,n=computed(()=>{const{class:s,...a}=e;return a}),o=At(n);return(s,a)=>(openBlock(),createBlock(unref(Wu),mergeProps({class:unref(cn)("relative h-9 w-9 p-0 text-center text-sm focus-within:relative focus-within:z-20 [&:has([data-selected])]:rounded-md [&:has([data-selected])]:bg-accent [&:has([data-selected][data-outside-view])]:bg-accent/50",e.class)},unref(o)),{default:withCtx(()=>[renderSlot(s.$slots,"default")]),_:3},16,["class"]))}}),_sfc_main$w=defineComponent({__name:"CalendarCellTrigger",props:{day:{},month:{},asChild:{type:Boolean},as:{},class:{}},setup(r){const e=r,n=computed(()=>{const{class:s,...a}=e;return a}),o=At(n);return(s,a)=>(openBlock(),createBlock(unref(Zu),mergeProps({class:unref(cn)(unref(buttonVariants)({variant:"ghost"}),"h-9 w-9 p-0 font-normal","[&[data-today]:not([data-selected])]:bg-accent [&[data-today]:not([data-selected])]:text-accent-foreground","data-[selected]:bg-primary data-[selected]:text-primary-foreground data-[selected]:opacity-100 data-[selected]:hover:bg-primary data-[selected]:hover:text-primary-foreground data-[selected]:focus:bg-primary data-[selected]:focus:text-primary-foreground","data-[disabled]:text-muted-foreground data-[disabled]:opacity-50","data-[unavailable]:text-destructive-foreground data-[unavailable]:line-through","data-[outside-view]:text-muted-foreground data-[outside-view]:opacity-50 [&[data-outside-view][data-selected]]:bg-accent/50 [&[data-outside-view][data-selected]]:text-muted-foreground [&[data-outside-view][data-selected]]:opacity-30",e.class)},unref(o)),{default:withCtx(()=>[renderSlot(s.$slots,"default")]),_:3},16,["class"]))}}),_sfc_main$v=defineComponent({__name:"CalendarGrid",props:{asChild:{type:Boolean},as:{},class:{}},setup(r){const e=r,n=computed(()=>{const{class:s,...a}=e;return a}),o=At(n);return(s,a)=>(openBlock(),createBlock(unref(Hu),mergeProps({class:unref(cn)("w-full border-collapse space-y-1",e.class)},unref(o)),{default:withCtx(()=>[renderSlot(s.$slots,"default")]),_:3},16,["class"]))}}),_sfc_main$u=defineComponent({__name:"CalendarGridBody",props:{asChild:{type:Boolean},as:{}},setup(r){const e=r;return(n,o)=>(openBlock(),createBlock(unref(Yu),normalizeProps(guardReactiveProps(e)),{default:withCtx(()=>[renderSlot(n.$slots,"default")]),_:3},16))}}),_sfc_main$t=defineComponent({__name:"CalendarGridHead",props:{asChild:{type:Boolean},as:{}},setup(r){const e=r;return(n,o)=>(openBlock(),createBlock(unref(qu),normalizeProps(guardReactiveProps(e)),{default:withCtx(()=>[renderSlot(n.$slots,"default")]),_:3},16))}}),_sfc_main$s=defineComponent({__name:"CalendarGridRow",props:{asChild:{type:Boolean},as:{},class:{}},setup(r){const e=r,n=computed(()=>{const{class:s,...a}=e;return a}),o=At(n);return(s,a)=>(openBlock(),createBlock(unref(Xu),mergeProps({class:unref(cn)("flex",e.class)},unref(o)),{default:withCtx(()=>[renderSlot(s.$slots,"default")]),_:3},16,["class"]))}}),_sfc_main$r=defineComponent({__name:"CalendarHeadCell",props:{asChild:{type:Boolean},as:{},class:{}},setup(r){const e=r,n=computed(()=>{const{class:s,...a}=e;return a}),o=At(n);return(s,a)=>(openBlock(),createBlock(unref(ju),mergeProps({class:unref(cn)("w-9 rounded-md text-[0.8rem] font-normal text-muted-foreground",e.class)},unref(o)),{default:withCtx(()=>[renderSlot(s.$slots,"default")]),_:3},16,["class"]))}}),_sfc_main$q=defineComponent({__name:"CalendarHeader",props:{asChild:{type:Boolean},as:{},class:{}},setup(r){const e=r,n=computed(()=>{const{class:s,...a}=e;return a}),o=At(n);return(s,a)=>(openBlock(),createBlock(unref(zu),mergeProps({class:unref(cn)("relative flex w-full items-center justify-between pt-1",e.class)},unref(o)),{default:withCtx(()=>[renderSlot(s.$slots,"default")]),_:3},16,["class"]))}}),_sfc_main$p=defineComponent({__name:"CalendarHeading",props:{asChild:{type:Boolean},as:{},class:{}},setup(r){const e=r,n=computed(()=>{const{class:s,...a}=e;return a}),o=At(n);return(s,a)=>(openBlock(),createBlock(unref(Ku),mergeProps({class:unref(cn)("text-sm font-medium",e.class)},unref(o)),{default:withCtx(l=>[renderSlot(s.$slots,"default",{headingValue:l.headingValue},()=>[createTextVNode(toDisplayString(l.headingValue),1)])]),_:3},16,["class"]))}}),_sfc_main$o=defineComponent({__name:"CalendarNextButton",props:{step:{},nextPage:{type:Function},asChild:{type:Boolean},as:{},class:{}},setup(r){const e=r,n=computed(()=>{const{class:s,...a}=e;return a}),o=At(n);return(s,a)=>(openBlock(),createBlock(unref(Uu),mergeProps({class:unref(cn)(unref(buttonVariants)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100",e.class)},unref(o)),{default:withCtx(()=>[renderSlot(s.$slots,"default",{},()=>[createVNode(unref(ChevronRight),{class:"h-4 w-4"})])]),_:3},16,["class"]))}}),_sfc_main$n=defineComponent({__name:"CalendarPrevButton",props:{step:{},prevPage:{type:Function},asChild:{type:Boolean},as:{},class:{}},setup(r){const e=r,n=computed(()=>{const{class:s,...a}=e;return a}),o=At(n);return(s,a)=>(openBlock(),createBlock(unref(Gu),mergeProps({class:unref(cn)(unref(buttonVariants)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100",e.class)},unref(o)),{default:withCtx(()=>[renderSlot(s.$slots,"default",{},()=>[createVNode(unref(ChevronLeft),{class:"h-4 w-4"})])]),_:3},16,["class"]))}}),DAILY_NOTE_TAG="day",DailyNoteContext=createContext(()=>{const{registerSettingGroup:r,registerSettingItem:e}=SettingsContext.useContext(),{getBacklinks:n}=IndexContext.useContext(),{blocksManager:o,blockEditor:s,synced:a}=BlocksContext.useContext(),{toast:l}=useToast(),{t:c}=useI18n(),d=useTaskQueue(),{getBlockTree:u}=BlockTreeContext.useContext();watch(a,(B,M)=>{if(!M&&B){const x=getPmSchema({getBlockRef:o.getBlockRef});if(o.getBlock("day"))return;const v=o.createBlockTransaction({type:"ui"});v.addBlock({id:"day",type:"normalBlock",fold:!1,parentId:INTERNAL_BLOCK_PARENT_ID,childrenIds:[],content:plainTextToTextContent("Day",x),metadata:{}}),v.commit()}},{immediate:!0}),r({key:"dailynote",label:{zh:"\u6BCF\u65E5\u7B14\u8BB0"}});const m="dailynote.defaultDateFormat",f="YYYY-MM-DD",p=useLocalStorage(m,f);e({id:m,groupKey:"dailynote",defaultValue:f,label:{zh:"\u9ED8\u8BA4\u65E5\u671F\u683C\u5F0F"},desc:{zh:"\u521B\u5EFA\u65B0\u7684\u6BCF\u65E5\u7B14\u8BB0\u65F6\uFF0C\u9ED8\u8BA4\u4F7F\u7528\u7684\u65E5\u671F\u683C\u5F0F"},value:useWritableComputedRef(p),componentType:{type:"textInput"}});const g="dailynote.parentBlockOfNewDailyNote",y="",b=useLocalStorage(g,y);e({id:g,groupKey:"dailynote",defaultValue:y,label:{zh:"\u6BCF\u65E5\u7B14\u8BB0\u7684\u5B58\u653E\u4F4D\u7F6E"},desc:{zh:"\u521B\u5EFA\u7684\u65B0\u6BCF\u65E5\u7B14\u8BB0\u5C06\u4F1A\u653E\u5230\u8FD9\u4E2A\u5757\u4E0B\uFF08\u4F5C\u4E3A\u5B50\u5757\uFF09"},value:useWritableComputedRef(b),componentType:{type:"blockIdInput"}});const k=()=>[...n(DAILY_NOTE_TAG,"tag")],w=()=>{const B=k(),M={};for(const x of B){const v=o.getBlock(x);if(!v)continue;const _=dayjs(v.ctext).format("YYYY-MM-DD");M[_]=x}return M};return{defaultDateFormat:p,parentBlockOfNewDailyNote:b,getAllDailyNotes:k,getDateToDailyNote:w,createDailyNote:B=>{const M=u("main");if(!M)return;const x=w(),v=dayjs(B).format("YYYY-MM-DD"),_=getPmSchema({getBlockRef:o.getBlockRef});if(!x[v]){if(!b.value){l({title:c("kbView.dailynoteNavigator.dontKnowWhereToCreate.title"),description:c("kbView.dailynoteNavigator.dontKnowWhereToCreate.desc")});return}d.addTask(async()=>{const{newNormalBlockId:E}=s.insertNormalBlock({pos:{parentId:b.value,childIndex:"first"},content:contentNodesToPmNode([_.text(v+" "),_.nodes.blockRef_v2.create({toBlockId:"day",tag:!0})])})??{};if(E){await M.nextUpdate();const N=M.findDi(I=>I.type==="basic-block"&&I.block.id===E);N&&M.focusDi(N.itemId)}})}}}}),_hoisted_1$c={class:"flex flex-col gap-y-4 mt-4 sm:flex-row sm:gap-x-4 sm:gap-y-0"},_sfc_main$m=defineComponent({__name:"DailynoteNavigator",setup(r){const{getDateToDailyNote:e,createDailyNote:n}=DailyNoteContext.useContext(),{getBlockTree:o}=BlockTreeContext.useContext(),s=ref(!1),a=computed(()=>e()),l=d=>{const u=dayjs(d).format("YYYY-MM-DD");return a.value[u]!==void 0},c=d=>{const u=dayjs(d).format("YYYY-MM-DD"),m=a.value[u],f=o("main");if(f)if(m){const p=f.findDi(g=>g.type==="basic-block"&&g.block.id===m);p&&f.focusDi(p.itemId)}else n(d)};return(d,u)=>(openBlock(),createBlock(unref(_sfc_main$1x),{open:s.value,"onUpdate:open":u[0]||(u[0]=m=>s.value=m)},{default:withCtx(()=>[createVNode(unref(_sfc_main$1v),null,{default:withCtx(()=>[renderSlot(d.$slots,"default")]),_:3}),createVNode(unref(_sfc_main$1w),{class:"p-0"},{default:withCtx(()=>[createVNode(unref(Lu),{class:"p-3"},{default:withCtx(({grid:m,weekDays:f})=>[createVNode(unref(_sfc_main$q),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$n)),createVNode(unref(_sfc_main$p)),createVNode(unref(_sfc_main$o))]),_:1}),createBaseVNode("div",_hoisted_1$c,[(openBlock(!0),createElementBlock(Fragment$1,null,renderList(m,p=>(openBlock(),createBlock(unref(_sfc_main$v),{key:p.value.toString()},{default:withCtx(()=>[createVNode(unref(_sfc_main$t),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$s),null,{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment$1,null,renderList(f,g=>(openBlock(),createBlock(unref(_sfc_main$r),{key:g},{default:withCtx(()=>[createTextVNode(toDisplayString(g),1)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024),createVNode(unref(_sfc_main$u),null,{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment$1,null,renderList(p.rows,(g,y)=>(openBlock(),createBlock(unref(_sfc_main$s),{key:`weekDate-${y}`,class:"mt-2 w-full"},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment$1,null,renderList(g,b=>(openBlock(),createBlock(unref(_sfc_main$x),{key:b.toString(),date:b},{default:withCtx(()=>[createVNode(unref(_sfc_main$1G),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1E),{"as-child":""},{default:withCtx(()=>[createVNode(unref(_sfc_main$w),{day:b,month:p.value,"data-disabled":l(b)?void 0:!0,onClickCapture:withModifiers(k=>c(b.toDate()),["prevent","stop"])},null,8,["day","month","data-disabled","onClickCapture"])]),_:2},1024),createVNode(unref(_sfc_main$1F),null,{default:withCtx(()=>[createTextVNode(toDisplayString(l(b)?d.$t("kbView.dailynoteNavigator.gotoDailyNote"):d.$t("kbView.dailynoteNavigator.noDailyNote")),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["date"]))),128))]),_:2},1024))),128))]),_:2},1024)]),_:2},1024))),128))])]),_:1})]),_:1})]),_:3},8,["open"]))}}),_hoisted_1$b={key:1,class:"flex items-center"},_sfc_main$l=defineComponent({__name:"HeaderBarItem",props:{item:{},iconOnly:{type:Boolean},iconClass:{},labelClass:{}},setup(r){return(e,n)=>"itemComp"in e.item?(openBlock(),createBlock(resolveDynamicComponent(e.item.itemComp),{key:0})):(openBlock(),createElementBlock("div",_hoisted_1$b,[(openBlock(),createBlock(resolveDynamicComponent(e.item.icon),{class:normalizeClass(["size-5 stroke-[1.8]",e.iconClass+` ${e.iconOnly?"":"mr-3"}`])},null,8,["class"])),e.iconOnly?createCommentVNode("",!0):(openBlock(),createBlock(resolveDynamicComponent(e.item.label),{key:0,class:normalizeClass(e.labelClass)},null,8,["class"]))]))}}),_sfc_main$k=defineComponent({__name:"ContextMenu",props:{dir:{},modal:{type:Boolean}},emits:["update:open"],setup(r,{emit:e}){const n=xe(r,e);return(o,s)=>(openBlock(),createBlock(unref(om),normalizeProps(guardReactiveProps(unref(n))),{default:withCtx(()=>[renderSlot(o.$slots,"default")]),_:3},16))}}),_sfc_main$j=defineComponent({__name:"ContextMenuContent",props:{forceMount:{type:Boolean},loop:{type:Boolean},alignOffset:{},avoidCollisions:{type:Boolean},collisionBoundary:{},collisionPadding:{},sticky:{},hideWhenDetached:{type:Boolean},prioritizePosition:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},emits:["escapeKeyDown","pointerDownOutside","focusOutside","interactOutside","closeAutoFocus"],setup(r,{emit:e}){const n=r,o=e,s=computed(()=>{const{class:l,...c}=n;return c}),a=xe(s,o);return(l,c)=>(openBlock(),createBlock(unref(sm),null,{default:withCtx(()=>[createVNode(unref(rm$2),mergeProps(unref(a),{class:unref(cn)("z-50 min-w-32 overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n.class)}),{default:withCtx(()=>[renderSlot(l.$slots,"default")]),_:3},16,["class"])]),_:3}))}}),_sfc_main$i=defineComponent({__name:"ContextMenuTrigger",props:{disabled:{type:Boolean},asChild:{type:Boolean},as:{}},setup(r){const e=At(r);return(n,o)=>(openBlock(),createBlock(unref(lm),normalizeProps(guardReactiveProps(unref(e))),{default:withCtx(()=>[renderSlot(n.$slots,"default")]),_:3},16))}}),_sfc_main$h=defineComponent({__name:"LeftButtons",setup(r){const{currentIndex:e,historyItems:n,goPrev:o,goNext:s}=HistoryContext.useContext(),a=computed(()=>e.value<=0),l=computed(()=>e.value>=n.value.length);return(c,d)=>(openBlock(),createElementBlock(Fragment$1,null,[createVNode(unref(_sfc_main$k),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1$),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1G),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$i),{asChild:""},{default:withCtx(()=>[createVNode(unref(_sfc_main$1E),{asChild:""},{default:withCtx(()=>[createVNode(unref(_sfc_main$1I),{variant:"ghost",size:"icon",disabled:a.value,onClick:unref(o)},{default:withCtx(()=>[createVNode(unref(ArrowLeft),{class:"size-5"})]),_:1},8,["disabled","onClick"])]),_:1})]),_:1}),createVNode(unref(_sfc_main$1F),null,{default:withCtx(()=>[createTextVNode(toDisplayString(c.$t("kbView.history.goToPrev")),1)]),_:1})]),_:1})]),_:1}),createVNode(unref(_sfc_main$j))]),_:1}),createVNode(unref(_sfc_main$k),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1$),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1G),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$i),{asChild:""},{default:withCtx(()=>[createVNode(unref(_sfc_main$1E),{asChild:""},{default:withCtx(()=>[createVNode(unref(_sfc_main$1I),{variant:"ghost",size:"icon",disabled:l.value,onClick:unref(s)},{default:withCtx(()=>[createVNode(unref(ArrowRight),{class:"size-5"})]),_:1},8,["disabled","onClick"])]),_:1})]),_:1}),createVNode(unref(_sfc_main$1F),null,{default:withCtx(()=>[createTextVNode(toDisplayString(c.$t("kbView.history.goToNext")),1)]),_:1})]),_:1})]),_:1}),createVNode(unref(_sfc_main$j))]),_:1})],64))}}),_hoisted_1$a={class:"left-part"},_hoisted_2$5={class:"left-buttons"},_hoisted_3$4={class:"right-part flex flex-row items-center"},_hoisted_4$3={class:"right-buttons"},_sfc_main$g=defineComponent({__name:"HeaderBar",setup(r){const{sidePaneOpen:e,sidePaneDir:n,sidePaneWidth:o,enableSidePaneAnimation:s}=SidebarContext.useContext(),{open:a}=SettingsPanelContext.useContext(),{open:l}=AttachmentsManagerContext.useContext(),{theme:c,toggleTheme:d}=ThemeContext.useContext(),{focusModeEnabled:u}=FocusModeContext.useContext(),{timeMachineOpen:m}=TimeMachineContext.useContext(),{openFusionCommand:f}=FusionCommandContext.useContext(),{synced:p}=BlocksContext.useContext(),{mainRootBlockId:g}=MainTreeContext.useContext(),{logout:y}=ServerInfoContext.useContext(),b=ref(!1),{t:k}=useI18n(),{goPrev:w,goNext:B,canGoPrev:M,canGoNext:x}=HistoryContext.useContext(),v=A=>{g.value=A},_=computed(()=>e.value&&n.value==="right"?`${o.value}px`:"0px"),E=computed(()=>s.value?"padding 500ms var(--tf), opacity 500ms var(--tf)":"opacity 500ms var(--tf)"),N=A=>{var F;(F=A.target)==null||F.blur()};computed(()=>!M.value),computed(()=>!x.value);const I=[{icon:()=>createVNode(_sfc_main$m,null,{default:()=>[createVNode(CalendarDays,{class:"size-5 stroke-[1.8]"},null)]}),label:()=>k("kbView.headerBar.dailynoteNavigator"),onClick:()=>{}},{icon:()=>createVNode(Search,{class:"size-5 stroke-[1.8]"},null),label:()=>createVNode(Fragment$1,null,[k("kbView.headerBar.search")]),onClick:()=>f("")},{icon:()=>createVNode("div",null,[c.value==="dark"?createVNode(Moon,{class:"size-5 stroke-[1.8]"},null):createVNode(Sun,{class:"size-5 stroke-[1.8]"},null)]),label:()=>c.value==="dark"?k("kbView.headerBar.switchLightTheme"):k("kbView.headerBar.switchDarkTheme"),onClick:d},{icon:()=>createVNode(Bell,{class:"size-5 stroke-[1.8]"},null),label:()=>k("kbView.headerBar.notifications"),onClick:()=>{}},{icon:PanelRight,label:()=>e.value?k("kbView.headerBar.closeSidepane"):k("kbView.headerBar.openSidepane"),onClick:()=>e.value=!e.value,active:e}],L=[{icon:Download,label:()=>k("kbView.headerBar.export"),onClick:()=>{}},{icon:FolderInput,label:()=>k("kbView.headerBar.import"),onClick:()=>{console.log("open importer"),b.value=!0}},{icon:Focus,label:()=>u.value?k("kbView.headerBar.exitFocusMode"):k("kbView.headerBar.enterFocusMode"),onClick:()=>u.value=!u.value},{icon:FolderClosed,label:()=>k("kbView.headerBar.attachmentsManager"),onClick:()=>l.value=!0},{icon:History,label:()=>k("kbView.headerBar.timeMachine"),onClick:()=>m.value=!0},{icon:Settings$1,label:()=>k("kbView.headerBar.settings"),onClick:()=>a.value=!0},{icon:CircleHelp,label:()=>k("kbView.headerBar.help"),onClick:()=>{}},{icon:LogOut,label:()=>k("kbView.headerBar.exit"),onClick:y}];return(A,F)=>(openBlock(),createElementBlock("div",{class:"header-bar fixed top-0 left-0 flex flex-row justify-between items-center w-[calc(100vw-16px)] px-[8px] py-[10px] z-10 bg-background",style:normalizeStyle({paddingRight:_.value,transition:E.value})},[createBaseVNode("div",_hoisted_1$a,[createBaseVNode("div",_hoisted_2$5,[createVNode(_sfc_main$h)])]),createVNode(_sfc_main$18,{"block-id":unref(g),onClickPathSegment:v},null,8,["block-id"]),createBaseVNode("div",_hoisted_3$4,[createVNode(unref(_sfc_main$1G),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1E),null,{default:withCtx(()=>[createVNode(unref(Dot),{class:normalizeClass(["size-8",unref(p)?"stroke-green-500":"stroke-red-500"])},null,8,["class"])]),_:1}),createVNode(unref(_sfc_main$1F),null,{default:withCtx(()=>[createTextVNode(toDisplayString(unref(k)(`kbView.syncStatus.${unref(p)?"synced":"disconnected"}`)),1)]),_:1})]),_:1}),createBaseVNode("div",_hoisted_4$3,[(openBlock(),createElementBlock(Fragment$1,null,renderList(I,(se,H)=>createVNode(unref(_sfc_main$1G),{key:H},{default:withCtx(()=>[createVNode(unref(_sfc_main$1E),{asChild:""},{default:withCtx(()=>{var V;return[createVNode(unref(_sfc_main$1I),{variant:"ghost",size:"icon",class:normalizeClass((V=se.active)!=null&&V.value?"bg-muted":"w-fit min-w-8"),onFocus:N,onClick:se.onClick},{default:withCtx(()=>[createVNode(_sfc_main$l,{item:se,iconOnly:""},null,8,["item"])]),_:2},1032,["class","onClick"])]}),_:2},1024),createVNode(unref(_sfc_main$1F),null,{default:withCtx(()=>[(openBlock(),createBlock(resolveDynamicComponent(se.label)))]),_:2},1024)]),_:2},1024)),64))]),createVNode(unref(_sfc_main$1r),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1k),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1G),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1E),{asChild:""},{default:withCtx(()=>[createVNode(unref(_sfc_main$1I),{variant:"ghost",size:"icon",onFocus:N},{default:withCtx(()=>[createVNode(unref(EllipsisVertical),{class:"size-5 stroke-[1.8]"})]),_:1})]),_:1}),createVNode(unref(_sfc_main$1F),null,{default:withCtx(()=>F[1]||(F[1]=[createTextVNode(" \u66F4\u591A\u9009\u9879 ")])),_:1})]),_:1})]),_:1}),createVNode(unref(_sfc_main$1q),{class:"mr-2"},{default:withCtx(()=>[(openBlock(),createElementBlock(Fragment$1,null,renderList(L,(se,H)=>createVNode(unref(_sfc_main$1o),{key:H,onClick:se.onClick},{default:withCtx(()=>[createVNode(_sfc_main$l,{item:se,iconClass:"!size-4"},null,8,["item"])]),_:2},1032,["onClick"])),64))]),_:1})]),_:1})]),(openBlock(),createBlock(Teleport,{to:"body"},[createVNode(_sfc_main$y,{open:b.value,"onUpdate:open":F[0]||(F[0]=se=>b.value=se)},null,8,["open"])]))],4))}}),_hoisted_1$9={class:"right-pane z-20 overflow-hidden flex flex-col"},_hoisted_2$4={class:"flex items-center justify-center gap-x-2 mt-2 mb-2"},_hoisted_3$3={class:"h-0 flex-grow overflow-y-hidden overflow-x-hidden"},_hoisted_4$2={class:"absolute z-10 top-3 right-2"},_sfc_main$f=defineComponent({__name:"SidePane",setup(r){const{sidePaneDir:e,sidePaneOpen:n,sidePaneWidth:o,sidePaneHeight:s,enableSidePaneAnimation:a,sidePaneBlocks:l,sidePaneCurrentBlockId:c,hasPrev:d,hasNext:u,goPrev:m,goNext:f,dir:p}=SidebarContext.useContext(),g=[{icon:()=>createVNode("div",null,[e.value==="right"?createVNode(ArrowDownFromLine,{class:"size-5 stroke-[1.8]"},null):createVNode(ArrowRightFromLine,{class:"size-5 stroke-[1.8]"},null)]),label:()=>e.value==="right"?"\u4FA7\u680F\u79FB\u52A8\u5230\u5E95\u90E8":"\u4FA7\u680F\u79FB\u52A8\u5230\u53F3\u4FA7",onClick:()=>e.value=e.value==="right"?"bottom":"right"},{icon:X,label:()=>"\u5173\u95ED\u4FA7\u680F",onClick:()=>n.value=!1}],y=M=>{e.value==="right"?o.value=window.innerWidth-M.x:s.value=window.innerHeight-M.y},b=()=>{document.removeEventListener("mousemove",y),document.removeEventListener("mouseup",b),document.removeEventListener("mouseleave",b),a.value=!0},k=M=>{M.preventDefault(),M.stopPropagation(),a.value=!1,document.addEventListener("mousemove",y),document.addEventListener("mouseup",b),document.addEventListener("mouseleave",b)},w=(M,x)=>{const v=M.animate([{opacity:1,transform:"translateX(0)"},{opacity:0,transform:p.value==="right"?"translateX(-100%)":"translateX(100%)"}],{duration:300,easing:"cubic-bezier(0.4, 0, 0.2, 1)"});v.onfinish=x},B=(M,x)=>{if(!(M instanceof HTMLElement))return;const v=M.animate([{opacity:0,transform:p.value==="right"?"translateX(100%)":"translateX(-100%)"},{opacity:1,transform:"translateX(0)"}],{duration:300,delay:100,easing:"cubic-bezier(0.4, 0, 0.2, 1)"});v.onfinish=()=>{x()}};return(M,x)=>(openBlock(),createElementBlock("div",_hoisted_1$9,[createBaseVNode("div",_hoisted_2$4,[createVNode(unref(_sfc_main$1I),{disabled:!unref(d),variant:"outline",size:"icon",onClick:unref(m)},{default:withCtx(()=>[createVNode(unref(ChevronLeft),{class:"size-4 stroke-muted-foreground"})]),_:1},8,["disabled","onClick"]),createVNode(unref(_sfc_main$1r),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1k),{asChild:""},{default:withCtx(()=>[createVNode(unref(_sfc_main$1I),{variant:"outline",size:"sm",class:"h-8 min-w-[200px]"},{default:withCtx(()=>[createVNode(_sfc_main$18,{class:"pointer-events-none","include-self":!0,"block-id":unref(c)},null,8,["block-id"])]),_:1})]),_:1}),createVNode(unref(_sfc_main$1q),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1p),null,{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment$1,null,renderList(unref(l),v=>(openBlock(),createBlock(unref(_sfc_main$1o),{key:v.id,onClick:()=>c.value=v.id},{default:withCtx(()=>[createVNode(_sfc_main$18,{class:"pointer-events-none","include-self":!0,"block-id":v.id},null,8,["block-id"])]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1}),createVNode(unref(_sfc_main$1I),{disabled:!unref(u),variant:"outline",size:"icon",onClick:unref(f)},{default:withCtx(()=>[createVNode(unref(ChevronRight),{class:"size-4 stroke-muted-foreground"})]),_:1},8,["disabled","onClick"])]),createBaseVNode("div",_hoisted_3$3,[createVNode(Transition,{onLeave:w,onEnter:B,css:!1},{default:withCtx(()=>[unref(c)?(openBlock(),createBlock(_sfc_main$Z,{class:"h-full mr-1",key:unref(c),id:`side-pane-${unref(c)}`,"root-block-id":unref(c),"root-block-level":0,paddingBottom:20},null,8,["id","root-block-id"])):createCommentVNode("",!0)]),_:1})]),createBaseVNode("div",_hoisted_4$2,[(openBlock(),createElementBlock(Fragment$1,null,renderList(g,(v,_)=>createVNode(unref(_sfc_main$1G),{key:_},{default:withCtx(()=>[createVNode(unref(_sfc_main$1E),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1I),{variant:"ghost",size:"icon",onClick:v.onClick},{default:withCtx(()=>[(openBlock(),createBlock(resolveDynamicComponent(v.icon),{class:"size-5 stroke-[1.8]"}))]),_:2},1032,["onClick"])]),_:2},1024),createVNode(unref(_sfc_main$1F),null,{default:withCtx(()=>[(openBlock(),createBlock(resolveDynamicComponent(v.label)))]),_:2},1024)]),_:2},1024)),64))]),unref(e)==="bottom"?(openBlock(),createElementBlock("div",{key:0,class:"absolute top-0 z-10 left-0 w-full h-1 cursor-row-resize",onMousedown:k},null,32)):createCommentVNode("",!0),unref(e)==="right"?(openBlock(),createElementBlock("div",{key:1,class:"absolute top-0 z-10 left-0 w-1 h-full cursor-col-resize",onMousedown:k},null,32)):createCommentVNode("",!0)]))}}),_sfc_main$e=defineComponent({__name:"Collapsible",props:{defaultOpen:{type:Boolean},open:{type:Boolean},disabled:{type:Boolean},asChild:{type:Boolean},as:{}},emits:["update:open"],setup(r,{emit:e}){const n=xe(r,e);return(o,s)=>(openBlock(),createBlock(unref(ji),normalizeProps(guardReactiveProps(unref(n))),{default:withCtx(({open:a})=>[renderSlot(o.$slots,"default",{open:a})]),_:3},16))}}),_sfc_main$d=defineComponent({__name:"CollapsibleContent",props:{forceMount:{type:Boolean},asChild:{type:Boolean},as:{}},setup(r){const e=r;return(n,o)=>(openBlock(),createBlock(unref(qi),mergeProps(e,{class:"overflow-hidden transition-all data-[state=closed]:animate-collapsible-up data-[state=open]:animate-collapsible-down"}),{default:withCtx(()=>[renderSlot(n.$slots,"default")]),_:3},16))}}),_sfc_main$c=defineComponent({__name:"CollapsibleTrigger",props:{asChild:{type:Boolean},as:{}},setup(r){const e=r;return(n,o)=>(openBlock(),createBlock(unref(Ui),normalizeProps(guardReactiveProps(e)),{default:withCtx(()=>[renderSlot(n.$slots,"default")]),_:3},16))}}),_hoisted_1$8=["data-active"],_hoisted_2$3={class:"whitespace-nowrap overflow-hidden text-ellipsis"},_sfc_main$b=defineComponent({__name:"FileTreeItem",props:{dirent:{},path:{}},setup(r){const e=ref(!1),{activeDirent:n}=AttachmentsManagerContext.useContext(),o=(s,a)=>{n.value={path:a,isDirectory:s.isDirectory,isPreview:!1}};return(s,a)=>{const l=resolveComponent("FileTreeItem",!0);return openBlock(),createBlock(unref(_sfc_main$e),{open:e.value,"onUpdate:open":a[1]||(a[1]=c=>e.value=c)},{default:withCtx(()=>[createVNode(unref(_sfc_main$c),{"as-child":""},{default:withCtx(()=>{var c;return[createBaseVNode("div",{"data-active":s.path===((c=unref(n))==null?void 0:c.path),onClick:a[0]||(a[0]=d=>o(s.dirent,s.path)),class:"flex items-center px-2 py-1 my-0.5 cursor-default select-none hover:bg-muted rounded-sm text-sm data-[active=true]:bg-muted"},[s.dirent.isDirectory?(openBlock(),createBlock(unref(ChevronDown),{key:0,class:normalizeClass(["size-4 mr-2 flex-shrink-0 transition-transform duration-50",{"-rotate-90":!e.value}])},null,8,["class"])):(openBlock(),createBlock(unref(File),{key:1,class:"size-4 mr-2 flex-shrink-0"})),createBaseVNode("span",_hoisted_2$3,toDisplayString(s.dirent.name),1)],8,_hoisted_1$8)]}),_:1}),s.dirent.isDirectory?(openBlock(),createBlock(unref(_sfc_main$d),{key:0,class:"ml-6"},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment$1,null,renderList(s.dirent.subDirents,c=>(openBlock(),createBlock(l,{key:c.name,dirent:c,path:unref(joinPathSegments)([s.path,c.name])},null,8,["dirent","path"]))),128))]),_:1})):createCommentVNode("",!0)]),_:1},8,["open"])}}}),_hoisted_1$7={class:"flex-1 overflow-auto pr-1 mb-2"},_hoisted_2$2={key:0,class:"text-center text-sm text-muted-foreground py-8"},_hoisted_3$2={class:"mr-1 flex gap-x-1"},_sfc_main$a=defineComponent({__name:"FileTree",setup(r){const{attachmentsFolderName:e,attachmentsBasePath:n,currentPathSegments:o,orderedFiles:s,refetchFiles:a}=AttachmentsManagerContext.useContext(),l=ref("idle");async function c(){l.value="loading",await Promise.all([a(),timeout(1e3)]),l.value="updated",await timeout(1e3),l.value="idle"}return(d,u)=>(openBlock(),createElementBlock("div",{class:normalizeClass(["w-[250px] bg-sidebar-bg border-r p-2 pr-1 flex flex-col justify-between text-sidebar-fg",{"opacity-50":l.value==="loading"}])},[createVNode(unref(_sfc_main$1d),{class:"bg-sidebar-accent w-fit px-2 py-1.5 mr-1 mb-2 rounded overflow-hidden"},{default:withCtx(()=>[createVNode(unref(_sfc_main$1a),{class:"flex-nowrap w-fit gap-1 sm:gap-1 overflow-hidden"},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment$1,null,renderList([unref(e),...unref(o)],(m,f)=>(openBlock(),createElementBlock(Fragment$1,{key:m},[createVNode(unref(_sfc_main$1c),{class:"cursor-pointer select-none hover:text-sidebar-fg transition-colors duration-50"},{default:withCtx(()=>[createTextVNode(toDisplayString(m),1)]),_:2},1024),f!==unref(o).length?(openBlock(),createBlock(unref(_sfc_main$19),{key:0,class:"size-3"})):createCommentVNode("",!0)],64))),128))]),_:1})]),_:1}),createBaseVNode("div",_hoisted_1$7,[(openBlock(!0),createElementBlock(Fragment$1,null,renderList(unref(s),m=>(openBlock(),createBlock(_sfc_main$b,{key:m.name,dirent:m,path:unref(joinPathSegments)([unref(n),...unref(o),m.name])},null,8,["dirent","path"]))),128)),Object.keys(unref(s)).length===0?(openBlock(),createElementBlock("div",_hoisted_2$2,toDisplayString(d.$t("kbView.attachmentsManager.noFiles")),1)):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_3$2,[createVNode(unref(_sfc_main$1I),{variant:"outline",class:"size-9 flex-shrink-0 p-0",disabled:l.value==="loading",onClick:c},{default:withCtx(()=>[createVNode(unref(RefreshCw),{class:normalizeClass(["size-4",{"animate-spin":l.value==="loading"}])},null,8,["class"])]),_:1},8,["disabled"]),createVNode(unref(_sfc_main$1I),{variant:"outline",size:"sm",class:"w-full"},{default:withCtx(()=>[createVNode(unref(Upload),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(d.$t("kbView.attachmentsManager.upload")),1)]),_:1})])],2))}}),_sfc_main$9={},_hoisted_1$6={t:"1730332855813",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2264",width:"200",height:"200"};function _sfc_render$4(r,e){return openBlock(),createElementBlock("svg",_hoisted_1$6,e[0]||(e[0]=[createBaseVNode("path",{d:"M912 217.142857q16 16 27.428571 43.428571t11.428571 50.285714l0 658.285714q0 22.857143-16 38.857143t-38.857143 16l-768 0q-22.857143 0-38.857143-16t-16-38.857143l0-914.285714q0-22.857143 16-38.857143t38.857143-16l512 0q22.857143 0 50.285714 11.428571t43.428571 27.428571zm-253.714286-139.428571l0 214.857143 214.857143 0q-5.714286-16.571429-12.571429-23.428571l-178.857143-178.857143q-6.857143-6.857143-23.428571-12.571429zm219.428571 873.142857l0-585.142857-237.714286 0q-22.857143 0-38.857143-16t-16-38.857143l0-237.714286-438.857143 0 0 877.714286 731.428571 0zm-450.285714-465.142857q11.428571 4.571429 11.428571 17.142857l0 310.857143q0 12.571429-11.428571 17.142857-4.571429 1.142857-6.857143 1.142857-6.857143 0-13.142857-5.142857l-94.857143-95.428571-74.857143 0q-8 0-13.142857-5.142857t-5.142857-13.142857l0-109.714286q0-8 5.142857-13.142857t13.142857-5.142857l74.857143 0 94.857143-95.428571q9.142857-8.571429 20-4zm238.285714 393.714286q17.714286 0 28.571429-13.714286 73.714286-90.857143 73.714286-207.428571t-73.714286-207.428571q-9.142857-12-24.571429-13.714286t-26.857143 8q-12 9.714286-13.428571 24.857143t8.285714 27.142857q57.142857 70.285714 57.142857 161.142857t-57.142857 161.142857q-9.714286 12-8.285714 27.142857t13.428571 24.285714q10.285714 8.571429 22.857143 8.571429zm-120.571429-84.571429q15.428571 0 26.857143-11.428571 49.714286-53.142857 49.714286-125.142857t-49.714286-125.142857q-10.285714-10.857143-25.714286-11.428571t-26.285714 9.714286-11.428571 25.428571 10.285714 26.571429q29.714286 32.571429 29.714286 74.857143t-29.714286 74.857143q-10.857143 11.428571-10.285714 26.571429t11.428571 25.428571q11.428571 9.714286 25.142857 9.714286z",fill:"currentColor","p-id":"2265"},null,-1)]))}const Audio=_export_sfc(_sfc_main$9,[["render",_sfc_render$4]]),_sfc_main$8={},_hoisted_1$5={t:"1730332795021",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"1970",width:"200",height:"200"};function _sfc_render$3(r,e){return openBlock(),createElementBlock("svg",_hoisted_1$5,e[0]||(e[0]=[createBaseVNode("path",{d:"M917.8112 229.0688c-22.20032-30.28992-53.16608-65.69984-87.18336-99.69664s-69.40672-64.96256-99.69664-87.18336c-51.56864-37.82656-76.5952-42.1888-90.9312-42.1888l-496.00512 0c-44.11392 0-79.99488 35.88096-79.99488 79.99488l0 864.01024c0 44.11392 35.88096 79.99488 79.99488 79.99488l736.01024 0c44.11392 0 79.99488-35.88096 79.99488-79.99488l0-624.00512c0-14.336-4.36224-39.34208-42.1888-90.9312l0 0 0 0zM785.36704 174.63296c30.69952 30.69952 54.80448 58.38848 72.58112 81.36704l-153.94816 0 0-153.94816c22.97856 17.77664 50.688 41.8816 81.36704 72.58112l0 0 0 0zM896 944.00512c0 8.66304-7.33184 15.99488-15.99488 15.99488l-736.01024 0c-8.66304 0-15.99488-7.33184-15.99488-15.99488l0-864.01024c0-8.66304 7.33184-15.99488 15.99488-15.99488 0 0 495.96416 0 496.00512 0l0 224.01024c0 17.67424 14.31552 32.01024 32.01024 32.01024l224.01024 0 0 624.00512zM256 64l128 0 0 64-128 0 0-64zM384 128l128 0 0 64-128 0 0-64zM256 192l128 0 0 64-128 0 0-64zM384 256l128 0 0 64-128 0 0-64zM256 320l128 0 0 64-128 0 0-64zM384 384l128 0 0 64-128 0 0-64zM256 448l128 0 0 64-128 0 0-64zM384 512l128 0 0 64-128 0 0-64zM256 847.99488c0 26.39872 21.6064 48.00512 48.00512 48.00512l160.01024 0c26.39872 0 48.00512-21.6064 48.00512-48.00512l0-160.01024c0-26.39872-21.6064-48.00512-48.00512-48.00512l-79.99488 0 0-64-128 0 0 271.99488zM448 768l0 64-128 0 0-64 128 0z",fill:"currentColor","p-id":"1971"},null,-1)]))}const Compressed=_export_sfc(_sfc_main$8,[["render",_sfc_render$3]]),_sfc_main$7={},_hoisted_1$4={t:"1730332732861",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"1676",width:"200",height:"200"};function _sfc_render$2(r,e){return openBlock(),createElementBlock("svg",_hoisted_1$4,e[0]||(e[0]=[createBaseVNode("path",{d:"M832 896l-640 0 0-128 192-320 263.00416 320 184.99584-128 0 256zM832 480.01024c0 53.02272-42.98752 96.01024-96.01024 96.01024s-96.01024-42.98752-96.01024-96.01024 42.98752-96.01024 96.01024-96.01024c53.02272 0 96.01024 42.98752 96.01024 96.01024zM917.8112 229.0688c-22.2208-30.28992-53.16608-65.69984-87.18336-99.69664s-69.40672-64.96256-99.69664-87.18336c-51.56864-37.82656-76.5952-42.1888-90.9312-42.1888l-496.00512 0c-44.11392 0-79.99488 35.88096-79.99488 79.99488l0 864.01024c0 44.11392 35.88096 79.99488 79.99488 79.99488l736.01024 0c44.11392 0 79.99488-35.88096 79.99488-79.99488l0-624.00512c0-14.336-4.36224-39.34208-42.1888-90.9312zM785.36704 174.63296c30.69952 30.69952 54.80448 58.38848 72.58112 81.36704l-153.94816 0 0-153.94816c22.97856 17.77664 50.688 41.8816 81.36704 72.58112zM896 944.00512c0 8.66304-7.33184 15.99488-15.99488 15.99488l-736.01024 0c-8.66304 0-15.99488-7.33184-15.99488-15.99488l0-864.01024c0-8.66304 7.33184-15.99488 15.99488-15.99488 0 0 495.96416 0 496.00512 0l0 224.01024c0 17.67424 14.336 32.01024 32.01024 32.01024l224.01024 0 0 624.00512z",fill:"currentColor","p-id":"1677"},null,-1)]))}const Image=_export_sfc(_sfc_main$7,[["render",_sfc_render$2]]),_sfc_main$6={},_hoisted_1$3={t:"1730332828563",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2117",width:"200",height:"200"};function _sfc_render$1(r,e){return openBlock(),createElementBlock("svg",_hoisted_1$3,e[0]||(e[0]=[createBaseVNode("path",{d:"M842.01472 589.47584c-13.63968-13.45536-43.90912-20.56192-89.96864-21.17632-31.17056-0.34816-68.7104 2.39616-108.17536 7.92576-17.67424-10.19904-35.90144-21.2992-50.19648-34.65216-38.46144-35.92192-70.57408-85.77024-90.58304-140.5952 1.31072-5.12 2.41664-9.6256 3.44064-14.21312 0 0 21.66784-123.06432 15.93344-164.6592-0.79872-5.71392-1.26976-7.35232-2.80576-11.79648l-1.88416-4.83328c-5.89824-13.59872-17.44896-27.99616-35.57376-27.21792l-10.91584-0.34816c-20.19328 0-36.6592 10.32192-40.98048 25.76384-13.14816 48.4352 0.4096 120.89344 24.9856 214.7328l-6.28736 15.27808c-17.59232 42.88512-39.6288 86.05696-59.0848 124.14976l-2.51904 4.95616c-20.45952 40.0384-39.03488 74.0352-55.84896 102.83008l-17.36704 9.19552c-1.26976 0.67584-31.04768 16.42496-38.03136 20.64384-59.24864 35.38944-98.52928 75.55072-105.04192 107.4176-2.06848 10.17856-0.53248 23.18336 10.01472 29.20448l16.81408 8.45824c7.29088 3.64544 14.97088 5.50912 22.85568 5.50912 42.20928 0 91.19744-52.57216 158.69952-170.37312 77.9264-25.37472 166.64576-46.44864 244.40832-58.08128 59.24864 33.36192 132.13696 56.54528 178.13504 56.54528 8.17152 0 15.21664-0.77824 20.93056-2.29376 8.82688-2.33472 16.26112-7.3728 20.7872-14.19264 8.92928-13.43488 10.73152-31.92832 8.31488-50.87232-0.7168-5.632-5.20192-12.57472-10.07616-17.32608zM211.64032 814.03904c7.70048-21.03296 38.15424-62.64832 83.21024-99.55328 2.82624-2.29376 9.80992-8.82688 16.19968-14.90944-47.104 75.12064-78.6432 105.0624-99.40992 114.46272zM478.43328 199.68c13.55776 0 21.27872 34.2016 21.93408 66.2528s-6.8608 54.55872-16.15872 71.20896c-7.70048-24.65792-11.42784-63.50848-11.42784-88.90368 0 0-0.57344-48.55808 5.65248-48.55808l0 0zM398.848 637.50144c9.44128-16.91648 19.29216-34.75456 29.32736-53.67808 24.49408-46.32576 39.95648-82.55488 51.48672-112.35328 22.91712 41.6768 51.44576 77.12768 84.992 105.51296 4.17792 3.54304 8.62208 7.10656 13.27104 10.6496-68.21888 13.49632-127.16032 29.9008-179.07712 49.8688l0 0zM828.90752 633.6512c-4.15744 2.60096-16.05632 4.096-23.71584 4.096-24.69888 0-55.27552-11.28448-98.11968-29.67552 16.46592-1.20832 31.55968-1.8432 45.09696-1.8432 24.7808 0 32.11264-0.1024 56.34048 6.06208s24.53504 18.7392 20.3776 21.34016l0 0zM917.8112 229.0688c-22.20032-30.28992-53.16608-65.69984-87.18336-99.69664s-69.40672-64.96256-99.69664-87.18336c-51.56864-37.82656-76.5952-42.1888-90.9312-42.1888l-496.00512 0c-44.11392 0-79.99488 35.88096-79.99488 79.99488l0 864.01024c0 44.11392 35.88096 79.99488 79.99488 79.99488l736.01024 0c44.11392 0 79.99488-35.88096 79.99488-79.99488l0-624.00512c0-14.336-4.36224-39.34208-42.1888-90.9312l0 0zM785.36704 174.63296c30.69952 30.69952 54.80448 58.38848 72.58112 81.36704l-153.94816 0 0-153.94816c22.97856 17.77664 50.688 41.8816 81.36704 72.58112l0 0zM896 944.00512c0 8.66304-7.33184 15.99488-15.99488 15.99488l-736.01024 0c-8.66304 0-15.99488-7.33184-15.99488-15.99488l0-864.01024c0-8.66304 7.33184-15.99488 15.99488-15.99488 0 0 495.96416 0 496.00512 0l0 224.01024c0 17.67424 14.31552 32.01024 32.01024 32.01024l224.01024 0 0 624.00512z",fill:"currentColor","p-id":"2118"},null,-1)]))}const Pdf=_export_sfc(_sfc_main$6,[["render",_sfc_render$1]]),_sfc_main$5={},_hoisted_1$2={t:"1730332771789",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"1823",width:"200",height:"200"};function _sfc_render(r,e){return openBlock(),createElementBlock("svg",_hoisted_1$2,e[0]||(e[0]=[createBaseVNode("path",{d:"M639.77472 475.89376l44.21632 0-51.01568 226.18112-66.31424-318.01344-106.55744 0-77.1072 318.01344-57.81504-318.01344-111.39072 0 113.09056 511.87712 108.83072 0 76.288-302.71488 68.25984 302.71488 100.33152 0 129.61792-511.87712-170.45504 0 0 91.83232zM917.8112 229.0688c-22.20032-30.28992-53.16608-65.69984-87.18336-99.69664s-69.40672-64.96256-99.69664-87.18336c-51.56864-37.82656-76.5952-42.1888-90.9312-42.1888l-496.00512 0c-44.11392 0-79.99488 35.88096-79.99488 79.99488l0 864.01024c0 44.11392 35.88096 79.99488 79.99488 79.99488l736.01024 0c44.11392 0 79.99488-35.88096 79.99488-79.99488l0-624.00512c0-14.336-4.36224-39.34208-42.1888-90.9312l0 0zM785.36704 174.63296c30.69952 30.69952 54.80448 58.38848 72.58112 81.36704l-153.94816 0 0-153.94816c22.97856 17.77664 50.688 41.8816 81.36704 72.58112l0 0zM896 944.00512c0 8.66304-7.33184 15.99488-15.99488 15.99488l-736.01024 0c-8.66304 0-15.99488-7.33184-15.99488-15.99488l0-864.01024c0-8.66304 7.33184-15.99488 15.99488-15.99488 0 0 495.96416 0 496.00512 0l0 224.01024c0 17.67424 14.31552 32.01024 32.01024 32.01024l224.01024 0 0 624.00512z",fill:"currentColor","p-id":"1824"},null,-1)]))}const Word=_export_sfc(_sfc_main$5,[["render",_sfc_render]]),_hoisted_1$1={key:0,class:"flex items-center"},_hoisted_2$1={key:1,class:"flex flex-col items-center gap-y-4"},_hoisted_3$1=["src"],_hoisted_4$1={class:"flex items-center gap-x-2"},_hoisted_5={key:2},_sfc_main$4=defineComponent({__name:"ImagePreviewPane",props:{image:{}},emits:["close","insertImage","download","reference","delete"],setup(r,{emit:e}){return(n,o)=>n.image.status==="fetching"?(openBlock(),createElementBlock("div",_hoisted_1$1,[createVNode(unref(LoaderCircle),{class:"size-4 mr-2 animate-spin"}),createTextVNode(" "+toDisplayString(n.$t("kbView.attachmentsManager.previewPane.fetchingImage")),1)])):n.image.status==="synced"?(openBlock(),createElementBlock("div",_hoisted_2$1,[createBaseVNode("img",{src:n.image.url,class:"max-w-full max-h-full"},null,8,_hoisted_3$1),createBaseVNode("div",_hoisted_4$1,[createVNode(unref(_sfc_main$1I),{variant:"outline",size:"sm",onClick:o[0]||(o[0]=s=>n.$emit("close"))},{default:withCtx(()=>[createVNode(unref(X),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(n.$t("kbView.attachmentsManager.previewPane.closePreview")),1)]),_:1}),createVNode(unref(_sfc_main$1I),{variant:"outline",size:"sm",onClick:o[1]||(o[1]=s=>n.$emit("insertImage"))},{default:withCtx(()=>[createVNode(unref(Image$1),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(n.$t("kbView.attachmentsManager.previewPane.insertImage")),1)]),_:1}),createVNode(unref(_sfc_main$1r),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1k),{"as-child":""},{default:withCtx(()=>[createVNode(unref(_sfc_main$1I),{variant:"outline",size:"sm",class:"size-9 p-0"},{default:withCtx(()=>[createVNode(unref(Ellipsis),{class:"size-4"})]),_:1})]),_:1}),createVNode(unref(_sfc_main$1q),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1o),{onClick:o[2]||(o[2]=s=>n.$emit("download"))},{default:withCtx(()=>[createVNode(unref(Download),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(n.$t("kbView.attachmentsManager.previewPane.download")),1)]),_:1}),createVNode(unref(_sfc_main$1o),{onClick:o[3]||(o[3]=s=>n.$emit("reference"))},{default:withCtx(()=>[createVNode(unref(Link2),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(n.$t("kbView.attachmentsManager.previewPane.reference")),1)]),_:1}),createVNode(unref(_sfc_main$1o),{class:"!text-red-500",onClick:o[4]||(o[4]=s=>n.$emit("delete"))},{default:withCtx(()=>[createVNode(unref(Trash2),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(n.$t("kbView.attachmentsManager.previewPane.delete")),1)]),_:1})]),_:1})]),_:1})])])):n.image.status==="fetchError"?(openBlock(),createElementBlock("div",_hoisted_5,toDisplayString(n.$t("kbView.attachmentsManager.previewPane.fetchImageError")),1)):createCommentVNode("",!0)}}),imageExtnames=["png","jpg","jpeg","gif","bmp","webp"],audioExtnames=["mp3","wav","m4a"],videoExtnames=["mp4","webm","ogg"];function isImage(r){return imageExtnames.includes(r)}function isAudio(r){return audioExtnames.includes(r)}function isVideo(r){return videoExtnames.includes(r)}let _hoisted_1,_hoisted_2,_hoisted_3,_hoisted_4,_sfc_main$3,_sfc_main$2,_sfc_main$1,ImageEditorContext,MenubarContext,_sfc_main;_hoisted_1={class:"flex items-center justify-center flex-grow"},_hoisted_2={key:0,class:"flex flex-col items-center text-muted-foreground gap-y-6"},_hoisted_3={class:"text-sm break-all px-8"},_hoisted_4={class:"flex items-center justify-center flex-wrap gap-2"},_sfc_main$3=defineComponent({__name:"PreviewPane",setup(r){const{blockEditor:e}=BlocksContext.useContext(),n=useTaskQueue(),{serverUrl:o}=ServerInfoContext.useContext(),{useImage:s}=ImagesContext.useContext(),{attachmentsBasePath:a,activeDirent:l,open:c}=AttachmentsManagerContext.useContext(),{lastFocusedBlockTree:d,lastFocusedDiId:u}=LastFocusContext.useContext(),{blocksManager:m}=BlocksContext.useContext(),f=computed(()=>{const x=a.value;if(!l.value)return null;const v=l.value.path,_=getSeperator(),E=l.value.isDirectory?void 0:l.value.path.split(".").pop(),N=l.value.isDirectory?void 0:v.split(_).pop();return{isDirectory:l.value.isDirectory,isPreview:l.value.isPreview,absolutePath:v,relativePath:v.slice(x.length+1),extname:E,fileNameAndExtname:N,isImage:E&&isImage(E),isAudio:E&&isAudio(E),isVideo:E&&isVideo(E)}}),p=s(()=>{var x;return(x=f.value)!=null&&x.isImage?f.value.relativePath:null}),g=computed(()=>{if(!l.value)return null;if(l.value.isDirectory)return Folder;const x=l.value.path.split(".").pop();return x==="mp3"||x==="wav"||x==="m4a"?Audio:x==="zip"||x==="rar"||x==="7z"?Compressed:x==="png"||x==="jpg"||x==="jpeg"||x==="gif"||x==="bmp"||x==="webp"?Image:x==="pdf"?Pdf:x==="doc"||x==="docx"?Word:File}),y=computed(()=>!f.value||!f.value.extname?!1:f.value.isAudio||f.value.isVideo||f.value.isImage||["pdf","doc","docx"].includes(f.value.extname)),b=()=>{l.value&&(l.value.isPreview=!l.value.isPreview)},k=x=>{const v=d.value,_=u.value;if(!v||!_)return;const E=v.getDi(_),N=v.getEditorView(_);if(!E||!DI_FILTERS.isBlockDi(E)||!(N instanceof EditorView$1||N instanceof EditorView))return;const I=E.block.id;if(!I)return;const L=[BLOCK_CONTENT_TYPES.IMAGE,x,"left",null,null,[]],A=N instanceof EditorView$1&&N.state.doc.content.size===0,F=N instanceof EditorView&&N.state.doc.length===0;A||F?n.addTask(()=>{e.changeBlockContent({blockId:I,content:L}),c.value=!1}):n.addTask(()=>{const se={baseBlockId:I,offset:1};e.insertNormalBlock({pos:se,content:L})})},w=async x=>{const v=await fsGetAttachmentSignedUrl({path:x});if(!v.success)return;const _=v.data.signedUrl,E=document.createElement("a");E.href=`http://${o.value}${_}`,E.download=x,E.click()},B=async x=>{},M=x=>{const v=d.value,_=u.value;if(!v||!_)return;const E=v.getEditorView(_);if(!x||!(E instanceof EditorView$1))return;const N={getBlockRef:m.getBlockRef},I=getPmSchema(N).nodes.pathRef.create({path:x}),L=E.state.tr.replaceSelectionWith(I);E.dispatch(L)};return(x,v)=>(openBlock(),createElementBlock("div",_hoisted_1,[unref(l)?(openBlock(),createElementBlock("div",_hoisted_2,[f.value&&f.value.isPreview?(openBlock(),createElementBlock(Fragment$1,{key:0},[f.value.isImage&&unref(p)?(openBlock(),createBlock(_sfc_main$4,{key:0,image:unref(p),onClose:b,onInsertImage:v[0]||(v[0]=_=>k(f.value.relativePath)),onDownload:v[1]||(v[1]=_=>w(f.value.absolutePath)),onReference:v[2]||(v[2]=_=>M(f.value.relativePath)),onDelete:v[3]||(v[3]=_=>B(f.value.absolutePath))},null,8,["image"])):createCommentVNode("",!0)],64)):f.value?(openBlock(),createElementBlock(Fragment$1,{key:1},[(openBlock(),createBlock(resolveDynamicComponent(g.value),{class:"size-20"})),createBaseVNode("div",_hoisted_3,toDisplayString(f.value.fileNameAndExtname),1),createBaseVNode("div",_hoisted_4,[f.value.isImage?(openBlock(),createElementBlock(Fragment$1,{key:0},[createVNode(unref(_sfc_main$1I),{variant:"outline",size:"sm",onClick:b},{default:withCtx(()=>[createVNode(unref(Eye),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(x.$t("kbView.attachmentsManager.previewPane.openPreview")),1)]),_:1}),createVNode(unref(_sfc_main$1I),{variant:"outline",size:"sm",onClick:v[4]||(v[4]=_=>k(f.value.relativePath))},{default:withCtx(()=>[createVNode(unref(Image$1),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(x.$t("kbView.attachmentsManager.previewPane.insertImage")),1)]),_:1}),createVNode(unref(_sfc_main$1r),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1k),{"as-child":""},{default:withCtx(()=>[createVNode(unref(_sfc_main$1I),{variant:"outline",size:"sm",class:"size-9 p-0"},{default:withCtx(()=>[createVNode(unref(Ellipsis),{class:"size-4"})]),_:1})]),_:1}),createVNode(unref(_sfc_main$1q),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1o),null,{default:withCtx(()=>[createVNode(unref(Info),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(x.$t("kbView.attachmentsManager.previewPane.info")),1)]),_:1}),createVNode(unref(_sfc_main$1o),{onClick:v[5]||(v[5]=_=>w(unref(l).path))},{default:withCtx(()=>[createVNode(unref(Download),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(x.$t("kbView.attachmentsManager.previewPane.download")),1)]),_:1}),createVNode(unref(_sfc_main$1o),null,{default:withCtx(()=>[createVNode(unref(Link2),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(x.$t("kbView.attachmentsManager.previewPane.reference")),1)]),_:1}),createVNode(unref(_sfc_main$1o),{class:"!text-red-500",onClick:v[6]||(v[6]=_=>B(unref(l).path))},{default:withCtx(()=>[createVNode(unref(Trash2),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(x.$t("kbView.attachmentsManager.previewPane.delete")),1)]),_:1})]),_:1})]),_:1})],64)):y.value?(openBlock(),createElementBlock(Fragment$1,{key:1},[createVNode(unref(_sfc_main$1I),{variant:"outline",size:"sm",onClick:b},{default:withCtx(()=>[createVNode(unref(Eye),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(x.$t("kbView.attachmentsManager.previewPane.openPreview")),1)]),_:1}),createVNode(unref(_sfc_main$1I),{variant:"outline",size:"sm",onClick:v[7]||(v[7]=_=>w(unref(l).path))},{default:withCtx(()=>[createVNode(unref(Download),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(x.$t("kbView.attachmentsManager.previewPane.download")),1)]),_:1}),createVNode(unref(_sfc_main$1I),{variant:"outline",size:"sm",onClick:v[8]||(v[8]=_=>M(f.value.relativePath))},{default:withCtx(()=>[createVNode(unref(Link2),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(x.$t("kbView.attachmentsManager.previewPane.pathReference")),1)]),_:1}),createVNode(unref(_sfc_main$1r),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1k),{"as-child":""},{default:withCtx(()=>[createVNode(unref(_sfc_main$1I),{variant:"outline",size:"sm",class:"size-9 p-0"},{default:withCtx(()=>[createVNode(unref(Ellipsis),{class:"size-4"})]),_:1})]),_:1}),createVNode(unref(_sfc_main$1q),null,{default:withCtx(()=>[createVNode(unref(_sfc_main$1o),null,{default:withCtx(()=>[createVNode(unref(Info),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(x.$t("kbView.attachmentsManager.previewPane.info")),1)]),_:1}),createVNode(unref(_sfc_main$1o),{onClick:v[9]||(v[9]=_=>w(unref(l).path))},{default:withCtx(()=>[createVNode(unref(Link2),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(x.$t("kbView.attachmentsManager.previewPane.reference")),1)]),_:1}),createVNode(unref(_sfc_main$1o),{class:"!text-red-500",onClick:v[10]||(v[10]=_=>B(unref(l).path))},{default:withCtx(()=>[createVNode(unref(Trash2),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(x.$t("kbView.attachmentsManager.previewPane.delete")),1)]),_:1})]),_:1})]),_:1})],64)):(openBlock(),createBlock(unref(_sfc_main$1I),{key:2,variant:"outline",size:"sm",onClick:v[11]||(v[11]=_=>M(f.value.relativePath))},{default:withCtx(()=>[createVNode(unref(Link2),{class:"size-4 mr-2"}),createTextVNode(" "+toDisplayString(x.$t("kbView.attachmentsManager.previewPane.pathReference")),1)]),_:1}))])],64)):createCommentVNode("",!0)])):createCommentVNode("",!0)]))}}),_sfc_main$2=defineComponent({__name:"AttachmentsManager",setup(r){const{open:e,files:n,refetchFiles:o,fetchFilesStatus:s,uploadStatus:a,currentPathSegments:l,dbBasePath:c}=AttachmentsManagerContext.useContext();return ref([]),onMounted(async()=>{await fsEnsureAttachmentsDir({}),await o()}),(d,u)=>(openBlock(),createBlock(unref(_sfc_main$1T),{open:unref(e),"onUpdate:open":u[0]||(u[0]=m=>isRef(e)?e.value=m:null)},{default:withCtx(()=>[createVNode(unref(_sfc_main$1S),{class:"flex flex-row max-w-[80vw] max-h-[80vh] w-[800px] h-[600px] p-0 !outline-none"},{default:withCtx(()=>[createVNode(unref(_sfc_main$1J),{class:"hidden"},{default:withCtx(()=>[createVNode(unref(_sfc_main$1K),null,{default:withCtx(()=>[createTextVNode(toDisplayString(d.$t("kbView.attachmentsManager.title")),1)]),_:1})]),_:1}),createVNode(_sfc_main$a),createVNode(_sfc_main$3)]),_:1})]),_:1},8,["open"]))}}),_sfc_main$1=defineComponent({__name:"KbViewContent",setup(r){const{sidePaneOpen:e,sidePaneDir:n,sidePaneWidth:o,sidePaneHeight:s,enableSidePaneAnimation:a}=SidebarContext.useContext(),{synced:l,blocksManager:c}=BlocksContext.useContext(),{mainRootBlockId:d}=MainTreeContext.useContext(),u=shallowRef(null);createCreateNewTreeDialogContext.useContext(),watch(l,(y,b)=>{!b&&y&&(c.getRootBlockRef().value==null?c.createNewTree():c.createBlockTransaction({type:"ui"}).commit())}),watch(d,y=>{const b=c.getBlockRef(y);syncRef(u,b,{direction:"rtl"})},{immediate:!0});const m=(y,b)=>{if(!(y instanceof HTMLElement))return;const k=y.animate([{opacity:1,transform:"translateX(0)"},{opacity:0,transform:"translateX(100%)"}],{duration:500,easing:"cubic-bezier(0.4, 0, 0.2, 1)"});k.onfinish=()=>{b()}},f=(y,b)=>{if(!(y instanceof HTMLElement))return;const k=y.animate([{opacity:0,transform:"translateX(100%)"},{opacity:1,transform:"translateX(0)"}],{duration:500,easing:"cubic-bezier(0.4, 0, 0.2, 1)"});k.onfinish=()=>{b()}},p=(y,b)=>{if(!(y instanceof HTMLElement))return;const k=y.animate([{opacity:1,transform:"translateY(0)"},{opacity:0,transform:"translateY(100%)"}],{duration:500,easing:"cubic-bezier(0.4, 0, 0.2, 1)"});k.onfinish=()=>{b()}},g=(y,b)=>{if(!(y instanceof HTMLElement))return;const k=y.animate([{opacity:0,transform:"translateY(100%)"},{opacity:1,transform:"translateY(0)"}],{duration:500,easing:"cubic-bezier(0.4, 0, 0.2, 1)"});k.onfinish=()=>{b()}};return(y,b)=>(openBlock(),createElementBlock(Fragment$1,null,[createVNode(_sfc_main$g),unref(l)&&u.value?(openBlock(),createBlock(_sfc_main$Z,{key:0,class:"h-[100vh] mr-1 ml-4",id:"main",style:normalizeStyle({paddingRight:unref(e)&&unref(n)==="right"?`${unref(o)}px`:"0px",paddingBottom:unref(e)&&unref(n)==="bottom"?`${unref(s)}px`:"0px",transition:unref(a)?"padding 500ms var(--tf)":"none"}),"root-block-id":u.value.id,"root-block-level":0,"padding-top":60,"enlarge-root-block":!0},null,8,["style","root-block-id"])):(openBlock(),createElementBlock("div",{key:1,class:"h-[100vh] mr-1 flex justify-center items-center text-muted-foreground",style:normalizeStyle({paddingRight:unref(e)&&unref(n)==="right"?`${unref(o)}px`:"0px",paddingBottom:unref(e)&&unref(n)==="bottom"?`${unref(s)}px`:"0px",transition:unref(a)?"padding 500ms var(--tf)":"none"})},[createVNode(unref(LoaderCircle),{class:"animate-spin mr-2"}),createTextVNode(" "+toDisplayString(y.$t("kbView.loadingKb")),1)],4)),createVNode(Transition,{onLeave:m,onEnter:f},{default:withCtx(()=>[unref(e)&&unref(n)==="right"?(openBlock(),createBlock(_sfc_main$f,{key:0,class:"absolute right-0 top-0 h-full border-l",style:normalizeStyle({width:`${unref(o)}px`})},null,8,["style"])):createCommentVNode("",!0)]),_:1}),createVNode(Transition,{onLeave:p,onEnter:g},{default:withCtx(()=>[unref(e)&&unref(n)==="bottom"?(openBlock(),createBlock(_sfc_main$f,{key:0,class:"absolute bottom-0 left-0 w-[100vw] border-t",style:normalizeStyle({height:`${unref(s)}px`})},null,8,["style"])):createCommentVNode("",!0)]),_:1}),createVNode(_sfc_main$B),createVNode(_sfc_main$z),createVNode(_sfc_main$U),createVNode(_sfc_main$2),createVNode(_sfc_main$C),createVNode(_sfc_main$1u),createVNode(_sfc_main$V),createVNode(_sfc_main$W),createVNode(_sfc_main$Y),createVNode(_sfc_main$X)],64))}}),ImageEditorContext=createContext(()=>{const r=ref(!0),e=ref("https://letsenhance.io/static/8f5e523ee6b2479e26ecc91b9c25261e/1015f/MainAfter.jpg"),n=ref(!1);return{open:r,imageUrl:e,deleteOriginal:n}}),MenubarContext=createContext(()=>({menuPaneOpen:ref(!1)})),_sfc_main=defineComponent({__name:"KbView",setup(r){return(e,n)=>(openBlock(),createBlock(unref(kbViewRegistry).Provider,null,{default:withCtx(()=>[createVNode(unref(MainTreeContext).Provider,null,{default:withCtx(()=>[createVNode(unref(MenubarContext).Provider,null,{default:withCtx(()=>[createVNode(unref(ImageEditorContext).Provider,null,{default:withCtx(()=>[createVNode(unref(SettingsContext).Provider,null,{default:withCtx(()=>[createVNode(unref(BasicSettingsContext).Provider,null,{default:withCtx(()=>[createVNode(unref(PathsContext).Provider,null,{default:withCtx(()=>[createVNode(unref(BlockTreeContext).Provider,null,{default:withCtx(()=>[createVNode(unref(PasteDialogContext).Provider,null,{default:withCtx(()=>[createVNode(unref(FocusModeContext).Provider,null,{default:withCtx(()=>[createVNode(unref(TimeMachineContext).Provider,null,{default:withCtx(()=>[createVNode(unref(FloatingMathInputContext).Provider,null,{default:withCtx(()=>[createVNode(unref(LastFocusContext).Provider,null,{default:withCtx(()=>[createVNode(unref(BlocksContext).Provider,null,{default:withCtx(()=>[createVNode(unref(ExporterContext).Provider,null,{default:withCtx(()=>[createVNode(unref(createCreateNewTreeDialogContext).Provider,null,{default:withCtx(()=>[createVNode(unref(IndexContext).Provider,null,{default:withCtx(()=>[createVNode(unref(AttachmentsManagerContext).Provider,null,{default:withCtx(()=>[createVNode(unref(ImagesContext).Provider,null,{default:withCtx(()=>[createVNode(unref(SidebarContext).Provider,null,{default:withCtx(()=>[createVNode(unref(KeymapContext).Provider,null,{default:withCtx(()=>[createVNode(unref(RefSuggestionsContext).Provider,null,{default:withCtx(()=>[createVNode(unref(BlockMoverContext).Provider,null,{default:withCtx(()=>[createVNode(unref(HistoryContext).Provider,null,{default:withCtx(()=>[createVNode(unref(BlockSelectDragContext).Provider,null,{default:withCtx(()=>[createVNode(unref(SettingsPanelContext).Provider,null,{default:withCtx(()=>[createVNode(unref(FavoriteContext).Provider,null,{default:withCtx(()=>[createVNode(unref(FieldsManagerContext).Provider,null,{default:withCtx(()=>[createVNode(unref(BacklinksContext).Provider,null,{default:withCtx(()=>[createVNode(unref(FloatingEditorContext).Provider,null,{default:withCtx(()=>[createVNode(unref(FieldValueInspectorContext).Provider,null,{default:withCtx(()=>[createVNode(unref(DailyNoteContext).Provider,null,{default:withCtx(()=>[createVNode(unref(FusionCommandContext).Provider,null,{default:withCtx(()=>[createVNode(_sfc_main$1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}}),KbView=Object.freeze(Object.defineProperty({__proto__:null,default:_sfc_main},Symbol.toStringTag,{value:"Module"}))});export{languageDataProp as A,foldService as B,CompletionContext as C,LanguageDescription as D,EditorView as E,ParseContext as F,bracketMatchingHandle as G,DefaultBufferLength as H,IterMode as I,sublanguageProp as J,KbView as K,LRLanguage as L,NodeWeakMap as N,Parser$1 as P,Tag as T,__tla,LanguageSupport as a,ifNotIn as b,continuedIndent as c,completeFromList as d,syntaxTree as e,foldNodeProp as f,flatIndent as g,delimitedIndent as h,indentNodeProp as i,foldInside as j,snippetCompletion as k,EditorSelection as l,NodeType as m,NodeProp as n,NodeSet as o,parseMixed as p,Tree as q,countColumn as r,styleTags as s,tags as t,Prec as u,keymap as v,EditorState as w,Language as x,indentUnit as y,defineLanguageFacet as z};
